{"version":3,"file":"avtranscoder.js","mappings":"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AAoB;IACpB,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;IAC9C,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;IAC9C,qBAAqB;IACrB,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;IAC9C,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;IAC9C,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;IAC9C,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;IAC9C,sBAAsB;IACtB,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;IAC9C,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,E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C,EAAE;YACX,qDAAY,CAAC,4BAA4B,GAAG,EAAE,0BAAC;SAChD;IACH,CAAC;IAEM,KAAK,CAAC,GAAqB,EAAE,GAAqB;QACvD,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAQ,eAAe,EAAE,GAAG,EAAE,GAAG,CAAC;IAC3D,CAAC;IAEM,KAAK;QACV,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC;QACjC,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE;QACrB,IAAI,CAAC,MAAM,GAAG,IAAI;IACpB,CAAC;IAEM,uBAAuB;QAC5B,OAAO,IAAI,CAAC,eAAe;IAC7B,CAAC;IAEM,wBAAwB;QAC7B,OAAO,IAAI,CAAC,gBAAgB;IAC9B,CAAC;CACF;;;;;;;;;;;AChHD;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;;;;;ACAA;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;UAEA;UACA;;;;;WCzBA;WACA;WACA;WACA;WACA;WACA,iCAAiC,WAAW;WAC5C;WACA;;;;;WCPA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;WACA;WACA;WACA;WACA;WACA;WACA;WACA,EAAE;WACF;;;;;WCRA;WACA;WACA;WACA;WACA;;;;;WCJA;WACA;WACA;WACA;WACA,GAAG;WACH;WACA;WACA,CAAC;;;;;WCPD;;;;;WCAA;WACA;WACA;WACA;WACA,uBAAuB,4BAA4B;WACnD;WACA;WACA;WACA,iBAAiB,oBAAoB;WACrC;WACA,mGAAmG,YAAY;WAC/G;WACA;WACA;WACA;WACA;;WAEA;WACA;WACA;WACA;WACA;WACA;;WAEA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA,mEAAmE,iCAAiC;WACpG;WACA;WACA;WACA;;;;;WCzCA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;WCNA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;;;;;WClBA;;WAEA;WACA;WACA;WACA;WACA;WACA;;WAEA;WACA;WACA;WACA,iCAAiC;;WAEjC;WACA;WACA;WACA,KAAK;WACL,eAAe;WACf;WACA;WACA;;WAEA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;;WAEA;;WAEA;;WAEA;;WAEA;;WAEA;;WAEA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA,MAAM,qBAAqB;WAC3B;WACA;WACA;WACA;WACA;WACA;;WAEA;;WAEA;WACA;WACA;;;;;UErFA;UACA;UACA;UACA","sources":["webpack://AVTranscoder/webpack/universalModuleDefinition","webpack://AVTranscoder/./src/audioresample/Resampler.ts","webpack://AVTranscoder/./src/avcodec/function/getAudioCodec.ts","webpack://AVTranscoder/./src/avcodec/function/getHardwarePreference.ts","webpack://AVTranscoder/./src/avcodec/function/getVideoCodec.ts","webpack://AVTranscoder/./src/avcodec/wasmcodec/AudioDecoder.ts","webpack://AVTranscoder/./src/avcodec/wasmcodec/AudioEncoder.ts","webpack://AVTranscoder/./src/avcodec/wasmcodec/VideoDecoder.ts","webpack://AVTranscoder/./src/avcodec/wasmcodec/VideoEncoder.ts","webpack://AVTranscoder/./src/avcodec/webcodec/AudioDecoder.ts","webpack://AVTranscoder/./src/avcodec/webcodec/AudioEncoder.ts","webpack://AVTranscoder/./src/avcodec/webcodec/VideoDecoder.ts","webpack://AVTranscoder/./src/avcodec/webcodec/VideoEncoder.ts","webpack://AVTranscoder/./src/avfilter/AVFilterNode.ts","webpack://AVTranscoder/./src/avfilter/AVInputNode.ts","webpack://AVTranscoder/./src/avfilter/AVOutputNode.ts","webpack://AVTranscoder/./src/avfilter/RangeFilterNode.ts","webpack://AVTranscoder/./src/avfilter/audio/ResampleFilterNode.ts","webpack://AVTranscoder/./src/avfilter/graph.ts","webpack://AVTranscoder/./src/avfilter/video/FramerateFilterNode.ts","webpack://AVTranscoder/./src/avfilter/video/ScaleFilterNode.ts","webpack://AVTranscoder/./src/avformat/AVFormatContext.ts","webpack://AVTranscoder/./src/avformat/AVStream.ts","webpack://AVTranscoder/./src/avformat/bsf/AVBSFilter.ts","webpack://AVTranscoder/./src/avformat/bsf/h2645/Annexb2AvccFilter.ts","webpack://AVTranscoder/./src/avformat/codecs/aac.ts","webpack://AVTranscoder/./src/avformat/codecs/av1.ts","webpack://AVTranscoder/./src/avformat/codecs/h264.ts","webpack://AVTranscoder/./src/avformat/codecs/hevc.ts","webpack://AVTranscoder/./src/avformat/codecs/mp3.ts","webpack://AVTranscoder/./src/avformat/codecs/opus.ts","webpack://AVTranscoder/./src/avformat/codecs/vp8.ts","webpack://AVTranscoder/./src/avformat/codecs/vp9.ts","webpack://AVTranscoder/./src/avformat/codecs/vvc.ts","webpack://AVTranscoder/./src/avformat/config.ts","webpack://AVTranscoder/./src/avformat/demux.ts","webpack://AVTranscoder/./src/avformat/dump.ts","webpack://AVTranscoder/./src/avformat/formats/OFormat.ts","webpack://AVTranscoder/./src/avformat/function/checkStreamParameters.ts","webpack://AVTranscoder/./src/avformat/mux.ts","webpack://AVTranscoder/./src/avnetwork/ioLoader/CustomIOLoader.ts","webpack://AVTranscoder/./src/avnetwork/ioLoader/FetchIOLoader.ts","webpack://AVTranscoder/./src/avnetwork/ioLoader/FileIOLoader.ts","webpack://AVTranscoder/./src/avnetwork/ioLoader/IOLoader.ts","webpack://AVTranscoder/./src/avpipeline/AudioDecodePipeline.ts","webpack://AVTranscoder/./src/avpipeline/AudioEncodePipeline.ts","webpack://AVTranscoder/./src/avpipeline/DemuxPipeline.ts","webpack://AVTranscoder/./src/avpipeline/IOPipeline.ts","webpack://AVTranscoder/./src/avpipeline/MuxPipeline.ts","webpack://AVTranscoder/./src/avpipeline/Pipeline.ts","webpack://AVTranscoder/./src/avpipeline/VideoDecodePipeline.ts","webpack://AVTranscoder/./src/avpipeline/VideoEncodePipeline.ts","webpack://AVTranscoder/./src/avpipeline/struct/stats.ts","webpack://AVTranscoder/./src/avtranscoder/AVTranscoder.ts","webpack://AVTranscoder/./src/avtranscoder/Controller.ts","webpack://AVTranscoder/./src/avtranscoder/eventType.ts","webpack://AVTranscoder/./src/avtranscoder/filter/AVFilterPipeline.ts","webpack://AVTranscoder/./src/avtranscoder/function/createMessageChannel.ts","webpack://AVTranscoder/./src/avutil/constant.ts","webpack://AVTranscoder/./src/avutil/error.ts","webpack://AVTranscoder/./src/avutil/function/analyzeAVFormat.ts","webpack://AVTranscoder/./src/avutil/function/audioData2AVFrame.ts","webpack://AVTranscoder/./src/avutil/function/avframe2AudioData.ts","webpack://AVTranscoder/./src/avutil/function/avframe2VideoFrame.ts","webpack://AVTranscoder/./src/avutil/function/avpacket2EncodedAudioChunk.ts","webpack://AVTranscoder/./src/avutil/function/avpacket2EncodedVideoChunk.ts","webpack://AVTranscoder/./src/avutil/function/compileResource.ts","webpack://AVTranscoder/./src/avutil/function/encodedAudioChunk2AVPacket.ts","webpack://AVTranscoder/./src/avutil/function/encodedVideoChunk2AVPacket.ts","webpack://AVTranscoder/./src/avutil/function/videoFrame2AVFrame.ts","webpack://AVTranscoder/./src/avutil/implement/AVFramePoolImpl.ts","webpack://AVTranscoder/./src/avutil/implement/AVPacketPoolImpl.ts","webpack://AVTranscoder/./src/avutil/pixelFormatDescriptor.ts","webpack://AVTranscoder/./src/avutil/sampleFormatDescriptor.ts","webpack://AVTranscoder/./src/avutil/stringEnum.ts","webpack://AVTranscoder/./src/avutil/struct/audiosample.ts","webpack://AVTranscoder/./src/avutil/struct/avbuffer.ts","webpack://AVTranscoder/./src/avutil/struct/avcodecparameters.ts","webpack://AVTranscoder/./src/avutil/struct/avdict.ts","webpack://AVTranscoder/./src/avutil/struct/avframe.ts","webpack://AVTranscoder/./src/avutil/struct/avpacket.ts","webpack://AVTranscoder/./src/avutil/struct/avpcmbuffer.ts","webpack://AVTranscoder/./src/avutil/struct/rational.ts","webpack://AVTranscoder/./src/avutil/util/av1syntax.ts","webpack://AVTranscoder/./src/avutil/util/avbuffer.ts","webpack://AVTranscoder/./src/avutil/util/avdict.ts","webpack://AVTranscoder/./src/avutil/util/avframe.ts","webpack://AVTranscoder/./src/avutil/util/avpacket.ts","webpack://AVTranscoder/./src/avutil/util/channel.ts","webpack://AVTranscoder/./src/avutil/util/codecparameters.ts","webpack://AVTranscoder/./src/avutil/util/common.ts","webpack://AVTranscoder/./src/avutil/util/expgolomb.ts","webpack://AVTranscoder/./src/avutil/util/intread.ts","webpack://AVTranscoder/./src/avutil/util/mem.ts","webpack://AVTranscoder/./src/avutil/util/nalu.ts","webpack://AVTranscoder/./src/avutil/util/pixel.ts","webpack://AVTranscoder/./src/avutil/util/rational.ts","webpack://AVTranscoder/./src/avutil/util/sample.ts","webpack://AVTranscoder/./src/avutil/util/serialize.ts","webpack://AVTranscoder/./src/cheap/allocator/AllocatorJS.ts","webpack://AVTranscoder/./src/cheap/allocator/Table.ts","webpack://AVTranscoder/./src/cheap/asm/memory.ts","webpack://AVTranscoder/./src/cheap/config.ts","webpack://AVTranscoder/./src/cheap/ctypeEnumImpl.ts","webpack://AVTranscoder/./src/cheap/ctypeEnumRead.ts","webpack://AVTranscoder/./src/cheap/ctypeEnumWrite.ts","webpack://AVTranscoder/./src/cheap/definedStruct.ts","webpack://AVTranscoder/./src/cheap/function/definedMetaProperty.ts","webpack://AVTranscoder/./src/cheap/heap.ts","webpack://AVTranscoder/./src/cheap/proxyStruct.ts","webpack://AVTranscoder/./src/cheap/stack.ts","webpack://AVTranscoder/./src/cheap/staticData.ts","webpack://AVTranscoder/./src/cheap/std/buffer/SafeUint8Array.ts","webpack://AVTranscoder/./src/cheap/std/collection/List.ts","webpack://AVTranscoder/./src/cheap/std/function/isPointer.ts","webpack://AVTranscoder/./src/cheap/std/make.ts","webpack://AVTranscoder/./src/cheap/std/memory.ts","webpack://AVTranscoder/./src/cheap/std/sizeof.ts","webpack://AVTranscoder/./src/cheap/std/string.ts","webpack://AVTranscoder/./src/cheap/std/structAccess.ts","webpack://AVTranscoder/./src/cheap/std/unmake.ts","webpack://AVTranscoder/./src/cheap/symbol.ts","webpack://AVTranscoder/./src/cheap/thread/asm/atomics.ts","webpack://AVTranscoder/./src/cheap/thread/atomics.ts","webpack://AVTranscoder/./src/cheap/thread/atomicsImpl.ts","webpack://AVTranscoder/./src/cheap/thread/cond.ts","webpack://AVTranscoder/./src/cheap/thread/initClass.ts","webpack://AVTranscoder/./src/cheap/thread/initFunction.ts","webpack://AVTranscoder/./src/cheap/thread/initModule.ts","webpack://AVTranscoder/./src/cheap/thread/mutex.ts","webpack://AVTranscoder/./src/cheap/thread/semaphore.ts","webpack://AVTranscoder/./src/cheap/thread/thread.ts","webpack://AVTranscoder/./src/cheap/typedef.ts","webpack://AVTranscoder/./src/cheap/webassembly/ThreadPool.ts","webpack://AVTranscoder/./src/cheap/webassembly/WebAssemblyRunner.ts","webpack://AVTranscoder/./src/cheap/webassembly/compiler.ts","webpack://AVTranscoder/./src/cheap/webassembly/runThread.ts","webpack://AVTranscoder/./src/cheap/webassembly/runtime/asm/libc.ts","webpack://AVTranscoder/./src/cheap/webassembly/runtime/asm/thread.ts","webpack://AVTranscoder/./src/cheap/webassembly/runtime/atomic.ts","webpack://AVTranscoder/./src/cheap/webassembly/runtime/clib.ts","webpack://AVTranscoder/./src/cheap/webassembly/runtime/pthread.ts","webpack://AVTranscoder/./src/cheap/webassembly/runtime/semaphore.ts","webpack://AVTranscoder/./src/cheap/webassembly/thread.ts","webpack://AVTranscoder/./src/common/event/CustomEvent.ts","webpack://AVTranscoder/./src/common/event/Emitter.ts","webpack://AVTranscoder/./src/common/function/checkVersion.ts","webpack://AVTranscoder/./src/common/function/concatTypeArray.ts","webpack://AVTranscoder/./src/common/function/debounce.ts","webpack://AVTranscoder/./src/common/function/execute.ts","webpack://AVTranscoder/./src/common/function/generateUUID.ts","webpack://AVTranscoder/./src/common/function/getTimestamp.ts","webpack://AVTranscoder/./src/common/function/isAudioWorklet.ts","webpack://AVTranscoder/./src/common/function/isDef.ts","webpack://AVTranscoder/./src/common/function/isLittleEndian.ts","webpack://AVTranscoder/./src/common/function/isNative.ts","webpack://AVTranscoder/./src/common/function/isWorker.ts","webpack://AVTranscoder/./src/common/function/nextTick.ts","webpack://AVTranscoder/./src/common/function/sourceLoad.ts","webpack://AVTranscoder/./src/common/function/split.ts","webpack://AVTranscoder/./src/common/function/toNumber.ts","webpack://AVTranscoder/./src/common/function/toString.ts","webpack://AVTranscoder/./src/common/helper/CommandQueue.ts","webpack://AVTranscoder/./src/common/interface/ArrayLike.ts","webpack://AVTranscoder/./src/common/io/BitReader.ts","webpack://AVTranscoder/./src/common/io/BitWriter.ts","webpack://AVTranscoder/./src/common/io/BufferReader.ts","webpack://AVTranscoder/./src/common/io/BufferWriter.ts","webpack://AVTranscoder/./src/common/io/FileIO.ts","webpack://AVTranscoder/./src/common/io/IOReader.ts","webpack://AVTranscoder/./src/common/io/IOWriter.ts","webpack://AVTranscoder/./src/common/io/IOWriterSync.ts","webpack://AVTranscoder/./src/common/io/SafeFileIO.ts","webpack://AVTranscoder/./src/common/math/align.ts","webpack://AVTranscoder/./src/common/math/gcd.ts","webpack://AVTranscoder/./src/common/network/FakeMessageChannel.ts","webpack://AVTranscoder/./src/common/network/IPCPort.ts","webpack://AVTranscoder/./src/common/network/NodeIPCPort.ts","webpack://AVTranscoder/./src/common/timer/Clock.ts","webpack://AVTranscoder/./src/common/timer/LoopTask.ts","webpack://AVTranscoder/./src/common/timer/Sleep.ts","webpack://AVTranscoder/./src/common/timer/Timer.ts","webpack://AVTranscoder/./src/common/timer/WorkerSetTimeout.ts","webpack://AVTranscoder/./src/common/timer/workerSetTimeoutTask.ts","webpack://AVTranscoder/./src/common/util/array.ts","webpack://AVTranscoder/./src/common/util/base32.ts","webpack://AVTranscoder/./src/common/util/base64.ts","webpack://AVTranscoder/./src/common/util/bigint.ts","webpack://AVTranscoder/./src/common/util/browser.ts","webpack://AVTranscoder/./src/common/util/constant.ts","webpack://AVTranscoder/./src/common/util/is.ts","webpack://AVTranscoder/./src/common/util/keypath.ts","webpack://AVTranscoder/./src/common/util/logger.ts","webpack://AVTranscoder/./src/common/util/object.ts","webpack://AVTranscoder/./src/common/util/os.ts","webpack://AVTranscoder/./src/common/util/string.ts","webpack://AVTranscoder/./src/common/util/support.ts","webpack://AVTranscoder/./src/common/util/text.ts","webpack://AVTranscoder/./src/common/util/url.ts","webpack://AVTranscoder/./src/common/util/wasm.ts","webpack://AVTranscoder/./src/videoscale/VideoScaler.ts","webpack://AVTranscoder/./src/cheap/asm/memory.asm","webpack://AVTranscoder/./src/cheap/thread/asm/atomics.asm","webpack://AVTranscoder/./src/cheap/webassembly/runtime/asm/libc.asm","webpack://AVTranscoder/./src/cheap/webassembly/runtime/asm/thread.asm","webpack://AVTranscoder/webpack/bootstrap","webpack://AVTranscoder/webpack/runtime/compat get default export","webpack://AVTranscoder/webpack/runtime/define property getters","webpack://AVTranscoder/webpack/runtime/ensure chunk","webpack://AVTranscoder/webpack/runtime/get javascript chunk filename","webpack://AVTranscoder/webpack/runtime/global","webpack://AVTranscoder/webpack/runtime/hasOwnProperty shorthand","webpack://AVTranscoder/webpack/runtime/load script","webpack://AVTranscoder/webpack/runtime/make namespace object","webpack://AVTranscoder/webpack/runtime/publicPath","webpack://AVTranscoder/webpack/runtime/jsonp chunk loading","webpack://AVTranscoder/webpack/before-startup","webpack://AVTranscoder/webpack/startup","webpack://AVTranscoder/webpack/after-startup"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"AVTranscoder\"] = factory();\n\telse\n\t\troot[\"AVTranscoder\"] = factory();\n})(self, () => {\nreturn ","/*\r\n * libmedia audio resampler\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVSampleFormat } from 'avutil/audiosamplefmt'\r\nimport { AVChannelLayout } from 'avutil/struct/audiosample'\r\nimport AVPCMBuffer from 'avutil/struct/avpcmbuffer'\r\nimport { WebAssemblyResource } from 'cheap/webassembly/compiler'\r\nimport WebAssemblyRunner from 'cheap/webassembly/WebAssemblyRunner'\r\nimport * as logger from 'common/util/logger'\r\n\r\nexport interface PCMParameters {\r\n  channels: int32\r\n  sampleRate: int32\r\n  format: AVSampleFormat\r\n  layout?: pointer<AVChannelLayout>\r\n}\r\n\r\nexport type ResamplerOptions = {\r\n  resource: WebAssemblyResource\r\n}\r\n\r\nexport default class Resampler {\r\n\r\n  private resampler: WebAssemblyRunner\r\n\r\n  private options: ResamplerOptions\r\n\r\n  private inputParameters: PCMParameters\r\n  private outputParameters: PCMParameters\r\n\r\n  constructor(options: ResamplerOptions) {\r\n    this.options = options\r\n\r\n    this.resampler = new WebAssemblyRunner(this.options.resource)\r\n\r\n  }\r\n\r\n  public async open(input: PCMParameters, output: PCMParameters) {\r\n\r\n    this.inputParameters = input\r\n    this.outputParameters = output\r\n\r\n    await this.resampler.run()\r\n\r\n    this.resampler.call(\r\n      'resample_set_input_parameters',\r\n      input.sampleRate,\r\n      input.channels,\r\n      input.format,\r\n      input.layout || nullptr\r\n    )\r\n    this.resampler.call(\r\n      'resample_set_output_parameters',\r\n      output.sampleRate,\r\n      output.channels,\r\n      output.format,\r\n      output.layout || nullptr\r\n    )\r\n\r\n    let ret = this.resampler.call<int32>('resample_init')\r\n    if (ret < 0) {\r\n      logger.fatal(`open resampler failed, ret: ${ret}`)\r\n    }\r\n  }\r\n\r\n  public resample(input: pointer<pointer<uint8>>, output: pointer<AVPCMBuffer>, numberOfFrames: int32) {\r\n    return this.resampler.call<int32>('resample_process', input, output, numberOfFrames)\r\n  }\r\n\r\n  public getOutputSampleCount(numberOfFrames: int32) {\r\n    return this.resampler.call<int32>('resample_nb_sample', numberOfFrames)\r\n  }\r\n\r\n  public close() {\r\n    this.resampler.call('resample_destroy')\r\n    this.resampler.destroy()\r\n    this.resampler = null\r\n  }\r\n\r\n  public getInputPCMParameters() {\r\n    return this.inputParameters\r\n  }\r\n\r\n  public getOutputPCMParameters() {\r\n    return this.outputParameters\r\n  }\r\n}\r\n","/*\r\n * libmedia generate audio codec string\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVCodecID } from 'avutil/codec'\r\nimport { CodecId2MimeType } from 'avutil/stringEnum'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\n\r\nexport default function getAudioCodec(codecpar: pointer<AVCodecParameters>) {\r\n\r\n  const codecId = codecpar.codecId\r\n  let profile = codecpar.profile\r\n\r\n  let codec = CodecId2MimeType[codecId]\r\n\r\n  if (codecId === AVCodecID.AV_CODEC_ID_AAC) {\r\n    /*\r\n     * mp4a.40.profile\r\n     * url: https://developer.mozilla.org/en-US/docs/Web/Media/Formats/codecs_parameter#iso_base_media_file_format_mp4_quicktime_and_3gp\r\n     */\r\n    codec = `${codec}.${profile}`\r\n  }\r\n  return codec || 'unknown'\r\n}\r\n","/*\r\n * libmedia webcodec hardware preference different chrome version\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport browser from 'common/util/browser'\r\n\r\nexport function getHardwarePreference(enable: boolean): HardwareAcceleration {\r\n  if (enable) {\r\n    if (!browser.chrome || browser.checkVersion(browser.majorVersion, '94', true)) {\r\n      return 'prefer-hardware'\r\n    }\r\n    else {\r\n      return 'allow' as HardwareAcceleration\r\n    }\r\n  }\r\n  else {\r\n    if (!browser.chrome || browser.checkVersion(browser.majorVersion, '94', true)) {\r\n      return 'prefer-software'\r\n    }\r\n    else {\r\n      return 'deny' as HardwareAcceleration\r\n    }\r\n  }\r\n}\r\n","/*\r\n * libmedia generate video codec string\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVCodecID } from 'avutil/codec'\r\nimport { CodecId2MimeType } from 'avutil/stringEnum'\r\nimport { H264Profile } from 'avformat/codecs/h264'\r\nimport * as av1 from 'avformat/codecs/av1'\r\nimport * as vp8 from 'avformat/codecs/vp8'\r\nimport * as vp9 from 'avformat/codecs/vp9'\r\nimport * as vvc from 'avformat/codecs/vvc'\r\nimport * as string from 'common/util/string'\r\nimport { NOPTS_VALUE } from 'avutil/constant'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport { mapUint8Array } from 'cheap/std/memory'\r\nimport * as base32 from 'common/util/base32'\r\n\r\nexport default function getVideoCodec(codecpar: pointer<AVCodecParameters>, extradata?: Uint8Array) {\r\n  const codecId = codecpar.codecId\r\n  let profile = codecpar.profile\r\n  let level = codecpar.level\r\n  if (!extradata && codecpar.extradata !== nullptr && codecpar.extradataSize) {\r\n    extradata = mapUint8Array(codecpar.extradata, codecpar.extradataSize)\r\n  }\r\n\r\n  let entry = CodecId2MimeType[codecId]\r\n  let codec = ''\r\n\r\n  if (codecId === AVCodecID.AV_CODEC_ID_H264) {\r\n    /*\r\n     * avc1.profile_idc.constraint_set.level_idc\r\n     * 每个参数 1 个字节压缩成 16 进制\r\n     * url: https://developer.mozilla.org/en-US/docs/Web/Media/Formats/codecs_parameter#iso_base_media_file_format_mp4_quicktime_and_3gp\r\n     */\r\n\r\n    // High 10 Profile 会提示不支持，但是能解码出来\r\n    if (profile === H264Profile.kHigh10) {\r\n      profile = H264Profile.kHigh\r\n    }\r\n    codec = string.format(\r\n      '%s.%02x00%02x',\r\n      entry,\r\n      profile & 0xff,\r\n      level & 0xff\r\n    )\r\n  }\r\n  else if (codecId === AVCodecID.AV_CODEC_ID_HEVC) {\r\n    /**\r\n     * \r\n     * hev1.[general_profile_space?general_profile_idc].[general_profile_compatibility_flags( 十六进制）][general_tier_flag general_level_idc][constraint_flags( 十六进制）]\r\n     * general_profile_space:\r\n     *  A -> 1\r\n     *  B -> 2\r\n     *  C -> 3\r\n     * empty -> 0\r\n     * \r\n     * general_tier_flag:\r\n     *  L -> 0\r\n     *  H -> 1\r\n     * \r\n     */\r\n\r\n    let generalProfileSpace = 0\r\n    let generalProfileCompatibilityFlags = 0\r\n    let generalTierFlag = 0\r\n    let constraintFlags = 0\r\n\r\n    if (extradata?.length > 13) {\r\n      generalProfileSpace = (extradata[1] >>> 6) & 0x03\r\n      generalTierFlag = (extradata[1] >>> 5) & 0x01\r\n      generalProfileCompatibilityFlags = extradata[2] | (extradata[3] << 8) | (extradata[4] << 16) | (extradata[5] << 24)\r\n      // constraintFlags 目前只能使用 4 个 bit\r\n      constraintFlags = extradata[6] & 0xf0\r\n    }\r\n\r\n    const generalProfileSpaceMap = {\r\n      0: '',\r\n      1: 'A',\r\n      2: 'B',\r\n      3: 'C'\r\n    }\r\n\r\n    codec = string.format(\r\n      '%s.%s%d.%x.%s%d.%x',\r\n      entry,\r\n      generalProfileSpaceMap[generalProfileSpace],\r\n      profile,\r\n      generalProfileCompatibilityFlags,\r\n      generalTierFlag === 0 ? 'L' : 'H',\r\n      level,\r\n      constraintFlags\r\n    )\r\n  }\r\n  else if (codecId === AVCodecID.AV_CODEC_ID_VVC) {\r\n    /**\r\n     * \r\n     * vvc1.<sample entry 4CC>.<general_profile_idc>.[LH]<op_level_idc>{.C<general_constraint_info>}{.S<general_sub_profile_idc>}{.O{<OlsIdx>}{+<MaxTid>}}\r\n     */\r\n\r\n    let generalTierFlag = 0\r\n\r\n    if (extradata?.length > 13) {\r\n      generalTierFlag = extradata[5] & 0x01\r\n    }\r\n\r\n    codec = string.format(\r\n      '%s.%d.%s%d',\r\n      entry,\r\n      profile,\r\n      generalTierFlag === 0 ? 'L' : 'H',\r\n      level\r\n    )\r\n\r\n    if (extradata) {\r\n      const params = vvc.parseExtraData(extradata)\r\n      if (params.generalConstraintInfo.length) {\r\n        let index = params.generalConstraintInfo.length - 1\r\n        while (index > 0 && params.generalConstraintInfo[index] === 0) {\r\n          index--\r\n        }\r\n        const generalConstraintInfo = (params.generalConstraintInfo as number[]).slice(0, index + 1)\r\n        if (generalConstraintInfo.length) {\r\n          codec += `.C${base32.encode(new Uint8Array(generalConstraintInfo), false)}`\r\n        }\r\n      }\r\n      if (params.generalSubProfileIdc.length) {\r\n        codec += `.S${params.generalSubProfileIdc.map((profile: number) => profile.toString(16)).join('+')}`\r\n      }\r\n      codec += `.O${params.olsIdx}+${params.numSublayers}`\r\n    }\r\n  }\r\n  else if (codecId === AVCodecID.AV_CODEC_ID_AV1) {\r\n    /*\r\n     * av01.profile.level+seqTier.bitDepth[.monochrome[.chromaSubsampling[.colorPrimaries[.colorPrimaries[.matrixCoefficients]]]]]\r\n     * url: https://aomediacodec.github.io/av1-isobmff/#codecsparam\r\n     * url: https://developer.mozilla.org/en-US/docs/Web/Media/Formats/codecs_parameter#av1\r\n     */\r\n\r\n    if (extradata) {\r\n      const params = av1.parseExtraData(extradata)\r\n      codec = string.format(\r\n        '%s.%d.%02d%s.%02d.%d.%d%d%d',\r\n        entry,\r\n        params.profile,\r\n        params.level,\r\n        params.tier ? 'H' : 'M',\r\n        params.bitDepth,\r\n        params.monochrome,\r\n        params.chromaSubsamplingX,\r\n        params.chromaSubsamplingY,\r\n        params.chromaSamplePosition\r\n      )\r\n    }\r\n    else {\r\n      codec = string.format('%s.%d.%02dM.08', entry, profile, level)\r\n    }\r\n  }\r\n  else if (codecId === AVCodecID.AV_CODEC_ID_VP8) {\r\n    /*\r\n     * url: https://developer.mozilla.org/en-US/docs/Web/Media/Formats/codecs_parameter#videowebmcodecsvp08.00.41.08vorbis\r\n     */\r\n    if (extradata) {\r\n      const params = vp8.parseExtraData(extradata)\r\n      codec = string.format(\r\n        '%s.%02d.%02d.%02d',\r\n        entry,\r\n        params.profile,\r\n        params.level,\r\n        params.bitDepth\r\n      )\r\n    }\r\n    else if (profile !== NOPTS_VALUE && level !== NOPTS_VALUE) {\r\n      codec = string.format('%s.%02d.%02d.08', entry, profile, level)\r\n    }\r\n    else {\r\n      codec = entry\r\n    }\r\n  }\r\n  else if (codecId === AVCodecID.AV_CODEC_ID_VP9) {\r\n    /*\r\n     * vp09.profile.level.colorDepth.chromaSubsampling[.colorPrimaries[.transferCharacteristics[.matrixCoefficients[.blackLevel and color range]]]]\r\n     * url: https://www.webmproject.org/vp9/mp4/#CodecsParameterString\r\n     * url: https://developer.mozilla.org/en-US/docs/Web/Media/Formats/codecs_parameter#webm\r\n     */\r\n    if (extradata) {\r\n      const params = vp9.parseExtraData(extradata)\r\n      codec = string.format(\r\n        '%s.%02d.%02d.%02d.%02d.%02d.%02d.%02d.%02d',\r\n        entry,\r\n        params.profile,\r\n        params.level,\r\n        params.bitDepth,\r\n        params.chromaSubsampling,\r\n        params.colorPrimaries,\r\n        params.colorTrc,\r\n        params.colorSpace,\r\n        params.fullRangeFlag\r\n      )\r\n    }\r\n    else if (profile !== NOPTS_VALUE && level !== NOPTS_VALUE) {\r\n      codec = string.format('%s.%02d.%02d.08.00', entry, profile, level)\r\n    }\r\n    else {\r\n      codec = string.format('%s.%02d.%02d.08.00', entry, 0, 40)\r\n    }\r\n  }\r\n  else {\r\n    codec = entry || 'unknown'\r\n  }\r\n\r\n  return codec\r\n}\r\n","/*\r\n * libmedia wasm audio decoder\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport AVPacket from 'avutil/struct/avpacket'\r\nimport AVFrame, { AVFramePool, AVFrameRef } from 'avutil/struct/avframe'\r\nimport { WebAssemblyResource } from 'cheap/webassembly/compiler'\r\nimport WebAssemblyRunner from 'cheap/webassembly/WebAssemblyRunner'\r\nimport { createAVFrame, destroyAVFrame } from 'avutil/util/avframe'\r\nimport * as logger from 'common/util/logger'\r\nimport support from 'common/util/support'\r\nimport { AVDictionary } from 'avutil/struct/avdict'\r\nimport { Data } from 'common/types/type'\r\nimport * as object from 'common/util/object'\r\nimport * as dict from 'avutil/util/avdict'\r\nimport * as is from 'common/util/is'\r\nimport { avMallocz } from 'avutil/util/mem'\r\n\r\nexport type WasmAudioDecoderOptions = {\r\n  resource: WebAssemblyResource\r\n  onReceiveFrame: (frame: pointer<AVFrame>) => void\r\n  onError: (error?: Error) => void\r\n  avframePool?: AVFramePool\r\n}\r\n\r\nexport default class WasmAudioDecoder {\r\n\r\n  private options: WasmAudioDecoderOptions\r\n\r\n  private decoder: WebAssemblyRunner\r\n\r\n  private frame: pointer<AVFrame>\r\n\r\n  private decoderOptions: pointer<AVDictionary> = nullptr\r\n\r\n  constructor(options: WasmAudioDecoderOptions) {\r\n    this.options = options\r\n    this.decoder = new WebAssemblyRunner(options.resource)\r\n  }\r\n\r\n  private getAVFrame() {\r\n    if (this.frame) {\r\n      return this.frame\r\n    }\r\n    return this.frame = this.options.avframePool ? this.options.avframePool.alloc() : createAVFrame()\r\n  }\r\n\r\n  private outputAVFrame() {\r\n    if (this.frame) {\r\n      if (this.options.onReceiveFrame) {\r\n        this.options.onReceiveFrame(this.frame)\r\n      }\r\n      else {\r\n        this.options.avframePool ? this.options.avframePool.release(this.frame as pointer<AVFrameRef>) : destroyAVFrame(this.frame)\r\n      }\r\n\r\n      this.frame = nullptr\r\n    }\r\n  }\r\n\r\n  private receiveAVFrame() {\r\n    return this.decoder.call<int32>('decoder_receive', this.getAVFrame())\r\n  }\r\n\r\n  public async open(parameters: pointer<AVCodecParameters>, opts: Data = {}) {\r\n    await this.decoder.run()\r\n\r\n    if (object.keys(opts).length) {\r\n      if (this.decoderOptions) {\r\n        dict.freeAVDict2(this.decoderOptions)\r\n        free(this.decoderOptions)\r\n        this.decoderOptions = nullptr\r\n      }\r\n      this.decoderOptions = avMallocz(sizeof(AVDictionary))\r\n      object.each(opts, (value, key) => {\r\n        if (is.string(value) || is.string(key)) {\r\n          dict.avDictSet(this.decoderOptions, key, value)\r\n        }\r\n      })\r\n    }\r\n\r\n    let ret = 0\r\n    if (support.jspi) {\r\n      ret = await this.decoder.callAsync<int32>('decoder_open', parameters, nullptr, 1, this.decoderOptions)\r\n    }\r\n    else {\r\n      ret = this.decoder.call<int32>('decoder_open', parameters, nullptr, 1, this.decoderOptions)\r\n      await this.decoder.childrenThreadReady()\r\n    }\r\n    if (ret < 0) {\r\n      logger.fatal(`open audio decoder failed, ret: ${ret}`)\r\n    }\r\n  }\r\n\r\n  public decode(avpacket: pointer<AVPacket>) {\r\n    let ret = this.decoder.call<int32>('decoder_decode', avpacket)\r\n\r\n    if (ret) {\r\n      return ret\r\n    }\r\n\r\n    while (true) {\r\n      ret = this.receiveAVFrame()\r\n      if (ret === 1) {\r\n        this.outputAVFrame()\r\n      }\r\n      else if (ret < 0) {\r\n        return ret\r\n      }\r\n      else {\r\n        break\r\n      }\r\n    }\r\n\r\n    return 0\r\n  }\r\n\r\n  public async flush() {\r\n    this.decoder.call('decoder_flush')\r\n    while (1) {\r\n      const ret = this.receiveAVFrame()\r\n      if (ret < 1) {\r\n        return\r\n      }\r\n      this.outputAVFrame()\r\n    }\r\n  }\r\n\r\n  public close() {\r\n    this.decoder.call('decoder_close')\r\n    this.decoder.destroy()\r\n    this.decoder = null\r\n\r\n    if (this.frame) {\r\n      this.options.avframePool ? this.options.avframePool.release(this.frame as pointer<AVFrameRef>) : destroyAVFrame(this.frame)\r\n      this.frame = nullptr\r\n    }\r\n    if (this.decoderOptions) {\r\n      dict.freeAVDict2(this.decoderOptions)\r\n      free(this.decoderOptions)\r\n      this.decoderOptions = nullptr\r\n    }\r\n  }\r\n}\r\n","/*\r\n * libmedia wasm audio encoder\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport AVFrame from 'avutil/struct/avframe'\r\nimport { WebAssemblyResource } from 'cheap/webassembly/compiler'\r\nimport WebAssemblyRunner from 'cheap/webassembly/WebAssemblyRunner'\r\nimport AVPacket, { AVPacketPool, AVPacketRef } from 'avutil/struct/avpacket'\r\nimport { createAVPacket, destroyAVPacket } from 'avutil/util/avpacket'\r\nimport * as logger from 'common/util/logger'\r\nimport { audioData2AVFrame } from 'avutil/function/audioData2AVFrame'\r\nimport * as stack from 'cheap/stack'\r\nimport { createAVFrame, destroyAVFrame, getAudioBuffer, unrefAVFrame } from 'avutil/util/avframe'\r\nimport { Rational } from 'avutil/struct/rational'\r\nimport { mapUint8Array, memcpyFromUint8Array } from 'cheap/std/memory'\r\nimport { getBytesPerSample, sampleFormatIsPlanar, sampleSetSilence } from 'avutil/util/sample'\r\nimport { AVSampleFormat } from 'avutil/audiosamplefmt'\r\nimport { avRescaleQ } from 'avutil/util/rational'\r\nimport support from 'common/util/support'\r\nimport isPointer from 'cheap/std/function/isPointer'\r\nimport { AVDictionary } from 'avutil/struct/avdict'\r\nimport { Data } from 'common/types/type'\r\nimport * as object from 'common/util/object'\r\nimport * as dict from 'avutil/util/avdict'\r\nimport * as is from 'common/util/is'\r\nimport { avMallocz } from 'avutil/util/mem'\r\n\r\nexport type WasmAudioEncoderOptions = {\r\n  resource: WebAssemblyResource\r\n  onReceiveAVPacket: (avpacket: pointer<AVPacket>) => void\r\n  onError: (error?: Error) => void\r\n  avpacketPool?: AVPacketPool\r\n}\r\n\r\nclass AudioFrameResizer {\r\n\r\n  private parameters: pointer<AVCodecParameters>\r\n\r\n  private data: Uint8Array[]\r\n\r\n  private planes: int32\r\n\r\n  private pos: int32\r\n  private posEnd: int32\r\n\r\n  private bufferLength: int32\r\n  private bytesPerSample: int32\r\n  private planar: boolean\r\n  private channels: int32\r\n  private frameSize: int32\r\n\r\n  private pts: int64\r\n\r\n  constructor(parameters: pointer<AVCodecParameters>, frameSize: int32) {\r\n    this.parameters = parameters\r\n    this.frameSize = frameSize\r\n\r\n    this.planar = sampleFormatIsPlanar(parameters.format as AVSampleFormat)\r\n    this.planes = this.planar ? parameters.chLayout.nbChannels : 1\r\n    this.channels = parameters.chLayout.nbChannels\r\n\r\n    this.bufferLength = 500 * 1024\r\n    this.data = []\r\n    for (let i = 0; i < this.planes; i++) {\r\n      this.data[i] = new Uint8Array(this.bufferLength)\r\n    }\r\n    this.pos = 0\r\n    this.posEnd = 0\r\n    this.bytesPerSample = getBytesPerSample(parameters.format as AVSampleFormat)\r\n    this.pts = 0n\r\n  }\r\n\r\n  public sendAVFrame(avframe: pointer<AVFrame>) {\r\n    const size = avframe.nbSamples * this.bytesPerSample * (this.planar ? 1 : this.channels)\r\n    if (this.posEnd + size >= this.bufferLength) {\r\n      const len = this.posEnd - this.pos\r\n      for (let i = 0; i < this.planes; i++) {\r\n        this.data[i].set(this.data[i].subarray(this.pos, this.posEnd), 0)\r\n      }\r\n      this.pos = 0\r\n      this.posEnd = len\r\n    }\r\n\r\n    for (let i = 0; i < this.planes; i++) {\r\n      this.data[i].set(mapUint8Array(avframe.data[i], size), this.posEnd)\r\n    }\r\n\r\n    this.posEnd += size\r\n  }\r\n\r\n  public remainFrameSize() {\r\n    const step = this.bytesPerSample * (this.planar ? 1 : this.channels)\r\n    return (this.posEnd - this.pos) / step\r\n  }\r\n\r\n  private handleData(avframe: pointer<AVFrame>, size: int32) {\r\n    unrefAVFrame(avframe)\r\n\r\n    avframe.sampleRate = this.parameters.sampleRate\r\n    avframe.nbSamples = this.frameSize\r\n    avframe.chLayout.nbChannels = this.parameters.chLayout.nbChannels\r\n    avframe.format = this.parameters.format\r\n    avframe.pts = this.pts\r\n    avframe.timeBase.den = this.parameters.sampleRate\r\n    avframe.timeBase.num = 1\r\n\r\n    getAudioBuffer(avframe)\r\n\r\n    for (let i = 0; i < this.planes; i++) {\r\n      memcpyFromUint8Array(avframe.data[i], avframe.linesize[0], this.data[i].subarray(this.pos, this.pos + size))\r\n    }\r\n\r\n    this.pos += size\r\n    this.pts += static_cast<int64>(this.frameSize)\r\n  }\r\n\r\n  public receiveAVFrame(avframe: pointer<AVFrame>) {\r\n    const size = this.frameSize * this.bytesPerSample * (this.planar ? 1 : this.channels)\r\n    const remainingSize = (this.posEnd - this.pos)\r\n    if (remainingSize < size) {\r\n      return -1\r\n    }\r\n    this.handleData(avframe, size)\r\n    return 0\r\n  }\r\n\r\n  public flush(avframe: pointer<AVFrame>) {\r\n    const size = this.posEnd - this.pos\r\n    const frameSize = size / (this.bytesPerSample * (this.planar ? 1 : this.channels))\r\n    this.handleData(avframe, size)\r\n    sampleSetSilence(\r\n      addressof(avframe.data),\r\n      frameSize,\r\n      this.parameters.format as AVSampleFormat,\r\n      this.frameSize - frameSize,\r\n      this.parameters.chLayout.nbChannels\r\n    )\r\n    return 0\r\n  }\r\n}\r\n\r\nexport default class WasmAudioEncoder {\r\n\r\n  private options: WasmAudioEncoderOptions\r\n\r\n  private encoder: WebAssemblyRunner\r\n  private parameters: pointer<AVCodecParameters>\r\n  private timeBase: Rational\r\n\r\n  private avpacket: pointer<AVPacket>\r\n\r\n  private avframe: pointer<AVFrame>\r\n\r\n  private pts: int64\r\n  private frameSize: int32\r\n  private audioFrameResizer: AudioFrameResizer\r\n\r\n  private encoderOptions: pointer<AVDictionary> = nullptr\r\n\r\n  constructor(options: WasmAudioEncoderOptions) {\r\n    this.options = options\r\n    this.encoder = new WebAssemblyRunner(this.options.resource)\r\n  }\r\n\r\n  private getAVPacket() {\r\n    if (this.avpacket) {\r\n      return this.avpacket\r\n    }\r\n    return this.avpacket = this.options.avpacketPool ? this.options.avpacketPool.alloc() : createAVPacket()\r\n  }\r\n\r\n  private outputAVPacket() {\r\n    if (this.avpacket) {\r\n      this.avpacket.pts = this.pts\r\n      this.avpacket.dts = this.pts\r\n      this.pts += this.avpacket.duration\r\n      this.avpacket.timeBase.den = this.timeBase.den\r\n      this.avpacket.timeBase.num = this.timeBase.num\r\n      this.options.onReceiveAVPacket(this.avpacket)\r\n      this.avpacket = nullptr\r\n    }\r\n  }\r\n\r\n  private receiveAVPacket() {\r\n    return this.encoder.call<int32>('encoder_receive', this.getAVPacket())\r\n  }\r\n\r\n  public async open(parameters: pointer<AVCodecParameters>, timeBase: Rational, opts: Data = {}) {\r\n    await this.encoder.run()\r\n\r\n    const timeBaseP = reinterpret_cast<pointer<Rational>>(stack.malloc(sizeof(Rational)))\r\n\r\n    timeBaseP.num = timeBase.num\r\n    timeBaseP.den = timeBase.den\r\n\r\n    this.encoder.call('encoder_set_flags', 1 << 22)\r\n\r\n    if (object.keys(opts).length) {\r\n      if (this.encoderOptions) {\r\n        dict.freeAVDict2(this.encoderOptions)\r\n        free(this.encoderOptions)\r\n        this.encoderOptions = nullptr\r\n      }\r\n      this.encoderOptions = avMallocz(sizeof(AVDictionary))\r\n      object.each(opts, (value, key) => {\r\n        if (is.string(value) || is.string(key)) {\r\n          dict.avDictSet(this.encoderOptions, key, value)\r\n        }\r\n      })\r\n    }\r\n\r\n    let ret = 0\r\n\r\n    if (support.jspi) {\r\n      ret = await this.encoder.callAsync<int32>('encoder_open', parameters, timeBaseP, 1, this.encoderOptions)\r\n    }\r\n    else {\r\n      ret = this.encoder.call<int32>('encoder_open', parameters, timeBaseP, 1, this.encoderOptions)\r\n      await this.encoder.childrenThreadReady()\r\n    }\r\n\r\n    this.frameSize = this.encoder.call<int32>('encoder_get_framesize_size')\r\n\r\n    stack.free(sizeof(Rational))\r\n\r\n    if (ret < 0) {\r\n      logger.fatal(`open audio encoder failed, ret: ${ret}`)\r\n    }\r\n    await this.encoder.childrenThreadReady()\r\n\r\n    this.parameters = parameters\r\n    this.timeBase = timeBase\r\n\r\n    this.pts = 0n\r\n  }\r\n\r\n  private encode_(avframe: pointer<AVFrame>) {\r\n    let ret = this.encoder.call<int32>('encoder_encode', avframe)\r\n    if (ret) {\r\n      return ret\r\n    }\r\n    while (true) {\r\n      ret = this.receiveAVPacket()\r\n      if (ret === 1) {\r\n        this.outputAVPacket()\r\n      }\r\n      else if (ret < 0) {\r\n        return ret\r\n      }\r\n      else {\r\n        break\r\n      }\r\n    }\r\n    return 0\r\n  }\r\n\r\n  public encode(avframe: pointer<AVFrame> | AudioData) {\r\n\r\n    if (!isPointer(avframe)) {\r\n      if (this.avframe) {\r\n        unrefAVFrame(this.avframe)\r\n      }\r\n      else {\r\n        this.avframe = createAVFrame()\r\n      }\r\n      avframe = audioData2AVFrame(avframe, this.avframe)\r\n    }\r\n\r\n    avframe.timeBase.den = this.timeBase.den\r\n    avframe.timeBase.num = this.timeBase.num\r\n\r\n    if (this.frameSize > 0 && avframe.nbSamples !== this.frameSize || this.audioFrameResizer) {\r\n      if (!this.audioFrameResizer) {\r\n        this.audioFrameResizer = new AudioFrameResizer(this.parameters, this.frameSize)\r\n      }\r\n      this.audioFrameResizer.sendAVFrame(avframe)\r\n      while (true) {\r\n        let ret = this.audioFrameResizer.receiveAVFrame(avframe)\r\n        if (ret < 0) {\r\n          return 0\r\n        }\r\n        avframe.pts = avRescaleQ(avframe.pts, avframe.timeBase, this.timeBase)\r\n        this.encode_(avframe)\r\n      }\r\n    }\r\n    else {\r\n      return this.encode_(avframe)\r\n    }\r\n  }\r\n\r\n  public async flush() {\r\n    if (this.audioFrameResizer && this.audioFrameResizer.remainFrameSize() > 0) {\r\n      const avframe = createAVFrame()\r\n      this.audioFrameResizer.flush(avframe)\r\n      avframe.pts = avRescaleQ(avframe.pts, avframe.timeBase, this.timeBase)\r\n      this.encode_(avframe)\r\n      destroyAVFrame(avframe)\r\n    }\r\n\r\n    this.encoder.call('encoder_flush')\r\n    while (1) {\r\n      const ret = this.receiveAVPacket()\r\n      if (ret < 1) {\r\n        return\r\n      }\r\n      this.outputAVPacket()\r\n    }\r\n  }\r\n\r\n  public getExtraData() {\r\n    const pointer = this.encoder.call<pointer<uint8>>('encoder_get_extradata')\r\n    const size = this.encoder.call<int32>('encoder_get_extradata_size')\r\n\r\n    if (pointer && size) {\r\n      return mapUint8Array(pointer, size).slice()\r\n    }\r\n    return null\r\n  }\r\n\r\n  public close() {\r\n    this.encoder.call('encoder_close')\r\n    this.encoder.destroy()\r\n    this.encoder = null\r\n\r\n    if (this.avpacket) {\r\n      this.options.avpacketPool\r\n        ? this.options.avpacketPool.release(this.avpacket as pointer<AVPacketRef>)\r\n        : destroyAVPacket(this.avpacket)\r\n      this.avpacket = nullptr\r\n    }\r\n\r\n    if (this.avframe) {\r\n      destroyAVFrame(this.avframe)\r\n      this.avframe = nullptr\r\n    }\r\n    if (this.encoderOptions) {\r\n      dict.freeAVDict2(this.encoderOptions)\r\n      free(this.encoderOptions)\r\n      this.encoderOptions = nullptr\r\n    }\r\n  }\r\n}\r\n","/*\r\n * libmedia wasm video decoder\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVPacket from 'avutil/struct/avpacket'\r\nimport AVFrame, { AVFramePool, AVFrameRef } from 'avutil/struct/avframe'\r\nimport { WebAssemblyResource } from 'cheap/webassembly/compiler'\r\nimport WebAssemblyRunner from 'cheap/webassembly/WebAssemblyRunner'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport { createAVFrame, destroyAVFrame } from 'avutil/util/avframe'\r\nimport * as logger from 'common/util/logger'\r\nimport support from 'common/util/support'\r\nimport { AVDictionary } from 'avutil/struct/avdict'\r\nimport { Data } from 'common/types/type'\r\nimport * as object from 'common/util/object'\r\nimport * as dict from 'avutil/util/avdict'\r\nimport * as is from 'common/util/is'\r\nimport { avMallocz } from 'avutil/util/mem'\r\n\r\nexport type WasmVideoDecoderOptions = {\r\n  resource: WebAssemblyResource\r\n  onReceiveFrame: (frame: pointer<AVFrame>) => void\r\n  onError: (error?: Error) => void\r\n  avframePool?: AVFramePool\r\n}\r\n\r\n/**\r\n * We leave some space between them for extensions (drop some\r\n * keyframes for intra-only or drop just some bidir frames). \r\n */\r\nexport const enum AVDiscard {\r\n  /**\r\n   * discard nothing\r\n   */\r\n  AVDISCARD_NONE = -16,\r\n  /**\r\n   * discard useless packets like 0 size packets in avi\r\n   */\r\n  AVDISCARD_DEFAULT = 0,\r\n  /**\r\n   * discard all non reference\r\n   */\r\n  AVDISCARD_NONREF = 8,\r\n  /**\r\n   * discard all bidirectional frames\r\n   */\r\n  AVDISCARD_BIDIR = 16,\r\n  /**\r\n   * discard all non intra frames\r\n   */\r\n  AVDISCARD_NONINTRA = 24,\r\n  /**\r\n   * discard all frames except keyframes\r\n   */\r\n  AVDISCARD_NONKEY = 32,\r\n  /**\r\n   * discard all\r\n   */\r\n  AVDISCARD_ALL = 48\r\n}\r\n\r\nexport default class WasmVideoDecoder {\r\n\r\n  private options: WasmVideoDecoderOptions\r\n\r\n  private decoder: WebAssemblyRunner\r\n\r\n  private frame: pointer<AVFrame>\r\n\r\n  private parameters: pointer<AVCodecParameters>\r\n\r\n  private decoderOptions: pointer<AVDictionary> = nullptr\r\n\r\n  constructor(options: WasmVideoDecoderOptions) {\r\n    this.options = options\r\n    this.decoder = new WebAssemblyRunner(this.options.resource)\r\n  }\r\n\r\n  private getAVFrame() {\r\n    if (this.frame) {\r\n      return this.frame\r\n    }\r\n    return this.frame = this.options.avframePool ? this.options.avframePool.alloc() : createAVFrame()\r\n  }\r\n\r\n  private outputAVFrame() {\r\n    if (this.frame) {\r\n      if (this.options.onReceiveFrame) {\r\n        this.options.onReceiveFrame(this.frame)\r\n      }\r\n      else {\r\n        this.options.avframePool ? this.options.avframePool.release(this.frame as pointer<AVFrameRef>) : destroyAVFrame(this.frame)\r\n      }\r\n\r\n      this.frame = nullptr\r\n    }\r\n  }\r\n\r\n  private receiveAVFrame() {\r\n    return this.decoder.call<int32>('decoder_receive', this.getAVFrame())\r\n  }\r\n\r\n  public async open(parameters: pointer<AVCodecParameters>, threadCount: number = 1, opts: Data = {}) {\r\n    await this.decoder.run(null, threadCount)\r\n    let ret = 0\r\n\r\n    if (object.keys(opts).length) {\r\n      if (this.decoderOptions) {\r\n        dict.freeAVDict2(this.decoderOptions)\r\n        free(this.decoderOptions)\r\n        this.decoderOptions = nullptr\r\n      }\r\n      this.decoderOptions = avMallocz(sizeof(AVDictionary))\r\n      object.each(opts, (value, key) => {\r\n        if (is.string(value) || is.string(key)) {\r\n          dict.avDictSet(this.decoderOptions, key, value)\r\n        }\r\n      })\r\n    }\r\n\r\n    if (support.jspi) {\r\n      ret = await this.decoder.callAsync<int32>('decoder_open', parameters, nullptr, threadCount, this.decoderOptions)\r\n    }\r\n    else {\r\n      ret = this.decoder.call<int32>('decoder_open', parameters, nullptr, threadCount, this.decoderOptions)\r\n      await this.decoder.childrenThreadReady()\r\n    }\r\n\r\n    if (ret < 0) {\r\n      logger.fatal(`open video decoder failed, ret: ${ret}`)\r\n    }\r\n    this.parameters = parameters\r\n    await this.decoder.childrenThreadReady()\r\n  }\r\n\r\n  public decode(avpacket: pointer<AVPacket>) {\r\n    let ret = this.decoder.call<int32>('decoder_decode', avpacket)\r\n\r\n    if (ret) {\r\n      return ret\r\n    }\r\n\r\n    while (true) {\r\n      ret = this.receiveAVFrame()\r\n      if (ret === 1) {\r\n        this.outputAVFrame()\r\n      }\r\n      else if (ret < 0) {\r\n        return ret\r\n      }\r\n      else {\r\n        break\r\n      }\r\n    }\r\n    return 0\r\n  }\r\n\r\n  public async flush() {\r\n    this.decoder.call('decoder_flush')\r\n    while (1) {\r\n      const ret = this.receiveAVFrame()\r\n      if (ret < 1) {\r\n        return\r\n      }\r\n      this.outputAVFrame()\r\n    }\r\n  }\r\n\r\n  public close() {\r\n    this.decoder.call('decoder_close')\r\n    this.decoder.destroy()\r\n    this.decoder = null\r\n\r\n    if (this.frame) {\r\n      this.options.avframePool ? this.options.avframePool.release(this.frame as pointer<AVFrameRef>) : destroyAVFrame(this.frame)\r\n      this.frame = nullptr\r\n    }\r\n\r\n    this.parameters = nullptr\r\n\r\n    if (this.decoderOptions) {\r\n      dict.freeAVDict2(this.decoderOptions)\r\n      free(this.decoderOptions)\r\n      this.decoderOptions = nullptr\r\n    }\r\n  }\r\n\r\n  public setSkipFrameDiscard(discard: AVDiscard) {\r\n    this.decoder.call('decoder_discard', discard)\r\n  }\r\n}\r\n","/*\r\n * libmedia wasm video encoder\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport AVFrame, { AVPictureType } from 'avutil/struct/avframe'\r\nimport { WebAssemblyResource } from 'cheap/webassembly/compiler'\r\nimport WebAssemblyRunner from 'cheap/webassembly/WebAssemblyRunner'\r\nimport AVPacket, { AVPacketPool, AVPacketRef } from 'avutil/struct/avpacket'\r\nimport { createAVPacket, destroyAVPacket, getAVPacketData, getAVPacketSideData } from 'avutil/util/avpacket'\r\nimport * as logger from 'common/util/logger'\r\nimport * as stack from 'cheap/stack'\r\nimport { Rational } from 'avutil/struct/rational'\r\nimport { BitFormat } from 'avformat/codecs/h264'\r\nimport { videoFrame2AVFrame } from 'avutil/function/videoFrame2AVFrame'\r\nimport { createAVFrame, destroyAVFrame, unrefAVFrame } from 'avutil/util/avframe'\r\nimport { mapUint8Array } from 'cheap/std/memory'\r\nimport { AVCodecID, AVPacketSideDataType } from 'avutil/codec'\r\nimport { avQ2D } from 'avutil/util/rational'\r\nimport AVBSFilter from 'avformat/bsf/AVBSFilter'\r\nimport Annexb2AvccFilter from 'avformat/bsf/h2645/Annexb2AvccFilter'\r\nimport support from 'common/util/support'\r\nimport isPointer from 'cheap/std/function/isPointer'\r\nimport * as av1 from 'avformat/codecs/av1'\r\nimport * as vp9 from 'avformat/codecs/vp9'\r\nimport { AVDictionary } from 'avutil/struct/avdict'\r\nimport { Data } from 'common/types/type'\r\nimport * as object from 'common/util/object'\r\nimport * as dict from 'avutil/util/avdict'\r\nimport * as is from 'common/util/is'\r\nimport { avMallocz } from 'avutil/util/mem'\r\n\r\nexport type WasmVideoEncoderOptions = {\r\n  resource: WebAssemblyResource\r\n  onReceiveAVPacket: (avpacket: pointer<AVPacket>) => void\r\n  onError: (error?: Error) => void\r\n  avpacketPool?: AVPacketPool\r\n}\r\n\r\nexport default class WasmVideoEncoder {\r\n\r\n  private options: WasmVideoEncoderOptions\r\n\r\n  private encoder: WebAssemblyRunner\r\n  private parameters: pointer<AVCodecParameters>\r\n  private timeBase: Rational\r\n\r\n  private avpacket: pointer<AVPacket>\r\n\r\n  private avframe: pointer<AVFrame>\r\n\r\n  private encodeQueueSize: number\r\n  private framerate: int64\r\n  private inputCounter: int64\r\n\r\n  private bitrateFilter: AVBSFilter\r\n\r\n  private extradata: Uint8Array\r\n\r\n  private encoderOptions: pointer<AVDictionary> = nullptr\r\n\r\n  constructor(options: WasmVideoEncoderOptions) {\r\n    this.options = options\r\n    this.encoder = new WebAssemblyRunner(this.options.resource)\r\n  }\r\n\r\n  private getAVPacket() {\r\n    if (this.avpacket) {\r\n      return this.avpacket\r\n    }\r\n    return this.avpacket = this.options.avpacketPool ? this.options.avpacketPool.alloc() : createAVPacket()\r\n  }\r\n\r\n  private outputAVPacket() {\r\n    if (this.avpacket) {\r\n      if (this.parameters.codecId === AVCodecID.AV_CODEC_ID_H264\r\n        || this.parameters.codecId === AVCodecID.AV_CODEC_ID_HEVC\r\n        || this.parameters.codecId === AVCodecID.AV_CODEC_ID_VVC\r\n      ) {\r\n        // wasm 编码器给出的是 annexb 码流\r\n        if (this.parameters.bitFormat === BitFormat.AVCC) {\r\n          if (!this.bitrateFilter) {\r\n            this.bitrateFilter = new Annexb2AvccFilter()\r\n            const timeBaseP = reinterpret_cast<pointer<Rational>>(stack.malloc(sizeof(Rational)))\r\n            timeBaseP.num = this.timeBase.num\r\n            timeBaseP.den = this.timeBase.den\r\n            this.bitrateFilter.init(this.parameters, timeBaseP)\r\n            stack.free(sizeof(Rational))\r\n          }\r\n          this.bitrateFilter.sendAVPacket(this.avpacket)\r\n          this.bitrateFilter.receiveAVPacket(this.avpacket)\r\n        }\r\n\r\n        if (!this.extradata) {\r\n          const ele = getAVPacketSideData(this.avpacket, AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA)\r\n          if (ele) {\r\n            this.extradata = mapUint8Array(ele.data, ele.size).slice()\r\n          }\r\n        }\r\n        this.avpacket.bitFormat = this.parameters.bitFormat\r\n      }\r\n      else if (this.parameters.codecId === AVCodecID.AV_CODEC_ID_AV1) {\r\n        if (!this.extradata) {\r\n          this.extradata = av1.generateExtradata(this.parameters, getAVPacketData(this.avpacket))\r\n        }\r\n      }\r\n      else if (this.parameters.codecId === AVCodecID.AV_CODEC_ID_VP9) {\r\n        if (!this.extradata) {\r\n          this.extradata = vp9.generateExtradata(this.parameters)\r\n        }\r\n      }\r\n\r\n      this.avpacket.timeBase.den = this.timeBase.den\r\n      this.avpacket.timeBase.num = this.timeBase.num\r\n\r\n      this.options.onReceiveAVPacket(this.avpacket)\r\n      this.avpacket = nullptr\r\n      this.encodeQueueSize--\r\n    }\r\n  }\r\n\r\n  private receiveAVPacket() {\r\n    return this.encoder.call<int32>('encoder_receive', this.getAVPacket())\r\n  }\r\n\r\n  public async open(parameters: pointer<AVCodecParameters>, timeBase: Rational, threadCount: number = 1, opts: Data = {}) {\r\n    await this.encoder.run(null, threadCount)\r\n\r\n    const timeBaseP = reinterpret_cast<pointer<Rational>>(stack.malloc(sizeof(Rational)))\r\n\r\n    timeBaseP.num = timeBase.num\r\n    timeBaseP.den = timeBase.den\r\n\r\n    if (parameters.codecId === AVCodecID.AV_CODEC_ID_MPEG4 && parameters.bitFormat === BitFormat.AVCC) {\r\n      this.encoder.call('encoder_set_flags', 1 << 22)\r\n    }\r\n    this.encoder.call('encoder_set_max_b_frame', parameters.videoDelay)\r\n\r\n    if (object.keys(opts).length) {\r\n      if (this.encoderOptions) {\r\n        dict.freeAVDict2(this.encoderOptions)\r\n        free(this.encoderOptions)\r\n        this.encoderOptions = nullptr\r\n      }\r\n      this.encoderOptions = avMallocz(sizeof(AVDictionary))\r\n      object.each(opts, (value, key) => {\r\n        if (is.string(value) || is.string(key)) {\r\n          dict.avDictSet(this.encoderOptions, key, value)\r\n        }\r\n      })\r\n    }\r\n\r\n    let ret = 0\r\n\r\n    if (support.jspi) {\r\n      ret = await this.encoder.callAsync<int32>('encoder_open', parameters, timeBaseP, threadCount, this.encoderOptions)\r\n    }\r\n    else {\r\n      ret = this.encoder.call<int32>('encoder_open', parameters, timeBaseP, threadCount, this.encoderOptions)\r\n      await this.encoder.childrenThreadReady()\r\n    }\r\n\r\n    stack.free(sizeof(Rational))\r\n\r\n    if (ret < 0) {\r\n      logger.fatal(`open video decoder failed, ret: ${ret}`)\r\n    }\r\n\r\n    this.parameters = parameters\r\n    this.timeBase = timeBase\r\n\r\n    this.encodeQueueSize = 0\r\n    this.framerate = static_cast<int64>(avQ2D(parameters.framerate))\r\n    this.inputCounter = 0n\r\n  }\r\n\r\n  private preEncode(frame: pointer<AVFrame> | VideoFrame, key: boolean): pointer<AVFrame> {\r\n    if (!isPointer(frame)) {\r\n      if (this.avframe) {\r\n        unrefAVFrame(this.avframe)\r\n      }\r\n      else {\r\n        this.avframe = createAVFrame()\r\n      }\r\n      frame = videoFrame2AVFrame(frame, this.avframe)\r\n    }\r\n\r\n    if (key) {\r\n      frame.pictType = AVPictureType.AV_PICTURE_TYPE_I\r\n    }\r\n\r\n    frame.duration = static_cast<int64>(this.timeBase.den) / this.framerate\r\n    frame.pts = this.inputCounter * static_cast<int64>(this.timeBase.den / this.timeBase.num) / this.framerate\r\n    frame.timeBase.den = this.timeBase.den\r\n    frame.timeBase.num = this.timeBase.num\r\n\r\n    return frame\r\n  }\r\n\r\n  private postEncode() {\r\n    this.encodeQueueSize++\r\n    this.inputCounter++\r\n    while (true) {\r\n      let ret = this.receiveAVPacket()\r\n      if (ret === 1) {\r\n        this.outputAVPacket()\r\n      }\r\n      else if (ret < 0) {\r\n        return ret\r\n      }\r\n      else {\r\n        break\r\n      }\r\n    }\r\n    return 0\r\n  }\r\n\r\n  public async encodeAsync(frame: pointer<AVFrame> | VideoFrame, key: boolean) {\r\n    frame = this.preEncode(frame, key)\r\n\r\n    let ret = await this.encoder.callAsync<int32>('encoder_encode', frame)\r\n    if (ret) {\r\n      return ret\r\n    }\r\n    return this.postEncode()\r\n  }\r\n\r\n  public encode(frame: pointer<AVFrame> | VideoFrame, key: boolean) {\r\n    frame = this.preEncode(frame, key)\r\n\r\n    let ret = this.encoder.call<int32>('encoder_encode', frame)\r\n    if (ret) {\r\n      return ret\r\n    }\r\n\r\n    return this.postEncode()\r\n  }\r\n\r\n  public async flush() {\r\n    this.encoder.call('encoder_flush')\r\n    while (1) {\r\n      const ret = this.receiveAVPacket()\r\n      if (ret < 1) {\r\n        return\r\n      }\r\n      this.outputAVPacket()\r\n    }\r\n  }\r\n\r\n  public getExtraData() {\r\n    if (this.extradata) {\r\n      return this.extradata\r\n    }\r\n\r\n    const pointer = this.encoder.call<pointer<uint8>>('encoder_get_extradata')\r\n    const size = this.encoder.call<int32>('encoder_get_extradata_size')\r\n    if (pointer && size) {\r\n      return mapUint8Array(pointer, size).slice()\r\n    }\r\n    return null\r\n  }\r\n\r\n  public getColorSpace() {\r\n    return {\r\n      colorSpace: this.encoder.call<int32>('encoder_get_color_space'),\r\n      colorPrimaries: this.encoder.call<int32>('encoder_get_color_primaries'),\r\n      colorTrc: this.encoder.call<int32>('encoder_get_color_trc')\r\n    }\r\n  }\r\n\r\n  public close() {\r\n    this.encoder.call('encoder_close')\r\n    this.encoder.destroy()\r\n    this.encoder = null\r\n\r\n    if (this.avpacket) {\r\n      this.options.avpacketPool\r\n        ? this.options.avpacketPool.release(this.avpacket as pointer<AVPacketRef>)\r\n        : destroyAVPacket(this.avpacket)\r\n      this.avpacket = nullptr\r\n    }\r\n\r\n    if (this.avframe) {\r\n      destroyAVFrame(this.avframe)\r\n      this.avframe = nullptr\r\n    }\r\n    if (this.bitrateFilter) {\r\n      this.bitrateFilter.destroy()\r\n      this.bitrateFilter = null\r\n    }\r\n    if (this.encoderOptions) {\r\n      dict.freeAVDict2(this.encoderOptions)\r\n      free(this.encoderOptions)\r\n      this.encoderOptions = nullptr\r\n    }\r\n  }\r\n\r\n  public getQueueLength() {\r\n    return this.encodeQueueSize\r\n  }\r\n}\r\n","/*\r\n * libmedia Webcodec audio decoder\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVPacketSideDataType } from 'avutil/codec'\r\nimport getAudioCodec from '../function/getAudioCodec'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport { mapUint8Array } from 'cheap/std/memory'\r\nimport AVPacket from 'avutil/struct/avpacket'\r\nimport { getAVPacketSideData } from 'avutil/util/avpacket'\r\nimport avpacket2EncodedAudioChunk from 'avutil/function/avpacket2EncodedAudioChunk'\r\nimport * as logger from 'common/util/logger'\r\n\r\nexport type WebAudioDecoderOptions = {\r\n  onReceiveFrame: (frame: AudioData) => void\r\n  onError: (error?: Error) => void\r\n}\r\n\r\nexport default class WebAudioDecoder {\r\n\r\n  private options: WebAudioDecoderOptions\r\n\r\n  private decoder: AudioDecoder\r\n  private parameters: pointer<AVCodecParameters>\r\n\r\n  private extradata: Uint8Array\r\n\r\n  private currentError: Error\r\n\r\n  constructor(options: WebAudioDecoderOptions) {\r\n    this.options = options\r\n  }\r\n\r\n  private output(frame: AudioData) {\r\n    if (this.options.onReceiveFrame) {\r\n      this.options.onReceiveFrame(frame)\r\n    }\r\n    else {\r\n      frame.close()\r\n    }\r\n  }\r\n\r\n  private error(error: Error) {\r\n    this.currentError = error\r\n    this.options.onError(error)\r\n  }\r\n\r\n  public async open(parameters: pointer<AVCodecParameters>) {\r\n    this.currentError = null\r\n    this.parameters = parameters\r\n    this.extradata = null\r\n    if (parameters.extradata !== nullptr) {\r\n      this.extradata = mapUint8Array(parameters.extradata, parameters.extradataSize).slice()\r\n    }\r\n\r\n    const config: AudioDecoderConfig = {\r\n      codec: getAudioCodec(this.parameters),\r\n      sampleRate: parameters.sampleRate,\r\n      numberOfChannels: parameters.chLayout.nbChannels,\r\n      description: this.extradata\r\n    }\r\n\r\n    if (!config.description) {\r\n      // description 不是 arraybuffer 会抛错\r\n      delete config.description\r\n    }\r\n\r\n    const support = await AudioDecoder.isConfigSupported(config)\r\n\r\n    if (!support.supported) {\r\n      throw new Error('not support')\r\n    }\r\n\r\n    if (this.decoder && this.decoder.state !== 'closed') {\r\n      this.decoder.close()\r\n    }\r\n\r\n    this.decoder = new AudioDecoder({\r\n      output: this.output.bind(this),\r\n      error: this.error.bind(this)\r\n    })\r\n\r\n    this.decoder.reset()\r\n    this.decoder.configure(config)\r\n\r\n    if (this.currentError) {\r\n      throw this.currentError\r\n    }\r\n  }\r\n\r\n  public changeExtraData(buffer: Uint8Array) {\r\n    if (buffer.length === this.extradata.length) {\r\n      let same = true\r\n      for (let i = 0; i < buffer.length; i++) {\r\n        if (buffer[i] !== this.extradata[i]) {\r\n          same = false\r\n          break\r\n        }\r\n      }\r\n      if (same) {\r\n        return\r\n      }\r\n    }\r\n\r\n    this.extradata = buffer.slice()\r\n\r\n    this.decoder.reset()\r\n    this.decoder.configure({\r\n      codec: getAudioCodec(this.parameters),\r\n      sampleRate: this.parameters.sampleRate,\r\n      numberOfChannels: this.parameters.chLayout.nbChannels,\r\n      description: this.extradata\r\n    })\r\n\r\n    if (this.currentError) {\r\n      throw this.currentError\r\n    }\r\n  }\r\n\r\n  public decode(avpacket: pointer<AVPacket>, pts?: int64) {\r\n\r\n    const element = getAVPacketSideData(avpacket, AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA)\r\n\r\n    if (element !== nullptr) {\r\n      this.changeExtraData(mapUint8Array(element.data, element.size))\r\n    }\r\n\r\n    const audioChunk = avpacket2EncodedAudioChunk(avpacket, pts)\r\n\r\n    try {\r\n      this.decoder.decode(audioChunk)\r\n    }\r\n    catch (error) {\r\n      logger.error(`decode error, ${error}`)\r\n      return -1\r\n    }\r\n\r\n    return 0\r\n  }\r\n\r\n  public async flush() {\r\n    await this.decoder.flush()\r\n  }\r\n\r\n  public close() {\r\n    if (this.decoder.state !== 'closed') {\r\n      this.decoder.close()\r\n    }\r\n    this.decoder = null\r\n  }\r\n\r\n  public getQueueLength() {\r\n    return this.decoder.decodeQueueSize\r\n  }\r\n\r\n  static async isSupported(parameters: pointer<AVCodecParameters>) {\r\n    let extradata: Uint8Array = null\r\n    if (parameters.extradata !== nullptr) {\r\n      extradata = mapUint8Array(parameters.extradata, parameters.extradataSize).slice()\r\n    }\r\n    const config: AudioDecoderConfig = {\r\n      codec: getAudioCodec(parameters),\r\n      sampleRate: parameters.sampleRate,\r\n      numberOfChannels: parameters.chLayout.nbChannels,\r\n      description: extradata\r\n    }\r\n\r\n    if (!config.description) {\r\n      // description 不是 arraybuffer 会抛错\r\n      delete config.description\r\n    }\r\n\r\n    const support = await AudioDecoder.isConfigSupported(config)\r\n\r\n    return support.supported\r\n  }\r\n}\r\n","/*\r\n * libmedia Webcodec audio encoder\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport AVPacket, { AVPacketPool } from 'avutil/struct/avpacket'\r\nimport getAudioCodec from '../function/getAudioCodec'\r\nimport AVFrame, { AVFramePool, AVFrameRef } from 'avutil/struct/avframe'\r\nimport { avframe2AudioData } from 'avutil/function/avframe2AudioData'\r\nimport { createAVPacket } from 'avutil/util/avpacket'\r\nimport { createAVFrame, destroyAVFrame, refAVFrame } from 'avutil/util/avframe'\r\nimport { Rational } from 'avutil/struct/rational'\r\nimport encodedAudioChunk2AVPacket from 'avutil/function/encodedAudioChunk2AVPacket'\r\nimport { avRescaleQ } from 'avutil/util/rational'\r\nimport { AV_TIME_BASE_Q } from 'avutil/constant'\r\nimport isPointer from 'cheap/std/function/isPointer'\r\nimport * as logger from 'common/util/logger'\r\n\r\nexport type WebAudioEncoderOptions = {\r\n  onReceivePacket: (avpacket: pointer<AVPacket>) => void\r\n  onError: (error?: Error) => void\r\n  avpacketPool?: AVPacketPool\r\n  avframePool?: AVFramePool\r\n}\r\n\r\nexport default class WebAudioEncoder {\r\n\r\n  private encoder: AudioEncoder\r\n\r\n  private options: WebAudioEncoderOptions\r\n  private parameters: pointer<AVCodecParameters>\r\n  private timeBase: Rational\r\n\r\n  private currentError: Error\r\n\r\n  private pts: int64\r\n\r\n  private avframeCache: pointer<AVFrame>[]\r\n\r\n  private extradata: Uint8Array\r\n\r\n  constructor(options: WebAudioEncoderOptions) {\r\n\r\n    this.options = options\r\n    this.avframeCache = []\r\n  }\r\n\r\n  private async output(chunk: EncodedAudioChunk, metadata?: EncodedAudioChunkMetadata) {\r\n\r\n    const avpacket = this.options.avpacketPool ? this.options.avpacketPool.alloc() : createAVPacket()\r\n\r\n    if (!this.extradata) {\r\n      if (metadata?.decoderConfig?.description) {\r\n        let buffer: Uint8Array\r\n        if (metadata.decoderConfig.description instanceof ArrayBuffer) {\r\n          buffer = new Uint8Array(metadata.decoderConfig.description)\r\n        }\r\n        else {\r\n          buffer = new Uint8Array(metadata.decoderConfig.description.buffer)\r\n        }\r\n        this.extradata = buffer\r\n      }\r\n      encodedAudioChunk2AVPacket(chunk, avpacket)\r\n    }\r\n    else {\r\n      encodedAudioChunk2AVPacket(chunk, avpacket, metadata)\r\n    }\r\n\r\n    avpacket.pts = avRescaleQ(this.pts, AV_TIME_BASE_Q, this.timeBase)\r\n    avpacket.dts = avpacket.pts\r\n    avpacket.timeBase.den = this.timeBase.den\r\n    avpacket.timeBase.num = this.timeBase.num\r\n\r\n    this.pts += avpacket.duration\r\n\r\n    this.options.onReceivePacket(avpacket)\r\n\r\n    const avframe = this.avframeCache.shift()\r\n    if (avframe) {\r\n      this.options.avframePool\r\n        ? this.options.avframePool.release(reinterpret_cast<pointer<AVFrameRef>>(avframe))\r\n        : destroyAVFrame(avframe)\r\n    }\r\n  }\r\n\r\n  private error(error: Error) {\r\n    this.options.onError(error)\r\n  }\r\n\r\n  public async open(parameters: pointer<AVCodecParameters>, timeBase: Rational) {\r\n\r\n    this.currentError = null\r\n\r\n    const config: AudioEncoderConfig = {\r\n      codec: getAudioCodec(parameters),\r\n      sampleRate: parameters.sampleRate,\r\n      numberOfChannels: parameters.chLayout.nbChannels,\r\n      bitrate: static_cast<double>(parameters.bitrate),\r\n      bitrateMode: 'constant'\r\n    }\r\n\r\n    const support = await AudioEncoder.isConfigSupported(config)\r\n\r\n    if (!support.supported) {\r\n      throw new Error('not support')\r\n    }\r\n\r\n    if (this.encoder && this.encoder.state !== 'closed') {\r\n      this.encoder.close()\r\n    }\r\n\r\n    this.encoder = new AudioEncoder({\r\n      output: this.output.bind(this),\r\n      error: this.error.bind(this)\r\n    })\r\n\r\n    this.encoder.reset()\r\n    this.encoder.configure(config)\r\n\r\n    if (this.currentError) {\r\n      throw this.currentError\r\n    }\r\n\r\n    this.pts = 0n\r\n    this.parameters = parameters\r\n    this.timeBase = timeBase\r\n  }\r\n\r\n  public encode(frame: AudioData | pointer<AVFrame>) {\r\n    if (isPointer(frame)) {\r\n      const cache = this.options.avframePool ? this.options.avframePool.alloc() : createAVFrame()\r\n      refAVFrame(cache, frame)\r\n      this.avframeCache.push(cache)\r\n      cache.pts = 0n\r\n      frame = avframe2AudioData(cache)\r\n    }\r\n    try {\r\n      this.encoder.encode(frame)\r\n      return 0\r\n    }\r\n    catch (error) {\r\n      logger.error(`encode error, ${error}`)\r\n      return -1\r\n    }\r\n  }\r\n\r\n  public async flush() {\r\n    await this.encoder.flush()\r\n  }\r\n\r\n  public close() {\r\n    if (this.encoder) {\r\n      if (this.encoder.state !== 'closed') {\r\n        this.encoder.close()\r\n      }\r\n    }\r\n    if (this.avframeCache.length) {\r\n      this.avframeCache.forEach((avframe) => {\r\n        this.options.avframePool\r\n          ? this.options.avframePool.release(reinterpret_cast<pointer<AVFrameRef>>(avframe))\r\n          : destroyAVFrame(avframe)\r\n      })\r\n    }\r\n    this.encoder = null\r\n  }\r\n\r\n  public getExtraData() {\r\n    return this.extradata\r\n  }\r\n\r\n  public getQueueLength() {\r\n    return this.encoder.encodeQueueSize\r\n  }\r\n\r\n  static async isSupported(parameters: pointer<AVCodecParameters>) {\r\n    const config: AudioEncoderConfig = {\r\n      codec: getAudioCodec(parameters),\r\n      sampleRate: parameters.sampleRate,\r\n      numberOfChannels: parameters.chLayout.nbChannels,\r\n      bitrate: static_cast<double>(parameters.bitrate),\r\n      bitrateMode: 'constant'\r\n    }\r\n\r\n    const support = await AudioEncoder.isConfigSupported(config)\r\n\r\n    return support.supported\r\n  }\r\n}\r\n","/*\r\n * libmedia Webcodec video decoder\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVPacketSideDataType } from 'avutil/codec'\r\nimport browser from 'common/util/browser'\r\nimport getVideoCodec from '../function/getVideoCodec'\r\nimport AVPacket, { AVPacketFlags } from 'avutil/struct/avpacket'\r\nimport { mapUint8Array } from 'cheap/std/memory'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport { getAVPacketSideData } from 'avutil/util/avpacket'\r\nimport { getHardwarePreference } from '../function/getHardwarePreference'\r\nimport { BitFormat } from 'avformat/codecs/h264'\r\nimport avpacket2EncodedVideoChunk from 'avutil/function/avpacket2EncodedVideoChunk'\r\nimport * as logger from 'common/util/logger'\r\n\r\nexport type WebVideoDecoderOptions = {\r\n  onReceiveFrame: (frame: VideoFrame) => void\r\n  enableHardwareAcceleration?: boolean\r\n  onError: (error?: Error) => void\r\n}\r\n\r\nexport default class WebVideoDecoder {\r\n\r\n  private decoder: VideoDecoder\r\n\r\n  private options: WebVideoDecoderOptions\r\n  private parameters: pointer<AVCodecParameters>\r\n\r\n  private extradata: Uint8Array\r\n\r\n  private currentError: Error\r\n\r\n  private inputQueue: number[]\r\n  private outputQueue: VideoFrame[]\r\n\r\n  private sort: boolean\r\n\r\n  private keyframeRequire: boolean\r\n\r\n  constructor(options: WebVideoDecoderOptions) {\r\n\r\n    this.options = options\r\n    this.inputQueue = []\r\n    this.outputQueue = []\r\n\r\n    this.sort = browser.safari\r\n  }\r\n\r\n  private async output(frame: VideoFrame) {\r\n    if (this.sort) {\r\n      let i = 0\r\n      for (; i < this.outputQueue.length; i++) {\r\n        if (this.outputQueue[i].timestamp > frame.timestamp) {\r\n          this.outputQueue.splice(i, 0, frame)\r\n          break\r\n        }\r\n      }\r\n      if (i === this.outputQueue.length) {\r\n        this.outputQueue.push(frame)\r\n      }\r\n\r\n      while (this.outputQueue.length > 2\r\n        && this.outputQueue[0].timestamp === this.inputQueue[0]\r\n      ) {\r\n        const output = this.outputQueue.shift()\r\n        if (this.options.onReceiveFrame) {\r\n          this.options.onReceiveFrame(output)\r\n        }\r\n        else {\r\n          output.close()\r\n        }\r\n        this.inputQueue.shift()\r\n      }\r\n    }\r\n    else {\r\n      if (this.options.onReceiveFrame) {\r\n        this.options.onReceiveFrame(frame)\r\n      }\r\n      else {\r\n        frame.close()\r\n      }\r\n    }\r\n  }\r\n\r\n  private error(error: Error) {\r\n    this.currentError = error\r\n    this.options.onError(error)\r\n  }\r\n\r\n  private changeExtraData(buffer: Uint8Array) {\r\n    if (buffer.length === this.extradata.length) {\r\n      let same = true\r\n      for (let i = 0; i < buffer.length; i++) {\r\n        if (buffer[i] !== this.extradata[i]) {\r\n          same = false\r\n          break\r\n        }\r\n      }\r\n      if (same) {\r\n        return\r\n      }\r\n    }\r\n\r\n    this.extradata = buffer.slice()\r\n\r\n    this.decoder.reset()\r\n\r\n    this.decoder.configure({\r\n      codec: getVideoCodec(this.parameters, buffer),\r\n      description: this.extradata,\r\n      hardwareAcceleration: getHardwarePreference(this.options.enableHardwareAcceleration ?? true)\r\n    })\r\n\r\n    this.keyframeRequire = true\r\n  }\r\n\r\n  public async open(parameters: pointer<AVCodecParameters>) {\r\n    this.currentError = null\r\n    this.extradata = null\r\n    if (parameters.extradata !== nullptr) {\r\n      this.extradata = mapUint8Array(parameters.extradata, parameters.extradataSize).slice()\r\n    }\r\n    this.parameters = parameters\r\n\r\n    const config = {\r\n      codec: getVideoCodec(parameters),\r\n      codedWidth: parameters.width,\r\n      codedHeight: parameters.height,\r\n      description: (parameters.bitFormat !== BitFormat.ANNEXB) ? this.extradata : undefined,\r\n      hardwareAcceleration: getHardwarePreference(this.options.enableHardwareAcceleration ?? true)\r\n    }\r\n\r\n    if (!config.description) {\r\n      // description 不是 arraybuffer 会抛错\r\n      delete config.description\r\n    }\r\n\r\n    const support = await VideoDecoder.isConfigSupported(config)\r\n\r\n    if (!support.supported) {\r\n      throw new Error('not support')\r\n    }\r\n\r\n    if (this.decoder && this.decoder.state !== 'closed') {\r\n      this.decoder.close()\r\n    }\r\n\r\n    this.decoder = new VideoDecoder({\r\n      output: this.output.bind(this),\r\n      error: this.error.bind(this)\r\n    })\r\n\r\n    this.decoder.reset()\r\n    this.decoder.configure(config)\r\n\r\n    if (this.currentError) {\r\n      throw this.currentError\r\n    }\r\n\r\n    this.keyframeRequire = true\r\n\r\n    this.inputQueue.length = 0\r\n    this.outputQueue.length = 0\r\n  }\r\n\r\n  public decode(avpacket: pointer<AVPacket>) {\r\n\r\n    const element = getAVPacketSideData(avpacket, AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA)\r\n\r\n    if (element !== nullptr) {\r\n      this.changeExtraData(mapUint8Array(element.data, element.size))\r\n    }\r\n\r\n    const key = avpacket.flags & AVPacketFlags.AV_PKT_FLAG_KEY\r\n\r\n    if (this.keyframeRequire && !key) {\r\n      return 0\r\n    }\r\n\r\n    const timestamp = static_cast<double>(avpacket.pts)\r\n\r\n    const videoChunk = avpacket2EncodedVideoChunk(avpacket)\r\n\r\n    if (this.sort) {\r\n      let i = 0\r\n      for (; i < this.inputQueue.length; i++) {\r\n        if (this.inputQueue[i] > timestamp) {\r\n          this.inputQueue.splice(i, 0, timestamp)\r\n          break\r\n        }\r\n      }\r\n      if (i === this.inputQueue.length) {\r\n        this.inputQueue.push(timestamp)\r\n      }\r\n    }\r\n\r\n    try {\r\n      this.decoder.decode(videoChunk)\r\n    }\r\n    catch (error) {\r\n      logger.error(`decode error, ${error}`)\r\n      return -1\r\n    }\r\n\r\n    if (key) {\r\n      this.keyframeRequire = false\r\n    }\r\n\r\n    return 0\r\n  }\r\n\r\n  public async flush() {\r\n    await this.decoder.flush()\r\n    if (this.sort) {\r\n      while (this.outputQueue.length) {\r\n        const frame = this.outputQueue.shift()\r\n        if (this.options.onReceiveFrame) {\r\n          this.options.onReceiveFrame(frame)\r\n        }\r\n        else {\r\n          frame.close()\r\n        }\r\n      }\r\n    }\r\n    this.keyframeRequire = true\r\n  }\r\n\r\n  public close() {\r\n    if (this.decoder && this.decoder.state !== 'closed') {\r\n      this.decoder.close()\r\n    }\r\n    this.decoder = null\r\n    this.currentError = null\r\n\r\n    if (this.outputQueue?.length) {\r\n      this.outputQueue.forEach((frame) => {\r\n        frame.close()\r\n      })\r\n    }\r\n\r\n    this.inputQueue = null\r\n    this.outputQueue = null\r\n  }\r\n\r\n  public getQueueLength() {\r\n    return this.decoder.decodeQueueSize\r\n  }\r\n\r\n  public setSkipFrameDiscard(discard: number) {\r\n\r\n  }\r\n\r\n  static async isSupported(parameters: pointer<AVCodecParameters>, enableHardwareAcceleration: boolean) {\r\n    let extradata: Uint8Array = null\r\n    if (parameters.extradata !== nullptr) {\r\n      extradata = mapUint8Array(parameters.extradata, parameters.extradataSize).slice()\r\n    }\r\n    const config = {\r\n      codec: getVideoCodec(parameters),\r\n      codedWidth: parameters.width,\r\n      codedHeight: parameters.height,\r\n      description: (parameters.bitFormat !== BitFormat.ANNEXB) ? extradata : undefined,\r\n      hardwareAcceleration: getHardwarePreference(enableHardwareAcceleration ?? true)\r\n    }\r\n\r\n    if (!config.description) {\r\n      // description 不是 arraybuffer 会抛错\r\n      delete config.description\r\n    }\r\n\r\n    const support = await VideoDecoder.isConfigSupported(config)\r\n\r\n    return support.supported\r\n  }\r\n}\r\n","/*\r\n * libmedia Webcodec video encoder\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVPacket, { AVPacketPool } from 'avutil/struct/avpacket'\r\nimport { AVCodecID } from 'avutil/codec'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport AVFrame, { AVFramePool, AVFrameRef } from 'avutil/struct/avframe'\r\nimport getVideoCodec from '../function/getVideoCodec'\r\nimport { getHardwarePreference } from '../function/getHardwarePreference'\r\nimport { avQ2D, avRescaleQ } from 'avutil/util/rational'\r\nimport { avframe2VideoFrame } from 'avutil/function/avframe2VideoFrame'\r\nimport { createAVPacket, getAVPacketData } from 'avutil/util/avpacket'\r\nimport { AV_TIME_BASE_Q } from 'avutil/constant'\r\nimport { BitFormat } from 'avformat/codecs/h264'\r\nimport { PixelFormatDescriptorsMap, PixelFormatFlags } from 'avutil/pixelFormatDescriptor'\r\nimport { createAVFrame, destroyAVFrame, refAVFrame } from 'avutil/util/avframe'\r\nimport { Rational } from 'avutil/struct/rational'\r\nimport encodedVideoChunk2AVPacket from 'avutil/function/encodedVideoChunk2AVPacket'\r\nimport { mapColorPrimaries, mapColorSpace, mapColorTrc } from 'avutil/function/videoFrame2AVFrame'\r\nimport browser from 'common/util/browser'\r\nimport * as logger from 'common/util/logger'\r\n\r\nimport * as av1 from 'avformat/codecs/av1'\r\nimport * as vp9 from 'avformat/codecs/vp9'\r\nimport isPointer from 'cheap/std/function/isPointer'\r\n\r\nexport type WebVideoEncoderOptions = {\r\n  onReceivePacket: (avpacket: pointer<AVPacket>) => void\r\n  onError: (error?: Error) => void\r\n  enableHardwareAcceleration?: boolean\r\n  avpacketPool?: AVPacketPool\r\n  avframePool?: AVFramePool\r\n}\r\n\r\n// chrome bug: https://issues.chromium.org/issues/357902526\r\nfunction fixChromeConstraintSetFlagsBug(desc: Uint8Array) {\r\n  const constraintSetFlag = desc[2]\r\n  // 如果最高位是 0，最低位是 1，说明是 chrome 将这个值的二进制顺序搞反了\r\n  if (constraintSetFlag >> 7 === 0 && (constraintSetFlag & 1) === 1) {\r\n    let binaryString = constraintSetFlag\r\n      .toString(2)\r\n      .padStart(8, '0')\r\n      .split('')\r\n      .reverse()\r\n      .join('')\r\n\r\n    desc[2] = parseInt(binaryString, 2)\r\n  }\r\n}\r\n\r\nexport default class WebVideoEncoder {\r\n\r\n  private encoder: VideoEncoder\r\n\r\n  private options: WebVideoEncoderOptions\r\n  private parameters: pointer<AVCodecParameters>\r\n  private timeBase: Rational\r\n\r\n  private currentError: Error\r\n\r\n  private avframeMap: Map<int64, pointer<AVFrame>>\r\n\r\n  private framerate: int64\r\n\r\n  private inputCounter: int64\r\n  private outputCounter: int64\r\n\r\n  private extradata: Uint8Array\r\n\r\n  constructor(options: WebVideoEncoderOptions) {\r\n\r\n    this.options = options\r\n\r\n    this.avframeMap = new Map()\r\n  }\r\n\r\n  private async output(chunk: EncodedVideoChunk, metadata?: EncodedVideoChunkMetadata & {\r\n    svc?: {\r\n      temporalLayerId: number\r\n    }\r\n    alphaSideData?: BufferSource\r\n  }) {\r\n\r\n    const inputCounter = static_cast<int64>(chunk.timestamp)\r\n    const pts = inputCounter * 1000000n / this.framerate\r\n    const dts = static_cast<int64>(this.outputCounter++) * 1000000n / this.framerate\r\n\r\n    const avpacket = this.options.avpacketPool ? this.options.avpacketPool.alloc() : createAVPacket()\r\n\r\n    if (!this.extradata) {\r\n      if (metadata?.decoderConfig?.description) {\r\n        let buffer: Uint8Array\r\n        if (metadata.decoderConfig.description instanceof ArrayBuffer) {\r\n          buffer = new Uint8Array(metadata.decoderConfig.description)\r\n        }\r\n        else {\r\n          buffer = new Uint8Array(metadata.decoderConfig.description.buffer)\r\n        }\r\n        if (browser.chrome && !browser.checkVersion(browser.version, '130', true)) {\r\n          fixChromeConstraintSetFlagsBug(buffer)\r\n        }\r\n        this.extradata = buffer\r\n      }\r\n      if (metadata?.decoderConfig?.colorSpace) {\r\n        this.parameters.colorSpace = mapColorSpace(metadata.decoderConfig.colorSpace.matrix)\r\n        this.parameters.colorPrimaries = mapColorPrimaries(metadata.decoderConfig.colorSpace.primaries)\r\n        this.parameters.colorTrc = mapColorTrc(metadata.decoderConfig.colorSpace.transfer)\r\n      }\r\n\r\n      encodedVideoChunk2AVPacket(chunk, avpacket)\r\n\r\n      if (!this.extradata) {\r\n        let extradata: Uint8Array\r\n        if (this.parameters.codecId === AVCodecID.AV_CODEC_ID_AV1) {\r\n          extradata = av1.generateExtradata(this.parameters, getAVPacketData(avpacket))\r\n        }\r\n        else if (this.parameters.codecId === AVCodecID.AV_CODEC_ID_VP9) {\r\n          extradata = vp9.generateExtradata(this.parameters)\r\n        }\r\n        if (extradata) {\r\n          this.extradata = extradata\r\n        }\r\n      }\r\n    }\r\n    else {\r\n      encodedVideoChunk2AVPacket(chunk, avpacket, metadata)\r\n    }\r\n\r\n    avpacket.pts = avRescaleQ(pts, AV_TIME_BASE_Q, this.timeBase)\r\n    avpacket.dts = avRescaleQ(dts, AV_TIME_BASE_Q, this.timeBase)\r\n    avpacket.timeBase.den = this.timeBase.den\r\n    avpacket.timeBase.num = this.timeBase.num\r\n\r\n    if (this.parameters.codecId === AVCodecID.AV_CODEC_ID_H264\r\n      || this.parameters.codecId === AVCodecID.AV_CODEC_ID_HEVC\r\n      || this.parameters.codecId === AVCodecID.AV_CODEC_ID_VVC\r\n    ) {\r\n      avpacket.bitFormat = this.parameters.bitFormat\r\n    }\r\n\r\n    this.options.onReceivePacket(avpacket)\r\n\r\n    const avframe = this.avframeMap.get(inputCounter)\r\n\r\n    if (avframe) {\r\n      this.options.avframePool\r\n        ? this.options.avframePool.release(reinterpret_cast<pointer<AVFrameRef>>(avframe))\r\n        : destroyAVFrame(avframe)\r\n    }\r\n    this.avframeMap.delete(inputCounter)\r\n  }\r\n\r\n  private error(error: Error) {\r\n    this.currentError = error\r\n    this.options.onError(error)\r\n  }\r\n\r\n  public async open(parameters: pointer<AVCodecParameters>, timeBase: Rational) {\r\n    this.currentError = null\r\n\r\n    const descriptor = PixelFormatDescriptorsMap[parameters.format]\r\n\r\n    // webcodecs 目前还不支持 hdr\r\n    if (!descriptor || descriptor.comp[0].depth > 8) {\r\n      logger.fatal(`format ${parameters.format} not support`)\r\n    }\r\n\r\n    const config: VideoEncoderConfig = {\r\n      codec: getVideoCodec(parameters),\r\n      width: parameters.width,\r\n      height: parameters.height,\r\n      bitrate: static_cast<double>(parameters.bitrate),\r\n      framerate: avQ2D(parameters.framerate),\r\n      hardwareAcceleration: getHardwarePreference(this.options.enableHardwareAcceleration ?? true),\r\n      latencyMode: parameters.videoDelay ? 'quality' : 'realtime',\r\n      alpha: descriptor && (descriptor.flags & PixelFormatFlags.ALPHA) ? 'keep' : 'discard'\r\n    }\r\n\r\n    if (parameters.codecId === AVCodecID.AV_CODEC_ID_H264\r\n      || parameters.codecId === AVCodecID.AV_CODEC_ID_HEVC\r\n      || parameters.codecId === AVCodecID.AV_CODEC_ID_VVC\r\n    ) {\r\n      config.avc = {\r\n        format: parameters.bitFormat === BitFormat.AVCC ? 'avc' : 'annexb'\r\n      }\r\n    }\r\n\r\n    const support = await VideoEncoder.isConfigSupported(config)\r\n\r\n    if (!support.supported) {\r\n      logger.fatal('not support')\r\n    }\r\n\r\n    if (this.encoder && this.encoder.state !== 'closed') {\r\n      this.encoder.close()\r\n    }\r\n\r\n    this.encoder = new VideoEncoder({\r\n      output: this.output.bind(this),\r\n      error: this.error.bind(this)\r\n    })\r\n\r\n    this.encoder.reset()\r\n    this.encoder.configure(config)\r\n\r\n    if (this.currentError) {\r\n      throw this.currentError\r\n    }\r\n\r\n    this.parameters = parameters\r\n    this.timeBase = timeBase\r\n    this.inputCounter = 0n\r\n    this.outputCounter = 0n\r\n    this.framerate = static_cast<int64>(avQ2D(parameters.framerate))\r\n  }\r\n\r\n  public encode(frame: VideoFrame | pointer<AVFrame>, key: boolean) {\r\n    if (isPointer(frame)) {\r\n      const cache = this.options.avframePool ? this.options.avframePool.alloc() : createAVFrame()\r\n      refAVFrame(cache, frame)\r\n      cache.pts = this.inputCounter\r\n      if (cache.duration) {\r\n        cache.duration = avRescaleQ(cache.duration, frame.timeBase, AV_TIME_BASE_Q)\r\n      }\r\n      else {\r\n        cache.duration = 1000000n / this.framerate\r\n      }\r\n      this.avframeMap.set(cache.pts, cache)\r\n      frame = avframe2VideoFrame(cache)\r\n    }\r\n    else {\r\n      frame = new VideoFrame(frame, {\r\n        timestamp: static_cast<double>(this.inputCounter),\r\n        duration: static_cast<double>(1000000n / this.framerate)\r\n      })\r\n    }\r\n    try {\r\n      this.encoder.encode(frame, {\r\n        keyFrame: key\r\n      })\r\n      frame.close()\r\n      this.inputCounter++\r\n      return 0\r\n    }\r\n    catch (error) {\r\n      logger.error(`encode error, ${error}`)\r\n      frame.close()\r\n      return -1\r\n    }\r\n  }\r\n\r\n  public async flush() {\r\n    await this.encoder.flush()\r\n  }\r\n\r\n  public close() {\r\n    if (this.encoder) {\r\n      if (this.encoder.state !== 'closed') {\r\n        this.encoder.close()\r\n      }\r\n    }\r\n    if (this.avframeMap.size) {\r\n      this.avframeMap.forEach((avframe) => {\r\n        this.options.avframePool\r\n          ? this.options.avframePool.release(reinterpret_cast<pointer<AVFrameRef>>(avframe))\r\n          : destroyAVFrame(avframe)\r\n      })\r\n    }\r\n    this.encoder = null\r\n  }\r\n\r\n  public getExtraData() {\r\n    return this.extradata\r\n  }\r\n\r\n  public getColorSpace() {\r\n    return {\r\n      colorSpace: this.parameters.colorSpace,\r\n      colorPrimaries: this.parameters.colorPrimaries,\r\n      colorTrc: this.parameters.colorTrc,\r\n    }\r\n  }\r\n\r\n  public getQueueLength() {\r\n    return this.encoder.encodeQueueSize\r\n  }\r\n\r\n  static async isSupported(parameters: pointer<AVCodecParameters>, enableHardwareAcceleration: boolean) {\r\n    const descriptor = PixelFormatDescriptorsMap[parameters.format]\r\n    // webcodecs 目前还不支持 hdr\r\n    if (!descriptor || descriptor.comp[0].depth > 8) {\r\n      return false\r\n    }\r\n    const config: VideoEncoderConfig = {\r\n      codec: getVideoCodec(parameters),\r\n      width: parameters.width,\r\n      height: parameters.height,\r\n      bitrate: static_cast<double>(parameters.bitrate),\r\n      framerate: avQ2D(parameters.framerate),\r\n      hardwareAcceleration: getHardwarePreference(enableHardwareAcceleration ?? true),\r\n      latencyMode: parameters.videoDelay ? 'quality' : 'realtime',\r\n      alpha: descriptor && (descriptor.flags & PixelFormatFlags.ALPHA) ? 'keep' : 'discard'\r\n    }\r\n\r\n    if (parameters.codecId === AVCodecID.AV_CODEC_ID_H264\r\n      || parameters.codecId === AVCodecID.AV_CODEC_ID_HEVC\r\n      || parameters.codecId === AVCodecID.AV_CODEC_ID_VVC\r\n    ) {\r\n      config.avc = {\r\n        format: parameters.bitFormat === BitFormat.AVCC ? 'avc' : 'annexb'\r\n      }\r\n    }\r\n\r\n    const support = await VideoEncoder.isConfigSupported(config)\r\n\r\n    return support.supported\r\n  }\r\n}\r\n","\r\n/*\r\n * libmedia AVFilter\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVFrame, { AVFramePool, AVFrameRef } from 'avutil/struct/avframe'\r\nimport { destroyAVFrame } from 'avutil/util/avframe'\r\nimport IPCPort, { NOTIFY, REQUEST, RpcMessage } from 'common/network/IPCPort'\r\nimport * as array from 'common/util/array'\r\nimport isPointer from 'cheap/std/function/isPointer'\r\nimport * as is from 'common/util/is'\r\nimport AVOutputNode from './AVOutputNode'\r\n\r\nexport interface AVFilterNodeOptions {\r\n  avframePool?: AVFramePool\r\n}\r\n\r\nexport class AVFilterNodePort extends IPCPort {\r\n\r\n  private channel: MessageChannel | MessagePort\r\n\r\n  private next: AVFilterNodePort\r\n\r\n  constructor(channel: MessageChannel | MessagePort) {\r\n    super(channel instanceof MessageChannel ? channel.port1 : channel)\r\n    this.channel = channel\r\n  }\r\n\r\n  public connect(port: AVFilterNodePort) {\r\n    this.off()\r\n    port.off()\r\n\r\n    this.on(REQUEST, async (request: RpcMessage) => {\r\n      try {\r\n        const result = await port.request<pointer<AVFrame> | VideoFrame>(request.method, request.params)\r\n        this.reply(request, result, null, (isPointer(result) || is.number(result) || request.method !== 'pull') ? null : [result])\r\n      }\r\n      catch (error) {\r\n        this.reply(request, null, error)\r\n      }\r\n    })\r\n    this.on(NOTIFY, (message: RpcMessage) => {\r\n      port.notify(message.method, message.params)\r\n    })\r\n\r\n    port.on(REQUEST, async (request: RpcMessage) => {\r\n      try {\r\n        const result = await this.request<pointer<AVFrame> | VideoFrame>(request.method, request.params)\r\n        port.reply(request, result, null, (isPointer(result) || is.number(result) || request.method !== 'pull') ? null : [result])\r\n      }\r\n      catch (error) {\r\n        port.reply(request, null, error)\r\n      }\r\n    })\r\n    port.on(NOTIFY, (message: RpcMessage) => {\r\n      this.notify(message.method, message.params)\r\n    })\r\n\r\n    this.next = port\r\n  }\r\n\r\n  public disconnect() {\r\n    this.off()\r\n    if (this.next) {\r\n      this.next.off()\r\n    }\r\n    this.next = null\r\n  }\r\n\r\n  public getInnerPort() {\r\n    if (this.channel instanceof MessageChannel) {\r\n      return this.channel.port2\r\n    }\r\n  }\r\n}\r\n\r\nexport default abstract class AVFilterNode {\r\n\r\n  protected options: AVFilterNodeOptions\r\n\r\n  protected inputAVFilterNodePort: AVFilterNodePort[]\r\n  protected outputAVFilterNodePort: AVFilterNodePort[]\r\n\r\n  protected inputInnerNodePort: IPCPort[]\r\n  protected outputInnerNodePort: IPCPort[]\r\n\r\n  private currentOutput: (pointer<AVFrame> | VideoFrame)[]\r\n  private consumedCount: number\r\n  private pending: { resolve: (data?: any) => void, reject: () => void }[]\r\n\r\n  protected inputCount: number\r\n  protected outputCount: number\r\n\r\n  private inputConnectedMap: Map<any, number>\r\n  private outputConnectedMap: Map<any, number>\r\n\r\n  constructor(options: AVFilterNodeOptions, inputCount: number, outputCount: number) {\r\n    this.options = options\r\n    this.inputCount = inputCount\r\n    this.outputCount = outputCount\r\n\r\n    this.inputAVFilterNodePort = []\r\n    this.outputAVFilterNodePort = []\r\n\r\n    this.inputInnerNodePort = []\r\n    this.outputInnerNodePort = []\r\n\r\n    for (let i = 0; i < this.inputCount; i++) {\r\n      const port = new AVFilterNodePort(new MessageChannel())\r\n      this.inputAVFilterNodePort.push(port)\r\n      this.inputInnerNodePort.push(new IPCPort(port.getInnerPort()))\r\n    }\r\n    for (let i = 0; i < this.outputCount; i++) {\r\n      const port = new AVFilterNodePort(new MessageChannel())\r\n      this.outputAVFilterNodePort.push(port)\r\n      this.outputInnerNodePort.push(new IPCPort(port.getInnerPort()))\r\n    }\r\n\r\n    this.consumedCount = 0\r\n    this.pending = []\r\n    this.currentOutput = []\r\n\r\n    for (let i = 0; i < this.outputCount; i++) {\r\n      this.handlePull(this.outputInnerNodePort[i], i)\r\n    }\r\n\r\n    this.inputConnectedMap = new Map()\r\n    this.outputConnectedMap = new Map()\r\n  }\r\n\r\n  private handlePull(port: IPCPort, index: number) {\r\n    port.on(REQUEST, async (request: RpcMessage) => {\r\n      switch (request.method) {\r\n        case 'pull': {\r\n          if (this.consumedCount === 0) {\r\n            const input: (pointer<AVFrame> | VideoFrame)[] = []\r\n            this.currentOutput.length = 0\r\n            for (let i = 0; i < this.inputCount; i++) {\r\n              input.push(await this.inputInnerNodePort[i].request('pull'))\r\n            }\r\n\r\n            await this.process(input, this.currentOutput)\r\n\r\n            input.forEach((frame) => {\r\n              if (is.number(frame) && frame < 0) {\r\n                return\r\n              }\r\n              if (isPointer(frame)) {\r\n                if (frame > 0) {\r\n                  this.options.avframePool ? this.options.avframePool.release(reinterpret_cast<pointer<AVFrameRef>>(frame)) : destroyAVFrame(frame)\r\n                }\r\n              }\r\n              else {\r\n                frame.close()\r\n              }\r\n            })\r\n\r\n            port.reply(\r\n              request,\r\n              this.currentOutput[index],\r\n              null,\r\n              (isPointer(this.currentOutput[index])\r\n                || is.number(this.currentOutput[index])\r\n              )\r\n                ? null\r\n                : [this.currentOutput[index]]\r\n            )\r\n            this.consumedCount++\r\n\r\n            if (this.pending.length) {\r\n              this.pending.forEach((item) => {\r\n                item.resolve()\r\n              })\r\n              this.pending.length = 0\r\n            }\r\n            if (this.consumedCount === this.outputCount) {\r\n              this.consumedCount = 0\r\n              this.currentOutput.length = 0\r\n            }\r\n          }\r\n          else if (this.consumedCount === this.outputCount - 1) {\r\n            port.reply(\r\n              request,\r\n              this.currentOutput[index],\r\n              null,\r\n              (isPointer(this.currentOutput[index])\r\n                || is.number(this.currentOutput[index])\r\n              )\r\n                ? null\r\n                : [this.currentOutput[index]]\r\n            )\r\n            this.consumedCount = 0\r\n            this.currentOutput.length = 0\r\n          }\r\n          else {\r\n            await new Promise((resolve, reject) => {\r\n              this.pending.push({\r\n                resolve,\r\n                reject\r\n              })\r\n            })\r\n            port.reply(\r\n              request,\r\n              this.currentOutput[index],\r\n              null,\r\n              (isPointer(this.currentOutput[index])\r\n                || is.number(this.currentOutput[index])\r\n              )\r\n                ? null\r\n                : [this.currentOutput[index]]\r\n            )\r\n            this.consumedCount++\r\n          }\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  public getInputNodePort(index: number) {\r\n    return this.inputAVFilterNodePort[index]\r\n  }\r\n\r\n  public getOutputNodePort(index: number) {\r\n    return this.outputAVFilterNodePort[index]\r\n  }\r\n\r\n  public getInputCount() {\r\n    return this.inputCount\r\n  }\r\n\r\n  public getOutputCount() {\r\n    return this.outputCount\r\n  }\r\n\r\n  public getFreeInputNodePort() {\r\n\r\n    const used: number[] = []\r\n\r\n    this.inputConnectedMap.forEach((index, node) => {\r\n      used.push(index)\r\n    })\r\n\r\n    for (let i = 0; i < this.inputCount; i++) {\r\n      if (!array.has(used, i)) {\r\n        return {\r\n          index: i,\r\n          port: this.getInputNodePort(i)\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public getFreeOutputNodePort() {\r\n\r\n    const used: number[] = []\r\n\r\n    this.outputConnectedMap.forEach((index, node) => {\r\n      used.push(index)\r\n    })\r\n\r\n    for (let i = 0; i < this.outputCount; i++) {\r\n      if (!array.has(used, i)) {\r\n        return {\r\n          index: i,\r\n          port: this.getOutputNodePort(i)\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public addInputPeer(node: any, index: number) {\r\n    this.inputConnectedMap.set(node, index)\r\n  }\r\n\r\n  public removeInputPeer(node: any) {\r\n    this.inputConnectedMap.delete(node)\r\n  }\r\n\r\n  public addOutputPeer(node: any, index: number) {\r\n    this.outputConnectedMap.set(node, index)\r\n  }\r\n\r\n  public removeOutputPeer(node: any) {\r\n    this.outputConnectedMap.delete(node)\r\n  }\r\n\r\n  public connect(node: AVFilterNode | AVOutputNode) {\r\n    if (this.outputConnectedMap.size === this.outputCount) {\r\n      throw new Error('all output has connected')\r\n    }\r\n\r\n    const output = this.getFreeOutputNodePort()\r\n    const nextInput = node.getFreeInputNodePort()\r\n\r\n    if (!nextInput) {\r\n      throw new Error('next node all input has connected')\r\n    }\r\n\r\n    output.port.connect(nextInput.port)\r\n\r\n    this.outputConnectedMap.set(node, output.index)\r\n    node.addInputPeer(this, nextInput.index)\r\n  }\r\n\r\n  private disconnectNode(node: any) {\r\n    if (!this.outputConnectedMap.has(node)) {\r\n      return\r\n    }\r\n    this.outputAVFilterNodePort[this.outputConnectedMap.get(node)].disconnect()\r\n    this.outputConnectedMap.delete(node)\r\n\r\n    if (node instanceof AVFilterNode) {\r\n      node.removeInputPeer(this)\r\n    }\r\n  }\r\n\r\n  public disconnect(node?: any) {\r\n    if (node) {\r\n      return this.disconnectNode(node)\r\n    }\r\n    this.outputConnectedMap.forEach((index, node) => {\r\n      this.disconnectNode(node)\r\n    })\r\n  }\r\n\r\n  public abstract ready(): void | Promise<void>\r\n  public abstract destroy(): void | Promise<void>\r\n  public abstract process(inputs: (pointer<AVFrame> | VideoFrame)[], outputs: (pointer<AVFrame> | VideoFrame)[]): void | Promise<void>\r\n}\r\n","import AVFilterNode, { AVFilterNodePort } from './AVFilterNode'\r\nimport AVOutputNode from './AVOutputNode'\r\n\r\nexport default class AVInputNode {\r\n\r\n  private nodePort: AVFilterNodePort\r\n\r\n  private outputNode: AVFilterNode | AVOutputNode\r\n\r\n  constructor(port: MessagePort) {\r\n    this.nodePort = new AVFilterNodePort(port)\r\n  }\r\n\r\n  public connect(node: AVFilterNode | AVOutputNode) {\r\n    const { port: nextPort, index } = node.getFreeInputNodePort()\r\n    this.nodePort.connect(nextPort)\r\n    node.addInputPeer(this, index)\r\n    this.outputNode = node\r\n  }\r\n\r\n}\r\n","import AVFilterNode, { AVFilterNodePort } from './AVFilterNode'\r\nimport AVInputNode from './AVInputNode'\r\n\r\nexport default class AVOutputNode {\r\n\r\n  public nodePort: AVFilterNodePort\r\n\r\n  private inputNode: AVFilterNode | AVInputNode\r\n\r\n  constructor(port: MessagePort) {\r\n    this.nodePort = new AVFilterNodePort(port)\r\n  }\r\n\r\n  public getFreeInputNodePort() {\r\n    return {\r\n      index: 0,\r\n      port: this.nodePort\r\n    }\r\n  }\r\n\r\n  public addInputPeer(node: AVFilterNode | AVInputNode) {\r\n    this.inputNode = node\r\n  }\r\n\r\n}\r\n","import AVFilterNode, { AVFilterNodeOptions } from './AVFilterNode'\r\nimport AVFrame, { AVFrameRef } from 'avutil/struct/avframe'\r\nimport { createAVFrame, destroyAVFrame, refAVFrame } from 'avutil/util/avframe'\r\nimport isPointer from 'cheap/std/function/isPointer'\r\nimport { IOError } from 'common/io/error'\r\nimport * as is from 'common/util/is'\r\n\r\nexport interface RangeFilterNodeOptions extends AVFilterNodeOptions {\r\n  start: int64\r\n  end: int64\r\n}\r\n\r\nexport default class RangeFilterNode extends AVFilterNode {\r\n  declare options: RangeFilterNodeOptions\r\n\r\n  constructor(options: RangeFilterNodeOptions) {\r\n    super(options, 1, 1)\r\n  }\r\n\r\n  public async ready() {\r\n\r\n  }\r\n\r\n  public async destroy() {\r\n\r\n  }\r\n\r\n  public async process(inputs: (pointer<AVFrame> | VideoFrame)[], outputs: (pointer<AVFrame> | VideoFrame)[]) {\r\n    let avframe = inputs[0]\r\n\r\n    if (is.number(avframe) && avframe < 0) {\r\n      outputs[0] = avframe\r\n      return\r\n    }\r\n\r\n    let pts = isPointer(avframe) ? avframe.pts : static_cast<int64>(avframe.timestamp)\r\n\r\n    if (pts < this.options.start) {\r\n      while (true) {\r\n        const next = await this.inputInnerNodePort[0].request<pointer<AVFrame> | VideoFrame>('pull')\r\n        if (is.number(next) && next < 0) {\r\n          outputs[0] = next\r\n          return\r\n        }\r\n        pts = isPointer(next) ? next.pts : static_cast<int64>(next.timestamp)\r\n        if (pts >= this.options.start) {\r\n          outputs[0] = next\r\n          return\r\n        }\r\n        else {\r\n          if (isPointer(next)) {\r\n            this.options.avframePool ? this.options.avframePool.release(reinterpret_cast<pointer<AVFrameRef>>(next)) : destroyAVFrame(next)\r\n          }\r\n          else {\r\n            next.close()\r\n          }\r\n        }\r\n      }\r\n    }\r\n    else if (pts > this.options.end && this.options.end >= this.options.start) {\r\n      outputs[0] = reinterpret_cast<pointer<AVFrame>>(IOError.END)\r\n      return\r\n    }\r\n    else {\r\n      if (isPointer(avframe)) {\r\n        const out = this.options.avframePool ? this.options.avframePool.alloc() : createAVFrame()\r\n        refAVFrame(out, avframe)\r\n        outputs[0] = out\r\n      }\r\n      else {\r\n        outputs[0] = avframe.clone()\r\n      }\r\n    }\r\n  }\r\n}\r\n","import Resampler, { PCMParameters } from 'audioresample/Resampler'\r\nimport AVFilterNode, { AVFilterNodeOptions } from '../AVFilterNode'\r\nimport AVFrame, { AV_NUM_DATA_POINTERS } from 'avutil/struct/avframe'\r\nimport AVPCMBuffer from 'avutil/struct/avpcmbuffer'\r\nimport { createAVFrame, refAVFrame, unrefAVFrame } from 'avutil/util/avframe'\r\nimport { avFree, avFreep, avMalloc, avMallocz } from 'avutil/util/mem'\r\nimport { sampleFormatIsPlanar } from 'avutil/util/sample'\r\nimport { WebAssemblyResource } from 'cheap/webassembly/compiler'\r\nimport * as errorType from 'avutil/error'\r\nimport { avbufferCreate } from 'avutil/util/avbuffer'\r\nimport { NOPTS_VALUE } from 'avutil/constant'\r\nimport * as logger from 'common/util/logger'\r\nimport * as is from 'common/util/is'\r\nimport compileResource from 'avutil/function/compileResource'\r\n\r\nexport interface ResampleFilterNodeOptions extends AVFilterNodeOptions {\r\n  resource: WebAssemblyResource | ArrayBuffer\r\n  output: PCMParameters\r\n}\r\n\r\nexport default class ResampleFilterNode extends AVFilterNode {\r\n  declare options: ResampleFilterNodeOptions\r\n\r\n  private resampler: Resampler\r\n\r\n  private pcm: pointer<AVPCMBuffer>\r\n\r\n  constructor(options: ResampleFilterNodeOptions) {\r\n    super(options, 1, 1)\r\n  }\r\n\r\n  public async ready() {\r\n    this.pcm = avMallocz(sizeof(AVPCMBuffer))\r\n  }\r\n\r\n  public async destroy() {\r\n    if (this.pcm) {\r\n      if (this.pcm.data) {\r\n        avFreep(addressof(this.pcm.data[0]))\r\n        avFreep(reinterpret_cast<pointer<pointer<void>>>(addressof(this.pcm.data)))\r\n      }\r\n      avFree(this.pcm)\r\n    }\r\n    if (this.resampler) {\r\n      this.resampler.close()\r\n      this.resampler = null\r\n    }\r\n  }\r\n\r\n  public async process(inputs: (pointer<AVFrame> | VideoFrame)[], outputs: (pointer<AVFrame> | VideoFrame)[]) {\r\n    const avframe = inputs[0] as pointer<AVFrame>\r\n\r\n    if (avframe < 0) {\r\n      outputs[0] = avframe\r\n      return\r\n    }\r\n\r\n    const out = this.options.avframePool ? this.options.avframePool.alloc() : createAVFrame()\r\n\r\n    if (avframe.sampleRate !== this.options.output.sampleRate\r\n      || avframe.chLayout.nbChannels !== this.options.output.channels\r\n      || avframe.format !== this.options.output.format && this.options.output.format !== NOPTS_VALUE\r\n    ) {\r\n      if (this.resampler) {\r\n        const currentInput = this.resampler.getInputPCMParameters()\r\n        if (currentInput.channels !== avframe.chLayout.nbChannels\r\n          || currentInput.sampleRate !== avframe.sampleRate\r\n          || currentInput.format !== avframe.format\r\n        ) {\r\n          this.resampler.close()\r\n          this.resampler = null\r\n        }\r\n      }\r\n      if (!this.resampler) {\r\n        let resource = this.options.resource\r\n        if (is.arrayBuffer(resource)) {\r\n          resource = await compileResource(resource)\r\n        }\r\n        this.resampler = new Resampler({\r\n          resource\r\n        })\r\n\r\n        try {\r\n          await this.resampler.open(\r\n            {\r\n              channels: avframe.chLayout.nbChannels,\r\n              sampleRate: avframe.sampleRate,\r\n              format: avframe.format\r\n            },\r\n            {\r\n              channels: this.options.output.channels,\r\n              sampleRate: this.options.output.sampleRate,\r\n              format: this.options.output.format === NOPTS_VALUE ? avframe.format : this.options.output.format\r\n            }\r\n          )\r\n        }\r\n        catch (error) {\r\n          logger.error(`open resampler failed, error ${error}`)\r\n          outputs[0] = reinterpret_cast<pointer<AVFrame>>(errorType.FORMAT_NOT_SUPPORT)\r\n          return\r\n        }\r\n      }\r\n\r\n      this.resampler.resample(avframe.extendedData, this.pcm, avframe.nbSamples)\r\n\r\n      out.format = this.options.output.format === NOPTS_VALUE ? avframe.format : this.options.output.format\r\n      out.nbSamples = this.pcm.nbSamples\r\n      out.sampleRate = this.pcm.sampleRate\r\n      out.chLayout.nbChannels = this.pcm.channels\r\n      out.linesize[0] = this.pcm.linesize\r\n\r\n      out.pts = avframe.pts\r\n      out.duration = avframe.duration\r\n      out.pktDts = avframe.pktDts\r\n      out.timeBase = avframe.timeBase\r\n\r\n      const planar = sampleFormatIsPlanar(out.format)\r\n      const planes = planar ? out.chLayout.nbChannels : 1\r\n\r\n      if (planes > AV_NUM_DATA_POINTERS) {\r\n        out.extendedData = reinterpret_cast<pointer<pointer<uint8>>>(avMalloc(planes * sizeof(accessof(out.extendedData))))\r\n        if (!out.extendedData) {\r\n          avFreep(reinterpret_cast<pointer<pointer<uint8>>>(addressof(out.extendedData)))\r\n          outputs[0] = reinterpret_cast<pointer<AVFrame>>(errorType.NO_MEMORY)\r\n          return\r\n        }\r\n      }\r\n      else {\r\n        out.extendedData = addressof(out.data)\r\n      }\r\n\r\n      for (let i = 0; i < Math.min(planes, AV_NUM_DATA_POINTERS); i++) {\r\n        if (i === 0) {\r\n          out.buf[i] = avbufferCreate(this.pcm.data[i], this.pcm.linesize * (planar ? this.pcm.channels : 1))\r\n          if (!out.buf[i]) {\r\n            unrefAVFrame(out)\r\n            outputs[0] = reinterpret_cast<pointer<AVFrame>>(errorType.NO_MEMORY)\r\n            return\r\n          }\r\n        }\r\n        out.extendedData[i] = out.data[i] = this.pcm.data[i]\r\n        this.pcm.data[i] = nullptr\r\n      }\r\n\r\n      for (let i = 0; i < planes - AV_NUM_DATA_POINTERS; i++) {\r\n        out.extendedData[i + AV_NUM_DATA_POINTERS] = this.pcm.data[i]\r\n        this.pcm.data[i] = nullptr\r\n      }\r\n      this.pcm.maxnbSamples = 0\r\n      outputs[0] = out\r\n    }\r\n    else {\r\n      refAVFrame(out, avframe)\r\n      outputs[0] = out\r\n    }\r\n  }\r\n}\r\n","import RangeFilterNode from './RangeFilterNode'\r\nimport ResampleFilterNode from './audio/ResampleFilterNode'\r\nimport FramerateFilterNode from './video/FramerateFilterNode'\r\nimport ScaleFilterNode from './video/ScaleFilterNode'\r\nimport { AVFramePool } from 'avutil/struct/avframe'\r\nimport * as logger from 'common/util/logger'\r\n\r\ntype ConstructorParameters<T extends abstract new (...args: any) => any> =\r\n  T extends new (...args: infer P) => any ? P : never\r\n\r\ntype FirstConstructorParameter<T extends abstract new (...args: any) => any> =\r\n  ConstructorParameters<T>[0]\r\n\r\nexport type GraphNodeType = 'resampler' | 'scaler' | 'range' | 'framerate'\r\n\r\ntype GraphNodeType2AVFilterConstructor<T extends GraphNodeType> =\r\n  T extends 'resampler'\r\n    ? typeof ResampleFilterNode\r\n    : T extends 'scaler'\r\n      ? typeof ScaleFilterNode\r\n      : T extends 'range'\r\n        ? typeof RangeFilterNode\r\n        : T extends 'framerate'\r\n          ? typeof FramerateFilterNode\r\n          : never\r\n\r\ntype GraphNodeType2AVFilter<T extends GraphNodeType> =\r\n  T extends 'resampler'\r\n    ? ResampleFilterNode\r\n    : T extends 'scaler'\r\n      ? ScaleFilterNode\r\n      : T extends 'range'\r\n        ? RangeFilterNode\r\n        : T extends 'framerate'\r\n          ? FramerateFilterNode\r\n          : never\r\n\r\ntype AVFilterGraphFilterOptions<T extends GraphNodeType> = FirstConstructorParameter<GraphNodeType2AVFilterConstructor<T>>\r\n\r\nexport interface AVFilterGraphDesVertex<T extends GraphNodeType> {\r\n  id: number\r\n  type: T\r\n  options: AVFilterGraphFilterOptions<T>\r\n}\r\n\r\nexport interface AVFilterGraphVertex<T extends GraphNodeType> {\r\n  id: number\r\n  filter: GraphNodeType2AVFilter<T>\r\n  children: AVFilterGraphVertex<GraphNodeType>[]\r\n  parents: AVFilterGraphVertex<GraphNodeType>[]\r\n}\r\n\r\nexport interface FilterGraphDes {\r\n  vertices: AVFilterGraphDesVertex<GraphNodeType>[]\r\n  edges: { parent: number, child: number }[]\r\n}\r\n\r\nexport interface FilterGraphPortDes {\r\n  port: MessagePort\r\n  id: number\r\n}\r\n\r\nexport interface FilterGraph {\r\n  vertices: AVFilterGraphVertex<GraphNodeType>[]\r\n  edges: { parent: number, child: number }[]\r\n  inputs: AVFilterGraphVertex<GraphNodeType>[]\r\n  outputs: AVFilterGraphVertex<GraphNodeType>[]\r\n}\r\n\r\nfunction createFilter(vertex: AVFilterGraphDesVertex<GraphNodeType>, avframePool?: AVFramePool) {\r\n  const options = vertex.options\r\n  if (avframePool) {\r\n    options.avframePool = avframePool\r\n  }\r\n\r\n  switch (vertex.type) {\r\n    case 'resampler':\r\n      return new ResampleFilterNode(options as AVFilterGraphFilterOptions<'resampler'>)\r\n    case 'scaler':\r\n      return new ScaleFilterNode(options as AVFilterGraphFilterOptions<'scaler'>)\r\n    case 'range':\r\n      return new RangeFilterNode(options as AVFilterGraphFilterOptions<'range'>)\r\n    case 'framerate':\r\n      return new FramerateFilterNode(options as AVFilterGraphFilterOptions<'framerate'>)\r\n    default:\r\n      throw new Error(`invalid GraphNodeType, ${vertex.type}`)\r\n  }\r\n}\r\n\r\nlet id = 0\r\nexport function createGraphDesVertex<T extends GraphNodeType>(type: T, options: AVFilterGraphFilterOptions<T>): AVFilterGraphDesVertex<T> {\r\n  return {\r\n    id: id++,\r\n    type,\r\n    options\r\n  }\r\n}\r\n\r\nexport function createFilterGraph(des: FilterGraphDes, avframePool?: AVFramePool): FilterGraph {\r\n  const vertices: AVFilterGraphVertex<GraphNodeType>[] = []\r\n  const inputs: AVFilterGraphVertex<GraphNodeType>[] = []\r\n  const outputs: AVFilterGraphVertex<GraphNodeType>[] = []\r\n\r\n  const map: Map<number, AVFilterGraphVertex<GraphNodeType>> = new Map()\r\n\r\n  const hasChildMap: Map<number, boolean> = new Map()\r\n  const hasParentMap: Map<number, boolean> = new Map()\r\n\r\n  des.vertices.forEach((vertex) => {\r\n    const node: AVFilterGraphVertex<GraphNodeType> = {\r\n      id: vertex.id,\r\n      filter: createFilter(vertex, avframePool),\r\n      children: [],\r\n      parents: []\r\n    }\r\n    map.set(node.id, node)\r\n    vertices.push(node)\r\n  })\r\n\r\n  des.edges.forEach((edge, index) => {\r\n    const parent = map.get(edge.parent)\r\n    const child = map.get(edge.child)\r\n\r\n    if (!parent) {\r\n      logger.fatal(`${index} edge parent(${edge.parent}) not found`)\r\n    }\r\n    if (!child) {\r\n      logger.fatal(`${index} edge child(${edge.child}) not found`)\r\n    }\r\n    parent.children.push(child)\r\n    child.parents.push(parent)\r\n    hasChildMap.set(parent.id, true)\r\n    hasParentMap.set(child.id, true)\r\n    parent.filter.connect(child.filter)\r\n  })\r\n\r\n  des.vertices.forEach((vertex) => {\r\n    if (!hasParentMap.has(vertex.id)) {\r\n      inputs.push(map.get(vertex.id))\r\n    }\r\n    if (!hasChildMap.has(vertex.id)) {\r\n      outputs.push(map.get(vertex.id))\r\n    }\r\n  })\r\n\r\n  return {\r\n    vertices,\r\n    edges: des.edges,\r\n    inputs,\r\n    outputs\r\n  }\r\n}\r\n\r\nexport function checkFilterGraphInvalid(graph: FilterGraph, inputs: FilterGraphPortDes[], output: FilterGraphPortDes[]) {\r\n  const inputsMap: Map<number, number> = new Map()\r\n  const outputsMap: Map<number, number> = new Map()\r\n\r\n  for (let i = 0; i < inputs.length; i++) {\r\n    if (inputsMap.has(inputs[i].id)) {\r\n      inputsMap.set(inputs[i].id, inputsMap.get(inputs[i].id) + 1)\r\n    }\r\n    else {\r\n      inputsMap.set(inputs[i].id, 1)\r\n    }\r\n  }\r\n\r\n  for (let i = 0; i < output.length; i++) {\r\n    if (outputsMap.has(output[i].id)) {\r\n      outputsMap.set(output[i].id, outputsMap.get(output[i].id) + 1)\r\n    }\r\n    else {\r\n      outputsMap.set(output[i].id, 1)\r\n    }\r\n  }\r\n\r\n  for (let i = 0; i < graph.inputs.length; i++) {\r\n    if (graph.inputs[i].filter.getInputCount() > (inputsMap.get(graph.inputs[i].id) ?? 0)) {\r\n      logger.error(`input filter(${graph.inputs[i].id}) only has ${inputsMap.get(graph.inputs[i].id)} input channel port`)\r\n      return false\r\n    }\r\n  }\r\n\r\n  for (let i = 0; i < graph.outputs.length; i++) {\r\n    if (graph.outputs[i].filter.getOutputCount() > (outputsMap.get(graph.outputs[i].id) ?? 0)) {\r\n      logger.error(`output filter(${graph.outputs[i].id}) only has ${outputsMap.get(graph.outputs[i].id)} output channel port`)\r\n      return false\r\n    }\r\n  }\r\n\r\n  for (let i = 0; i < graph.vertices.length; i++) {\r\n    if (graph.vertices[i].children.length && graph.vertices[i].parents.length) {\r\n      if (graph.vertices[i].filter.getOutputCount() !== graph.vertices[i].children.length) {\r\n        logger.error(`filter(${graph.vertices[i].id}) only has ${graph.vertices[i].children.length} output channel port`)\r\n        return false\r\n      }\r\n      if (graph.vertices[i].filter.getInputCount() !== graph.vertices[i].parents.length) {\r\n        logger.error(`filter(${graph.vertices[i].id}) only has ${graph.vertices[i].parents.length} input channel port`)\r\n        return false\r\n      }\r\n    }\r\n  }\r\n\r\n  return true\r\n}\r\n","import AVFilterNode, { AVFilterNodeOptions } from '../AVFilterNode'\r\nimport AVFrame, { AVFrameRef } from 'avutil/struct/avframe'\r\nimport * as is from 'common/util/is'\r\nimport { createAVFrame, destroyAVFrame, refAVFrame } from 'avutil/util/avframe'\r\nimport { Rational } from 'avutil/struct/rational'\r\nimport { avRescaleQ } from 'avutil/util/rational'\r\nimport { AV_TIME_BASE_Q } from 'avutil/constant'\r\nimport isPointer from 'cheap/std/function/isPointer'\r\n\r\nexport interface FramerateFilterNodeOptions extends AVFilterNodeOptions {\r\n  framerate: Rational\r\n  timeBase: Rational\r\n}\r\n\r\nexport default class FramerateFilterNode extends AVFilterNode {\r\n  declare options: FramerateFilterNodeOptions\r\n\r\n  private lastPts: int64\r\n\r\n  private delta: int64\r\n\r\n  private timeBase: Rational\r\n  private step: int64\r\n\r\n  constructor(options: FramerateFilterNodeOptions) {\r\n    super(options, 1, 1)\r\n  }\r\n\r\n  public async ready() {\r\n    this.lastPts = -1n\r\n    this.delta = 0n\r\n    this.timeBase = AV_TIME_BASE_Q\r\n    this.step = avRescaleQ(\r\n      1n,\r\n      {\r\n        den: this.options.framerate.num,\r\n        num: this.options.framerate.den\r\n      },\r\n      this.timeBase\r\n    )\r\n  }\r\n\r\n  public async destroy() {\r\n\r\n  }\r\n\r\n  public async process(inputs: (pointer<AVFrame> | VideoFrame)[], outputs: (pointer<AVFrame> | VideoFrame)[]) {\r\n    let avframe = inputs[0]\r\n\r\n    if (is.number(avframe) && avframe < 0) {\r\n      outputs[0] = avframe\r\n      return\r\n    }\r\n\r\n    let pts = avRescaleQ(\r\n      isPointer(avframe) ? avframe.pts : static_cast<int64>(avframe.timestamp),\r\n      this.options.timeBase,\r\n      this.timeBase\r\n    )\r\n    let diff = pts - this.lastPts + this.delta\r\n\r\n    if (diff < this.step && this.lastPts > -1n) {\r\n      while (true) {\r\n        const next = await this.inputInnerNodePort[0].request<pointer<AVFrame> | VideoFrame>('pull')\r\n        if (is.number(next) && next < 0) {\r\n          outputs[0] = next\r\n          return\r\n        }\r\n        pts = avRescaleQ(\r\n          isPointer(next) ? next.pts : static_cast<int64>(next.timestamp),\r\n          this.options.timeBase,\r\n          this.timeBase\r\n        )\r\n        diff = pts - this.lastPts\r\n        if (diff >= this.step) {\r\n          this.delta += diff - this.step\r\n          this.lastPts = pts\r\n          outputs[0] = next\r\n          return\r\n        }\r\n        else {\r\n          if (isPointer(next)) {\r\n            this.options.avframePool ? this.options.avframePool.release(reinterpret_cast<pointer<AVFrameRef>>(next)) : destroyAVFrame(next)\r\n          }\r\n          else {\r\n            next.close()\r\n          }\r\n        }\r\n      }\r\n    }\r\n    else {\r\n      if (this.lastPts > -1n) {\r\n        this.delta = diff - this.step\r\n      }\r\n      this.lastPts = pts\r\n\r\n      if (isPointer(avframe)) {\r\n        const out = this.options.avframePool ? this.options.avframePool.alloc() : createAVFrame()\r\n        refAVFrame(out, avframe)\r\n        outputs[0] = out\r\n      }\r\n      else {\r\n        outputs[0] = avframe.clone()\r\n      }\r\n    }\r\n  }\r\n}\r\n","import AVFilterNode, { AVFilterNodeOptions } from '../AVFilterNode'\r\nimport AVFrame, { AVFrameRef } from 'avutil/struct/avframe'\r\nimport { createAVFrame, destroyAVFrame, refAVFrame } from 'avutil/util/avframe'\r\nimport { WebAssemblyResource } from 'cheap/webassembly/compiler'\r\nimport VideoScaler, { ScaleParameters } from 'videoscale/VideoScaler'\r\nimport * as is from 'common/util/is'\r\nimport { mapFormat, videoFrame2AVFrame } from 'avutil/function/videoFrame2AVFrame'\r\nimport { NOPTS_VALUE } from 'avutil/constant'\r\nimport { AVPixelFormat } from 'avutil/pixfmt'\r\nimport * as errorType from 'avutil/error'\r\nimport * as logger from 'common/util/logger'\r\nimport isPointer from 'cheap/std/function/isPointer'\r\nimport compileResource from 'avutil/function/compileResource'\r\n\r\nexport interface ScaleFilterNodeOptions extends AVFilterNodeOptions {\r\n  resource: WebAssemblyResource | ArrayBuffer\r\n  output: ScaleParameters\r\n}\r\n\r\nexport default class ScaleFilterNode extends AVFilterNode {\r\n  declare options: ScaleFilterNodeOptions\r\n\r\n  private scaler: VideoScaler\r\n\r\n  constructor(options: ScaleFilterNodeOptions) {\r\n    super(options, 1, 1)\r\n  }\r\n\r\n  public async ready() {\r\n\r\n  }\r\n\r\n  public async destroy() {\r\n    if (this.scaler) {\r\n      this.scaler.close()\r\n      this.scaler = null\r\n    }\r\n  }\r\n\r\n  public async process(inputs: (pointer<AVFrame> | VideoFrame)[], outputs: (pointer<AVFrame> | VideoFrame)[]) {\r\n    let avframe = inputs[0]\r\n\r\n    if (is.number(avframe) && avframe < 0) {\r\n      outputs[0] = avframe\r\n      return\r\n    }\r\n\r\n    const width = isPointer(avframe) ? avframe.width : avframe.displayWidth\r\n    const height = isPointer(avframe) ? avframe.height : avframe.displayHeight\r\n    const format = isPointer(avframe) ? avframe.format : mapFormat(avframe.format)\r\n\r\n    if (width !== this.options.output.width\r\n      || height !== this.options.output.height\r\n      || format !== this.options.output.format\r\n        && this.options.output.format !== NOPTS_VALUE\r\n        && format !== AVPixelFormat.AV_PIX_FMT_NONE\r\n    ) {\r\n\r\n      if (format === AVPixelFormat.AV_PIX_FMT_NONE) {\r\n        logger.error('src avframe format not support')\r\n        outputs[0] = reinterpret_cast<pointer<AVFrame>>(errorType.FORMAT_NOT_SUPPORT)\r\n        return\r\n      }\r\n\r\n      const out = this.options.avframePool ? this.options.avframePool.alloc() : createAVFrame()\r\n\r\n      if (this.scaler) {\r\n        const currentInput = this.scaler.getInputScaleParameters()\r\n        if (currentInput.width !== width\r\n          || currentInput.height !== height\r\n          || currentInput.format !== format\r\n        ) {\r\n          this.scaler.close()\r\n          this.scaler = null\r\n        }\r\n      }\r\n      if (!this.scaler) {\r\n        let resource = this.options.resource\r\n        if (is.arrayBuffer(resource)) {\r\n          resource = await compileResource(resource)\r\n        }\r\n        this.scaler = new VideoScaler({\r\n          resource\r\n        })\r\n\r\n        try {\r\n          await this.scaler.open(\r\n            {\r\n              width,\r\n              height,\r\n              format\r\n            },\r\n            {\r\n              width: this.options.output.width,\r\n              height: this.options.output.height,\r\n              format: this.options.output.format !== NOPTS_VALUE\r\n                ? this.options.output.format\r\n                : (format === AVPixelFormat.AV_PIX_FMT_NV12 && !isPointer(avframe)\r\n                  ? AVPixelFormat.AV_PIX_FMT_YUV420P\r\n                  : format\r\n                )\r\n            }\r\n          )\r\n        }\r\n        catch (error) {\r\n          logger.error(`open scaler failed, error ${error}`)\r\n          outputs[0] = reinterpret_cast<pointer<AVFrame>>(errorType.FORMAT_NOT_SUPPORT)\r\n          return\r\n        }\r\n      }\r\n\r\n      if (!isPointer(avframe)) {\r\n        avframe = videoFrame2AVFrame(inputs[0] as VideoFrame, this.options.avframePool ? this.options.avframePool.alloc() : createAVFrame())\r\n      }\r\n\r\n      this.scaler.scale(avframe, out)\r\n\r\n      out.width = this.options.output.width\r\n      out.height = this.options.output.height\r\n      out.pts = avframe.pts\r\n      out.duration = avframe.duration\r\n      out.format = this.options.output.format\r\n      out.colorPrimaries = avframe.colorPrimaries\r\n      out.colorRange = avframe.colorRange\r\n      out.colorSpace = avframe.colorSpace\r\n      out.colorTrc = avframe.colorTrc\r\n\r\n      outputs[0] = out\r\n\r\n      if (!isPointer(inputs[0])) {\r\n        this.options.avframePool ? this.options.avframePool.release(reinterpret_cast<pointer<AVFrameRef>>(avframe)) : destroyAVFrame(avframe)\r\n      }\r\n    }\r\n    else {\r\n      if (isPointer(avframe)) {\r\n        const out = this.options.avframePool ? this.options.avframePool.alloc() : createAVFrame()\r\n        refAVFrame(out, avframe)\r\n        outputs[0] = out\r\n      }\r\n      else {\r\n        outputs[0] = avframe.clone()\r\n      }\r\n    }\r\n  }\r\n}\r\n","/*\r\n * libmedia AVFormatContext\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVCodecID, AVMediaType } from 'avutil/codec'\r\n\r\nimport AVStream, { AVStreamInterface } from './AVStream'\r\nimport AVPacket from 'avutil/struct/avpacket'\r\n\r\nimport OFormat from './formats/OFormat'\r\nimport IFormat from './formats/IFormat'\r\n\r\nimport IOWriter from 'common/io/IOWriterSync'\r\nimport IOReader from 'common/io/IOReader'\r\nimport IOReaderSync from 'common/io/IOReaderSync'\r\nimport { WebAssemblyResource } from 'cheap/webassembly/compiler'\r\nimport { AVFormat } from './avformat'\r\nimport { destroyAVPacket } from 'avutil/util/avpacket'\r\nimport { Rational } from 'avutil/struct/rational'\r\nimport * as staticData from 'cheap/staticData'\r\nimport { Mutex, lock, unlock } from 'cheap/thread/mutex'\r\n\r\n// 在静态区分配 stream 计数器和计数器操作锁\r\nconst streamCounter: pointer<int32> = reinterpret_cast<pointer<int32>>(staticData.malloc(sizeof(int32), sizeof(int32)))\r\nconst streamCounterMutex: pointer<Mutex> = reinterpret_cast<pointer<Mutex>>(staticData.malloc(sizeof(Mutex), sizeof(atomic_int32)))\r\n\r\nexport interface AVChapter {\r\n  /**\r\n   * 章节 id\r\n   */\r\n  id: uint64\r\n  /**\r\n   * 时间基\r\n   */\r\n  timeBase: Rational\r\n  /**\r\n   * 开始时间\r\n   */\r\n  start: int64\r\n  /**\r\n   * 结束时间\r\n   */\r\n  end: int64\r\n  /**\r\n   * 元数据\r\n   */\r\n  metadata: Record<string, any>\r\n}\r\n\r\nclass AVFormatContextInterval {\r\n\r\n  public packetBuffer: pointer<AVPacket>[]\r\n\r\n  constructor() {\r\n    this.packetBuffer = []\r\n  }\r\n}\r\n\r\nexport interface AVIFormatContext {\r\n  metadata: Record<string, any>\r\n  streams: AVStream[]\r\n\r\n  options: Record<string, any>\r\n  chapters: AVChapter[]\r\n\r\n  privateData: Record<string, any>\r\n\r\n  format: AVFormat\r\n  iformat: IFormat\r\n\r\n  ioReader: IOReader\r\n\r\n  errorFlag: number\r\n\r\n  interval: AVFormatContextInterval\r\n\r\n  streamIndex: number\r\n\r\n  getStreamById(id: number): AVStream\r\n\r\n  getStreamByIndex(index: number): AVStream\r\n\r\n  getStreamByMediaType(mediaType: AVMediaType): AVStream\r\n\r\n  createStream(): AVStream\r\n\r\n  addStream(stream: AVStream): void\r\n\r\n  removeStream(stream: AVStream): void\r\n\r\n  removeStreamById(id: number): void\r\n\r\n  removeStreamByIndex(index: number): void\r\n\r\n  destroy(): void\r\n\r\n  getDecoderResource: (mediaType: AVMediaType, codecId: AVCodecID) => Promise<WebAssemblyResource> | WebAssemblyResource\r\n}\r\n\r\nexport interface AVOFormatContext {\r\n\r\n  metadataHeaderPadding: int32\r\n\r\n  metadata: Record<string, any>\r\n  streams: AVStream[]\r\n\r\n  options: Record<string, any>\r\n  chapters: AVChapter[]\r\n\r\n  privateData: Record<string, any>\r\n  processPrivateData: Record<string, any>\r\n\r\n  format: AVFormat\r\n  oformat: OFormat\r\n\r\n  ioWriter: IOWriter\r\n\r\n  errorFlag: number\r\n\r\n  interval: AVFormatContextInterval\r\n\r\n  streamIndex: number\r\n\r\n  getStreamById(id: number): AVStream\r\n\r\n  getStreamByIndex(index: number): AVStream\r\n\r\n  getStreamByMediaType(mediaType: AVMediaType): AVStream\r\n\r\n  createStream(): AVStream\r\n\r\n  addStream(stream: AVStream): void\r\n\r\n  removeStream(stream: AVStream): void\r\n\r\n  removeStreamById(id: number): void\r\n\r\n  removeStreamByIndex(index: number): void\r\n\r\n  destroy(): void\r\n}\r\n\r\nexport interface AVFormatContextInterface {\r\n  metadata: Record<string, any>\r\n  format: AVFormat\r\n  streams: AVStreamInterface[]\r\n  chapters: AVChapter[]\r\n}\r\n\r\nexport class AVFormatContext implements AVIFormatContext, AVOFormatContext {\r\n\r\n  public metadataHeaderPadding = -1\r\n\r\n  public metadata: Record<string, any>\r\n  public streams: AVStream[]\r\n\r\n  public options: Record<string, any>\r\n  public chapters: AVChapter[]\r\n\r\n  public privateData: Record<string, any>\r\n  public processPrivateData: Record<string, any>\r\n\r\n  public iformat: IFormat\r\n  public oformat: OFormat\r\n\r\n  // @ts-ignore\r\n  public ioReader: IOReader | IOReaderSync\r\n\r\n  public ioWriter: IOWriter\r\n\r\n  public errorFlag: number\r\n\r\n  public interval: AVFormatContextInterval\r\n\r\n  public streamIndex: number\r\n\r\n  public getDecoderResource: (mediaType: AVMediaType, codecId: AVCodecID) => Promise<WebAssemblyResource> | WebAssemblyResource = null\r\n\r\n  constructor() {\r\n    this.streams = []\r\n    this.errorFlag = 0\r\n    this.streamIndex  = 0\r\n    this.interval = new AVFormatContextInterval()\r\n\r\n    this.options = {}\r\n    this.privateData = {}\r\n    this.metadata = {}\r\n    this.chapters = []\r\n  }\r\n\r\n  get format() {\r\n    if (this.iformat) {\r\n      return this.iformat.type\r\n    }\r\n    else if (this.oformat) {\r\n      return this.oformat.type\r\n    }\r\n    return AVFormat.UNKNOWN\r\n  }\r\n\r\n  public getStreamById(id: number) {\r\n    return this.streams.find((stream) => stream.id === id)\r\n  }\r\n\r\n  public getStreamByIndex(index: number) {\r\n    return this.streams.find((stream) => stream.index === index)\r\n  }\r\n\r\n  public getStreamByMediaType(mediaType: AVMediaType) {\r\n    return this.streams.find((stream) => stream.codecpar?.codecType === mediaType)\r\n  }\r\n\r\n  public createStream() {\r\n    const stream = new AVStream()\r\n    stream.index = this.streamIndex++\r\n\r\n    if (defined(ENABLE_THREADS)) {\r\n      lock(streamCounterMutex)\r\n    }\r\n    stream.id = accessof(streamCounter)\r\n    accessof(streamCounter) <- reinterpret_cast<int32>(stream.id + 1)\r\n    if (defined(ENABLE_THREADS)) {\r\n      unlock(streamCounterMutex)\r\n    }\r\n\r\n    this.removeStreamByIndex(stream.index)\r\n    this.streams.push(stream)\r\n\r\n    return stream\r\n  }\r\n\r\n  public addStream(stream: AVStream) {\r\n    this.removeStreamByIndex(stream.index)\r\n    this.streams.push(stream)\r\n  }\r\n\r\n  public removeStream(stream: AVStream) {\r\n    this.removeStreamByIndex(stream.index)\r\n  }\r\n\r\n  public removeStreamById(id: number) {\r\n    const index = this.streams.findIndex((stream) => stream.id === id)\r\n\r\n    if (index > -1) {\r\n      const st = this.streams.splice(index, 1)\r\n      if (st[0]) {\r\n        st[0].destroy()\r\n      }\r\n    }\r\n  }\r\n\r\n  public removeStreamByIndex(i: number) {\r\n\r\n    const index = this.streams.findIndex((stream) => stream.index === i)\r\n\r\n    if (index > -1) {\r\n      const st = this.streams.splice(index, 1)\r\n      if (st[0]) {\r\n        st[0].destroy()\r\n      }\r\n    }\r\n  }\r\n\r\n  public destroy() {\r\n\r\n    if (this.oformat) {\r\n      this.oformat.destroy(this)\r\n    }\r\n    if (this.iformat) {\r\n      this.iformat.destroy(this as AVIFormatContext)\r\n    }\r\n\r\n    if (this.interval.packetBuffer.length) {\r\n      this.interval.packetBuffer.forEach((avpacket) => {\r\n        destroyAVPacket(avpacket)\r\n      })\r\n    }\r\n\r\n    this.streams.forEach((stream) => {\r\n      stream.destroy()\r\n    })\r\n    this.streams = []\r\n    this.interval = null\r\n    this.ioReader = this.ioWriter = null\r\n    this.oformat = this.iformat = null\r\n  }\r\n}\r\n\r\n/**\r\n * 创建 AVIFormatContext\r\n * \r\n * @returns \r\n */\r\nexport function createAVIFormatContext() {\r\n  return new AVFormatContext() as AVIFormatContext\r\n}\r\n\r\n/**\r\n * 创建 AVOFormatContext\r\n * \r\n * @returns \r\n */\r\nexport function createAVOFormatContext() {\r\n  return new AVFormatContext() as AVOFormatContext\r\n}\r\n","/*\r\n * libmedia AVStream defined\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { Data } from 'common/types/type'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport { AVPacketSideDataType } from 'avutil/codec'\r\nimport { NOPTS_VALUE, NOPTS_VALUE_BIGINT } from 'avutil/constant'\r\nimport { Rational } from 'avutil/struct/rational'\r\n\r\nexport const enum AVDisposition {\r\n  NONE = 0,\r\n  DEFAULT = 0x0001,\r\n  DUB = 0x0002,\r\n  ORIGINAL = 0x0004,\r\n  COMMENT = 0x0008,\r\n  LYRICS = 0x0010,\r\n  KARAOKE = 0x0020,\r\n\r\n  /**\r\n   * Track should be used during playback by default.\r\n   * Useful for subtitle track that should be displayed\r\n   * even when user did not explicitly ask for subtitles.\r\n   */\r\n  FORCED = 0x0040,\r\n  /**\r\n   * stream for hearing impaired audiences\r\n   */\r\n  HEARING_IMPAIRED = 0x0080,\r\n  /**\r\n   * stream for visual impaired audiences\r\n   */\r\n  VISUAL_IMPAIRED = 0x0100,\r\n  /**\r\n   * stream without voice\r\n   */\r\n  CLEAN_EFFECTS = 0x0200,\r\n  /**\r\n   * The stream is stored in the file as an attached picture/\"cover art\" (e.g.\r\n   * APIC frame in ID3v2). The first (usually only) packet associated with it\r\n   * will be returned among the first few packets read from the file unless\r\n   * seeking takes place. It can also be accessed at any time in\r\n   * AVStream.attached_pic.\r\n   */\r\n  ATTACHED_PIC = 0x0400,\r\n  /**\r\n   * The stream is sparse, and contains thumbnail images, often corresponding\r\n   * to chapter markers. Only ever used with AV_DISPOSITION_ATTACHED_PIC.\r\n   */\r\n  TIMED_THUMBNAILS = 0x0800,\r\n\r\n  /**\r\n   * To specify text track kind (different from subtitles default).\r\n   */\r\n  CAPTIONS = 0x10000,\r\n  DESCRIPTIONS = 0x20000,\r\n  METADATA = 0x40000,\r\n  /**\r\n   * dependent audio stream (mix_type=0 in mpegts)\r\n   */\r\n  DEPENDENT = 0x80000,\r\n  /**\r\n   * still images in video stream (still_picture_flag=1 in mpegts\r\n   */\r\n  STILL_IMAGE = 0x100000\r\n}\r\n\r\n/**\r\n * from FFmpeg\r\n * \r\n */\r\nexport default class AVStream {\r\n  /**\r\n   * stream index in AVFormatContext\r\n   */\r\n  index: int32 = NOPTS_VALUE\r\n\r\n  /**\r\n   * Format-specific stream ID.\r\n   * decoding: set by libavformat\r\n   * encoding: set by the user, replaced by libavformat if left unset\r\n   */\r\n  id: int32 = NOPTS_VALUE\r\n\r\n  privData: any = null\r\n\r\n  codecpar: AVCodecParameters = make<AVCodecParameters>(new AVCodecParameters())\r\n\r\n  /**\r\n   * An array of side data that applies to the whole stream (i.e. the\r\n   * container does not allow it to change between packets).\r\n   *\r\n   * There may be no overlap between the side data in this array and side data\r\n   * in the packets. I.e. a given side data is either exported by the muxer\r\n   * (demuxing) / set by the caller (muxing) in this array, then it never\r\n   * appears in the packets, or the side data is exported / sent through\r\n   * the packets (always in the first packet where the value becomes known or\r\n   * changes), then it does not appear in this array.\r\n   *\r\n   * - demuxing: Set by libavformat when the stream is created.\r\n   * - muxing: May be set by the caller before write_header().\r\n   *\r\n   */\r\n  sideData: Partial<Record<AVPacketSideDataType, Uint8Array>> = {}\r\n\r\n  /**\r\n   * number of frames in this stream if known or 0\r\n   */\r\n  nbFrames: int64 = 0n\r\n\r\n  metadata: Data = {}\r\n\r\n  /**\r\n   * Decoding: duration of the stream, in stream time base.\r\n   * If a source file does not specify a duration, but does specify\r\n   * a bitrate, this value will be estimated from bitrate and file size.\r\n   *\r\n   * Encoding: May be set by the caller before avformat_write_header() to\r\n   * provide a hint to the muxer about the estimated duration.\r\n   */\r\n  duration: int64 = NOPTS_VALUE_BIGINT\r\n\r\n  /**\r\n   * Decoding: pts of the first frame of the stream in presentation order, in stream time base.\r\n   * Only set this if you are absolutely 100% sure that the value you set\r\n   * it to really is the pts of the first frame.\r\n   * This may be undefined (AV_NOPTS_VALUE).\r\n   * @note The ASF header does NOT contain a correct start_time the ASF\r\n   * demuxer must NOT set this.\r\n   */\r\n  startTime: int64 = NOPTS_VALUE_BIGINT\r\n\r\n  /**\r\n   * 第一个 packet 的 dts\r\n   */\r\n  firstDTS: int64 = 0n\r\n\r\n  /**\r\n   * AV_DISPOSITION_* bit field\r\n   */\r\n  disposition: AVDisposition = AVDisposition.NONE\r\n\r\n  /**\r\n   *\r\n   * 封装时间基\r\n   * \r\n   * decoding: set by libavformat\r\n   * encoding: May be set by the caller before avformat_write_header() to\r\n   *           provide a hint to the muxer about the desired timebase. In\r\n   *           avformat_write_header(), the muxer will overwrite this field\r\n   *           with the timebase that will actually be used for the timestamps\r\n   *           written into the file (which may or may not be related to the\r\n   *           user-provided one, depending on the format).\r\n   */\r\n  timeBase: Rational = make<Rational>()\r\n\r\n  /**\r\n   * 帧索引，可用于 seek\r\n   */\r\n  sampleIndexes: {\r\n    dts: int64\r\n    pts: int64\r\n    pos: int64\r\n    size: int32\r\n    duration: int64\r\n    flags: int32\r\n  }[] = []\r\n\r\n  /**\r\n   * pos 到 sample index 的映射\r\n   */\r\n  sampleIndexesPosMap: Map<int64, int32> = new Map()\r\n\r\n\r\n  public destroy() {\r\n    if (this.codecpar) {\r\n      this.codecpar.destroy()\r\n      unmake(this.codecpar)\r\n      this.codecpar = null\r\n    }\r\n    if (this.timeBase) {\r\n      unmake(this.timeBase)\r\n      this.timeBase = null\r\n    }\r\n    this.sampleIndexes.length = 0\r\n    this.sampleIndexesPosMap.clear()\r\n  }\r\n}\r\n\r\nexport interface AVStreamInterface {\r\n  index: number\r\n  id: number\r\n  codecpar: pointer<AVCodecParameters>\r\n  nbFrames: int64\r\n  metadata: Data\r\n  duration: int64\r\n  startTime: int64\r\n  disposition: int32\r\n  timeBase: Rational\r\n}\r\n","/*\r\n * libmedia AVBSFilter\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVPacket from 'avutil/struct/avpacket'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport { Rational } from 'avutil/struct/rational'\r\nimport { avMallocz } from 'avutil/util/mem'\r\nimport { copyCodecParameters, freeCodecParameters } from 'avutil/util/codecparameters'\r\n\r\nexport default abstract class AVBSFilter {\r\n\r\n  inCodecpar: pointer<AVCodecParameters>\r\n  inTimeBase: Rational\r\n\r\n  outCodecpar: pointer<AVCodecParameters>\r\n\r\n  public init(codecpar: pointer<AVCodecParameters>, timeBase: pointer<Rational>): number {\r\n    this.inCodecpar = avMallocz(sizeof(AVCodecParameters))\r\n    copyCodecParameters(this.inCodecpar, codecpar)\r\n\r\n    this.inTimeBase = {\r\n      den: timeBase.den,\r\n      num: timeBase.num\r\n    }\r\n\r\n    return 0\r\n  }\r\n\r\n  public destroy() {\r\n    if (this.inCodecpar) {\r\n      freeCodecParameters(this.inCodecpar)\r\n      this.inCodecpar = nullptr\r\n    }\r\n  }\r\n\r\n  public abstract sendAVPacket(avpacket: pointer<AVPacket>): number\r\n  public abstract receiveAVPacket(avpacket: pointer<AVPacket>): number\r\n  public abstract reset(): number\r\n}\r\n","/*\r\n * libmedia Annexb2AvccFilter\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVPacket, { AVPacketFlags } from 'avutil/struct/avpacket'\r\nimport AVBSFilter from '../AVBSFilter'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport { Rational } from 'avutil/struct/rational'\r\nimport { addAVPacketData, addAVPacketSideData, copyAVPacketProps, createAVPacket,\r\n  destroyAVPacket, refAVPacket, unrefAVPacket\r\n} from 'avutil/util/avpacket'\r\n\r\nimport * as h264 from '../../codecs/h264'\r\nimport * as hevc from '../../codecs/hevc'\r\nimport * as vvc from '../../codecs/vvc'\r\nimport { mapSafeUint8Array, memcpyFromUint8Array } from 'cheap/std/memory'\r\nimport { AVCodecID, AVPacketSideDataType } from 'avutil/codec'\r\nimport * as errorType from 'avutil/error'\r\nimport { isAnnexb } from 'avutil/util/nalu'\r\nimport { avMalloc } from 'avutil/util/mem'\r\nimport * as logger from 'common/util/logger'\r\n\r\nexport default class Annexb2AvccFilter extends AVBSFilter {\r\n\r\n  private cache: pointer<AVPacket>\r\n  private cached: boolean\r\n\r\n  public init(codecpar: pointer<AVCodecParameters>, timeBase: pointer<Rational>): number {\r\n    super.init(codecpar, timeBase)\r\n    this.cache = createAVPacket()\r\n    this.cached = false\r\n\r\n    return 0\r\n  }\r\n\r\n  public destroy(): void {\r\n    super.destroy()\r\n    destroyAVPacket(this.cache)\r\n    this.cache = nullptr\r\n  }\r\n\r\n  public sendAVPacket(avpacket: pointer<AVPacket>): number {\r\n\r\n    const buffer = mapSafeUint8Array(avpacket.data, avpacket.size)\r\n\r\n    if (avpacket.bitFormat === h264.BitFormat.AVCC || !isAnnexb(buffer)) {\r\n      refAVPacket(this.cache, avpacket)\r\n    }\r\n    else {\r\n\r\n      copyAVPacketProps(this.cache, avpacket)\r\n\r\n      let convert: {\r\n        bufferPointer: pointer<uint8>,\r\n        length: size,\r\n        extradata: Uint8Array,\r\n        key: boolean\r\n      }\r\n\r\n      if (this.inCodecpar.codecId === AVCodecID.AV_CODEC_ID_H264) {\r\n        convert = h264.annexb2Avcc(buffer)\r\n      }\r\n      else if (this.inCodecpar.codecId === AVCodecID.AV_CODEC_ID_HEVC) {\r\n        convert = hevc.annexb2Avcc(buffer)\r\n      }\r\n      else if (this.inCodecpar.codecId === AVCodecID.AV_CODEC_ID_VVC) {\r\n        convert = vvc.annexb2Avcc(buffer)\r\n      }\r\n      else {\r\n        logger.fatal(`not support for codecId: ${this.inCodecpar.codecId}`)\r\n      }\r\n\r\n      this.cache.bitFormat = h264.BitFormat.AVCC\r\n\r\n      addAVPacketData(this.cache, convert.bufferPointer, convert.length)\r\n\r\n      if (convert.key) {\r\n        this.cache.flags |= AVPacketFlags.AV_PKT_FLAG_KEY\r\n      }\r\n\r\n      if (convert.extradata) {\r\n        const extradata = avMalloc(convert.extradata.length)\r\n        memcpyFromUint8Array(extradata, convert.extradata.length, convert.extradata)\r\n        addAVPacketSideData(this.cache, AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA, extradata, convert.extradata.length)\r\n      }\r\n    }\r\n    this.cached = true\r\n    return 0\r\n  }\r\n\r\n  public receiveAVPacket(avpacket: pointer<AVPacket>): number {\r\n    if (this.cached) {\r\n      unrefAVPacket(avpacket)\r\n      refAVPacket(avpacket, this.cache)\r\n      this.cached = false\r\n      return 0\r\n    }\r\n    else {\r\n      return errorType.DATA_INVALID\r\n    }\r\n  }\r\n\r\n  public reset(): number {\r\n    return 0\r\n  }\r\n}\r\n","/*\r\n * libmedia aac util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport Stream from '../AVStream'\r\nimport { AVPacketSideDataType } from 'avutil/codec'\r\nimport { NOPTS_VALUE } from 'avutil/constant'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport BitReader from 'common/io/BitReader'\r\nimport { Uint8ArrayInterface } from 'common/io/interface'\r\n\r\nexport const enum MPEG4AudioObjectTypes {\r\n  NULL = 0,\r\n  /**\r\n   * Main-AAC\r\n   */\r\n  AAC_MAIN,\r\n  /**\r\n   * LC-AAC\r\n   */\r\n  AAC_LC,\r\n  AAC_SSR,\r\n  AAC_LTP,\r\n  /**\r\n   * HE-AAC\r\n   */\r\n  AAC_SBR,\r\n  AAC_SCALABLE,\r\n\r\n  LAYER1 = 32,\r\n  LAYER2,\r\n  /**\r\n   * MP3\r\n   */\r\n  LAYER3\r\n}\r\n\r\nexport const AACProfile2Name: Partial<Record<MPEG4AudioObjectTypes, string>> = {\r\n  [MPEG4AudioObjectTypes.AAC_MAIN]: 'Main',\r\n  [MPEG4AudioObjectTypes.AAC_LC]: 'LC',\r\n  [MPEG4AudioObjectTypes.AAC_SSR]: 'LC',\r\n  [MPEG4AudioObjectTypes.AAC_LTP]: 'LC',\r\n  [MPEG4AudioObjectTypes.AAC_SBR]: 'HE',\r\n  [MPEG4AudioObjectTypes.AAC_SCALABLE]: 'HE'\r\n}\r\n\r\nexport const MPEG4SamplingFrequencyIndex = {\r\n  96000: 0,\r\n  88200: 1,\r\n  64000: 2,\r\n  48000: 3,\r\n  44100: 4,\r\n  32000: 5,\r\n  24000: 6,\r\n  22050: 7,\r\n  16000: 8,\r\n  12000: 9,\r\n  11025: 10,\r\n  8000: 11,\r\n  7350: 12\r\n}\r\n\r\nexport const MPEG4SamplingFrequencies = [\r\n  96000,\r\n  88200,\r\n  64000,\r\n  48000,\r\n  44100,\r\n  32000,\r\n  24000,\r\n  22050,\r\n  16000,\r\n  12000,\r\n  11025,\r\n  8000,\r\n  7350,\r\n  NOPTS_VALUE,\r\n  NOPTS_VALUE,\r\n  NOPTS_VALUE\r\n]\r\n\r\nexport const MPEG4Channels = [\r\n  NOPTS_VALUE,\r\n  1,\r\n  2,\r\n  3,\r\n  4,\r\n  5,\r\n  6,\r\n  7\r\n]\r\n\r\n/**\r\n * 解析 AAC AudioSpecificConfig\r\n *    \r\n *             frequency\r\n *              44100Hz        fill bit\r\n *               4 bit          3 bit\r\n *              -------         -----\r\n *    0 0 0 1 0 0 1 0 0 0 0 1 0 0 0 0\r\n *    ---------         -------\r\n *      5 bit            4 bit\r\n *     AAC LC           fl, fr\r\n *    profile           channel\r\n * \r\n * url: https://wiki.multimedia.cx/index.php/MPEG-4_Audio#Audio_Specific_Config\r\n * \r\n */\r\n\r\nexport function getAVCodecParameters(extradata: Uint8ArrayInterface) {\r\n  let profile = NOPTS_VALUE\r\n  let sampleRate = NOPTS_VALUE\r\n  let channels = NOPTS_VALUE\r\n  if (extradata.length >= 2) {\r\n    profile = (extradata[0] >> 3) & 0x1f\r\n    sampleRate = MPEG4SamplingFrequencies[((extradata[0] & 0x07) << 1)\r\n      | (extradata[1] >> 7)] ?? 48000\r\n\r\n    channels = MPEG4Channels[(extradata[1] >> 3) & 0x0f] ?? 2\r\n  }\r\n\r\n  return {\r\n    profile,\r\n    sampleRate,\r\n    channels\r\n  }\r\n}\r\n\r\nexport function parseAVCodecParameters(stream: Stream, extradata?: Uint8ArrayInterface) {\r\n  if (!extradata && stream.sideData[AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA]) {\r\n    extradata = stream.sideData[AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA]\r\n  }\r\n  if (extradata) {\r\n    const { profile, sampleRate, channels } = getAVCodecParameters(extradata)\r\n    stream.codecpar.profile = profile\r\n    stream.codecpar.sampleRate = sampleRate\r\n    stream.codecpar.chLayout.nbChannels = channels\r\n  }\r\n}\r\n\r\nexport function avCodecParameters2Extradata(codecpar: AVCodecParameters) {\r\n  const samplingFreqIndex = MPEG4SamplingFrequencyIndex[codecpar.sampleRate]\r\n  const channelConfig = codecpar.chLayout.nbChannels\r\n\r\n  const extradata = new Uint8Array(2)\r\n  extradata[0] = ((codecpar.profile & 0x1f) << 3) | ((samplingFreqIndex & 0x0e) >> 1)\r\n  extradata[1] = ((samplingFreqIndex & 0x01) << 7) | ((channelConfig & 0x0f) << 3)\r\n\r\n  return extradata\r\n}\r\n\r\nexport interface AACADTSHeader {\r\n  syncWord: number\r\n  profile: number\r\n  sampleRate: number\r\n  channels: number\r\n  aacFrameLength: number\r\n  numberOfRawDataBlocksInFrame: number\r\n  headerLength: number\r\n  framePayloadLength: number\r\n}\r\n\r\nexport interface AACLATMHeader {\r\n  syncWord: number\r\n  profile: number\r\n  sampleRate: number\r\n  channels: number\r\n  useSameStreamMux: boolean\r\n  headerLength: number\r\n  framePayloadLength: number\r\n  muxLengthBytes: number\r\n}\r\n\r\n/**\r\n * \r\n * adts 封装转 raw\r\n * \r\n * bits    \r\n * - 12  syncword\r\n * - 1   ID (MPEG 标识位，固定为 1)\r\n * - 2   Layer ( 固定为 0)\r\n * - 1   Protection Absent ( 指示是否有 CRC 校验，1 表示没有校验）\r\n * - 2   Profile\r\n * - 4   Sampling Frequency Index ( 采样率的索引）\r\n * - 1   Private Bit ( 保留位，一般设置为 0)\r\n * - 3   Channel Configuration ( 音频通道数）\r\n * - 1   Original Copy ( 原始拷贝标志位，一般设置为 0)\r\n * - 1   Home ( 保留位，一般设置为 0)\r\n * - 1   Copyright Identification Bit（置 0）\r\n * - 1   Copyright Identification Start（置 0）\r\n * - 13  Frame Length ( 帧长度，包括 ADTS 头和音频帧数据的长度）\r\n * - 11  Buffer Fullness ( 缓冲区满度，可用于音频流的同步）\r\n * - 2   Number of Raw Data Blocks in Frame ( 帧中原始数据块的数量）\r\n * - 16  CRC (Protection Absent 控制）\r\n * - N  raw aac data\r\n * \r\n */\r\nexport function parseADTSHeader(buffer: Uint8ArrayInterface): AACADTSHeader | number {\r\n\r\n  if (buffer.length < 7) {\r\n    return -1\r\n  }\r\n\r\n  const syncWord = (buffer[0] << 4) | (buffer[0 + 1] >> 4)\r\n\r\n  if (syncWord !== 0xFFF) {\r\n    return -1\r\n  }\r\n\r\n  /*\r\n    * const id = (buffer[1] & 0x08) >>> 3\r\n    * const layer = (buffer[1] & 0x06) >>> 1\r\n    */\r\n  const protectionAbsent = buffer[1] & 0x01\r\n  const profile = (buffer[2] & 0xC0) >>> 6\r\n  const samplingFrequencyIndex = (buffer[2] & 0x3C) >>> 2\r\n  const channelConfiguration = ((buffer[2] & 0x01) << 2) | ((buffer[3] & 0xC0) >>> 6)\r\n\r\n  // adts_variable_header()\r\n  const aacFrameLength = ((buffer[3] & 0x03) << 11)\r\n    | (buffer[4] << 3)\r\n    | ((buffer[5] & 0xE0) >>> 5)\r\n\r\n  const numberOfRawDataBlocksInFrame = buffer[6] & 0x03\r\n\r\n  let headerLength = protectionAbsent === 1 ? 7 : 9\r\n  let framePayloadLength = aacFrameLength - headerLength\r\n\r\n  return {\r\n    syncWord,\r\n    profile: profile + 1,\r\n    sampleRate: MPEG4SamplingFrequencies[samplingFrequencyIndex],\r\n    channels: MPEG4Channels[channelConfiguration],\r\n    aacFrameLength,\r\n    numberOfRawDataBlocksInFrame,\r\n    headerLength,\r\n    framePayloadLength\r\n  }\r\n}\r\n\r\nexport function parseLATMHeader(buffer: Uint8ArrayInterface, bitReader?: BitReader) {\r\n  if (!bitReader) {\r\n    bitReader = new BitReader()\r\n    bitReader.appendBuffer(buffer)\r\n  }\r\n\r\n  function getLATMValue() {\r\n    const bytesForValue = bitReader.readU(2)\r\n    let value = 0\r\n\r\n    for (let i = 0; i <= bytesForValue; i++) {\r\n      value = value << 8\r\n      value = value | bitReader.readU(8)\r\n    }\r\n    return value\r\n  }\r\n\r\n  const now = bitReader.getPointer()\r\n\r\n  const info: AACLATMHeader = {\r\n    syncWord: 0,\r\n    profile: 0,\r\n    sampleRate: 0,\r\n    channels: 0,\r\n    useSameStreamMux: false,\r\n    headerLength: 0,\r\n    framePayloadLength: 0,\r\n    muxLengthBytes: 0\r\n  }\r\n\r\n  const syncWord = bitReader.readU(11)\r\n\r\n  if (syncWord !== 0x2B7) {\r\n    return -1\r\n  }\r\n\r\n  info.syncWord = syncWord\r\n\r\n  info.muxLengthBytes = bitReader.readU(13)\r\n\r\n  const useSameStreamMux = bitReader.readU1() === 0x01\r\n\r\n  info.useSameStreamMux = useSameStreamMux\r\n\r\n  if (!useSameStreamMux) {\r\n    const audioMuxVersion = bitReader.readU1() === 0x01\r\n    const audioMuxVersionA = audioMuxVersion && bitReader.readU1() === 0x01\r\n    if (audioMuxVersionA) {\r\n      return -1\r\n    }\r\n    if (audioMuxVersion) {\r\n      getLATMValue()\r\n    }\r\n    const allStreamsSameTimeFraming = bitReader.readU1() === 0x01\r\n    if (!allStreamsSameTimeFraming) {\r\n      return -1\r\n    }\r\n    const numSubFrames = bitReader.readU(6)\r\n    if (numSubFrames !== 0) {\r\n      return -1\r\n    }\r\n\r\n    const numProgram = bitReader.readU(4)\r\n    if (numProgram !== 0) {\r\n      return -1\r\n    }\r\n\r\n    const numLayer = bitReader.readU(3)\r\n    if (numLayer !== 0) {\r\n      return -1\r\n    }\r\n\r\n    let fillBits = audioMuxVersion ? getLATMValue() : 0\r\n\r\n    const audioObjectType = bitReader.readU(5)\r\n    fillBits -= 5\r\n\r\n    const samplingFreqIndex = bitReader.readU(4)\r\n    fillBits -= 4\r\n\r\n    const channelConfig = bitReader.readU(4)\r\n    fillBits -= 4\r\n\r\n    bitReader.readU(3)\r\n    fillBits -= 3\r\n\r\n    if (fillBits > 0) {\r\n      bitReader.readU(fillBits)\r\n    }\r\n\r\n    const frameLengthType = bitReader.readU(3)\r\n    if (frameLengthType === 0) {\r\n      bitReader.readU(8)\r\n    }\r\n    else {\r\n      return -1\r\n    }\r\n\r\n    const otherDataPresent = bitReader.readU1() === 0x01\r\n    if (otherDataPresent) {\r\n      if (audioMuxVersion) {\r\n        getLATMValue()\r\n      }\r\n      else {\r\n        let otherDataLenBits = 0\r\n        while (true) {\r\n          otherDataLenBits = otherDataLenBits << 8\r\n          const otherDataLenEsc = bitReader.readU1() === 0x01\r\n          const otherDataLenTmp = bitReader.readU(8)\r\n          otherDataLenBits += otherDataLenTmp\r\n          if (!otherDataLenEsc) {\r\n            break\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    const crcCheckPresent = bitReader.readU1() === 0x01\r\n    if (crcCheckPresent) {\r\n      bitReader.readU(8)\r\n    }\r\n\r\n    info.profile = audioObjectType + 1\r\n    info.sampleRate = MPEG4SamplingFrequencies[samplingFreqIndex]\r\n    info.channels = MPEG4Channels[channelConfig]\r\n  }\r\n\r\n  let length = 0\r\n  while (true) {\r\n    const tmp = bitReader.readU(8)\r\n    length += tmp\r\n    if (tmp !== 0xff) {\r\n      break\r\n    }\r\n  }\r\n\r\n  info.framePayloadLength = length\r\n  info.headerLength = bitReader.getPointer() - now + (bitReader.getBitLeft() === 8 ? 0 : 1)\r\n\r\n  return info\r\n}\r\n","/*\r\n * libmedia av1 util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVStream from '../AVStream'\r\nimport { AVPacketSideDataType } from 'avutil/codec'\r\nimport BitReader from 'common/io/BitReader'\r\nimport * as av1syntax from 'avutil/util/av1syntax'\r\nimport { Uint8ArrayInterface } from 'common/io/interface'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport BitWriter from 'common/io/BitWriter'\r\nimport { PixelFormatDescriptorsMap } from 'avutil/pixelFormatDescriptor'\r\n\r\nexport const enum AV1Profile {\r\n  Main,\r\n  High,\r\n  Professional\r\n}\r\n\r\nexport const enum OBUType {\r\n  Reserved,\r\n  SEQUENCE_HEADER,\r\n  TEMPORAL_DELIMITER,\r\n  FRAME_HEADER,\r\n  TILE_GROUP,\r\n  METADATA,\r\n  FRAME,\r\n  REDUNDANT_FRAME_HEADER,\r\n  TILE_LIST,\r\n  PADDING = 15\r\n}\r\n\r\nexport const AV1Profile2Name: Record<AV1Profile, string> = {\r\n  [AV1Profile.Main]: 'Main',\r\n  [AV1Profile.High]: 'High',\r\n  [AV1Profile.Professional]: 'Professional'\r\n}\r\n\r\nexport const LevelCapabilities = [\r\n  { level: 20, maxResolution: 2048 * 1152 },\r\n  { level: 21, maxResolution: 2816 * 1584 },\r\n  { level: 30, maxResolution: 4352 * 2448 },\r\n  { level: 31, maxResolution: 5504 * 3096 },\r\n  { level: 40, maxResolution: 6144 * 3456 },\r\n  { level: 41, maxResolution: 6144 * 3456 },\r\n  { level: 50, maxResolution: 8192 * 4352 },\r\n  { level: 51, maxResolution: 8192 * 4352 },\r\n  { level: 52, maxResolution: 8192 * 4352 },\r\n  { level: 53, maxResolution: 8192 * 4352 },\r\n  { level: 60, maxResolution: 16384 * 8704 },\r\n  { level: 61, maxResolution: 16384 * 8704 },\r\n  { level: 62, maxResolution: 16384 * 8704 },\r\n  { level: 63, maxResolution: 16384 * 8704 }\r\n]\r\n\r\nexport const AV1LevelIdx = [20, 21, 22, 23, 30, 31, 32, 33, 40, 41, 42, 43, 50, 51, 52, 53, 60, 61, 62, 63, 70, 71, 72, 73]\r\n\r\nexport function getLevelByResolution(width: number, height: number, fps: number) {\r\n  const resolution = width * height\r\n  for (const level of LevelCapabilities) {\r\n    if (resolution <= level.maxResolution) {\r\n      return level.level\r\n    }\r\n  }\r\n}\r\n\r\nexport function parseAVCodecParameters(stream: AVStream, extradata?: Uint8ArrayInterface) {\r\n  if (!extradata && stream.sideData[AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA]) {\r\n    extradata = stream.sideData[AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA]\r\n  }\r\n  if (extradata && extradata.length >= 4) {\r\n    const params = parseExtraData(extradata)\r\n\r\n    stream.codecpar.profile = params.profile\r\n    stream.codecpar.level = params.level\r\n  }\r\n}\r\n\r\n/**\r\n * - 1 bit marker\r\n * - 7 bit version\r\n * - 3 bit profile\r\n * - 5 bit level\r\n * - 1 bit tier\r\n * - 1 bit bitdepth > 8\r\n * - 1 bit bitdepth == 12\r\n * - 1 bit monochrome\r\n * - 1 bit chroma_subsampling_x\r\n * - 1 bit chroma_subsampling_y\r\n * - 2 bit chroma_sample_position\r\n * - 8 bit padding\r\n * \r\n * @param header \r\n */\r\nexport function parseExtraData(extradata: Uint8ArrayInterface) {\r\n  const bitReader = new BitReader(extradata.length)\r\n  bitReader.appendBuffer(extradata)\r\n  // marker\r\n  bitReader.readU1()\r\n  // version\r\n  bitReader.readU(7)\r\n\r\n  const profile = bitReader.readU(3)\r\n  const level = bitReader.readU(5)\r\n  const tier = bitReader.readU1()\r\n  let bitDepth = bitReader.readU1() ? 10 : 8\r\n  if (bitReader.readU1()) {\r\n    bitDepth = 12\r\n  }\r\n  const monochrome = bitReader.readU1()\r\n  const chromaSubsamplingX = bitReader.readU1()\r\n  const chromaSubsamplingY = bitReader.readU1()\r\n  const chromaSamplePosition = bitReader.readU(2)\r\n\r\n  return {\r\n    profile,\r\n    level,\r\n    tier,\r\n    bitDepth,\r\n    monochrome,\r\n    chromaSubsamplingX,\r\n    chromaSubsamplingY,\r\n    chromaSamplePosition\r\n  }\r\n}\r\n\r\n/* eslint-disable camelcase */\r\nexport function parseSequenceHeader(header: Uint8ArrayInterface) {\r\n  const bitReader = new BitReader(header.length)\r\n  bitReader.appendBuffer(header)\r\n\r\n  bitReader.readU1()\r\n  bitReader.readU(4)\r\n  const extensionFlag = bitReader.readU1()\r\n  const hasSizeFlag = bitReader.readU1()\r\n  // obu_reserved_1bit\r\n  bitReader.readU1()\r\n  if (extensionFlag) {\r\n    bitReader.readU(8)\r\n  }\r\n  if (hasSizeFlag) {\r\n    av1syntax.leb128(bitReader)\r\n  }\r\n\r\n  const seq_profile =\tav1syntax.f(bitReader, 3)\r\n  const still_picture =\tav1syntax.f(bitReader, 1)\r\n  const reduced_still_picture_header = av1syntax.f(bitReader, 1)\r\n\r\n  let timing_info_present_flag = 0\r\n  let decoder_model_info_present_flag = 0\r\n  let initial_display_delay_present_flag = 0\r\n  let operating_points_cnt_minus_1 = 0\r\n  let operating_point_idc: number[] = [0]\r\n  let seq_level_idx: number[] = [0]\r\n  let seq_tier: number[] = [0]\r\n  let decoder_model_present_for_this_op: number[] = [0]\r\n  let initial_display_delay_present_for_this_op: number[] = [0]\r\n  let initial_display_delay_minus_1: number[] = [0]\r\n  let buffer_delay_length_minus_1 = 0\r\n  let decoder_buffer_delay: number[] = [0]\r\n  let encoder_buffer_delay: number[] = [0]\r\n  let low_delay_mode_flag: number[] = [0]\r\n\r\n  if (reduced_still_picture_header) {\r\n    seq_level_idx[0] = av1syntax.f(bitReader, 5)\r\n  }\r\n  else {\r\n    timing_info_present_flag = av1syntax.f(bitReader, 1)\r\n    if (timing_info_present_flag) {\r\n\r\n      let num_units_in_display_tick =\tav1syntax.f(bitReader, 32)\r\n      let time_scale = av1syntax.f(bitReader, 32)\r\n      let equal_picture_interval = av1syntax.f(bitReader, 1)\r\n      if (equal_picture_interval) {\r\n        let num_ticks_per_picture_minus_1 = av1syntax.uvlc(bitReader)\r\n      }\r\n\r\n      let decoder_model_info_present_flag =\tav1syntax.f(bitReader, 1)\r\n      if (decoder_model_info_present_flag) {\r\n        buffer_delay_length_minus_1 =\tav1syntax.f(bitReader, 5)\r\n        let num_units_in_decoding_tick = av1syntax.f(bitReader, 32)\r\n        let buffer_removal_time_length_minus_1 = av1syntax.f(bitReader, 5)\r\n        let frame_presentation_time_length_minus_1 = av1syntax.f(bitReader, 5)\r\n      }\r\n    }\r\n    else {\r\n      decoder_model_info_present_flag = 0\r\n    }\r\n    let initial_display_delay_present_flag = av1syntax.f(bitReader, 1)\r\n    let operating_points_cnt_minus_1 = av1syntax.f(bitReader, 5)\r\n    for (let i = 0; i <= operating_points_cnt_minus_1; i++ ) {\r\n      operating_point_idc[i] = av1syntax.f(bitReader, 12)\r\n      seq_level_idx[i] = av1syntax.f(bitReader, 5)\r\n      if (seq_level_idx[i] > 7) {\r\n        seq_tier[i] = av1syntax.f(bitReader, 1)\r\n      }\r\n      else {\r\n        seq_tier[i] = 0\r\n      }\r\n      if (decoder_model_info_present_flag) {\r\n        decoder_model_present_for_this_op[i] = av1syntax.f(bitReader, 1)\r\n        if (decoder_model_present_for_this_op[i]) {\r\n          let n = buffer_delay_length_minus_1 + 1\r\n          decoder_buffer_delay[i] =\tav1syntax.f(bitReader, n)\r\n          encoder_buffer_delay[i] =\tav1syntax.f(bitReader, n)\r\n          low_delay_mode_flag[i] = av1syntax.f(bitReader, 1)\r\n        }\r\n      }\r\n      else {\r\n        decoder_model_present_for_this_op[i] = 0\r\n      }\r\n      if (initial_display_delay_present_flag) {\r\n        initial_display_delay_present_for_this_op[i] = av1syntax.f(bitReader, 1)\r\n        if ( initial_display_delay_present_for_this_op[i] ) {\r\n          initial_display_delay_minus_1[i] = av1syntax.f(bitReader, 4)\r\n        }\r\n      }\r\n    }\r\n  }\r\n  let frame_width_bits_minus_1 = av1syntax.f(bitReader, 4)\r\n  let frame_height_bits_minus_1 =\tav1syntax.f(bitReader, 4)\r\n  let n = frame_width_bits_minus_1 + 1\r\n  let max_frame_width_minus_1 =\tav1syntax.f(bitReader, n)\r\n  n = frame_height_bits_minus_1 + 1\r\n  let max_frame_height_minus_1 = av1syntax.f(bitReader, n)\r\n  let frame_id_numbers_present_flag = 0\r\n  let delta_frame_id_length_minus_2 = 0\r\n  let additional_frame_id_length_minus_1 = 0\r\n  if (reduced_still_picture_header ) {\r\n    frame_id_numbers_present_flag = 0\r\n  }\r\n  else {\r\n    frame_id_numbers_present_flag =\tav1syntax.f(bitReader, 1)\r\n  }\r\n  if ( frame_id_numbers_present_flag ) {\r\n    delta_frame_id_length_minus_2 =\tav1syntax.f(bitReader, 4)\r\n    additional_frame_id_length_minus_1 = av1syntax.f(bitReader, 3)\r\n  }\r\n  let use_128x128_superblock = av1syntax.f(bitReader, 1)\r\n  let enable_filter_intra =\tav1syntax.f(bitReader, 1)\r\n  let enable_intra_edge_filter = av1syntax.f(bitReader, 1)\r\n  let enable_interintra_compound = 0\r\n  let enable_masked_compound = 0\r\n  let enable_warped_motion = 0\r\n  let enable_dual_filter = 0\r\n  let enable_order_hint = 0\r\n  let enable_jnt_comp = 0\r\n  let enable_ref_frame_mvs = 0\r\n  let seq_force_screen_content_tools = 2\r\n  let seq_force_integer_mv = 2\r\n  let OrderHintBits = 0\r\n  if (!reduced_still_picture_header) {\r\n    let enable_interintra_compound = av1syntax.f(bitReader, 1)\r\n    enable_masked_compound = av1syntax.f(bitReader, 1)\r\n    enable_warped_motion = av1syntax.f(bitReader, 1)\r\n    enable_dual_filter = av1syntax.f(bitReader, 1)\r\n    enable_order_hint = av1syntax.f(bitReader, 1)\r\n    if (enable_order_hint) {\r\n      enable_jnt_comp = av1syntax.f(bitReader, 1)\r\n      enable_ref_frame_mvs = av1syntax.f(bitReader, 1)\r\n    }\r\n    else {\r\n      enable_jnt_comp = 0\r\n      enable_ref_frame_mvs = 0\r\n    }\r\n    let seq_choose_screen_content_tools =\tav1syntax.f(bitReader, 1)\r\n    if (seq_choose_screen_content_tools) {\r\n      seq_force_screen_content_tools = 2\r\n    }\r\n    else {\r\n      seq_force_screen_content_tools = av1syntax.f(bitReader, 1)\r\n    }\r\n\r\n    if (seq_force_screen_content_tools > 0) {\r\n      let seq_choose_integer_mv =\tav1syntax.f(bitReader, 1)\r\n      if (seq_choose_integer_mv) {\r\n        seq_force_integer_mv = 2\r\n      }\r\n      else {\r\n        seq_force_integer_mv = av1syntax.f(bitReader, 1)\r\n      }\r\n    }\r\n    else {\r\n      seq_force_integer_mv = 2\r\n    }\r\n    if (enable_order_hint) {\r\n      const order_hint_bits_minus_1 =\tav1syntax.f(bitReader, 3)\r\n      OrderHintBits = order_hint_bits_minus_1 + 1\r\n    }\r\n    else {\r\n      OrderHintBits = 0\r\n    }\r\n  }\r\n  let enable_superres =\tav1syntax.f(bitReader, 1)\r\n  let enable_cdef =\tav1syntax.f(bitReader, 1)\r\n  let enable_restoration = av1syntax.f(bitReader, 1)\r\n\r\n  let high_bitdepth =\tav1syntax.f(bitReader, 1)\r\n  let twelve_bit = 0\r\n  let bit_depth = 0\r\n  let mono_chrome = 0\r\n  if (seq_profile == 2 && high_bitdepth ) {\r\n    twelve_bit = av1syntax.f(bitReader, 1)\r\n    bit_depth = twelve_bit ? 12 : 10\r\n  }\r\n  else if (seq_profile <= 2) {\r\n    bit_depth = high_bitdepth ? 10 : 8\r\n  }\r\n  if ( seq_profile == 1 ) {\r\n    mono_chrome = 0\r\n  }\r\n  else {\r\n    mono_chrome = av1syntax.f(bitReader, 1)\r\n  }\r\n  const color_description_present_flag = av1syntax.f(bitReader, 1)\r\n  let color_primaries = 0\r\n  let transfer_characteristics = 0\r\n  let matrix_coefficients = 0\r\n  if (color_description_present_flag ) {\r\n    color_primaries =\tav1syntax.f(bitReader, 8)\r\n    transfer_characteristics = av1syntax.f(bitReader, 8)\r\n    matrix_coefficients = av1syntax.f(bitReader, 8)\r\n  }\r\n  else {\r\n    color_primaries = 2\r\n    transfer_characteristics = 2\r\n    matrix_coefficients = 2\r\n  }\r\n  let color_range = 0\r\n  let subsampling_x = 0\r\n  let subsampling_y = 0\r\n  let chroma_sample_position = 0\r\n  let separate_uv_delta_q = 0\r\n  if (mono_chrome) {\r\n    color_range =\tav1syntax.f(bitReader, 1)\r\n    subsampling_x = 1\r\n    subsampling_y = 1\r\n    chroma_sample_position = 0\r\n    separate_uv_delta_q = 0\r\n  }\r\n  else if (color_primaries == 1\r\n    && transfer_characteristics == 13\r\n    && matrix_coefficients == 0\r\n  ) {\r\n    color_range = 1\r\n    subsampling_x = 0\r\n    subsampling_y = 0\r\n    separate_uv_delta_q = av1syntax.f(bitReader, 1)\r\n  }\r\n  else {\r\n    color_range =\tav1syntax.f(bitReader, 1)\r\n    if (seq_profile == 0) {\r\n      subsampling_x = 1\r\n      subsampling_y = 1\r\n    }\r\n    else if ( seq_profile == 1 ) {\r\n      subsampling_x = 0\r\n      subsampling_y = 0\r\n    }\r\n    else {\r\n      if (bit_depth == 12) {\r\n        subsampling_x\t= av1syntax.f(bitReader, 1)\r\n        if (subsampling_x) {\r\n          subsampling_y =\tav1syntax.f(bitReader, 1)\r\n        }\r\n        else {\r\n          subsampling_y = 0\r\n        }\r\n      }\r\n      else {\r\n        subsampling_x = 1\r\n        subsampling_y = 0\r\n      }\r\n    }\r\n    if (subsampling_x && subsampling_y) {\r\n      chroma_sample_position = av1syntax.f(bitReader, 2)\r\n    }\r\n    separate_uv_delta_q = av1syntax.f(bitReader, 1)\r\n  }\r\n\r\n  let film_grain_params_present\t= av1syntax.f(bitReader, 1)\r\n\r\n  return {\r\n    width: max_frame_width_minus_1 + 1,\r\n    height: max_frame_height_minus_1 + 1,\r\n    profile: seq_profile,\r\n    level: AV1LevelIdx[seq_level_idx[0]],\r\n    tier: seq_tier[0],\r\n    bitDepth: bit_depth,\r\n    monoChrome: mono_chrome,\r\n    colorRange: color_range,\r\n    colorPrimaries: color_primaries,\r\n    transferCharacteristics: transfer_characteristics,\r\n    matrixCoefficients: matrix_coefficients,\r\n    subsamplingX: subsampling_x,\r\n    subsamplingY: subsampling_y,\r\n    chromaSamplePosition: chroma_sample_position\r\n  }\r\n}\r\n\r\nexport function splitOBU(buffer: Uint8ArrayInterface) {\r\n  const bitReader = new BitReader()\r\n\r\n  bitReader.appendBuffer(buffer)\r\n\r\n  const list: Uint8ArrayInterface[] = []\r\n\r\n  while (bitReader.remainingLength()) {\r\n    const now = bitReader.getPointer()\r\n    // obu_forbidden_bit\r\n    bitReader.readU1()\r\n    const type = bitReader.readU(4)\r\n    const extensionFlag = bitReader.readU1()\r\n    const hasSizeFlag = bitReader.readU1()\r\n    // obu_reserved_1bit\r\n    bitReader.readU1()\r\n\r\n    if (extensionFlag) {\r\n      bitReader.readU(8)\r\n    }\r\n\r\n    const size = hasSizeFlag ? av1syntax.leb128(bitReader) : buffer.length - 1 - extensionFlag\r\n\r\n    const headerSize = bitReader.getPointer() - now\r\n\r\n    list.push(buffer.subarray(now, now + headerSize + size))\r\n\r\n    bitReader.skip(size * 8)\r\n  }\r\n\r\n  return list\r\n}\r\n\r\nexport function generateExtradata(codecpar: pointer<AVCodecParameters>, buffer: Uint8ArrayInterface) {\r\n  const bitWriter = new BitWriter(4)\r\n  // marker\r\n  bitWriter.writeU1(1)\r\n  // version\r\n  bitWriter.writeU(7, 1)\r\n\r\n  const header = splitOBU(buffer).find((buffer) => {\r\n    return ((buffer[0] >>> 3) & 0x0f) === OBUType.SEQUENCE_HEADER\r\n  })\r\n\r\n  if (header) {\r\n    const params = parseSequenceHeader(header)\r\n    bitWriter.writeU(3, params.profile)\r\n    bitWriter.writeU(5, params.level)\r\n    bitWriter.writeU(1, params.tier)\r\n    bitWriter.writeU(1, params.bitDepth > 8 ? 1 : 0)\r\n    bitWriter.writeU(1, params.bitDepth === 12 ? 1 : 0)\r\n    bitWriter.writeU(1, params.monoChrome)\r\n    bitWriter.writeU(1, params.subsamplingX)\r\n    bitWriter.writeU(1, params.subsamplingY)\r\n    bitWriter.writeU(1, params.chromaSamplePosition)\r\n  }\r\n  else {\r\n    const desc = PixelFormatDescriptorsMap[codecpar.format]\r\n    bitWriter.writeU(3, codecpar.profile)\r\n    bitWriter.writeU(5, codecpar.level)\r\n    bitWriter.writeU(1, 0)\r\n    bitWriter.writeU(1, desc.comp[0].depth > 8 ? 1 : 0)\r\n    bitWriter.writeU(1, desc.comp[0].depth === 12 ? 1 : 0)\r\n    bitWriter.writeU(1, 0)\r\n    bitWriter.writeU(1, 1)\r\n    bitWriter.writeU(1, 1)\r\n    bitWriter.writeU(1, 0)\r\n  }\r\n  // padding\r\n  bitWriter.writeU(8, 0)\r\n  return bitWriter.getBuffer()\r\n}\r\n","/*\r\n * libmedia h264 util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport * as array from 'common/util/array'\r\nimport AVPacket, { AVPacketFlags } from 'avutil/struct/avpacket'\r\nimport BufferWriter from 'common/io/BufferWriter'\r\nimport BufferReader from 'common/io/BufferReader'\r\nimport { AVPacketSideDataType } from 'avutil/codec'\r\nimport BitReader from 'common/io/BitReader'\r\nimport AVStream from '../AVStream'\r\nimport * as logger from 'common/util/logger'\r\nimport { mapUint8Array, memcpyFromUint8Array } from 'cheap/std/memory'\r\nimport { addAVPacketSideData, getAVPacketData } from 'avutil/util/avpacket'\r\nimport { naluUnescape, splitNaluByStartCode, isAnnexb } from 'avutil/util/nalu'\r\nimport { avMalloc } from 'avutil/util/mem'\r\nimport * as expgolomb from 'avutil/util/expgolomb'\r\nimport { Uint8ArrayInterface } from 'common/io/interface'\r\nimport * as intread from 'avutil/util/intread'\r\n\r\nexport const NALULengthSizeMinusOne = 3\r\n\r\nexport const enum BitFormat {\r\n  AVCC = 1,\r\n  ANNEXB\r\n}\r\n\r\nexport const enum PictureType {\r\n  I = 1,\r\n  P,\r\n  B,\r\n  SPS,\r\n  PPS,\r\n  SEI\r\n}\r\n\r\nexport const enum H264NaluType {\r\n  kUnspecified = 0,\r\n  kSliceNonIDR,\r\n  kSliceDPA,\r\n  kSliceDPB,\r\n  kSliceDPC,\r\n  kSliceIDR,\r\n  kSliceSEI,\r\n  kSliceSPS,\r\n  kSlicePPS,\r\n  kSliceAUD,\r\n  kEndOfSequence,\r\n  kEndOfStream,\r\n  kFiller,\r\n  kSPSExt,\r\n  kReserved0\r\n}\r\n\r\nexport const enum H264SliceType {\r\n  kSliceNone = -1,\r\n  kSliceP,\r\n  kSliceB,\r\n  kSliceI,\r\n  kSliceSP = 5,\r\n  kSliceSB,\r\n  kSliceSI\r\n}\r\n\r\nexport const enum H264Profile {\r\n  kBaseline = 66,\r\n  kMain = 77,\r\n  kHigh = 100,\r\n  kConstrained = kBaseline,\r\n  kHigh10 = 110,\r\n  kHigh422 = 122,\r\n  kHigh444 = 244\r\n}\r\n\r\nexport const H264Profile2Name: Record<H264Profile, string> = {\r\n  [H264Profile.kBaseline]: 'Constrained Baseline',\r\n  [H264Profile.kMain]: 'Main',\r\n  [H264Profile.kHigh]: 'High',\r\n  [H264Profile.kHigh10]: 'High10',\r\n  [H264Profile.kHigh422]: 'High422',\r\n  [H264Profile.kHigh444]: 'High444'\r\n}\r\n\r\nexport const LevelCapabilities = [\r\n  { level: 10, maxResolution: 25344, maxFrameRate: 15 },\r\n  { level: 11, maxResolution: 25344, maxFrameRate: 30 },\r\n  { level: 12, maxResolution: 101376, maxFrameRate: 30 },\r\n  { level: 13, maxResolution: 101376, maxFrameRate: 30 },\r\n  { level: 20, maxResolution: 101376, maxFrameRate: 30 },\r\n  { level: 21, maxResolution: 202752, maxFrameRate: 30 },\r\n  { level: 22, maxResolution: 414720, maxFrameRate: 30 },\r\n  { level: 30, maxResolution: 414720, maxFrameRate: 30 },\r\n  { level: 31, maxResolution: 921600, maxFrameRate: 30 },\r\n  { level: 32, maxResolution: 1310720, maxFrameRate: 60 },\r\n  { level: 40, maxResolution: 2097152, maxFrameRate: 30 },\r\n  { level: 41, maxResolution: 2097152, maxFrameRate: 60 },\r\n  { level: 42, maxResolution: 2228224, maxFrameRate: 60 },\r\n  { level: 50, maxResolution: 8912896, maxFrameRate: 30 },\r\n  { level: 51, maxResolution: 8912896, maxFrameRate: 60 },\r\n  { level: 52, maxResolution: 8912896, maxFrameRate: 120 },\r\n  { level: 60, maxResolution: 35651584, maxFrameRate: 30 },\r\n  { level: 61, maxResolution: 35651584, maxFrameRate: 60 },\r\n  { level: 62, maxResolution: 35651584, maxFrameRate: 120 }\r\n]\r\n\r\nexport function getLevelByResolution(width: number, height: number, fps: number) {\r\n  const resolution = width * height\r\n  for (const level of LevelCapabilities) {\r\n    if (resolution <= level.maxResolution && fps <= level.maxFrameRate) {\r\n      return level.level\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * \r\n * avcc 格式的 extradata 转 annexb sps pps\r\n * \r\n * bits    \r\n * - 8   version ( always 0x01 )\r\n * - 8   avc profile ( sps[0][1] )\r\n * - 8   avc compatibility ( sps[0][2] )\r\n * - 8   avc level ( sps[0][3] )\r\n * - 6   reserved ( all bits on )\r\n * - 2   NALULengthSizeMinusOne\r\n * - 3   reserved ( all bits on )\r\n * - 5   number of SPS NALUs (usually 1)\r\n * - repeated once per SPS:\r\n *   - 16         SPS size\r\n *   - variable   SPS NALU data\r\n * - 8 number of PPS NALUs (usually 1)\r\n * - repeated once per PPS:\r\n *   - 16       PPS size\r\n *   - variable PPS NALU data\r\n * \r\n * - ext (profile !== 66 && profile !== 77 && profile !== 88)\r\n *  - 6 reserved ( all bits on )\r\n *  - 2 chroma_format_idc\r\n *  - 5 reserved ( all bits on )\r\n *  - 3 bit_depth_luma_minus8\r\n *  - 5 reserved ( all bits on )\r\n *  - 3 bit_depth_chroma_minus8\r\n *  - 8 number of SPS_EXT NALUs\r\n *    - 16 SPS_EXT size\r\n *    - variable   SPS_EXT NALU data\r\n * \r\n */\r\nexport function extradata2SpsPps(extradata: Uint8ArrayInterface) {\r\n  const bufferReader = new BufferReader(extradata)\r\n  bufferReader.skip(5)\r\n\r\n  const spss = []\r\n  const ppss = []\r\n  const spsExts = []\r\n\r\n  const spsLength = bufferReader.readUint8() & 0x1f\r\n  for (let i = 0; i < spsLength; i++) {\r\n    const length = bufferReader.readUint16()\r\n    spss.push(bufferReader.readBuffer(length))\r\n  }\r\n\r\n  const ppsLength = bufferReader.readUint8()\r\n  for (let i = 0; i < ppsLength; i++) {\r\n    const length = bufferReader.readUint16()\r\n    ppss.push(bufferReader.readBuffer(length))\r\n  }\r\n\r\n  if (bufferReader.remainingSize() > 4) {\r\n    bufferReader.skip(3)\r\n    const spsExtLength = bufferReader.readUint8()\r\n    if (spsExtLength > 0) {\r\n      for (let i = 0; i < spsExtLength; i++) {\r\n        const length = bufferReader.readUint16()\r\n        spsExts.push(bufferReader.readBuffer(length))\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    spss,\r\n    ppss,\r\n    spsExts\r\n  }\r\n}\r\n\r\nexport function spsPps2Extradata(spss: Uint8ArrayInterface[], ppss: Uint8ArrayInterface[], spsExts: Uint8ArrayInterface[] = []) {\r\n\r\n  if (spss.length > 32) {\r\n    logger.warn(`h264 metadata\\'s sps max length is 32, but get ${spss.length}`)\r\n    spss = spss.slice(0, 32)\r\n  }\r\n  if (spss.length > 256) {\r\n    logger.warn(`h264 metadata\\'s pps max length is 256, but get ${spss.length}`)\r\n    spss = spss.slice(0, 256)\r\n  }\r\n\r\n  let length = 7\r\n  length = spss.reduce((prev, sps) => {\r\n    return prev + 2 + sps.length\r\n  }, length)\r\n  length = ppss.reduce((prev, pps) => {\r\n    return prev + 2 + pps.length\r\n  }, length)\r\n\r\n  const sps = spss[0]\r\n\r\n  const params = parseSPS(sps)\r\n\r\n  if (params.profile !== 66 && params.profile !== 77 && params.profile !== 88) {\r\n    length += 4\r\n\r\n    if (spsExts.length) {\r\n      length = spsExts.reduce((prev, ext) => {\r\n        return prev + 2 + ext.length\r\n      }, length)\r\n    }\r\n  }\r\n\r\n  const buffer = new Uint8Array(length)\r\n  const bufferWriter = new BufferWriter(buffer)\r\n\r\n  bufferWriter.writeUint8(0x01)\r\n  bufferWriter.writeUint8(sps[1])\r\n  bufferWriter.writeUint8(sps[2])\r\n  bufferWriter.writeUint8(sps[3])\r\n  bufferWriter.writeUint8(0xfc | NALULengthSizeMinusOne)\r\n\r\n  // sps\r\n  bufferWriter.writeUint8(0xe0 | (spss.length & 0x1f))\r\n  array.each(spss, (sps) => {\r\n    bufferWriter.writeUint16(sps.length)\r\n    bufferWriter.writeBuffer(sps)\r\n  })\r\n\r\n  // pps\r\n  bufferWriter.writeUint8(ppss.length)\r\n  array.each(ppss, (pps) => {\r\n    bufferWriter.writeUint16(pps.length)\r\n    bufferWriter.writeBuffer(pps)\r\n  })\r\n\r\n  if (params.profile !== 66 && params.profile !== 77 && params.profile !== 88) {\r\n    bufferWriter.writeUint8(0xfc | params.chromaFormatIdc)\r\n    bufferWriter.writeUint8(0xf8 | params.bitDepthLumaMinus8)\r\n    bufferWriter.writeUint8(0xf8 | params.bitDepthChromaMinus8)\r\n\r\n    if (spsExts.length) {\r\n      array.each(spsExts, (ext) => {\r\n        bufferWriter.writeUint16(ext.length)\r\n        bufferWriter.writeBuffer(ext)\r\n      })\r\n    }\r\n  }\r\n\r\n  return buffer\r\n}\r\n\r\nexport function annexbExtradata2AvccExtradata(data: Uint8ArrayInterface) {\r\n  let nalus = splitNaluByStartCode(data)\r\n  if (nalus.length > 1) {\r\n    const spss = []\r\n    const ppss = []\r\n    const spsExts = []\r\n\r\n    nalus.forEach((nalu) => {\r\n      const type = nalu[0] & 0x1f\r\n      if (type === H264NaluType.kSliceSPS) {\r\n        spss.push(nalu)\r\n      }\r\n      else if (type === H264NaluType.kSlicePPS) {\r\n        ppss.push(nalu)\r\n      }\r\n      else if (type === H264NaluType.kSPSExt) {\r\n        spsExts.push(nalu)\r\n      }\r\n    })\r\n    if (spss.length && ppss.length) {\r\n      return spsPps2Extradata(spss, ppss, spsExts)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * \r\n * annexb 格式的 NALU 转 avcc NALU \r\n * \r\n */\r\nexport function annexb2Avcc(data: Uint8ArrayInterface) {\r\n\r\n  let nalus = splitNaluByStartCode(data)\r\n  let extradata: Uint8Array\r\n  let key: boolean = false\r\n\r\n  if (nalus.length > 1) {\r\n    const spss = []\r\n    const ppss = []\r\n    const spsExts = []\r\n\r\n    nalus.forEach((nalu) => {\r\n      const type = nalu[0] & 0x1f\r\n      if (type === H264NaluType.kSliceSPS) {\r\n        spss.push(nalu)\r\n      }\r\n      else if (type === H264NaluType.kSlicePPS) {\r\n        ppss.push(nalu)\r\n      }\r\n      else if (type === H264NaluType.kSPSExt) {\r\n        spsExts.push(nalu)\r\n      }\r\n    })\r\n\r\n    if (spss.length && ppss.length) {\r\n      extradata = spsPps2Extradata(spss, ppss, spsExts)\r\n    }\r\n\r\n    nalus = nalus.filter((nalu) => {\r\n      const type = nalu[0] & 0x1f\r\n      return type !== H264NaluType.kSliceAUD\r\n        && type !== H264NaluType.kSlicePPS\r\n        && type !== H264NaluType.kSliceSPS\r\n        && type !== H264NaluType.kSPSExt\r\n    })\r\n  }\r\n\r\n  const length = nalus.reduce((prev, nalu) => {\r\n    return prev + NALULengthSizeMinusOne + 1 + nalu.length\r\n  }, 0)\r\n\r\n  const bufferPointer = avMalloc(length)\r\n  const buffer = mapUint8Array(bufferPointer, length)\r\n\r\n  const bufferWriter = new BufferWriter(buffer)\r\n\r\n  array.each(nalus, (nalu) => {\r\n    if (NALULengthSizeMinusOne === 3) {\r\n      bufferWriter.writeUint32(nalu.length)\r\n    }\r\n    else if (NALULengthSizeMinusOne === 2) {\r\n      bufferWriter.writeUint24(nalu.length)\r\n    }\r\n    else if (NALULengthSizeMinusOne === 1) {\r\n      bufferWriter.writeUint16(nalu.length)\r\n    }\r\n    else {\r\n      bufferWriter.writeUint8(nalu.length)\r\n    }\r\n    bufferWriter.writeBuffer(nalu.subarray(0))\r\n\r\n    const type = nalu[0] & 0x1f\r\n    if (type === H264NaluType.kSliceIDR) {\r\n      key = true\r\n    }\r\n  })\r\n\r\n  return {\r\n    bufferPointer,\r\n    length,\r\n    key,\r\n    extradata\r\n  }\r\n}\r\n\r\n/**\r\n * avcc 格式的 NALU 转 annexb NALU \r\n * \r\n */\r\nexport function avcc2Annexb(data: Uint8ArrayInterface, extradata?: Uint8ArrayInterface) {\r\n  const naluLengthSizeMinusOne = extradata ? (extradata[4] & 0x03) : NALULengthSizeMinusOne\r\n  let spss = []\r\n  let ppss = []\r\n  let spsExts = []\r\n  let key = false\r\n\r\n  if (extradata) {\r\n    const result = extradata2SpsPps(extradata)\r\n    spss = result.spss\r\n    ppss = result.ppss\r\n    spsExts = result.spsExts\r\n\r\n    key = true\r\n  }\r\n\r\n  const nalus = []\r\n  const seis = []\r\n\r\n  const bufferReader = new BufferReader(data)\r\n  while (bufferReader.remainingSize() > 0) {\r\n    let length = 0\r\n    if (naluLengthSizeMinusOne === 3) {\r\n      length = bufferReader.readUint32()\r\n    }\r\n    else if (naluLengthSizeMinusOne === 2) {\r\n      length = bufferReader.readUint24()\r\n    }\r\n    else if (naluLengthSizeMinusOne === 1) {\r\n      length = bufferReader.readUint16()\r\n    }\r\n    else {\r\n      length = bufferReader.readUint8()\r\n    }\r\n\r\n    const nalu = data.subarray(static_cast<int32>(bufferReader.getPos()), static_cast<int32>(bufferReader.getPos()) + length)\r\n    bufferReader.skip(length)\r\n\r\n    const naluType = nalu[0] & 0x1f\r\n\r\n    if (naluType === H264NaluType.kSliceSEI) {\r\n      seis.push(nalu)\r\n    }\r\n    else if (naluType !== H264NaluType.kSliceAUD) {\r\n      nalus.push(nalu)\r\n    }\r\n  }\r\n\r\n  let length = spss.reduce((prev, sps) => {\r\n    return prev + 4 + sps.length\r\n  }, 0)\r\n  length = ppss.reduce((prev, pps) => {\r\n    return prev + 4 + pps.length\r\n  }, length)\r\n  length = spsExts.reduce((prev, ext) => {\r\n    return prev + 4 + ext.length\r\n  }, length)\r\n  length = seis.reduce((prev, sei) => {\r\n    return prev + 4 + sei.length\r\n  }, length)\r\n  length = nalus.reduce((prev, nalu, index) => {\r\n    return prev + (index ? 3 : 4) + nalu.length\r\n  }, length)\r\n\r\n  const bufferPointer = avMalloc(length + 6)\r\n  const bufferWriter = new BufferWriter(mapUint8Array(bufferPointer, length + 6))\r\n\r\n  // AUD\r\n  bufferWriter.writeUint8(0x00)\r\n  bufferWriter.writeUint8(0x00)\r\n  bufferWriter.writeUint8(0x00)\r\n  bufferWriter.writeUint8(0x01)\r\n  bufferWriter.writeUint8(0x09)\r\n  bufferWriter.writeUint8(0xf0)\r\n\r\n  array.each(seis, (sei) => {\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x01)\r\n    bufferWriter.writeBuffer(sei)\r\n  })\r\n\r\n  array.each(spss, (sps) => {\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x01)\r\n    bufferWriter.writeBuffer(sps)\r\n  })\r\n\r\n  array.each(ppss, (pps) => {\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x01)\r\n    bufferWriter.writeBuffer(pps)\r\n  })\r\n  array.each(spsExts, (ext) => {\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x01)\r\n    bufferWriter.writeBuffer(ext)\r\n  })\r\n\r\n  array.each(nalus, (nalu, index) => {\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    if (!index) {\r\n      bufferWriter.writeUint8(0x00)\r\n    }\r\n    bufferWriter.writeUint8(0x01)\r\n    bufferWriter.writeBuffer(nalu)\r\n\r\n    const type = nalu[0] & 0x1f\r\n    if (type === H264NaluType.kSliceIDR) {\r\n      key = true\r\n    }\r\n  })\r\n  return {\r\n    bufferPointer,\r\n    length: length + 6,\r\n    key\r\n  }\r\n}\r\n\r\nexport function parseAvccExtraData(avpacket: pointer<AVPacket>, stream: AVStream) {\r\n\r\n  if (!(avpacket.flags & AVPacketFlags.AV_PKT_FLAG_KEY)) {\r\n    return\r\n  }\r\n\r\n  const data = getAVPacketData(avpacket)\r\n\r\n  if (isAnnexb(data)) {\r\n    return\r\n  }\r\n\r\n  const naluLengthSizeMinusOne = stream.metadata.naluLengthSizeMinusOne ?? NALULengthSizeMinusOne\r\n\r\n  let spss = []\r\n  let ppss = []\r\n  let spsExts = []\r\n  let others = []\r\n\r\n  const bufferReader = new BufferReader(data)\r\n  while (bufferReader.remainingSize() > 0) {\r\n    let length = 0\r\n    if (naluLengthSizeMinusOne === 3) {\r\n      length = bufferReader.readUint32()\r\n    }\r\n    else if (naluLengthSizeMinusOne === 2) {\r\n      length = bufferReader.readUint24()\r\n    }\r\n    else if (naluLengthSizeMinusOne === 1) {\r\n      length = bufferReader.readUint16()\r\n    }\r\n    else {\r\n      length = bufferReader.readUint8()\r\n    }\r\n\r\n    const nalu = data.subarray(static_cast<int32>(bufferReader.getPos()), static_cast<int32>(bufferReader.getPos()) + length)\r\n    bufferReader.skip(length)\r\n\r\n    const naluType = nalu[0] & 0x1f\r\n\r\n    if (naluType === H264NaluType.kSliceSPS) {\r\n      spss.push(nalu)\r\n    }\r\n    else if (naluType === H264NaluType.kSlicePPS) {\r\n      ppss.push(nalu)\r\n    }\r\n    else if (naluType === H264NaluType.kSPSExt) {\r\n      spsExts.push(nalu)\r\n    }\r\n    else {\r\n      others.push(nalu)\r\n    }\r\n  }\r\n\r\n  if (spss.length || ppss.length) {\r\n    const extradata = spsPps2Extradata(spss, ppss, spsExts)\r\n    const extradataPointer = avMalloc(extradata.length)\r\n    memcpyFromUint8Array(extradataPointer, extradata.length, extradata)\r\n    addAVPacketSideData(avpacket, AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA, extradataPointer, extradata.length)\r\n  }\r\n}\r\n\r\nexport function parseAnnexbExtraData(avpacket: pointer<AVPacket>, force: boolean = false) {\r\n  if (!(avpacket.flags & AVPacketFlags.AV_PKT_FLAG_KEY) && !force) {\r\n    return\r\n  }\r\n\r\n  const data = getAVPacketData(avpacket)\r\n\r\n  if (!isAnnexb(data)) {\r\n    return\r\n  }\r\n\r\n  let nalus = splitNaluByStartCode(data)\r\n\r\n  if (nalus.length > 1) {\r\n    const spss = []\r\n    const ppss = []\r\n    const spsExts = []\r\n\r\n    nalus.forEach((nalu) => {\r\n      const type = nalu[0] & 0x1f\r\n      if (type === H264NaluType.kSliceSPS) {\r\n        spss.push(nalu)\r\n      }\r\n      else if (type === H264NaluType.kSlicePPS) {\r\n        ppss.push(nalu)\r\n      }\r\n      else if (type === H264NaluType.kSPSExt) {\r\n        spsExts.push(nalu)\r\n      }\r\n    })\r\n\r\n    if (spss.length && ppss.length) {\r\n      const extradata = spsPps2Extradata(spss, ppss, spsExts)\r\n      const extradataPointer = avMalloc(extradata.length)\r\n      memcpyFromUint8Array(extradataPointer, extradata.length, extradata)\r\n      addAVPacketSideData(avpacket, AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA, extradataPointer, extradata.length)\r\n      avpacket.flags |= AVPacketFlags.AV_PKT_FLAG_KEY\r\n    }\r\n  }\r\n}\r\n\r\nexport function parseAVCodecParameters(stream: AVStream, extradata?: Uint8ArrayInterface) {\r\n  if (!extradata && stream.sideData[AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA]) {\r\n    extradata = stream.sideData[AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA]\r\n  }\r\n  if (extradata && extradata.length >= 6) {\r\n\r\n    stream.metadata.naluLengthSizeMinusOne = (extradata[4] & 0x03)\r\n\r\n    const { spss } = extradata2SpsPps(extradata)\r\n\r\n    if (spss.length) {\r\n      const { profile, level, width, height } = parseSPS(spss[0])\r\n\r\n      stream.codecpar.profile = profile\r\n      stream.codecpar.level = level\r\n      stream.codecpar.width = width\r\n      stream.codecpar.height = height\r\n    }\r\n  }\r\n}\r\n\r\nexport function isIDR(avpacket: pointer<AVPacket>, naluLengthSize: int32 = 4) {\r\n  if (avpacket.bitFormat === BitFormat.ANNEXB) {\r\n    let nalus = splitNaluByStartCode(mapUint8Array(avpacket.data, avpacket.size))\r\n    return nalus.some((nalu) => {\r\n      const type = nalu[0] & 0x1f\r\n      return type === H264NaluType.kSliceIDR\r\n    })\r\n  }\r\n  else {\r\n    const size = avpacket.size\r\n    let i = 0\r\n    while (i < (size - naluLengthSize)) {\r\n      const type = intread.r8(avpacket.data + (i + naluLengthSize)) & 0x1f\r\n      if (type === H264NaluType.kSliceIDR) {\r\n        return true\r\n      }\r\n      if (naluLengthSize === 4) {\r\n        i += intread.rb32(avpacket.data + i)\r\n      }\r\n      else if (naluLengthSize === 3) {\r\n        i += intread.rb24(avpacket.data + i)\r\n      }\r\n      else if (naluLengthSize === 2) {\r\n        i += intread.rb16(avpacket.data + i)\r\n      }\r\n      else {\r\n        i += intread.r8(avpacket.data + i)\r\n      }\r\n      i += naluLengthSize\r\n    }\r\n    return false\r\n  }\r\n}\r\n\r\nexport interface H264SPS {\r\n  profile: number\r\n  level: number\r\n  width: number\r\n  height: number\r\n  chromaFormatIdc: number\r\n  bitDepthLumaMinus8: number\r\n  bitDepthChromaMinus8: number\r\n  frameMbsOnlyFlag: number\r\n  picOrderCntType: number\r\n  log2MaxPicOrderCntLsbMinus4: number\r\n  deltaPicOrderAlwaysZeroFlag: number\r\n  log2MaxFrameNumMinus4: number\r\n}\r\n\r\nexport function parseSPS(sps: Uint8ArrayInterface): H264SPS {\r\n\r\n  if (!sps || sps.length < 3) {\r\n    return\r\n  }\r\n\r\n  let offset = 0\r\n  if (sps[0] === 0x00\r\n    && sps[1] === 0x00\r\n    && sps[2] === 0x00\r\n    && sps[3] === 0x01\r\n  ) {\r\n    offset = 4\r\n  }\r\n\r\n  const buffer = naluUnescape(sps.subarray(offset))\r\n  const bitReader = new BitReader(buffer.length)\r\n  bitReader.appendBuffer(buffer)\r\n\r\n  // forbidden_zero_bit\r\n  bitReader.readU1()\r\n  // nal_ref_idc\r\n  bitReader.readU(2)\r\n  // nal_unit_type\r\n  bitReader.readU(5)\r\n\r\n  const profile = bitReader.readU(8)\r\n\r\n  // constraint_set0_flag\r\n  bitReader.readU1()\r\n  // constraint_set1_flag\r\n  bitReader.readU1()\r\n  // constraint_set2_flag\r\n  bitReader.readU1()\r\n  // constraint_set3_flag\r\n  bitReader.readU1()\r\n  // constraint_set4_flag\r\n  bitReader.readU1()\r\n  // constraint_set4_flag\r\n  bitReader.readU1()\r\n  // reserved_zero_2bits\r\n  bitReader.readU(2)\r\n\r\n  const level = bitReader.readU(8)\r\n\r\n  // seq_parameter_set_id\r\n  expgolomb.readUE(bitReader)\r\n\r\n  // 摄像机出图大部分格式是 4:2:0\r\n  let chromaFormatIdc = 1\r\n  let bitDepthLumaMinus8 = 0\r\n  let bitDepthChromaMinus8 = 0\r\n\r\n  if (profile == 100 || profile == 110 || profile == 122\r\n    || profile == 244 || profile == 44 || profile == 83\r\n    || profile == 86 || profile == 118 || profile == 128\r\n    || profile == 138 || profile == 139 || profile == 134 || profile == 135\r\n  ) {\r\n    chromaFormatIdc = expgolomb.readUE(bitReader)\r\n    if (chromaFormatIdc === 3) {\r\n      // separate_colour_plane_flag\r\n      bitReader.readU1()\r\n    }\r\n    // bit_depth_luma_minus8\r\n    bitDepthLumaMinus8 = expgolomb.readUE(bitReader)\r\n    // bit_depth_chroma_minus8\r\n    bitDepthChromaMinus8 = expgolomb.readUE(bitReader)\r\n    // qpprime_y_zero_transform_bypass_flag\r\n    bitReader.readU1()\r\n\r\n    let seqScalingMatrixPresentFlag = bitReader.readU1()\r\n    if (seqScalingMatrixPresentFlag) {\r\n      const seqScalingListPresentFlag = new Array(8)\r\n      for (let i = 0; i < ((chromaFormatIdc != 3) ? 8 : 12); i++) {\r\n        seqScalingListPresentFlag[i] = bitReader.readU1()\r\n      }\r\n    }\r\n  }\r\n\r\n  // log2_max_frame_num_minus4\r\n  const log2MaxFrameNumMinus4 = expgolomb.readUE(bitReader)\r\n\r\n  const picOrderCntType = expgolomb.readUE(bitReader)\r\n  let log2MaxPicOrderCntLsbMinus4 = 0\r\n  let deltaPicOrderAlwaysZeroFlag = 0\r\n\r\n  if (picOrderCntType === 0) {\r\n    // log2_max_pic_order_cnt_lsb_minus4\r\n    log2MaxPicOrderCntLsbMinus4 = expgolomb.readUE(bitReader)\r\n  }\r\n  else if (picOrderCntType === 1) {\r\n    // delta_pic_order_always_zero_flag\r\n    deltaPicOrderAlwaysZeroFlag = bitReader.readU1()\r\n\r\n    // offset_for_non_ref_pic\r\n    expgolomb.readSE(bitReader)\r\n    // offset_for_top_to_bottom_field\r\n    expgolomb.readSE(bitReader)\r\n\r\n    const numRefFramesInPicOrderCntCycle = expgolomb.readUE(bitReader)\r\n    for (let i = 0; i < numRefFramesInPicOrderCntCycle; i++) {\r\n      expgolomb.readSE(bitReader)\r\n    }\r\n  }\r\n\r\n  // max_num_ref_frames\r\n  expgolomb.readUE(bitReader)\r\n  // gaps_in_frame_num_value_allowed_flag\r\n  bitReader.readU1()\r\n\r\n  const picWidthInMbsMinus1 = expgolomb.readUE(bitReader)\r\n  const picHeightInMapUnitsMinus1 = expgolomb.readUE(bitReader)\r\n  const frameMbsOnlyFlag = bitReader.readU1()\r\n\r\n  let width = (picWidthInMbsMinus1 + 1) * 16\r\n  let height = (2 - frameMbsOnlyFlag) * (picHeightInMapUnitsMinus1 + 1) * 16\r\n\r\n  if (!frameMbsOnlyFlag) {\r\n    // mb_adaptive_frame_field_flag\r\n    bitReader.readU1()\r\n  }\r\n\r\n  // direct_8x8_inference_flag\r\n  bitReader.readU1()\r\n\r\n  const frameCroppingFlag = bitReader.readU1()\r\n  if (frameCroppingFlag) {\r\n    const frameCropLeftOffset = expgolomb.readUE(bitReader)\r\n    const frameCropRightOffset = expgolomb.readUE(bitReader)\r\n    const frameCropTopOffset = expgolomb.readUE(bitReader)\r\n    const frameCropBottomOffset = expgolomb.readUE(bitReader)\r\n\r\n    let cropUnitX = 1\r\n    let cropUnitY = 2 - frameCroppingFlag\r\n\r\n    if (chromaFormatIdc === 1) {\r\n      cropUnitX = 2\r\n      cropUnitY = 2 * (2 - frameCroppingFlag)\r\n    }\r\n    else if (frameCroppingFlag === 2) {\r\n      cropUnitX = 2\r\n      cropUnitY = 2 - frameCroppingFlag\r\n    }\r\n\r\n    width -= cropUnitX * (frameCropLeftOffset + frameCropRightOffset)\r\n    height -= cropUnitY * (frameCropTopOffset + frameCropBottomOffset)\r\n  }\r\n\r\n  return {\r\n    profile,\r\n    level,\r\n    width,\r\n    height,\r\n    chromaFormatIdc,\r\n    bitDepthLumaMinus8,\r\n    bitDepthChromaMinus8,\r\n    frameMbsOnlyFlag,\r\n    picOrderCntType,\r\n    log2MaxPicOrderCntLsbMinus4,\r\n    deltaPicOrderAlwaysZeroFlag,\r\n    log2MaxFrameNumMinus4\r\n  }\r\n}\r\n","/*\r\n * libmedia hevc util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport * as array from 'common/util/array'\r\nimport AVPacket, { AVPacketFlags } from 'avutil/struct/avpacket'\r\nimport BufferWriter from 'common/io/BufferWriter'\r\nimport BufferReader from 'common/io/BufferReader'\r\nimport { AVPacketSideDataType } from 'avutil/codec'\r\nimport BitReader from 'common/io/BitReader'\r\nimport AVStream from '../AVStream'\r\nimport { mapUint8Array, memcpyFromUint8Array } from 'cheap/std/memory'\r\nimport { naluUnescape, splitNaluByStartCode, isAnnexb } from 'avutil/util/nalu'\r\nimport { addAVPacketSideData, getAVPacketData } from 'avutil/util/avpacket'\r\nimport { avMalloc } from 'avutil/util/mem'\r\nimport * as expgolomb from 'avutil/util/expgolomb'\r\nimport { Uint8ArrayInterface } from 'common/io/interface'\r\nimport { BitFormat } from './h264'\r\nimport * as intread from 'avutil/util/intread'\r\n\r\nexport const enum HEVCProfile {\r\n  Main = 1,\r\n  Main10,\r\n  MainStillPicture,\r\n  Main444\r\n}\r\n\r\nexport const HEVCProfile2Name: Record<HEVCProfile, string> = {\r\n  [HEVCProfile.Main]: 'Main',\r\n  [HEVCProfile.Main10]: 'Main10',\r\n  [HEVCProfile.MainStillPicture]: 'MainStillPicture',\r\n  [HEVCProfile.Main444]: 'Main444'\r\n}\r\n\r\nexport const LevelCapabilities = [\r\n  { level: 10, maxLumaSamplesPerSecond: 552960, maxLumaPictureSize: 36864, maxBitRate: { main: 128, main10: 150 } },\r\n  { level: 20, maxLumaSamplesPerSecond: 3686400, maxLumaPictureSize: 122880, maxBitRate: { main: 1500, main10: 1875 } },\r\n  { level: 21, maxLumaSamplesPerSecond: 7372800, maxLumaPictureSize: 245760, maxBitRate: { main: 3000, main10: 3750 } },\r\n  { level: 30, maxLumaSamplesPerSecond: 16588800, maxLumaPictureSize: 552960, maxBitRate: { main: 6000, main10: 7500 } },\r\n  { level: 31, maxLumaSamplesPerSecond: 33177600, maxLumaPictureSize: 983040, maxBitRate: { main: 10000, main10: 12500 } },\r\n  { level: 40, maxLumaSamplesPerSecond: 66846720, maxLumaPictureSize: 2228224, maxBitRate: { main: 12000, main10: 15000 } },\r\n  { level: 41, maxLumaSamplesPerSecond: 133693440, maxLumaPictureSize: 2228224, maxBitRate: { main: 20000, main10: 25000 } },\r\n  { level: 50, maxLumaSamplesPerSecond: 267386880, maxLumaPictureSize: 8912896, maxBitRate: { main: 25000, main10: 40000 } },\r\n  { level: 51, maxLumaSamplesPerSecond: 534773760, maxLumaPictureSize: 8912896, maxBitRate: { main: 40000, main10: 60000 } },\r\n  { level: 52, maxLumaSamplesPerSecond: 1069547520, maxLumaPictureSize: 35651584, maxBitRate: { main: 60000, main10: 100000 } },\r\n  { level: 60, maxLumaSamplesPerSecond: 1069547520, maxLumaPictureSize: 35651584, maxBitRate: { main: 60000, main10: 100000 } },\r\n  { level: 61, maxLumaSamplesPerSecond: 2139095040, maxLumaPictureSize: 89128960, maxBitRate: { main: 120000, main10: 240000 } },\r\n  { level: 62, maxLumaSamplesPerSecond: 4278190080, maxLumaPictureSize: 356515840, maxBitRate: { main: 240000, main10: 480000 } }\r\n]\r\n\r\nexport function getLevelByResolution(profile: number, width: number, height: number, fps: number, bitrate: number) {\r\n\r\n  bitrate /= 1000\r\n\r\n  const selectedProfile = profile === HEVCProfile.Main ? 'main' : 'main10'\r\n  const lumaSamplesPerSecond = width * height * fps\r\n  for (const level of LevelCapabilities) {\r\n    if (lumaSamplesPerSecond <= level.maxLumaSamplesPerSecond && width * height <= level.maxLumaPictureSize && bitrate <= level.maxBitRate[selectedProfile]) {\r\n      return level.level\r\n    }\r\n  }\r\n}\r\n\r\nconst NALULengthSizeMinusOne = 3\r\n\r\nexport const enum HEVCNaluType {\r\n  kSliceTRAIL_N = 0,\r\n  kSliceTRAIL_R = 1,\r\n  kSliceTSA_N = 2,\r\n  kSliceTSA_R = 3,\r\n  kSliceSTSA_N = 4,\r\n  kSliceSTSA_R = 5,\r\n  kSliceRADL_N = 6,\r\n  kSliceRADL_R = 7,\r\n  kSliceRASL_N = 8,\r\n  kSliceRASL_R = 9,\r\n  kSliceBLA_W_LP = 16,\r\n  kSliceBLA_W_RADL = 17,\r\n  kSliceBLA_N_LP = 18,\r\n  kSliceIDR_W_RADL = 19,\r\n  kSliceIDR_N_LP = 20,\r\n  kSliceCRA_NUT = 21,\r\n  kSliceVPS = 32,\r\n  kSliceSPS = 33,\r\n  kSlicePPS = 34,\r\n  kSliceAUD = 35,\r\n  kSliceEOS_NUT = 36,\r\n  kSliceEOB_NUT = 37,\r\n  kSliceFD_NUT = 38,\r\n  kSliceSEI_PREFIX = 39,\r\n  kSliceSEI_SUFFIX = 40\r\n}\r\n\r\n\r\nexport const enum HEVCSliceType {\r\n  kSliceNone = -1,\r\n  kSliceB = 0,\r\n  kSliceP = 1,\r\n  kSliceI = 2\r\n}\r\n\r\n/**\r\n * \r\n * avcc 格式的 extradata 转 annexb vps sps pps\r\n * \r\n * bits    \r\n * - 8   configurationVersion( 固定   1)\r\n * - 2   general_profile_space\r\n * - 1   general_tier_flag\r\n * - 5   general_profile_idc\r\n * - 32  general_profile_compatibility_flags\r\n * - 48  general_constraint_indicator_flags (6 个 字节）\r\n * - 8   general_level_idc\r\n * - 4   reserved1 (1111)\r\n * - 4   min_spatial_segmentation_idc_L\r\n * - 8   min_spatial_segmentation_idc_H\r\n * - 6   reserved2 (111111)\r\n * - 2   parallelismType\r\n * - 6   reserved3 (111111)\r\n * - 2   chromaFormat\r\n * - 5   reserved4 (11111)\r\n * - 3   bitDepthLumaMinus8\r\n * - 5   reserved5(11111)\r\n * - 3   bitDepthChromaMinus8\r\n * - 16  avgFrameRate\r\n * - 2   constantFrameRate\r\n * - 3   numTemporalLayers\r\n * - 1   temporalIdNested\r\n * - 2   lengthSizeMinusOne\r\n * - 8   numOfArrays\r\n * - repeated of array (vps/sps/pps)\r\n * - 1   array_completeness\r\n * - 1   reserved (0)\r\n * - 6   NAL_unit_type\r\n * - 16  numNalus\r\n * - repeated once per NAL\r\n * - 16  nalUnitLength\r\n * - N   NALU data\r\n * \r\n */\r\nexport function extradata2VpsSpsPps(extradata: Uint8ArrayInterface) {\r\n  const bufferReader = new BufferReader(extradata, true)\r\n  bufferReader.skip(22)\r\n\r\n  let vpss = []\r\n  let spss = []\r\n  let ppss = []\r\n\r\n  const arrayLen = bufferReader.readUint8()\r\n\r\n  for (let i = 0; i < arrayLen; i++) {\r\n    const naluType = bufferReader.readUint8() & 0x3f\r\n    const count = bufferReader.readUint16()\r\n    const list = []\r\n\r\n    for (let j = 0; j < count; j++) {\r\n      const len = bufferReader.readUint16()\r\n      list.push(bufferReader.readBuffer(len))\r\n    }\r\n\r\n    if (naluType === HEVCNaluType.kSliceVPS) {\r\n      vpss = list\r\n    }\r\n    else if (naluType === HEVCNaluType.kSliceSPS) {\r\n      spss = list\r\n    }\r\n    else if (naluType === HEVCNaluType.kSlicePPS) {\r\n      ppss = list\r\n    }\r\n  }\r\n\r\n  return {\r\n    vpss,\r\n    spss,\r\n    ppss\r\n  }\r\n}\r\n\r\nexport function vpsSpsPps2Extradata(vpss: Uint8ArrayInterface[], spss: Uint8ArrayInterface[], ppss: Uint8ArrayInterface[]) {\r\n\r\n  const sps = spss[0]\r\n\r\n  let length = 23\r\n\r\n\r\n  if (vpss.length) {\r\n    // type + count\r\n    length += 3\r\n    length = vpss.reduce((prev, value) => {\r\n      // length + data\r\n      return prev + 2 + value.length\r\n    }, length)\r\n  }\r\n\r\n  if (spss.length) {\r\n    // type + count\r\n    length += 3\r\n    length = spss.reduce((prev, value) => {\r\n      // length + data\r\n      return prev + 2 + value.length\r\n    }, length)\r\n  }\r\n\r\n  if (ppss.length) {\r\n    // type + count\r\n    length += 3\r\n    length = ppss.reduce((prev, value) => {\r\n      // length + data\r\n      return prev + 2 + value.length\r\n    }, length)\r\n  }\r\n\r\n  const buffer = new Uint8Array(length)\r\n  const bufferWriter = new BufferWriter(buffer, true)\r\n  const spsData = parseSPS(sps)\r\n\r\n  bufferWriter.writeUint8(0x01)\r\n  bufferWriter.writeUint8(sps[1])\r\n  bufferWriter.writeUint8(sps[2])\r\n  bufferWriter.writeUint8(sps[3])\r\n  bufferWriter.writeUint8(sps[4])\r\n  bufferWriter.writeUint8(sps[5])\r\n\r\n  // general_constraint_indicator_flags\r\n  bufferWriter.writeUint8(sps[6])\r\n  bufferWriter.writeUint8(sps[7])\r\n  bufferWriter.writeUint8(sps[8])\r\n  bufferWriter.writeUint8(sps[9])\r\n  bufferWriter.writeUint8(sps[10])\r\n  bufferWriter.writeUint8(sps[11])\r\n\r\n  bufferWriter.writeUint8(spsData.level)\r\n\r\n  // min_spatial_segmentation_idc\r\n  bufferWriter.writeUint8((0xff << 2) | 0)\r\n  bufferWriter.writeUint8(0)\r\n\r\n  // parallelismType\r\n  bufferWriter.writeUint8((0xff << 6) | 0)\r\n\r\n  // chromaFormat\r\n  bufferWriter.writeUint8((0xff << 6) | spsData.chroma_format_idc)\r\n\r\n  // bitDepthLumaMinus8\r\n  bufferWriter.writeUint8((0xff << 5) | spsData.bit_depth_luma_minus8)\r\n\r\n  // bitDepthChromaMinus8\r\n  bufferWriter.writeUint8((0xff << 5) | spsData.bit_depth_chroma_minus8)\r\n\r\n  // avgFrameRate\r\n  bufferWriter.writeUint16(0)\r\n\r\n  // constantFrameRate numTemporalLayers temporalIdNested lengthSizeMinusOne\r\n  bufferWriter.writeUint8((0 << 6) | (1 << 3) | ((sps[0] & 0x01) << 2) | NALULengthSizeMinusOne)\r\n\r\n  // numOfArrays\r\n  let numOfArrays = 0\r\n  if (vpss.length) {\r\n    numOfArrays++\r\n  }\r\n  if (spss.length) {\r\n    numOfArrays++\r\n  }\r\n  if (ppss.length) {\r\n    numOfArrays++\r\n  }\r\n  bufferWriter.writeUint8(numOfArrays)\r\n\r\n  // vps\r\n  if (vpss.length) {\r\n    bufferWriter.writeUint8((1 << 7) | HEVCNaluType.kSliceVPS)\r\n    bufferWriter.writeUint16(vpss.length)\r\n    array.each(vpss, (vps) => {\r\n      bufferWriter.writeUint16(vps.length)\r\n      bufferWriter.writeBuffer(vps)\r\n    })\r\n  }\r\n\r\n  // sps\r\n  if (spss.length) {\r\n    bufferWriter.writeUint8((1 << 7) | HEVCNaluType.kSliceSPS)\r\n    bufferWriter.writeUint16(spss.length)\r\n    array.each(spss, (sps) => {\r\n      bufferWriter.writeUint16(sps.length)\r\n      bufferWriter.writeBuffer(sps)\r\n    })\r\n  }\r\n\r\n  // pps\r\n  if (ppss.length) {\r\n    bufferWriter.writeUint8((1 << 7) | HEVCNaluType.kSlicePPS)\r\n    bufferWriter.writeUint16(ppss.length)\r\n    array.each(ppss, (pps) => {\r\n      bufferWriter.writeUint16(pps.length)\r\n      bufferWriter.writeBuffer(pps)\r\n    })\r\n  }\r\n\r\n  return buffer\r\n}\r\n\r\nexport function annexbExtradata2AvccExtradata(data: Uint8ArrayInterface) {\r\n  let nalus = splitNaluByStartCode(data)\r\n\r\n  if (nalus.length >= 2) {\r\n    const vpss = []\r\n    const spss = []\r\n    const ppss = []\r\n\r\n    nalus.forEach((nalu) => {\r\n      const type = (nalu[0] >>> 1) & 0x3f\r\n      if (type === HEVCNaluType.kSliceVPS) {\r\n        vpss.push(nalu)\r\n      }\r\n      else if (type === HEVCNaluType.kSliceSPS) {\r\n        spss.push(nalu)\r\n      }\r\n      else if (type === HEVCNaluType.kSlicePPS) {\r\n        ppss.push(nalu)\r\n      }\r\n    })\r\n\r\n    if (spss.length && ppss.length) {\r\n      return vpsSpsPps2Extradata(vpss, spss, ppss)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * \r\n * annexb 格式的 NALU 转 avcc NALU \r\n * \r\n */\r\nexport function annexb2Avcc(data: Uint8ArrayInterface) {\r\n\r\n  let extradata: Uint8Array\r\n  let key: boolean = false\r\n\r\n  let nalus = splitNaluByStartCode(data)\r\n\r\n  if (nalus.length >= 2) {\r\n    const vpss = []\r\n    const spss = []\r\n    const ppss = []\r\n\r\n    nalus.forEach((nalu) => {\r\n      const type = (nalu[0] >>> 1) & 0x3f\r\n      if (type === HEVCNaluType.kSliceVPS) {\r\n        vpss.push(nalu)\r\n      }\r\n      else if (type === HEVCNaluType.kSliceSPS) {\r\n        spss.push(nalu)\r\n      }\r\n      else if (type === HEVCNaluType.kSlicePPS) {\r\n        ppss.push(nalu)\r\n      }\r\n    })\r\n\r\n    if (spss.length && ppss.length) {\r\n      extradata = vpsSpsPps2Extradata(vpss, spss, ppss)\r\n\r\n      nalus = nalus.filter((nalu) => {\r\n        const type = (nalu[0] >>> 1) & 0x3f\r\n        return type !== HEVCNaluType.kSliceVPS\r\n          && type !== HEVCNaluType.kSliceSPS\r\n          && type !== HEVCNaluType.kSlicePPS\r\n          && type !== HEVCNaluType.kSliceAUD\r\n      })\r\n    }\r\n  }\r\n\r\n  const length = nalus.reduce((prev, nalu) => {\r\n    return prev + NALULengthSizeMinusOne + 1 + nalu.length\r\n  }, 0)\r\n\r\n  const bufferPointer = avMalloc(length)\r\n  const buffer = mapUint8Array(bufferPointer, length)\r\n\r\n  const bufferWriter = new BufferWriter(buffer)\r\n\r\n  array.each(nalus, (nalu) => {\r\n    if (NALULengthSizeMinusOne === 3) {\r\n      bufferWriter.writeUint32(nalu.length)\r\n    }\r\n    else if (NALULengthSizeMinusOne === 2) {\r\n      bufferWriter.writeUint24(nalu.length)\r\n    }\r\n    else if (NALULengthSizeMinusOne === 1) {\r\n      bufferWriter.writeUint16(nalu.length)\r\n    }\r\n    else {\r\n      bufferWriter.writeUint8(nalu.length)\r\n    }\r\n    bufferWriter.writeBuffer(nalu.subarray(0))\r\n\r\n    const type = (nalu[0] >>> 1) & 0x3f\r\n    if (type === HEVCNaluType.kSliceIDR_W_RADL\r\n      || type === HEVCNaluType.kSliceIDR_N_LP\r\n      || type === HEVCNaluType.kSliceCRA_NUT\r\n    ) {\r\n      key = true\r\n    }\r\n  })\r\n\r\n  return {\r\n    bufferPointer,\r\n    length,\r\n    extradata,\r\n    key\r\n  }\r\n}\r\n\r\n/**\r\n * avcc 格式的 NALU 转 annexb NALU \r\n * \r\n */\r\nexport function avcc2Annexb(data: Uint8ArrayInterface, extradata?: Uint8ArrayInterface) {\r\n  const naluLengthSizeMinusOne = extradata ? (extradata[21] & 0x03) : NALULengthSizeMinusOne\r\n\r\n  let vpss = []\r\n  let spss = []\r\n  let ppss = []\r\n  let key = false\r\n\r\n  if (extradata) {\r\n    const result = extradata2VpsSpsPps(extradata)\r\n    vpss = result.vpss\r\n    spss = result.spss\r\n    ppss = result.ppss\r\n    key = true\r\n  }\r\n\r\n  const nalus = []\r\n\r\n  const bufferReader = new BufferReader(data)\r\n  while (bufferReader.remainingSize() > 0) {\r\n    let length = 0\r\n    if (naluLengthSizeMinusOne === 3) {\r\n      length = bufferReader.readUint32()\r\n    }\r\n    else if (naluLengthSizeMinusOne === 2) {\r\n      length = bufferReader.readUint24()\r\n    }\r\n    else if (naluLengthSizeMinusOne === 1) {\r\n      length = bufferReader.readUint16()\r\n    }\r\n    else {\r\n      length = bufferReader.readUint8()\r\n    }\r\n    nalus.push(bufferReader.readBuffer(length))\r\n  }\r\n\r\n  let length = vpss.reduce((prev, vps) => {\r\n    return prev + 4 + vps.length\r\n  }, 0)\r\n  length = spss.reduce((prev, sps) => {\r\n    return prev + 4 + sps.length\r\n  }, length)\r\n  length = ppss.reduce((prev, pps) => {\r\n    return prev + 4 + pps.length\r\n  }, length)\r\n  length = nalus.reduce((prev, nalu, index) => {\r\n    return prev + (index ? 3 : 4) + nalu.length\r\n  }, length)\r\n\r\n  const bufferPointer = avMalloc(length + 7)\r\n  const buffer = mapUint8Array(bufferPointer, length + 7)\r\n\r\n  const bufferWriter = new BufferWriter(buffer)\r\n\r\n  // AUD\r\n  bufferWriter.writeUint8(0x00)\r\n  bufferWriter.writeUint8(0x00)\r\n  bufferWriter.writeUint8(0x00)\r\n  bufferWriter.writeUint8(0x01)\r\n  bufferWriter.writeUint8(HEVCNaluType.kSliceAUD << 1)\r\n  bufferWriter.writeUint8(0x00)\r\n  bufferWriter.writeUint8(0xf0)\r\n\r\n  array.each(vpss, (vps) => {\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x01)\r\n    bufferWriter.writeBuffer(vps)\r\n  })\r\n\r\n  array.each(spss, (sps) => {\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x01)\r\n    bufferWriter.writeBuffer(sps)\r\n  })\r\n\r\n  array.each(ppss, (pps) => {\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x01)\r\n    bufferWriter.writeBuffer(pps)\r\n  })\r\n\r\n  array.each(nalus, (nalu, index) => {\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    if (!index) {\r\n      bufferWriter.writeUint8(0x00)\r\n    }\r\n    bufferWriter.writeUint8(0x01)\r\n    bufferWriter.writeBuffer(nalu)\r\n\r\n    const type = (nalu[0] >>> 1) & 0x3f\r\n    if (type === HEVCNaluType.kSliceIDR_W_RADL\r\n      || type === HEVCNaluType.kSliceIDR_N_LP\r\n      || type === HEVCNaluType.kSliceCRA_NUT\r\n    ) {\r\n      key = true\r\n    }\r\n  })\r\n\r\n  return {\r\n    bufferPointer,\r\n    length: length + 7,\r\n    key\r\n  }\r\n}\r\n\r\nexport function parseAvccExtraData(avpacket: pointer<AVPacket>, stream: AVStream) {\r\n\r\n  if (!(avpacket.flags & AVPacketFlags.AV_PKT_FLAG_KEY)) {\r\n    return\r\n  }\r\n\r\n  const data = getAVPacketData(avpacket)\r\n\r\n  if (isAnnexb(data)) {\r\n    return\r\n  }\r\n\r\n  const naluLengthSizeMinusOne = stream.metadata.naluLengthSizeMinusOne ?? NALULengthSizeMinusOne\r\n\r\n  let vpss = []\r\n  let spss = []\r\n  let ppss = []\r\n\r\n  const bufferReader = new BufferReader(data)\r\n  while (bufferReader.remainingSize() > 0) {\r\n    let length = 0\r\n    if (naluLengthSizeMinusOne === 3) {\r\n      length = bufferReader.readUint32()\r\n    }\r\n    else if (naluLengthSizeMinusOne === 2) {\r\n      length = bufferReader.readUint24()\r\n    }\r\n    else if (naluLengthSizeMinusOne === 1) {\r\n      length = bufferReader.readUint16()\r\n    }\r\n    else {\r\n      length = bufferReader.readUint8()\r\n    }\r\n\r\n    const nalu = data.subarray(static_cast<int32>(bufferReader.getPos()), static_cast<int32>(bufferReader.getPos()) + length)\r\n    bufferReader.skip(length)\r\n\r\n    const naluType = (nalu[0] >>> 1) & 0x3f\r\n\r\n    if (naluType === HEVCNaluType.kSliceSPS) {\r\n      spss.push(nalu)\r\n    }\r\n    else if (naluType === HEVCNaluType.kSlicePPS) {\r\n      ppss.push(nalu)\r\n    }\r\n    else if (naluType === HEVCNaluType.kSliceVPS) {\r\n      vpss.push(nalu)\r\n    }\r\n  }\r\n\r\n  if (spss.length || ppss.length || vpss.length) {\r\n    const extradata = vpsSpsPps2Extradata(vpss, spss, ppss)\r\n    const extradataPointer = avMalloc(extradata.length)\r\n    memcpyFromUint8Array(extradataPointer, extradata.length, extradata)\r\n    addAVPacketSideData(avpacket, AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA, extradataPointer, extradata.length)\r\n  }\r\n}\r\n\r\nexport function parseAnnexbExtraData(avpacket: pointer<AVPacket>, force: boolean = false) {\r\n  if (!(avpacket.flags & AVPacketFlags.AV_PKT_FLAG_KEY) && !force) {\r\n    return\r\n  }\r\n\r\n  const data = getAVPacketData(avpacket)\r\n\r\n  if (!isAnnexb(data)) {\r\n    return\r\n  }\r\n\r\n  let nalus = splitNaluByStartCode(data)\r\n\r\n  if (nalus.length > 2) {\r\n    const vpss = []\r\n    const spss = []\r\n    const ppss = []\r\n\r\n    nalus.forEach((nalu) => {\r\n      const type = (nalu[0] >>> 1) & 0x3f\r\n      if (type === HEVCNaluType.kSliceVPS) {\r\n        vpss.push(nalu)\r\n      }\r\n      else if (type === HEVCNaluType.kSliceSPS) {\r\n        spss.push(nalu)\r\n      }\r\n      else if (type === HEVCNaluType.kSlicePPS) {\r\n        ppss.push(nalu)\r\n      }\r\n    })\r\n\r\n    if (vpss.length && spss.length && ppss.length) {\r\n      const extradata = vpsSpsPps2Extradata(vpss, spss, ppss)\r\n      const extradataPointer = avMalloc(extradata.length)\r\n      memcpyFromUint8Array(extradataPointer, extradata.length, extradata)\r\n      addAVPacketSideData(avpacket, AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA, extradataPointer, extradata.length)\r\n      avpacket.flags |= AVPacketFlags.AV_PKT_FLAG_KEY\r\n    }\r\n  }\r\n}\r\n\r\nexport function parseAVCodecParameters(stream: AVStream, extradata?: Uint8ArrayInterface) {\r\n  if (!extradata && stream.sideData[AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA]) {\r\n    extradata = stream.sideData[AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA]\r\n  }\r\n  if (extradata && extradata.length >= 6) {\r\n\r\n    stream.metadata.naluLengthSizeMinusOne = (extradata[21] & 0x03)\r\n\r\n    const { spss } = extradata2VpsSpsPps(extradata)\r\n\r\n    if (spss.length) {\r\n      const { profile, level, width, height } = parseSPS(spss[0])\r\n\r\n      stream.codecpar.profile = profile\r\n      stream.codecpar.level = level\r\n      stream.codecpar.width = width\r\n      stream.codecpar.height = height\r\n    }\r\n  }\r\n}\r\n\r\nexport function isIDR(avpacket: pointer<AVPacket>, naluLengthSize: int32 = 4) {\r\n  if (avpacket.bitFormat === BitFormat.ANNEXB) {\r\n    let nalus = splitNaluByStartCode(mapUint8Array(avpacket.data, avpacket.size))\r\n    return nalus.some((nalu) => {\r\n      const type = (nalu[0] >>> 1) & 0x3f\r\n      return type === HEVCNaluType.kSliceIDR_N_LP || type === HEVCNaluType.kSliceIDR_W_RADL\r\n    })\r\n  }\r\n  else {\r\n    const size = avpacket.size\r\n    let i = 0\r\n    while (i < (size - naluLengthSize)) {\r\n      const type = (intread.r8(avpacket.data + (i + naluLengthSize)) >>> 1) & 0x3f\r\n      if (type === HEVCNaluType.kSliceIDR_N_LP || type === HEVCNaluType.kSliceIDR_W_RADL) {\r\n        return true\r\n      }\r\n      if (naluLengthSize === 4) {\r\n        i += intread.rb32(avpacket.data + i)\r\n      }\r\n      else if (naluLengthSize === 3) {\r\n        i += intread.rb24(avpacket.data + i)\r\n      }\r\n      else if (naluLengthSize === 2) {\r\n        i += intread.rb16(avpacket.data + i)\r\n      }\r\n      else {\r\n        i += intread.r8(avpacket.data + i)\r\n      }\r\n      i += naluLengthSize\r\n    }\r\n    return false\r\n  }\r\n}\r\n\r\n/* eslint-disable camelcase */\r\nexport interface HevcSPS {\r\n  profile: number\r\n  level: number\r\n  width: number\r\n  height: number\r\n  chroma_format_idc: number\r\n  bit_depth_luma_minus8: number\r\n  bit_depth_chroma_minus8: number\r\n  general_profile_space: number\r\n  general_tier_flag: number\r\n  general_profile_compatibility_flags: number\r\n  constraint_flags: number\r\n  separate_colour_plane_flag: number\r\n  log2_min_cb_size: number\r\n  log2_diff_max_min_coding_block_size: number\r\n  log2_min_tb_size: number\r\n  log2_diff_max_min_transform_block_size: number\r\n  log2_max_trafo_size: number\r\n  log2_ctb_size: number\r\n  log2_min_pu_size: number\r\n  ctb_width: number\r\n  ctb_height: number\r\n  ctb_size: number\r\n  min_cb_width: number\r\n  min_cb_height: number\r\n  min_tb_width: number\r\n  min_tb_height: number\r\n  min_pu_width: number\r\n  min_pu_height: number\r\n  log2_max_poc_lsb: number\r\n}\r\n\r\nexport function parseSPS(sps: Uint8ArrayInterface): HevcSPS {\r\n\r\n  if (!sps || sps.length < 3) {\r\n    return\r\n  }\r\n\r\n  let offset = 0\r\n  if (sps[0] === 0x00\r\n    && sps[1] === 0x00\r\n    && sps[2] === 0x00\r\n    && sps[3] === 0x01\r\n  ) {\r\n    offset = 4\r\n  }\r\n\r\n  let profile = 0\r\n  let level = 0\r\n  let width = 0\r\n  let height = 0\r\n  let bit_depth_luma_minus8 = 0\r\n  let bit_depth_chroma_minus8 = 0\r\n  let chroma_format_idc = 1\r\n  let general_profile_space = 0\r\n  let general_tier_flag = 0\r\n  let general_profile_compatibility_flags = 0\r\n  let constraint_flags = 0\r\n\r\n  const buffer = naluUnescape(sps.subarray(offset))\r\n  const bitReader = new BitReader(buffer.length)\r\n  bitReader.appendBuffer(buffer)\r\n\r\n  // forbidden_zero_bit\r\n  bitReader.readU1()\r\n\r\n  // nalu type\r\n  bitReader.readU(6)\r\n\r\n  // layerId\r\n  bitReader.readU(6)\r\n\r\n  // tid\r\n  bitReader.readU(3)\r\n\r\n  // sps_video_parameter_set_id\r\n  bitReader.readU(4)\r\n\r\n  // The value of sps_max_sub_layers_minus1 shall be in the range of 0 to 6, inclusive.\r\n  const spsMaxSubLayersMinus1 = bitReader.readU(3)\r\n\r\n  // sps_temporal_id_nesting_flag\r\n  bitReader.readU1()\r\n\r\n  let separate_colour_plane_flag = 0\r\n\r\n  if (spsMaxSubLayersMinus1 <= 6) {\r\n    // profile_tier_level(sps_max_sub_layers_minus1)\r\n\r\n    // general_profile_space\r\n    general_profile_space = bitReader.readU(2)\r\n    // general_tier_flag\r\n    general_tier_flag = bitReader.readU1()\r\n    // general_profile_idc\r\n    profile = bitReader.readU(5)\r\n    // general_profile_compatibility_flag[32]\r\n    general_profile_compatibility_flags = bitReader.readU(32)\r\n\r\n    /**\r\n     * 1 general_progressive_source_flag\r\n     * 1 general_interlaced_source_flag\r\n     * 1 general_non_packed_constraint_flag\r\n     * 1 general_frame_only_constraint_flag\r\n     * 44 general_reserved_zero_44bits\r\n     */\r\n    constraint_flags = bitReader.readU(48)\r\n\r\n    // general_level_idc\r\n    level = bitReader.readU(8)\r\n\r\n    const subLayerProfilePresentFlag = new Array(6)\r\n    const subLayerLevelPresentFlag = new Array(6)\r\n    for (let i = 0; i < spsMaxSubLayersMinus1; i++) {\r\n      subLayerProfilePresentFlag[i] = bitReader.readU1()\r\n      subLayerLevelPresentFlag[i] = bitReader.readU1()\r\n    }\r\n\r\n    if (spsMaxSubLayersMinus1 > 0) {\r\n      for (let i = spsMaxSubLayersMinus1; i < 8; i++) {\r\n        // reserved_zero_2bits\r\n        bitReader.readU(2)\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < spsMaxSubLayersMinus1; i++) {\r\n      if (subLayerProfilePresentFlag[i]) {\r\n        // sub_layer_profile_space[i]\r\n        bitReader.readU(2)\r\n        // sub_layer_tier_flag[i]\r\n        bitReader.readU(1)\r\n        // sub_layer_profile_idc[i]\r\n        bitReader.readU(5)\r\n        // sub_layer_profile_compatibility_flag[i][32]\r\n        bitReader.readU(32)\r\n        // sub_layer_progressive_source_flag[i]\r\n        bitReader.readU(1)\r\n        // sub_layer_interlaced_source_flag[i]\r\n        bitReader.readU(1)\r\n        // sub_layer_non_packed_constraint_flag[i]\r\n        bitReader.readU(1)\r\n        // sub_layer_frame_only_constraint_flag[i]\r\n        bitReader.readU(1)\r\n        // sub_layer_reserved_zero_44bits[i]\r\n        bitReader.readU(44)\r\n      }\r\n\r\n      if (subLayerLevelPresentFlag[i]) {\r\n        // sub_layer_level_idc[i]\r\n        bitReader.readU(8)\r\n      }\r\n    }\r\n\r\n    // \"The  value  of sps_seq_parameter_set_id shall be in the range of 0 to 15, inclusive.\"\r\n    expgolomb.readUE(bitReader)\r\n    chroma_format_idc = expgolomb.readUE(bitReader)\r\n\r\n    if (chroma_format_idc === 3) {\r\n      // separate_colour_plane_flag\r\n      separate_colour_plane_flag = bitReader.readU(1)\r\n    }\r\n\r\n    width = expgolomb.readUE(bitReader)\r\n    height = expgolomb.readUE(bitReader)\r\n\r\n    const conformanceWindowFlag = bitReader.readU1()\r\n\r\n    let confWinLeftOffset = 0\r\n    let confWinRightOffset = 0\r\n    let confWinTopOffset = 0\r\n    let confWinBottomOffset = 0\r\n\r\n    if (conformanceWindowFlag) {\r\n      confWinLeftOffset = expgolomb.readUE(bitReader)\r\n      confWinRightOffset = expgolomb.readUE(bitReader)\r\n      confWinTopOffset = expgolomb.readUE(bitReader)\r\n      confWinBottomOffset = expgolomb.readUE(bitReader)\r\n    }\r\n\r\n    bit_depth_luma_minus8 = expgolomb.readUE(bitReader)\r\n    bit_depth_chroma_minus8 = expgolomb.readUE(bitReader)\r\n\r\n\r\n    let SubWidthC = 2\r\n    let SubHeightC = 2\r\n\r\n    if (chroma_format_idc === 0) {\r\n      SubWidthC = SubHeightC = 0\r\n    }\r\n    else if (chroma_format_idc === 2) {\r\n      SubWidthC = 2\r\n      SubHeightC = 1\r\n    }\r\n    else if (chroma_format_idc === 3) {\r\n      SubWidthC = SubHeightC = 1\r\n    }\r\n\r\n    const cropUnitX = SubWidthC * (1 << (bit_depth_luma_minus8 + 1))\r\n    const cropUnitY = SubHeightC * (1 << (bit_depth_luma_minus8 + 1))\r\n\r\n    width -= cropUnitX * (confWinLeftOffset + confWinRightOffset)\r\n    height -= cropUnitY * (confWinTopOffset + confWinBottomOffset)\r\n  }\r\n\r\n  const log2_max_poc_lsb = expgolomb.readUE(bitReader) + 4\r\n\r\n  const sublayer_ordering_info_flag = bitReader.readU1()\r\n  const start = sublayer_ordering_info_flag ? 0 : spsMaxSubLayersMinus1\r\n  for (let i = start; i < (spsMaxSubLayersMinus1 + 1); i++) {\r\n    // max_dec_pic_buffering\r\n    expgolomb.readUE(bitReader)\r\n    // num_reorder_pics\r\n    expgolomb.readUE(bitReader)\r\n    // max_latency_increase\r\n    expgolomb.readUE(bitReader)\r\n  }\r\n\r\n  const log2_min_cb_size = expgolomb.readUE(bitReader) + 3\r\n  const log2_diff_max_min_coding_block_size = expgolomb.readUE(bitReader)\r\n  const log2_min_tb_size = expgolomb.readUE(bitReader) + 2\r\n  const log2_diff_max_min_transform_block_size = expgolomb.readUE(bitReader)\r\n  const log2_max_trafo_size = log2_diff_max_min_transform_block_size + log2_min_tb_size\r\n\r\n  const log2_ctb_size = log2_min_cb_size + log2_diff_max_min_coding_block_size\r\n  const log2_min_pu_size = log2_min_cb_size - 1\r\n\r\n  const ctb_width  = (width  + (1 << log2_ctb_size) - 1) >> log2_ctb_size\r\n  const ctb_height = (height + (1 << log2_ctb_size) - 1) >> log2_ctb_size\r\n  const ctb_size   = ctb_width * ctb_height\r\n\r\n  const min_cb_width  = width  >> log2_min_cb_size\r\n  const min_cb_height = height >> log2_min_cb_size\r\n  const min_tb_width  = width  >> log2_min_tb_size\r\n  const min_tb_height = height >> log2_min_tb_size\r\n  const min_pu_width  = width  >> log2_min_pu_size\r\n  const min_pu_height = height >> log2_min_pu_size\r\n\r\n  return {\r\n    profile,\r\n    level,\r\n    width,\r\n    height,\r\n    chroma_format_idc,\r\n    bit_depth_luma_minus8,\r\n    bit_depth_chroma_minus8,\r\n    general_profile_space,\r\n    general_tier_flag,\r\n    general_profile_compatibility_flags,\r\n    constraint_flags,\r\n    separate_colour_plane_flag,\r\n    log2_min_cb_size,\r\n    log2_diff_max_min_coding_block_size,\r\n    log2_min_tb_size,\r\n    log2_diff_max_min_transform_block_size,\r\n    log2_max_trafo_size,\r\n    log2_ctb_size,\r\n    log2_min_pu_size,\r\n    ctb_width,\r\n    ctb_height,\r\n    ctb_size,\r\n    min_cb_width,\r\n    min_cb_height,\r\n    min_tb_width,\r\n    min_tb_height,\r\n    min_pu_width,\r\n    min_pu_height,\r\n    log2_max_poc_lsb\r\n  }\r\n}\r\n\r\nexport interface HevcPPS {\r\n  pps_pic_parameter_set_id: number\r\n  pps_seq_parameter_set_id: number\r\n  dependent_slice_segment_flag: number\r\n  output_flag_present_flag: number\r\n  num_extra_slice_header_bits: number\r\n}\r\n\r\nexport function parsePPS(pps: Uint8ArrayInterface): HevcPPS {\r\n  if (!pps || pps.length < 3) {\r\n    return\r\n  }\r\n\r\n  let offset = 0\r\n  if (pps[0] === 0x00\r\n    && pps[1] === 0x00\r\n    && pps[2] === 0x00\r\n    && pps[3] === 0x01\r\n  ) {\r\n    offset = 4\r\n  }\r\n\r\n  const buffer = naluUnescape(pps.subarray(offset))\r\n  const bitReader = new BitReader(buffer.length)\r\n  bitReader.appendBuffer(buffer)\r\n\r\n  const pps_pic_parameter_set_id = expgolomb.readUE(bitReader)\r\n  const pps_seq_parameter_set_id = expgolomb.readUE(bitReader)\r\n  const dependent_slice_segment_flag = bitReader.readU1()\r\n  const output_flag_present_flag = bitReader.readU1()\r\n  const num_extra_slice_header_bits = bitReader.readU(3)\r\n\r\n  return {\r\n    pps_pic_parameter_set_id,\r\n    pps_seq_parameter_set_id,\r\n    dependent_slice_segment_flag,\r\n    output_flag_present_flag,\r\n    num_extra_slice_header_bits\r\n  }\r\n}\r\n","/*\r\n * libmedia mp3 util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { Uint8ArrayInterface } from 'common/io/interface'\r\nimport AVStream from '../AVStream'\r\nimport { NOPTS_VALUE } from 'avutil/constant'\r\n\r\nconst MpegAudioV10SampleRateTable = [44100, 48000, 32000, 0]\r\n\r\nconst MpegAudioV20SampleRateTable = [22050, 24000, 16000, 0]\r\n\r\nconst MpegAudioV25SampleRateTable = [11025, 12000, 8000, 0]\r\n\r\nconst MpegAudioV10FrameSizeTable = [0, 1152, 1152, 384]\r\n\r\nconst MpegAudioV20FrameSizeTable = [0, 576, 1152, 384]\r\n\r\nconst MpegAudioV25FrameSizeTable = [0, 576, 1152, 384]\r\n\r\nconst MpegAudioV1L1BitRateTable = [0, 32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448, -1]\r\n\r\nconst MpegAudioV1L2BitRateTable = [0, 32, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384, -1]\r\n\r\nconst MpegAudioV1L3BitRateTable = [0, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, -1]\r\n\r\nconst MpegAudioV2L1BitRateTable = [0, 32, 48, 56, 64, 80, 96, 112, 128, 144, 160, 176, 192, 224, 256, -1]\r\n\r\nconst MpegAudioV2L2L3BitRateTable = [0, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160, -1]\r\n\r\nexport function getSampleRateByVersionIndex(version: number, samplingFreqIndex: number) {\r\n  switch (version) {\r\n    case 0:\r\n      // MPEG 2.5\r\n      return MpegAudioV25SampleRateTable[samplingFreqIndex]\r\n    case 2:\r\n      // MPEG 2\r\n      return MpegAudioV20SampleRateTable[samplingFreqIndex]\r\n    case 3:\r\n      // MPEG 1\r\n      return MpegAudioV10SampleRateTable[samplingFreqIndex]\r\n  }\r\n  return NOPTS_VALUE\r\n}\r\n\r\nexport function getFrameSizeByVersionLayer(version: number, layer: number) {\r\n  switch (version) {\r\n    case 0:\r\n      // MPEG 2.5\r\n      return MpegAudioV25FrameSizeTable[layer]\r\n    case 2:\r\n      // MPEG 2\r\n      return MpegAudioV20FrameSizeTable[layer]\r\n    case 3:\r\n      // MPEG 1\r\n      return MpegAudioV10FrameSizeTable[layer]\r\n  }\r\n  return NOPTS_VALUE\r\n}\r\n\r\nexport function getBitRateByVersionLayerIndex(version: number, layer: number, index: number) {\r\n\r\n  switch (layer) {\r\n    // layer3\r\n    case 1:\r\n      switch (version) {\r\n        case 0:\r\n        case 2:\r\n          return MpegAudioV2L2L3BitRateTable[index]\r\n        case 3:\r\n          return MpegAudioV1L3BitRateTable[index]\r\n      }\r\n      break\r\n    // layer2\r\n    case 2:\r\n      switch (version) {\r\n        case 0:\r\n        case 2:\r\n          return MpegAudioV2L2L3BitRateTable[index]\r\n        case 3:\r\n          return MpegAudioV1L2BitRateTable[index]\r\n      }\r\n    // layer1\r\n    case 3:\r\n      switch (version) {\r\n        case 0:\r\n        case 2:\r\n          return MpegAudioV2L1BitRateTable[index]\r\n        case 3:\r\n          return MpegAudioV1L1BitRateTable[index]\r\n      }\r\n  }\r\n  return NOPTS_VALUE\r\n}\r\n\r\nexport function getProfileByLayer(layer: number) {\r\n  switch (layer) {\r\n    case 1:\r\n      // Layer 3\r\n      return 34\r\n    case 2:\r\n      // Layer 2\r\n      return 33\r\n    case 3:\r\n      // Layer 1\r\n      return 32\r\n  }\r\n  return NOPTS_VALUE\r\n}\r\n\r\nexport const enum MP3Profile {\r\n  Layer1 = 32,\r\n  Layer2 = 33,\r\n  Layer3 = 34\r\n}\r\n\r\nexport const MP3Profile2Name: Record<MP3Profile, string> = {\r\n  [MP3Profile.Layer1]: 'Layer1',\r\n  [MP3Profile.Layer2]: 'Layer2',\r\n  [MP3Profile.Layer3]: 'Layer3'\r\n}\r\n\r\n\r\nexport function parseAVCodecParameters(stream: AVStream, buffer: Uint8ArrayInterface) {\r\n  if (buffer && buffer.length >= 4) {\r\n    const ver = (buffer[1] >>> 3) & 0x03\r\n    const layer = (buffer[1] & 0x06) >> 1\r\n    // const bitrateIndex = (buffer[2] & 0xF0) >>> 4\r\n    const samplingFreqIndex = (buffer[2] & 0x0C) >>> 2\r\n\r\n    const channelMode = (buffer[3] >>> 6) & 0x03\r\n\r\n    const channelCount = channelMode !== 3 ? 2 : 1\r\n    const profile = getProfileByLayer(layer)\r\n    const sampleRate = getSampleRateByVersionIndex(ver, samplingFreqIndex)\r\n\r\n    stream.codecpar.profile = profile\r\n    stream.codecpar.sampleRate = sampleRate\r\n    stream.codecpar.chLayout.nbChannels = channelCount\r\n  }\r\n}\r\n","/*\r\n * libmedia opus util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVPacketSideDataType } from 'avutil/codec'\r\nimport AVStream from '../AVStream'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport BufferReader from 'common/io/BufferReader'\r\nimport BufferWriter from 'common/io/BufferWriter'\r\nimport { avRescaleQ } from 'avutil/util/rational'\r\nimport { Uint8ArrayInterface } from 'common/io/interface'\r\n\r\nexport const durations = [\r\n  /* Silk NB */\r\n  480, 960, 1920, 2880,\r\n  /* Silk MB */\r\n  480, 960, 1920, 2880,\r\n  /* Silk WB */\r\n  480, 960, 1920, 2880,\r\n  /* Hybrid SWB */\r\n  480, 960,\r\n  /* Hybrid FB */\r\n  480, 960,\r\n  /* CELT NB */\r\n  120, 240, 480, 960,\r\n  /* CELT NB */\r\n  120, 240, 480, 960,\r\n  /* CELT NB */\r\n  120, 240, 480, 960,\r\n  /* CELT NB */\r\n  120, 240, 480, 960\r\n]\r\n\r\n\r\nexport function getBufferSamples(buffer: Uint8Array) {\r\n  let toc = 0, frameDuration = 0, nframes = 0\r\n\r\n  if (buffer.length < 1) {\r\n    return 0\r\n  }\r\n\r\n  toc = buffer[0]\r\n\r\n  frameDuration = durations[toc >> 3]\r\n\r\n  switch (toc & 3) {\r\n    case 0:\r\n      nframes = 1\r\n      break\r\n    case 1:\r\n      nframes = 2\r\n      break\r\n    case 2:\r\n      nframes = 2\r\n      break\r\n    case 3:\r\n      if (buffer.length < 2) {\r\n        return 0\r\n      }\r\n      nframes = buffer[1] & 63\r\n      break\r\n  }\r\n  return nframes * frameDuration\r\n}\r\n\r\n/**\r\n * opus extradata\r\n * \r\n * - 8 bytes Magic Signature: OpusHead\r\n * - 1 bytes unsigned, 对应值 0x01 version\r\n * - 1 bytes unsigned, channels 它可能和编码声道数不一致， 它可能被修改成 packet-by-packet, 对应值 0x01\r\n * - 2 bytes unsigned, preSkip 这是要从开始播放时的解码器输出， 从页面的颗粒位置减去以计算其 PCM 样本位置。\r\n * - 4 bytes unsigned, sampleRate 原始输入采样率\r\n * - 2 bytes signed, outputGain 这是解码时要应用的增益， 20 * log10 缩放解码器输出以实现所需的播放音量\r\n * - 1 bytes unsigned, channelMappingFamily 指示输出渠道的顺序和语音含义。该八位位组的每个当前指定的值表示一个映射系列，它定义了一组允许的通道数，以及每个允许的通道数的通道名称的有序集合\r\n * - channelMappingTable 可选， 当 Channel Mapping Family 为 0 时被省略。\r\n *  - 1 bytes, streamCount, unsigned ogg packet 里面编码了多少路 stream\r\n *  - 1 bytes, coupledStreamCount, unsigned 标识有多少路流是双声声道，必须小于 streamCount\r\n *  - C bytes, C 为总输出声道数 coupledStreamCount + streamCount\r\n * \r\n */\r\nexport function parseAVCodecParameters(stream: AVStream, extradata?: Uint8ArrayInterface) {\r\n  if (!extradata && stream.sideData[AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA]) {\r\n    extradata = stream.sideData[AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA]\r\n  }\r\n  if (extradata && extradata.length >= 19) {\r\n    const reader = new BufferReader(extradata, false)\r\n    reader.skip(9)\r\n    stream.codecpar.chLayout.nbChannels = reader.readUint8()\r\n    stream.codecpar.initialPadding = reader.readUint16()\r\n    stream.codecpar.sampleRate = reader.readUint32()\r\n\r\n    stream.codecpar.seekPreroll = Number(avRescaleQ(\r\n      80n,\r\n      {\r\n        den: 1000,\r\n        num: 1\r\n      },\r\n      {\r\n        den: 48000,\r\n        num: 1\r\n      }\r\n    ))\r\n  }\r\n}\r\n\r\nexport function avCodecParameters2Extradata(codecpar: AVCodecParameters) {\r\n  const extradata = new Uint8Array(19)\r\n\r\n  const writer = new BufferWriter(extradata, false)\r\n\r\n  writer.writeString('OpusHead')\r\n  writer.writeUint8(0x01)\r\n  writer.writeUint8(codecpar.chLayout.nbChannels)\r\n  writer.writeUint16(codecpar.initialPadding)\r\n  writer.writeUint32(codecpar.sampleRate)\r\n\r\n  return extradata\r\n}\r\n","/*\r\n * libmedia vp8 util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVStream from '../AVStream'\r\nimport { AVPacketSideDataType } from 'avutil/codec'\r\nimport BitReader from 'common/io/BitReader'\r\nimport { Uint8ArrayInterface } from 'common/io/interface'\r\n\r\nexport function parseAVCodecParameters(stream: AVStream, extradata?: Uint8ArrayInterface) {\r\n  if (!extradata && stream.sideData[AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA]) {\r\n    extradata = stream.sideData[AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA]\r\n  }\r\n  if (extradata && extradata.length >= 6) {\r\n    const params = parseExtraData(extradata)\r\n    stream.codecpar.profile = params.profile\r\n    stream.codecpar.level = params.level\r\n  }\r\n}\r\n\r\n/**\r\n * - 1 byte profile\r\n * - 1 byte level\r\n * - 4 bit bitdepth\r\n * - 3 bit chroma_subsampling\r\n * - 1 bit full_range_flag\r\n * - 1 byte color_primaries\r\n * - 1 byte color_trc\r\n * - 1 byte color_space\r\n * \r\n * @param extradata \r\n */\r\nexport function parseExtraData(extradata: Uint8ArrayInterface) {\r\n  const bitReader = new BitReader(extradata.length)\r\n  bitReader.appendBuffer(extradata.subarray(4))\r\n  const profile = bitReader.readU(8)\r\n  const level = bitReader.readU(8)\r\n  let bitDepth = bitReader.readU(4)\r\n  const chromaSubsampling = bitReader.readU(3)\r\n  const fullRangeFlag = bitReader.readU1()\r\n  const colorPrimaries = bitReader.readU(8)\r\n  const colorTrc = bitReader.readU(8)\r\n  const colorSpace = bitReader.readU(8)\r\n\r\n  return {\r\n    profile,\r\n    level,\r\n    bitDepth,\r\n    chromaSubsampling,\r\n    fullRangeFlag,\r\n    colorPrimaries,\r\n    colorTrc,\r\n    colorSpace\r\n  }\r\n}\r\n","/*\r\n * libmedia vp9 util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVStream from '../AVStream'\r\nimport { AVPacketSideDataType } from 'avutil/codec'\r\nimport { Uint8ArrayInterface } from 'common/io/interface'\r\nimport BitReader from 'common/io/BitReader'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport { NOPTS_VALUE } from 'avutil/constant'\r\nimport { PixelFormatDescriptorsMap } from 'avutil/pixelFormatDescriptor'\r\nimport { avQ2D } from 'avutil/util/rational'\r\nimport { AVChromaLocation, AVColorRange } from 'avutil/pixfmt'\r\nimport BufferWriter from 'common/io/BufferWriter'\r\n\r\nexport const enum VP9Profile {\r\n  Profile0,\r\n  Profile1,\r\n  Profile2,\r\n  Profile3\r\n}\r\n\r\nexport const VP9Profile2Name: Record<VP9Profile, string> = {\r\n  [VP9Profile.Profile0]: 'Profile0',\r\n  [VP9Profile.Profile1]: 'Profile1',\r\n  [VP9Profile.Profile2]: 'Profile2',\r\n  [VP9Profile.Profile3]: 'Profile3'\r\n}\r\n\r\nexport const LevelCapabilities = [\r\n  { level: 10, maxResolution: 512 * 384, maxFrameRate: 30 },\r\n  { level: 11, maxResolution: 512 * 384, maxFrameRate: 60 },\r\n  { level: 20, maxResolution: 960 * 540, maxFrameRate: 30 },\r\n  { level: 21, maxResolution: 960 * 540, maxFrameRate: 60 },\r\n  { level: 30, maxResolution: 1920 * 1080, maxFrameRate: 30 },\r\n  { level: 31, maxResolution: 1920 * 1080, maxFrameRate: 60 },\r\n  { level: 40, maxResolution: 2560 * 1440, maxFrameRate: 30 },\r\n  { level: 41, maxResolution: 2560 * 1440, maxFrameRate: 60 },\r\n  { level: 50, maxResolution: 3840 * 2160, maxFrameRate: 30 },\r\n  { level: 51, maxResolution: 3840 * 2160, maxFrameRate: 60 },\r\n  { level: 60, maxResolution: 4096 * 2160, maxFrameRate: 30 },\r\n  { level: 61, maxResolution: 4096 * 2160, maxFrameRate: 60 },\r\n  { level: 70, maxResolution: 8192 * 4320, maxFrameRate: 30 },\r\n  { level: 71, maxResolution: 8192 * 4320, maxFrameRate: 60 }\r\n]\r\n\r\nexport function getLevelByResolution(width: number, height: number, fps: number) {\r\n  const resolution = width * height\r\n  for (const level of LevelCapabilities) {\r\n    if (resolution <= level.maxResolution && fps <= level.maxFrameRate) {\r\n      return level.level\r\n    }\r\n  }\r\n}\r\n\r\nexport function parseAVCodecParameters(stream: AVStream, extradata?: Uint8ArrayInterface) {\r\n  if (!extradata && stream.sideData[AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA]) {\r\n    extradata = stream.sideData[AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA]\r\n  }\r\n  if (extradata && extradata.length >= 6) {\r\n    const params = parseExtraData(extradata)\r\n    stream.codecpar.profile = params.profile\r\n    stream.codecpar.level = params.level\r\n  }\r\n}\r\n\r\n/**\r\n * - 1 byte profile\r\n * - 1 byte level\r\n * - 4 bit bitdepth\r\n * - 3 bit chroma_subsampling\r\n * - 1 bit full_range_flag\r\n * - 1 byte color_primaries\r\n * - 1 byte color_trc\r\n * - 1 byte color_space\r\n * \r\n * @param extradata \r\n */\r\nexport function parseExtraData(extradata: Uint8ArrayInterface) {\r\n  const bitReader = new BitReader(extradata.length)\r\n  bitReader.appendBuffer(extradata)\r\n  const profile = bitReader.readU(8)\r\n  const level = bitReader.readU(8)\r\n  let bitDepth = bitReader.readU(4)\r\n  const chromaSubsampling = bitReader.readU(3)\r\n  const fullRangeFlag = bitReader.readU1()\r\n  const colorPrimaries = bitReader.readU(8)\r\n  const colorTrc = bitReader.readU(8)\r\n  const colorSpace = bitReader.readU(8)\r\n\r\n  return {\r\n    profile,\r\n    level,\r\n    bitDepth,\r\n    chromaSubsampling,\r\n    fullRangeFlag,\r\n    colorPrimaries,\r\n    colorTrc,\r\n    colorSpace\r\n  }\r\n}\r\n\r\nconst enum VPX_CHROMA_SUBSAMPLING {\r\n  VPX_SUBSAMPLING_420_VERTICAL = 0,\r\n  VPX_SUBSAMPLING_420_COLLOCATED_WITH_LUMA = 1,\r\n  VPX_SUBSAMPLING_422 = 2,\r\n  VPX_SUBSAMPLING_444 = 3\r\n}\r\n\r\nfunction getVpccFeature(codecpar: pointer<AVCodecParameters>) {\r\n  let profile = codecpar.profile\r\n  let level = codecpar.level\r\n  if (level === NOPTS_VALUE) {\r\n    level = getLevelByResolution(codecpar.width, codecpar.height, avQ2D(codecpar.framerate))\r\n  }\r\n  const desc = PixelFormatDescriptorsMap[codecpar.format]\r\n\r\n  let bitDepth = codecpar.bitsPerCodedSample\r\n  let chromaSubsampling = VPX_CHROMA_SUBSAMPLING.VPX_SUBSAMPLING_420_COLLOCATED_WITH_LUMA\r\n  if (desc) {\r\n    bitDepth = desc.comp[0].depth\r\n    if (desc.log2ChromaW === 1 && desc.log2ChromaH === 1) {\r\n      if (codecpar.chromaLocation === AVChromaLocation.AVCHROMA_LOC_LEFT) {\r\n        chromaSubsampling = VPX_CHROMA_SUBSAMPLING.VPX_SUBSAMPLING_420_VERTICAL\r\n      }\r\n    }\r\n    else if (desc.log2ChromaW === 1 && desc.log2ChromaH === 0) {\r\n      chromaSubsampling = VPX_CHROMA_SUBSAMPLING.VPX_SUBSAMPLING_422\r\n    }\r\n    else if (desc.log2ChromaW === 0 && desc.log2ChromaH === 0) {\r\n      chromaSubsampling = VPX_CHROMA_SUBSAMPLING.VPX_SUBSAMPLING_444\r\n    }\r\n  }\r\n  const fullRange = codecpar.colorRange === AVColorRange.AVCOL_RANGE_JPEG ? 1 : 0\r\n\r\n  if (profile === NOPTS_VALUE && bitDepth) {\r\n    if (chromaSubsampling == VPX_CHROMA_SUBSAMPLING.VPX_SUBSAMPLING_420_VERTICAL\r\n      || chromaSubsampling == VPX_CHROMA_SUBSAMPLING.VPX_SUBSAMPLING_420_COLLOCATED_WITH_LUMA\r\n    ) {\r\n      profile = (bitDepth == 8) ? VP9Profile.Profile0 : VP9Profile.Profile2\r\n    }\r\n    else {\r\n      profile = (bitDepth == 8) ? VP9Profile.Profile1 : VP9Profile.Profile3\r\n    }\r\n  }\r\n  return {\r\n    profile,\r\n    level,\r\n    bitDepth,\r\n    chromaSubsampling,\r\n    fullRange\r\n  }\r\n}\r\n\r\nexport function generateExtradata(codecpar: pointer<AVCodecParameters>) {\r\n  const ioWriter = new BufferWriter(new Uint8Array(8))\r\n  const vpcc = getVpccFeature(codecpar)\r\n  ioWriter.writeUint8(vpcc.profile)\r\n  ioWriter.writeUint8(vpcc.level)\r\n  ioWriter.writeUint8((vpcc.bitDepth << 4) | (vpcc.chromaSubsampling << 1) | vpcc.fullRange)\r\n  ioWriter.writeUint8(codecpar.colorPrimaries)\r\n  ioWriter.writeUint8(codecpar.colorTrc)\r\n  ioWriter.writeUint8(codecpar.colorSpace)\r\n  ioWriter.writeUint16(0)\r\n  return ioWriter.getWroteBuffer()\r\n}\r\n","/*\r\n * libmedia vvc util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport * as array from 'common/util/array'\r\nimport AVPacket, { AVPacketFlags } from 'avutil/struct/avpacket'\r\nimport BufferWriter from 'common/io/BufferWriter'\r\nimport BufferReader from 'common/io/BufferReader'\r\nimport { AVPacketSideDataType } from 'avutil/codec'\r\nimport BitReader from 'common/io/BitReader'\r\nimport AVStream from '../AVStream'\r\nimport { mapUint8Array, memcpyFromUint8Array } from 'cheap/std/memory'\r\nimport { naluUnescape, splitNaluByStartCode, isAnnexb } from 'avutil/util/nalu'\r\nimport { addAVPacketSideData, getAVPacketData } from 'avutil/util/avpacket'\r\nimport { avMalloc } from 'avutil/util/mem'\r\nimport * as expgolomb from 'avutil/util/expgolomb'\r\nimport { Uint8ArrayInterface } from 'common/io/interface'\r\nimport BitWriter from 'common/io/BitWriter'\r\nimport { Data } from 'common/types/type'\r\nimport { BitFormat } from './h264'\r\nimport * as intread from 'avutil/util/intread'\r\n\r\nconst NALULengthSizeMinusOne = 3\r\n\r\nexport const enum VVCNaluType {\r\n  kTRAIL_NUT      = 0,\r\n  kSTSA_NUT       = 1,\r\n  kRADL_NUT       = 2,\r\n  kRASL_NUT       = 3,\r\n  kRSV_VCL_4      = 4,\r\n  kRSV_VCL_5      = 5,\r\n  kRSV_VCL_6      = 6,\r\n  kIDR_W_RADL     = 7,\r\n  kIDR_N_LP       = 8,\r\n  kCRA_NUT        = 9,\r\n  kGDR_NUT        = 10,\r\n  kRSV_IRAP_11    = 11,\r\n  kOPI_NUT        = 12,\r\n  kDCI_NUT        = 13,\r\n  kVPS_NUT        = 14,\r\n  kSPS_NUT        = 15,\r\n  kPPS_NUT        = 16,\r\n  kPREFIX_APS_NUT = 17,\r\n  kSUFFIX_APS_NUT = 18,\r\n  kPH_NUT         = 19,\r\n  kAUD_NUT        = 20,\r\n  kEOS_NUT        = 21,\r\n  kEOB_NUT        = 22,\r\n  kPREFIX_SEI_NUT = 23,\r\n  kSUFFIX_SEI_NUT = 24,\r\n  kFD_NUT         = 25,\r\n  kRSV_NVCL_26    = 26,\r\n  kRSV_NVCL_27    = 27,\r\n  kUNSPEC_28      = 28,\r\n  kUNSPEC_29      = 29,\r\n  kUNSPEC_30      = 30,\r\n  kUNSPEC_31      = 31,\r\n}\r\n\r\nexport const enum VVCSliceType {\r\n  kSliceNone = -1,\r\n  kSliceB = 0,\r\n  kSliceP = 1,\r\n  kSliceI = 2\r\n}\r\n\r\nexport const enum VVCAPSType {\r\n  kALF     = 0,\r\n  kLMCS    = 1,\r\n  kSCALING = 2\r\n}\r\n\r\n/* eslint-disable camelcase */\r\nfunction parsePTL(bitReader: BitReader) {\r\n  const olsIdx = bitReader.readU(9)\r\n  const numSublayers = bitReader.readU(3)\r\n  const constantFrameRate = bitReader.readU(2)\r\n  const chromaFormatIdc = bitReader.readU(2)\r\n  const bitDepthMinus8 = bitReader.readU(3)\r\n  bitReader.readU(5)\r\n\r\n  // VvcPTLRecord\r\n  bitReader.readU(2)\r\n  const num_bytes_constraint_info = bitReader.readU(6)\r\n  const generalProfileIdc = bitReader.readU(7)\r\n  const generalTierFlag = bitReader.readU(1)\r\n  const generalLevelIdc = bitReader.readU(8)\r\n  const ptlFrameOnlyConstraintFlag = bitReader.readU(1)\r\n  const ptlMultilayerEnabledFlag = bitReader.readU(1)\r\n  const generalConstraintInfo = []\r\n  const sublayerLevelIdc = []\r\n\r\n  if (num_bytes_constraint_info) {\r\n    for (let i = 0; i < num_bytes_constraint_info - 1; i++) {\r\n      generalConstraintInfo[i] = bitReader.readU(8)\r\n    }\r\n    generalConstraintInfo[num_bytes_constraint_info - 1] = bitReader.readU(6)\r\n  }\r\n  else {\r\n    bitReader.readU(6)\r\n  }\r\n  if (numSublayers > 1) {\r\n    let ptl_sublayer_present_mask = 0\r\n    for (let j = numSublayers - 2; j >= 0; --j) {\r\n      const val = bitReader.readU(1)\r\n      ptl_sublayer_present_mask |= val << j\r\n    }\r\n    for (let j = numSublayers; j <= 8 && numSublayers > 1; ++j) {\r\n      bitReader.readU(1)\r\n    }\r\n\r\n    for (let j = numSublayers - 2; j >= 0; --j) {\r\n      if (ptl_sublayer_present_mask & (1 << j)) {\r\n        sublayerLevelIdc[j] = bitReader.readU(8)\r\n      }\r\n    }\r\n  }\r\n  const ptl_num_sub_profiles = bitReader.readU(8)\r\n  const generalSubProfileIdc = []\r\n  if (ptl_num_sub_profiles) {\r\n    for (let i = 0; i < ptl_num_sub_profiles; i++) {\r\n      generalSubProfileIdc.push(bitReader.readU(8))\r\n    }\r\n  }\r\n\r\n  const maxPictureWidth = bitReader.readU(16)\r\n  const maxPictureHeight = bitReader.readU(16)\r\n  const avgFramerate = bitReader.readU(16)\r\n\r\n  return {\r\n    olsIdx,\r\n    numSublayers,\r\n    bitDepthMinus8,\r\n    chromaFormatIdc,\r\n    constantFrameRate,\r\n    generalProfileIdc,\r\n    generalTierFlag,\r\n    generalLevelIdc,\r\n    ptlFrameOnlyConstraintFlag,\r\n    ptlMultilayerEnabledFlag,\r\n    generalConstraintInfo,\r\n    sublayerLevelIdc,\r\n    generalSubProfileIdc,\r\n    maxPictureWidth,\r\n    maxPictureHeight,\r\n    avgFramerate\r\n  }\r\n}\r\n/* eslint-enable camelcase */\r\n\r\n/**\r\n * \r\n * vvcc 格式的 extradata 转 annexb vps sps pps\r\n * \r\n * bits    \r\n * - 5   reserved (11111)\r\n * - 2   lengthSizeMinusOne\r\n * - 1   ptl_present_flag\r\n * if ptl_present_flag\r\n *   - 9   ols_idx\r\n *   - 3  num_sublayers\r\n *   - 2  constant_frame_rate\r\n *   - 2  chroma_format_idc\r\n *   - 3  bit_depth_minus8\r\n *   - 5  reserved (11111)\r\n *   VvcPTLRecord\r\n *   - 2 reserved (11)\r\n *   - 6 num_bytes_constraint_info\r\n *   - 7 general_profile_idc\r\n *   - 1 general_tier_flag\r\n *   - 8 general_level_idc\r\n *   - 1 general_level_idc\r\n *   - 1 ptl_multilayer_enabled_flag\r\n *   if num_bytes_constraint_info > 0\r\n *      for (i = 0; i < num_bytes_constraint_info - 1; i++)\r\n *        - 8 general_constraint_info[i]\r\n *      - 6 general_constraint_info[num_bytes_constraint_info - 1]\r\n *   else\r\n *      - 6 reserved\r\n *   if num_sublayers > 1\r\n *      - num_sublayers - 2 ptl_sublayer_level_present_flag\r\n *      - 8 - num_sublayers + 1 ptl_reserved_zero_bit\r\n *      for (i = num_sublayers -2; i >= 0; i--)\r\n *        if ptl_sublayer_present_mask & (1 << i)\r\n *          - 8 sublayer_level_idc[i]\r\n *    - 8 ptl_num_sub_profiles\r\n *    if ptl_num_sub_profiles\r\n *      for (i = 0; i < ptl_num_sub_profiles; i++)\r\n *        - 32 general_sub_profile_idc[i]\r\n *    - 16 max_picture_width\r\n *    - 16 max_picture_height\r\n *    - 16 avg_frame_rate\r\n * - 8   numOfArrays\r\n * - repeated of array (vps/sps/pps)\r\n * - 1   array_completeness\r\n * - 2   reserved (0)\r\n * - 5   NAL_unit_type\r\n * if nalu_type != VVC_NALU_DEC_PARAM && nalu_type != VVC_NALU_OPI\r\n *    - 16  numNalus\r\n * else\r\n *   numNalus = 1\r\n * - repeated once per NAL\r\n * - 16  nalUnitLength\r\n * - N   NALU data\r\n * \r\n */\r\nexport function extradata2VpsSpsPps(extradata: Uint8ArrayInterface) {\r\n\r\n  const bufferReader = new BufferReader(extradata, true)\r\n\r\n  const ptlPresentFlag = bufferReader.readUint8() & 0x01\r\n\r\n  if (ptlPresentFlag) {\r\n    const bitReader = new BitReader()\r\n    bitReader.appendBuffer(extradata.subarray(1))\r\n    parsePTL(bitReader)\r\n    bufferReader.skip(bitReader.getPointer())\r\n  }\r\n\r\n  let vpss = []\r\n  let spss = []\r\n  let ppss = []\r\n\r\n  const arrayLen = bufferReader.readUint8()\r\n\r\n  for (let i = 0; i < arrayLen; i++) {\r\n    const naluType = bufferReader.readUint8() & 0x1f\r\n    let count = 1\r\n\r\n    if (naluType !== VVCNaluType.kDCI_NUT && naluType !== VVCNaluType.kOPI_NUT) {\r\n      count = bufferReader.readUint16()\r\n    }\r\n    const list = []\r\n\r\n    for (let j = 0; j < count; j++) {\r\n      const len = bufferReader.readUint16()\r\n      list.push(bufferReader.readBuffer(len))\r\n    }\r\n\r\n    if (naluType === VVCNaluType.kVPS_NUT) {\r\n      vpss = list\r\n    }\r\n    else if (naluType === VVCNaluType.kSPS_NUT) {\r\n      spss = list\r\n    }\r\n    else if (naluType === VVCNaluType.kPPS_NUT) {\r\n      ppss = list\r\n    }\r\n  }\r\n\r\n  return {\r\n    vpss,\r\n    spss,\r\n    ppss\r\n  }\r\n}\r\n\r\nexport function vpsSpsPps2Extradata(vpss: Uint8ArrayInterface[], spss: Uint8ArrayInterface[], ppss: Uint8ArrayInterface[]) {\r\n\r\n  const sps = spss[0]\r\n  let ptl: Uint8Array\r\n  if (sps) {\r\n    const spsParams = parseSPS(sps)\r\n    let generalConstraintInfo = spsParams.generalConstraintInfo\r\n    if (!generalConstraintInfo.length) {\r\n      generalConstraintInfo = new Array(12).fill(0)\r\n    }\r\n    const biWriter = new BitWriter()\r\n    biWriter.writeU(9, 0)\r\n    biWriter.writeU(3, spsParams.spsMaxSublayersMinus1 + 1)\r\n    biWriter.writeU(2, 1)\r\n    biWriter.writeU(2, spsParams.chromaFormatIdc)\r\n    biWriter.writeU(3, spsParams.bitDepthMinus8)\r\n    biWriter.writeU(5, 0b11111)\r\n    biWriter.writeU(2, 0)\r\n    biWriter.writeU(6, generalConstraintInfo.length)\r\n    biWriter.writeU(7, spsParams.profile)\r\n    biWriter.writeU1(spsParams.tierFlag)\r\n    biWriter.writeU(8, spsParams.level)\r\n    biWriter.writeU1(spsParams.ptlFrameOnlyConstraintFlag)\r\n    biWriter.writeU1(spsParams.ptlMultilayerEnabledFlag)\r\n\r\n    if (generalConstraintInfo.length) {\r\n      for (let i = 0; i < generalConstraintInfo.length - 1; i++) {\r\n        biWriter.writeU(8, generalConstraintInfo[i])\r\n      }\r\n      biWriter.writeU(6, generalConstraintInfo[generalConstraintInfo.length - 1])\r\n    }\r\n    else {\r\n      biWriter.writeU(6, 0b111111)\r\n    }\r\n\r\n    if (spsParams.spsMaxSublayersMinus1 + 1 > 1) {\r\n      let ptlSubLayerLevelPresentFlags = 0\r\n      for (let i = spsParams.spsMaxSublayersMinus1 - 1; i >= 0; i--) {\r\n        ptlSubLayerLevelPresentFlags = (ptlSubLayerLevelPresentFlags << 1 | spsParams.ptlSublayerLevelPresentFlag[i])\r\n      }\r\n      biWriter.writeU(spsParams.spsMaxSublayersMinus1, ptlSubLayerLevelPresentFlags)\r\n\r\n      for (let j = spsParams.spsMaxSublayersMinus1 + 1; j <= 8 && spsParams.spsMaxSublayersMinus1 > 0; ++j) {\r\n        biWriter.writeU1(0)\r\n      }\r\n      for (let i = spsParams.spsMaxSublayersMinus1 - 1; i >= 0; i--) {\r\n        if (spsParams.ptlSublayerLevelPresentFlag[i]) {\r\n          biWriter.writeU(8, spsParams.sublayerLevelIdc[i])\r\n        }\r\n      }\r\n    }\r\n    biWriter.writeU(8, spsParams.generalSubProfileIdc.length)\r\n    for (let i = 0; i < spsParams.generalSubProfileIdc.length; i++) {\r\n      biWriter.writeU(8, spsParams.sublayerLevelIdc[i])\r\n    }\r\n    biWriter.writeU(16, spsParams.width)\r\n    biWriter.writeU(16, spsParams.height)\r\n    biWriter.writeU(16, 0)\r\n    biWriter.padding()\r\n    ptl = biWriter.getBuffer().subarray(0, biWriter.getPointer())\r\n  }\r\n\r\n  let length = 2 + (ptl ? ptl.length : 0)\r\n\r\n  if (vpss.length) {\r\n    // type + count\r\n    length += 3\r\n    length = vpss.reduce((prev, value) => {\r\n      // length + data\r\n      return prev + 2 + value.length\r\n    }, length)\r\n  }\r\n\r\n  if (spss.length) {\r\n    // type + count\r\n    length += 3\r\n    length = spss.reduce((prev, value) => {\r\n      // length + data\r\n      return prev + 2 + value.length\r\n    }, length)\r\n  }\r\n\r\n  if (ppss.length) {\r\n    // type + count\r\n    length += 3\r\n    length = ppss.reduce((prev, value) => {\r\n      // length + data\r\n      return prev + 2 + value.length\r\n    }, length)\r\n  }\r\n\r\n  const buffer = new Uint8Array(length)\r\n  const bufferWriter = new BufferWriter(buffer, true)\r\n\r\n  bufferWriter.writeUint8(NALULengthSizeMinusOne << 1 | (ptl ? 1 : 0) | 0xf8)\r\n\r\n  if (ptl) {\r\n    bufferWriter.writeBuffer(ptl)\r\n  }\r\n\r\n  // numOfArrays\r\n  let numOfArrays = 0\r\n  if (vpss.length) {\r\n    numOfArrays++\r\n  }\r\n  if (spss.length) {\r\n    numOfArrays++\r\n  }\r\n  if (ppss.length) {\r\n    numOfArrays++\r\n  }\r\n  bufferWriter.writeUint8(numOfArrays)\r\n\r\n  // vps\r\n  if (vpss.length) {\r\n    bufferWriter.writeUint8((1 << 7) | VVCNaluType.kVPS_NUT)\r\n    bufferWriter.writeUint16(vpss.length)\r\n    array.each(vpss, (vps) => {\r\n      bufferWriter.writeUint16(vps.length)\r\n      bufferWriter.writeBuffer(vps)\r\n    })\r\n  }\r\n\r\n  // sps\r\n  if (spss.length) {\r\n    bufferWriter.writeUint8((1 << 7) | VVCNaluType.kSPS_NUT)\r\n    bufferWriter.writeUint16(spss.length)\r\n    array.each(spss, (sps) => {\r\n      bufferWriter.writeUint16(sps.length)\r\n      bufferWriter.writeBuffer(sps)\r\n    })\r\n  }\r\n\r\n  // pps\r\n  if (ppss.length) {\r\n    bufferWriter.writeUint8((1 << 7) | VVCNaluType.kPPS_NUT)\r\n    bufferWriter.writeUint16(ppss.length)\r\n    array.each(ppss, (pps) => {\r\n      bufferWriter.writeUint16(pps.length)\r\n      bufferWriter.writeBuffer(pps)\r\n    })\r\n  }\r\n\r\n  return buffer\r\n}\r\n\r\nexport function annexbExtradata2AvccExtradata(data: Uint8ArrayInterface) {\r\n  let nalus = splitNaluByStartCode(data)\r\n\r\n  if (nalus.length >= 2) {\r\n    const vpss = []\r\n    const spss = []\r\n    const ppss = []\r\n\r\n    nalus.forEach((nalu) => {\r\n      const type = (nalu[1] >>> 3) & 0x1f\r\n      if (type === VVCNaluType.kVPS_NUT) {\r\n        vpss.push(nalu)\r\n      }\r\n      else if (type === VVCNaluType.kSPS_NUT) {\r\n        spss.push(nalu)\r\n      }\r\n      else if (type === VVCNaluType.kPPS_NUT) {\r\n        ppss.push(nalu)\r\n      }\r\n    })\r\n\r\n    if (spss.length && ppss.length) {\r\n      return vpsSpsPps2Extradata(vpss, spss, ppss)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * \r\n * annexb 格式的 NALU 转 avcc NALU \r\n * \r\n */\r\nexport function annexb2Avcc(data: Uint8ArrayInterface) {\r\n  let extradata: Uint8Array\r\n  let key: boolean = false\r\n\r\n  let nalus = splitNaluByStartCode(data)\r\n\r\n  if (nalus.length >= 2) {\r\n    const vpss = []\r\n    const spss = []\r\n    const ppss = []\r\n\r\n    nalus.forEach((nalu) => {\r\n      const type = (nalu[1] >>> 3) & 0x1f\r\n      if (type === VVCNaluType.kVPS_NUT) {\r\n        vpss.push(nalu)\r\n      }\r\n      else if (type === VVCNaluType.kSPS_NUT) {\r\n        spss.push(nalu)\r\n      }\r\n      else if (type === VVCNaluType.kPPS_NUT) {\r\n        ppss.push(nalu)\r\n      }\r\n    })\r\n\r\n    if (spss.length && ppss.length) {\r\n      extradata = vpsSpsPps2Extradata(vpss, spss, ppss)\r\n\r\n      nalus = nalus.filter((nalu) => {\r\n        const type = (nalu[1] >>> 3) & 0x1f\r\n        return type !== VVCNaluType.kVPS_NUT\r\n          && type !== VVCNaluType.kSPS_NUT\r\n          && type !== VVCNaluType.kPPS_NUT\r\n          && type !== VVCNaluType.kAUD_NUT\r\n      })\r\n    }\r\n  }\r\n\r\n  const length = nalus.reduce((prev, nalu) => {\r\n    return prev + NALULengthSizeMinusOne + 1 + nalu.length\r\n  }, 0)\r\n\r\n  const bufferPointer = avMalloc(length)\r\n  const buffer = mapUint8Array(bufferPointer, length)\r\n\r\n  const bufferWriter = new BufferWriter(buffer)\r\n\r\n  array.each(nalus, (nalu) => {\r\n    if (NALULengthSizeMinusOne === 3) {\r\n      bufferWriter.writeUint32(nalu.length)\r\n    }\r\n    else if (NALULengthSizeMinusOne === 2) {\r\n      bufferWriter.writeUint24(nalu.length)\r\n    }\r\n    else if (NALULengthSizeMinusOne === 1) {\r\n      bufferWriter.writeUint16(nalu.length)\r\n    }\r\n    else {\r\n      bufferWriter.writeUint8(nalu.length)\r\n    }\r\n    bufferWriter.writeBuffer(nalu.subarray(0))\r\n\r\n    const type = (nalu[1] >>> 3) & 0x1f\r\n    if (type === VVCNaluType.kIDR_N_LP\r\n      || type === VVCNaluType.kIDR_W_RADL\r\n      || type === VVCNaluType.kCRA_NUT\r\n      || type === VVCNaluType.kGDR_NUT\r\n    ) {\r\n      key = true\r\n    }\r\n  })\r\n\r\n  return {\r\n    bufferPointer,\r\n    length,\r\n    extradata,\r\n    key\r\n  }\r\n}\r\n\r\n/**\r\n * avcc 格式的 NALU 转 annexb NALU \r\n * \r\n */\r\nexport function avcc2Annexb(data: Uint8ArrayInterface, extradata?: Uint8ArrayInterface) {\r\n  const naluLengthSizeMinusOne = extradata ? ((extradata[0] >>> 1) & 0x03) : NALULengthSizeMinusOne\r\n\r\n  let vpss = []\r\n  let spss = []\r\n  let ppss = []\r\n  let key = false\r\n\r\n  if (extradata) {\r\n    const result = extradata2VpsSpsPps(extradata)\r\n    vpss = result.vpss\r\n    spss = result.spss\r\n    ppss = result.ppss\r\n    key = true\r\n  }\r\n\r\n  const nalus = []\r\n\r\n  const bufferReader = new BufferReader(data)\r\n  while (bufferReader.remainingSize() > 0) {\r\n    let length = 0\r\n    if (naluLengthSizeMinusOne === 3) {\r\n      length = bufferReader.readUint32()\r\n    }\r\n    else if (naluLengthSizeMinusOne === 2) {\r\n      length = bufferReader.readUint24()\r\n    }\r\n    else if (naluLengthSizeMinusOne === 1) {\r\n      length = bufferReader.readUint16()\r\n    }\r\n    else {\r\n      length = bufferReader.readUint8()\r\n    }\r\n    nalus.push(bufferReader.readBuffer(length))\r\n  }\r\n\r\n  let length = vpss.reduce((prev, vps) => {\r\n    return prev + 4 + vps.length\r\n  }, 0)\r\n  length = spss.reduce((prev, sps) => {\r\n    return prev + 4 + sps.length\r\n  }, length)\r\n  length = ppss.reduce((prev, pps) => {\r\n    return prev + 4 + pps.length\r\n  }, length)\r\n  length = nalus.reduce((prev, nalu, index) => {\r\n    return prev + (index ? 3 : 4) + nalu.length\r\n  }, length)\r\n\r\n  const bufferPointer = avMalloc(length + 7)\r\n  const buffer = mapUint8Array(bufferPointer, length + 7)\r\n\r\n  const bufferWriter = new BufferWriter(buffer)\r\n\r\n  // AUD\r\n  bufferWriter.writeUint8(0x00)\r\n  bufferWriter.writeUint8(0x00)\r\n  bufferWriter.writeUint8(0x00)\r\n  bufferWriter.writeUint8(0x01)\r\n  bufferWriter.writeUint8(0x00)\r\n  bufferWriter.writeUint8(VVCNaluType.kAUD_NUT << 3)\r\n  bufferWriter.writeUint8(0xf0)\r\n\r\n  array.each(vpss, (vps) => {\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x01)\r\n    bufferWriter.writeBuffer(vps)\r\n  })\r\n\r\n  array.each(spss, (sps) => {\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x01)\r\n    bufferWriter.writeBuffer(sps)\r\n  })\r\n\r\n  array.each(ppss, (pps) => {\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x01)\r\n    bufferWriter.writeBuffer(pps)\r\n  })\r\n\r\n  array.each(nalus, (nalu, index) => {\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    if (!index) {\r\n      bufferWriter.writeUint8(0x00)\r\n    }\r\n    bufferWriter.writeUint8(0x01)\r\n    bufferWriter.writeBuffer(nalu)\r\n\r\n    const type = (nalu[1] >>> 3) & 0x1f\r\n    if (type === VVCNaluType.kIDR_N_LP\r\n      || type === VVCNaluType.kIDR_W_RADL\r\n      || type === VVCNaluType.kCRA_NUT\r\n      || type === VVCNaluType.kGDR_NUT\r\n    ) {\r\n      key = true\r\n    }\r\n  })\r\n\r\n  return {\r\n    bufferPointer,\r\n    length: length + 7,\r\n    key\r\n  }\r\n}\r\n\r\nexport function parseAvccExtraData(avpacket: pointer<AVPacket>, stream: AVStream) {\r\n  if (!(avpacket.flags & AVPacketFlags.AV_PKT_FLAG_KEY)) {\r\n    return\r\n  }\r\n\r\n  const data = getAVPacketData(avpacket)\r\n\r\n  if (isAnnexb(data)) {\r\n    return\r\n  }\r\n\r\n  const naluLengthSizeMinusOne = stream.metadata.naluLengthSizeMinusOne ?? NALULengthSizeMinusOne\r\n\r\n  let vpss = []\r\n  let spss = []\r\n  let ppss = []\r\n\r\n  const bufferReader = new BufferReader(data)\r\n  while (bufferReader.remainingSize() > 0) {\r\n    let length = 0\r\n    if (naluLengthSizeMinusOne === 3) {\r\n      length = bufferReader.readUint32()\r\n    }\r\n    else if (naluLengthSizeMinusOne === 2) {\r\n      length = bufferReader.readUint24()\r\n    }\r\n    else if (naluLengthSizeMinusOne === 1) {\r\n      length = bufferReader.readUint16()\r\n    }\r\n    else {\r\n      length = bufferReader.readUint8()\r\n    }\r\n\r\n    const nalu = data.subarray(static_cast<int32>(bufferReader.getPos()), static_cast<int32>(bufferReader.getPos()) + length)\r\n    bufferReader.skip(length)\r\n\r\n    const naluType = (nalu[1] >>> 3) & 0x1f\r\n\r\n    if (naluType === VVCNaluType.kSPS_NUT) {\r\n      spss.push(nalu)\r\n    }\r\n    else if (naluType === VVCNaluType.kPPS_NUT) {\r\n      ppss.push(nalu)\r\n    }\r\n    else if (naluType === VVCNaluType.kVPS_NUT) {\r\n      vpss.push(nalu)\r\n    }\r\n  }\r\n\r\n  if (spss.length || ppss.length || vpss.length) {\r\n    const extradata = vpsSpsPps2Extradata(vpss, spss, ppss)\r\n    const extradataPointer = avMalloc(extradata.length)\r\n    memcpyFromUint8Array(extradataPointer, extradata.length, extradata)\r\n    addAVPacketSideData(avpacket, AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA, extradataPointer, extradata.length)\r\n  }\r\n}\r\n\r\nexport function parseAnnexbExtraData(avpacket: pointer<AVPacket>, force: boolean = false) {\r\n  if (!(avpacket.flags & AVPacketFlags.AV_PKT_FLAG_KEY) && !force) {\r\n    return\r\n  }\r\n\r\n  const data = getAVPacketData(avpacket)\r\n\r\n  if (!isAnnexb(data)) {\r\n    return\r\n  }\r\n\r\n  let nalus = splitNaluByStartCode(data)\r\n\r\n  if (nalus.length > 2) {\r\n    const vpss = []\r\n    const spss = []\r\n    const ppss = []\r\n\r\n    nalus.forEach((nalu) => {\r\n      const type = (nalu[1] >>> 3) & 0x1f\r\n      if (type === VVCNaluType.kVPS_NUT) {\r\n        vpss.push(nalu)\r\n      }\r\n      else if (type === VVCNaluType.kSPS_NUT) {\r\n        spss.push(nalu)\r\n      }\r\n      else if (type === VVCNaluType.kPPS_NUT) {\r\n        ppss.push(nalu)\r\n      }\r\n    })\r\n\r\n    if (vpss.length && spss.length && ppss.length) {\r\n      const extradata = vpsSpsPps2Extradata(vpss, spss, ppss)\r\n      const extradataPointer = avMalloc(extradata.length)\r\n      memcpyFromUint8Array(extradataPointer, extradata.length, extradata)\r\n      addAVPacketSideData(avpacket, AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA, extradataPointer, extradata.length)\r\n      avpacket.flags |= AVPacketFlags.AV_PKT_FLAG_KEY\r\n    }\r\n  }\r\n}\r\n\r\nexport function parseAVCodecParametersBySps(stream: AVStream, sps: Uint8Array) {\r\n  const { profile, level, width, height } = parseSPS(sps)\r\n  stream.codecpar.profile = profile\r\n  stream.codecpar.level = level\r\n  stream.codecpar.width = width\r\n  stream.codecpar.height = height\r\n}\r\n\r\nexport function parseAVCodecParameters(stream: AVStream, extradata?: Uint8ArrayInterface) {\r\n  if (!extradata && stream.sideData[AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA]) {\r\n    extradata = stream.sideData[AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA]\r\n  }\r\n  if (extradata && extradata.length >= 6) {\r\n\r\n    stream.metadata.naluLengthSizeMinusOne = (extradata[0] >>> 1) & 0x03\r\n\r\n    const { spss } = extradata2VpsSpsPps(extradata)\r\n\r\n    if (spss.length) {\r\n      parseAVCodecParametersBySps(stream, spss[0])\r\n    }\r\n  }\r\n}\r\n\r\nexport function isIDR(avpacket: pointer<AVPacket>, naluLengthSize: int32 = 4) {\r\n  if (avpacket.bitFormat === BitFormat.ANNEXB) {\r\n    let nalus = splitNaluByStartCode(mapUint8Array(avpacket.data, avpacket.size))\r\n    return nalus.some((nalu) => {\r\n      const type = (nalu[1] >>> 3) & 0x1f\r\n      return type === VVCNaluType.kIDR_N_LP || type === VVCNaluType.kIDR_W_RADL\r\n    })\r\n  }\r\n  else {\r\n    const size = avpacket.size\r\n    let i = 0\r\n    while (i < (size - naluLengthSize)) {\r\n      const type = (intread.r8(avpacket.data + (i + naluLengthSize + 1)) >>> 3) & 0x1f\r\n      if (type === VVCNaluType.kIDR_N_LP || type === VVCNaluType.kIDR_W_RADL) {\r\n        return true\r\n      }\r\n      if (naluLengthSize === 4) {\r\n        i += intread.rb32(avpacket.data + i)\r\n      }\r\n      else if (naluLengthSize === 3) {\r\n        i += intread.rb24(avpacket.data + i)\r\n      }\r\n      else if (naluLengthSize === 2) {\r\n        i += intread.rb16(avpacket.data + i)\r\n      }\r\n      else {\r\n        i += intread.r8(avpacket.data + i)\r\n      }\r\n      i += naluLengthSize\r\n    }\r\n    return false\r\n  }\r\n}\r\n\r\n/* eslint-disable camelcase */\r\nexport interface VvcSPS {\r\n  profile: number\r\n  level: number\r\n  width: number\r\n  height: number\r\n  chromaFormatIdc: number\r\n  bitDepthMinus8: number\r\n  generalProfileSpace: number\r\n  tierFlag: number\r\n  generalConstraintInfo: number[]\r\n  generalSubProfileIdc: number[]\r\n  ptlFrameOnlyConstraintFlag: number\r\n  ptlMultilayerEnabledFlag: number\r\n  spsMaxSublayersMinus1: number\r\n  ptlSublayerLevelPresentFlag: number[]\r\n  sublayerLevelIdc: number[]\r\n  sps_log2_max_pic_order_cnt_lsb_minus4: number\r\n  sps_poc_msb_cycle_flag: number\r\n  sps_poc_msb_cycle_len_minus1: number\r\n  sps_num_extra_ph_bytes: number\r\n  sps_extra_ph_bit_present_flag: number[]\r\n}\r\n\r\nexport function parseSPS(sps: Uint8ArrayInterface): VvcSPS {\r\n  if (!sps || sps.length < 3) {\r\n    return\r\n  }\r\n\r\n  let offset = 0\r\n  if (sps[0] === 0x00\r\n    && sps[1] === 0x00\r\n    && sps[2] === 0x00\r\n    && sps[3] === 0x01\r\n  ) {\r\n    offset = 4\r\n  }\r\n\r\n  let profile = 0\r\n  let level = 0\r\n  let width = 0\r\n  let height = 0\r\n  let bitDepthMinus8 = 0\r\n  let chromaFormatIdc = 1\r\n  let generalProfileSpace = 0\r\n  let tierFlag = 0\r\n  let ptlFrameOnlyConstraintFlag = 0\r\n  let ptlMultilayerEnabledFlag = 0\r\n\r\n  const generalConstraintInfo = []\r\n  const ptlSublayerLevelPresentFlag = []\r\n  const sublayerLevelIdc = []\r\n  const generalSubProfileIdc = []\r\n\r\n  const buffer = naluUnescape(sps.subarray(offset))\r\n  const bitReader = new BitReader(buffer.length)\r\n  bitReader.appendBuffer(buffer)\r\n\r\n  // forbidden_zero_bit\r\n  bitReader.readU1()\r\n  // nuh_reserved_zero_bit\r\n  bitReader.readU1()\r\n  // layerId\r\n  bitReader.readU(6)\r\n  // nalu type\r\n  bitReader.readU(5)\r\n  // tid\r\n  bitReader.readU(3)\r\n\r\n  // sps_seq_parameter_set_id && sps_video_parameter_set_id\r\n  bitReader.readU(8)\r\n\r\n  const spsMaxSublayersMinus1 = bitReader.readU(3)\r\n  chromaFormatIdc = bitReader.readU(2)\r\n  const sps_log2_ctu_size_minus5 = bitReader.readU(2)\r\n  const sps_ptl_dpb_hrd_params_present_flag = bitReader.readU(1)\r\n  if (sps_ptl_dpb_hrd_params_present_flag) {\r\n    profile = bitReader.readU(7)\r\n    tierFlag = bitReader.readU(1)\r\n    level = bitReader.readU(8)\r\n    ptlFrameOnlyConstraintFlag = bitReader.readU(1)\r\n    ptlMultilayerEnabledFlag = bitReader.readU(1)\r\n    const gci_present_flag = bitReader.readU(1)\r\n    if (gci_present_flag) {\r\n      for (let j = 0; j < 8; j++) {\r\n        generalConstraintInfo[j] = bitReader.readU(8)\r\n      }\r\n      generalConstraintInfo[8] = bitReader.readU(7)\r\n      const gci_num_reserved_bits = bitReader.readU(8)\r\n      bitReader.readU(gci_num_reserved_bits)\r\n    }\r\n    bitReader.skipPadding()\r\n    for (let i = spsMaxSublayersMinus1 - 1; i >= 0; i--) {\r\n      ptlSublayerLevelPresentFlag[i] = bitReader.readU(1)\r\n    }\r\n    bitReader.skipPadding()\r\n    for (let i = spsMaxSublayersMinus1 - 1; i >= 0; i--) {\r\n      if (ptlSublayerLevelPresentFlag[i]) {\r\n        sublayerLevelIdc[i] = bitReader.readU(8)\r\n      }\r\n    }\r\n\r\n    const ptl_num_sub_profiles = bitReader.readU(8)\r\n    if (ptl_num_sub_profiles) {\r\n      for (let i = 0; i < ptl_num_sub_profiles; i++) {\r\n        generalSubProfileIdc[i] = bitReader.readU(32)\r\n      }\r\n    }\r\n  }\r\n\r\n  // sps_gdr_enabled_flag\r\n  bitReader.readU1()\r\n  const sps_ref_pic_resampling_enabled_flag = bitReader.readU1()\r\n  if (sps_ref_pic_resampling_enabled_flag) {\r\n    // sps_res_change_in_clvs_allowed_flag\r\n    bitReader.readU1()\r\n  }\r\n\r\n  const sps_pic_width_max_in_luma_samples = width = expgolomb.readUE(bitReader)\r\n  const sps_pic_height_max_in_luma_samples = height = expgolomb.readUE(bitReader)\r\n\r\n  if (bitReader.readU1()) {\r\n    // sps_conf_win_left_offset\r\n    expgolomb.readUE(bitReader)\r\n    // sps_conf_win_right_offset\r\n    expgolomb.readUE(bitReader)\r\n    // sps_conf_win_top_offset\r\n    expgolomb.readUE(bitReader)\r\n    // sps_conf_win_bottom_offset\r\n    expgolomb.readUE(bitReader)\r\n  }\r\n\r\n  if (bitReader.readU1()) {\r\n    const sps_num_subpics_minus1 = expgolomb.readUE(bitReader)\r\n    const ctb_log2_size_y = sps_log2_ctu_size_minus5 + 5\r\n    const ctb_size_y      = 1 << ctb_log2_size_y\r\n    const tmp_width_val   = sps_pic_width_max_in_luma_samples / (1 << ctb_log2_size_y)\r\n    const tmp_height_val  = sps_pic_height_max_in_luma_samples / (1 << ctb_log2_size_y)\r\n    const wlen            = Math.ceil(Math.log2(tmp_width_val))\r\n    const hlen            = Math.ceil(Math.log2(tmp_height_val))\r\n\r\n    let sps_subpic_id_len = 0\r\n    let sps_subpic_same_size_flag = 0\r\n    let sps_independent_subpics_flag = 0\r\n    // sps_num_subpics_minus1\r\n    if (sps_num_subpics_minus1 > 0) {\r\n      sps_independent_subpics_flag = bitReader.readU1()\r\n      sps_subpic_same_size_flag = bitReader.readU1()\r\n    }\r\n    for (let i = 0; sps_num_subpics_minus1 > 0 && i <= sps_num_subpics_minus1; i++) {\r\n      if (!sps_subpic_same_size_flag || i == 0) {\r\n        if (i > 0 && sps_pic_width_max_in_luma_samples > ctb_size_y) {\r\n          bitReader.readU(wlen)\r\n        }\r\n        if (i > 0 && sps_pic_height_max_in_luma_samples > ctb_size_y) {\r\n          bitReader.readU(hlen)\r\n        }\r\n        if (i < sps_num_subpics_minus1 && sps_pic_width_max_in_luma_samples > ctb_size_y) {\r\n          bitReader.readU(wlen)\r\n        }\r\n        if (i < sps_num_subpics_minus1 && sps_pic_height_max_in_luma_samples > ctb_size_y) {\r\n          bitReader.readU(hlen)\r\n        }\r\n      }\r\n      if (!sps_independent_subpics_flag) {\r\n        // sps_subpic_treated_as_pic_flag && sps_loop_filter_across_subpic_enabled_flag\r\n        bitReader.readU(2)\r\n      }\r\n    }\r\n    sps_subpic_id_len = expgolomb.readUE(bitReader) + 1\r\n    // sps_subpic_id_mapping_explicitly_signalled_flag\r\n    if (bitReader.readU(1)) {\r\n      // sps_subpic_id_mapping_present_flag\r\n      if (bitReader.readU(1)) {\r\n        for (let i = 0; i <= sps_num_subpics_minus1; i++) {\r\n          // sps_subpic_id[i]\r\n          bitReader.readU(sps_subpic_id_len)\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  bitDepthMinus8 = expgolomb.readUE(bitReader)\r\n\r\n  // sps_entropy_coding_sync_enabled_flag\r\n  bitReader.readU(1)\r\n  // sps_entry_point_offsets_present_flag\r\n  bitReader.readU(1)\r\n\r\n  const sps_log2_max_pic_order_cnt_lsb_minus4 = bitReader.readU(4)\r\n  const sps_poc_msb_cycle_flag = bitReader.readU(1)\r\n  let sps_poc_msb_cycle_len_minus1 = 0\r\n  if (sps_poc_msb_cycle_flag) {\r\n    sps_poc_msb_cycle_len_minus1 = expgolomb.readUE(bitReader)\r\n  }\r\n  const sps_extra_ph_bit_present_flag: number[] = []\r\n  const sps_num_extra_ph_bytes = bitReader.readU(2)\r\n  for (let i = 0; i < (sps_num_extra_ph_bytes * 8); i++) {\r\n    sps_extra_ph_bit_present_flag[i] = bitReader.readU(1)\r\n  }\r\n\r\n  return {\r\n    profile,\r\n    level,\r\n    width,\r\n    height,\r\n    chromaFormatIdc,\r\n    bitDepthMinus8,\r\n    generalProfileSpace,\r\n    tierFlag,\r\n    generalConstraintInfo,\r\n    generalSubProfileIdc,\r\n    ptlFrameOnlyConstraintFlag,\r\n    ptlMultilayerEnabledFlag,\r\n    spsMaxSublayersMinus1,\r\n    ptlSublayerLevelPresentFlag,\r\n    sublayerLevelIdc,\r\n    sps_log2_max_pic_order_cnt_lsb_minus4,\r\n    sps_poc_msb_cycle_flag,\r\n    sps_poc_msb_cycle_len_minus1,\r\n    sps_num_extra_ph_bytes,\r\n    sps_extra_ph_bit_present_flag\r\n  }\r\n}\r\n\r\nexport function parseExtraData(extradata: Uint8ArrayInterface) {\r\n\r\n  if (extradata[0] === 0 && extradata[1] === 0 && extradata[2] === 0 && extradata[3] === 1) {\r\n    extradata = annexbExtradata2AvccExtradata(extradata)\r\n  }\r\n\r\n  const bitReader = new BitReader()\r\n  bitReader.appendBuffer(extradata)\r\n  const ptlPresentFlag = bitReader.readU(8) & 0x01\r\n  if (ptlPresentFlag) {\r\n    return parsePTL(bitReader)\r\n  }\r\n  return {} as Data\r\n}\r\n","/*\r\n * libmedia avformat config\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nexport const DURATION_MAX_READ_SIZE = 250 * 1024\r\n\r\nexport const SAMPLE_INDEX_STEP = 5000n\r\n","/*\r\n * libmedia demux util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVPacket, { AVPacketFlags } from 'avutil/struct/avpacket'\r\nimport { AVIFormatContext } from './AVFormatContext'\r\nimport * as object from 'common/util/object'\r\nimport * as array from 'common/util/array'\r\nimport { AV_MILLI_TIME_BASE_Q, NOPTS_VALUE_BIGINT } from 'avutil/constant'\r\nimport { AVPacketSideDataType, AVCodecID, AVMediaType } from 'avutil/codec'\r\nimport { AVFormat, AVSeekFlags } from './avformat'\r\nimport { checkStreamParameters } from './function/checkStreamParameters'\r\nimport { avRescaleQ } from 'avutil/util/rational'\r\nimport { copyAVPacketData, createAVPacket, destroyAVPacket,\r\n  hasAVPacketSideData, refAVPacket, unrefAVPacket\r\n} from 'avutil/util/avpacket'\r\nimport { IOFlags } from 'common/io/flags'\r\nimport { DURATION_MAX_READ_SIZE, SAMPLE_INDEX_STEP } from './config'\r\nimport * as errorType from 'avutil/error'\r\nimport AVStream from './AVStream'\r\nimport * as logger from 'common/util/logger'\r\nimport { IOError } from 'common/io/error'\r\nimport WasmVideoDecoder from 'avcodec/wasmcodec/VideoDecoder'\r\nimport WasmAudioDecoder from 'avcodec/wasmcodec/AudioDecoder'\r\nimport { destroyAVFrame } from 'avutil/util/avframe'\r\n\r\nexport interface DemuxOptions {\r\n  // 只分析流的必要参数（设置 true 将不会分析视频帧率和音频每帧采用点数等参数）\r\n  fastOpen?: boolean\r\n  // 最大流分析时长（毫秒）\r\n  maxAnalyzeDuration?: number\r\n}\r\n\r\nexport const DefaultDemuxOptions = {\r\n  fastOpen: false,\r\n  maxAnalyzeDuration: 1000\r\n}\r\n\r\n// @ts-ignore\r\n@deasync\r\nexport async function open(formatContext: AVIFormatContext, options: DemuxOptions = {}) {\r\n  const opts = object.extend({}, DefaultDemuxOptions, options)\r\n  if (!formatContext.ioReader) {\r\n    logger.fatal('need IOReader')\r\n  }\r\n  if (!formatContext.iformat) {\r\n    logger.fatal('need iformat')\r\n  }\r\n  if (formatContext.iformat.type === AVFormat.MPEGTS) {\r\n    // mpegts 的最小分析时长为 2 秒，mpegts 的 dts 一般从 1.4 秒开始\r\n    opts.maxAnalyzeDuration = Math.max(opts.maxAnalyzeDuration, 2000)\r\n  }\r\n  formatContext.iformat.init(formatContext)\r\n  formatContext.options = opts\r\n  return formatContext.iformat.readHeader(formatContext)\r\n}\r\n\r\n\r\n// @ts-ignore\r\n@deasync\r\nasync function estimateDurationFromPts(formatContext: AVIFormatContext) {\r\n  const fileSize = await formatContext.ioReader.fileSize()\r\n  if (fileSize <= 0n) {\r\n    return\r\n  }\r\n\r\n  const cache = formatContext.interval.packetBuffer\r\n  formatContext.interval.packetBuffer = []\r\n\r\n  let now = formatContext.ioReader.getPos()\r\n\r\n  let retry = 0\r\n  while (retry < 4) {\r\n    const pos = fileSize - static_cast<int64>(DURATION_MAX_READ_SIZE << retry)\r\n    const nextPos = await formatContext.iformat.seek(formatContext, null, pos, AVSeekFlags.BYTE)\r\n    if (nextPos > 0n) {\r\n      now = nextPos\r\n    }\r\n    const lastDurationMap: Record<number, int64> = {}\r\n\r\n    const avpacket = createAVPacket()\r\n\r\n    while (true) {\r\n      const ret = await readAVPacket(formatContext, avpacket)\r\n\r\n      if (ret < 0) {\r\n        break\r\n      }\r\n      else {\r\n        let duration = avpacket.pts\r\n        const stream = formatContext.getStreamByIndex(avpacket.streamIndex)\r\n        if (stream.startTime !== NOPTS_VALUE_BIGINT) {\r\n          duration -= stream.startTime\r\n        }\r\n        else {\r\n          duration -= stream.firstDTS\r\n        }\r\n\r\n        if (duration > 0n) {\r\n          if (stream.duration === NOPTS_VALUE_BIGINT\r\n            || !lastDurationMap[avpacket.streamIndex]\r\n            || (\r\n              stream.duration < duration\r\n              && Math.abs(Number(duration - stream.duration)) < 60 * stream.timeBase.den / stream.timeBase.num\r\n            )\r\n          ) {\r\n            stream.duration = duration\r\n          }\r\n          lastDurationMap[avpacket.streamIndex] = duration\r\n        }\r\n      }\r\n    }\r\n\r\n    destroyAVPacket(avpacket)\r\n\r\n    let hasDuration = true\r\n\r\n    array.each(formatContext.streams, (stream) => {\r\n      if (stream.duration === NOPTS_VALUE_BIGINT) {\r\n        hasDuration = false\r\n        return false\r\n      }\r\n    })\r\n\r\n    if (hasDuration) {\r\n      break\r\n    }\r\n    retry++\r\n  }\r\n\r\n  array.each(formatContext.interval.packetBuffer, (avpacket) => {\r\n    destroyAVPacket(avpacket)\r\n  })\r\n  formatContext.interval.packetBuffer = cache\r\n  await formatContext.iformat.seek(formatContext, null, now, AVSeekFlags.BYTE)\r\n}\r\n\r\n// @ts-ignore\r\n@deasync\r\nexport async function analyzeStreams(formatContext: AVIFormatContext) {\r\n  const needStreams = formatContext.iformat.getAnalyzeStreamsCount()\r\n  const streamFirstGotMap = {}\r\n  const streamDtsMap: Record<number, bigint[]> = {}\r\n  const streamBitMap: Record<number, number> = {}\r\n\r\n  let avpacket: pointer<AVPacket> = nullptr\r\n  const caches: pointer<AVPacket>[] = []\r\n  let ret = 0\r\n\r\n  const decoderMap: Record<number, WasmVideoDecoder | WasmAudioDecoder> = {}\r\n  const pictureGot: Record<number, boolean> = {}\r\n\r\n  function checkPictureGot() {\r\n    if (!formatContext.getDecoderResource) {\r\n      return true\r\n    }\r\n    for (let i = 0; i < formatContext.streams.length; i++) {\r\n      if (decoderMap[formatContext.streams[i].index] && !pictureGot[formatContext.streams[i].index]) {\r\n        return false\r\n      }\r\n    }\r\n    return true\r\n  }\r\n\r\n  while (true) {\r\n    if (formatContext.streams.length >= needStreams\r\n      && checkStreamParameters(formatContext)\r\n      && (formatContext.options as DemuxOptions).fastOpen\r\n      && checkPictureGot()\r\n    ) {\r\n      break\r\n    }\r\n\r\n    if (!avpacket) {\r\n      avpacket = createAVPacket()\r\n    }\r\n    let packetCached = false\r\n    ret = await readAVPacket(formatContext, avpacket)\r\n\r\n    if (ret !== 0) {\r\n      break\r\n    }\r\n\r\n    const stream = formatContext.getStreamByIndex(avpacket.streamIndex)\r\n\r\n    if (avpacket.size) {\r\n      packetCached = true\r\n      caches.push(avpacket)\r\n\r\n      if (!streamFirstGotMap[stream.index]) {\r\n        stream.firstDTS = avpacket.dts\r\n        stream.startTime = avpacket.pts\r\n        streamFirstGotMap[stream.index] = true\r\n      }\r\n\r\n      if (avpacket.pts < stream.startTime) {\r\n        stream.startTime = avpacket.pts\r\n      }\r\n\r\n      if (streamDtsMap[stream.index]) {\r\n        streamDtsMap[stream.index].push(avpacket.dts)\r\n      }\r\n      else {\r\n        streamDtsMap[stream.index] = [avpacket.dts]\r\n      }\r\n\r\n      if (streamBitMap[stream.index]) {\r\n        streamBitMap[stream.index] += avpacket.size\r\n      }\r\n      else {\r\n        streamBitMap[stream.index] = avpacket.size\r\n      }\r\n\r\n      if (!pictureGot[stream.index] && formatContext.getDecoderResource) {\r\n        let decoder = decoderMap[stream.index]\r\n        if (!decoder) {\r\n          const resource = await formatContext.getDecoderResource(stream.codecpar.codecType, stream.codecpar.codecId)\r\n          if (resource) {\r\n            if (stream.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_AUDIO) {\r\n              decoder = new WasmAudioDecoder({\r\n                resource,\r\n                onReceiveFrame: (avframe) => {\r\n                  stream.codecpar.format = avframe.format\r\n                  stream.codecpar.frameSize = avframe.nbSamples\r\n                  stream.codecpar.sampleRate = avframe.sampleRate\r\n                  stream.codecpar.chLayout = avframe.chLayout\r\n                  destroyAVFrame(avframe)\r\n                  pictureGot[stream.index] = true\r\n                },\r\n                onError: () => {\r\n                  pictureGot[stream.index] = true\r\n                }\r\n              })\r\n            }\r\n            else if (stream.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_VIDEO) {\r\n              if (resource.threadModule) {\r\n                delete resource.threadModule\r\n              }\r\n              decoder = new WasmVideoDecoder({\r\n                resource,\r\n                onReceiveFrame: (avframe) => {\r\n                  stream.codecpar.format = avframe.format\r\n                  stream.codecpar.colorSpace = avframe.colorSpace\r\n                  stream.codecpar.colorPrimaries = avframe.colorPrimaries\r\n                  stream.codecpar.colorTrc = avframe.colorTrc\r\n                  stream.codecpar.chromaLocation = avframe.chromaLocation\r\n                  stream.codecpar.sampleAspectRatio = avframe.sampleAspectRatio\r\n                  stream.codecpar.width = avframe.width\r\n                  stream.codecpar.height = avframe.height\r\n                  destroyAVFrame(avframe)\r\n                  pictureGot[stream.index] = true\r\n                },\r\n                onError: () => {\r\n                  pictureGot[stream.index] = true\r\n                }\r\n              })\r\n            }\r\n            await decoder.open(addressof(stream.codecpar))\r\n            decoderMap[stream.index] = decoder\r\n          }\r\n        }\r\n        if (decoder) {\r\n          decoder.decode(avpacket)\r\n        }\r\n      }\r\n    }\r\n\r\n    if (streamDtsMap[stream.index] && streamDtsMap[stream.index].length === 12) {\r\n      let count = 0n\r\n      for (let i = 1; i < streamDtsMap[stream.index].length; i++) {\r\n        count += streamDtsMap[stream.index][i] - streamDtsMap[stream.index][i - 1]\r\n      }\r\n      let value = Number(count) / (streamDtsMap[stream.index].length - 1)\r\n\r\n      if (stream.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_AUDIO\r\n        && stream.codecpar.sampleRate > 0\r\n      ) {\r\n        stream.codecpar.frameSize = Math.round(value / stream.timeBase.den * stream.timeBase.num * stream.codecpar.sampleRate)\r\n      }\r\n      else if (stream.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_VIDEO) {\r\n        const framerate = stream.timeBase.den * stream.timeBase.num / value\r\n        stream.codecpar.framerate.num = Math.round(framerate)\r\n        stream.codecpar.framerate.den = 1\r\n      }\r\n      const duration = Number(avpacket.dts - stream.firstDTS) * stream.timeBase.num / stream.timeBase.den\r\n\r\n      if (duration) {\r\n        stream.codecpar.bitrate = static_cast<int64>(streamBitMap[stream.index] * 8 / duration)\r\n      }\r\n    }\r\n\r\n    if ((avpacket.dts - stream.startTime) > avRescaleQ(\r\n      static_cast<int64>((formatContext.options as DemuxOptions).maxAnalyzeDuration),\r\n      AV_MILLI_TIME_BASE_Q,\r\n      stream.timeBase\r\n    )\r\n    ) {\r\n      object.each(streamDtsMap, (list, id) => {\r\n        const stream = formatContext.getStreamByIndex(+id)\r\n        if (list && list.length > 1) {\r\n          let count = 0n\r\n          for (let i = 1; i < list.length; i++) {\r\n            count += list[i] - list[i - 1]\r\n          }\r\n          let value = Number(count) / (streamDtsMap[stream.index].length - 1)\r\n\r\n          if (stream.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_AUDIO\r\n            && stream.codecpar.sampleRate > 0\r\n          ) {\r\n            stream.codecpar.frameSize = Math.round(value / stream.timeBase.den * stream.timeBase.num * stream.codecpar.sampleRate)\r\n          }\r\n          else if (stream.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_VIDEO) {\r\n            const framerate = stream.timeBase.den * stream.timeBase.num / value\r\n            stream.codecpar.framerate.num = Math.round(framerate)\r\n            stream.codecpar.framerate.den = 1\r\n          }\r\n          const duration = Number(avpacket.dts - stream.firstDTS) * stream.timeBase.num / stream.timeBase.den\r\n          if (duration) {\r\n            stream.codecpar.bitrate = static_cast<int64>(streamBitMap[stream.index] * 8 / duration)\r\n          }\r\n        }\r\n      })\r\n      if (packetCached) {\r\n        avpacket = nullptr\r\n      }\r\n      break\r\n    }\r\n    if (packetCached) {\r\n      avpacket = nullptr\r\n    }\r\n  }\r\n\r\n  if (avpacket) {\r\n    destroyAVPacket(avpacket)\r\n  }\r\n  if (caches.length) {\r\n    formatContext.interval.packetBuffer = caches.concat(formatContext.interval.packetBuffer)\r\n  }\r\n\r\n  object.each(decoderMap, (decoder) => {\r\n    if (decoder) {\r\n      decoder.close()\r\n    }\r\n  })\r\n\r\n  if (ret === IOError.END) {\r\n    return 0\r\n  }\r\n  else if (ret !== 0) {\r\n    return ret\r\n  }\r\n\r\n  if ((formatContext.iformat.type === AVFormat.MPEGTS)\r\n    && (formatContext.ioReader.flags & IOFlags.SEEKABLE)\r\n  ) {\r\n    await estimateDurationFromPts(formatContext)\r\n  }\r\n  return 0\r\n}\r\n\r\nfunction addSample(stream: AVStream, avpacket: pointer<AVPacket>) {\r\n  const index = array.binarySearch(stream.sampleIndexes, (sample) => {\r\n    if (sample.pts < avpacket.pts) {\r\n      return 1\r\n    }\r\n    else {\r\n      return -1\r\n    }\r\n  })\r\n  const sample = {\r\n    dts: avpacket.dts,\r\n    pts: avpacket.pts,\r\n    pos: avpacket.pos,\r\n    size: avpacket.size,\r\n    duration: avpacket.duration,\r\n    flags: avpacket.flags\r\n  }\r\n  if (index > -1) {\r\n    stream.sampleIndexesPosMap.set(avpacket.pos, index)\r\n    stream.sampleIndexes.splice(index, 0, sample)\r\n  }\r\n  else {\r\n    stream.sampleIndexesPosMap.set(avpacket.pos, stream.sampleIndexes.length)\r\n    stream.sampleIndexes.push(sample)\r\n  }\r\n}\r\n\r\n// @ts-ignore\r\n@deasync\r\nasync function packetNeedRead(formatContext: AVIFormatContext, avpacket: pointer<AVPacket>) {\r\n  const stream = formatContext.getStreamByIndex(avpacket.streamIndex)\r\n  let ret = 0\r\n  // h264 hevc aac 解析到 extradata，继续\r\n  if (stream\r\n    && (stream.codecpar.codecId === AVCodecID.AV_CODEC_ID_H264\r\n      || stream.codecpar.codecId === AVCodecID.AV_CODEC_ID_HEVC\r\n      || stream.codecpar.codecId === AVCodecID.AV_CODEC_ID_VVC\r\n      || stream.codecpar.codecId === AVCodecID.AV_CODEC_ID_AAC\r\n    )\r\n  ) {\r\n    if (!avpacket.size\r\n      && hasAVPacketSideData(avpacket, AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA)\r\n    ) {\r\n      while (1) {\r\n        const tmpPacket = createAVPacket()\r\n        ret = await formatContext.iformat.readAVPacket(formatContext, tmpPacket)\r\n        if (ret !== 0) {\r\n          if (formatContext.interval.packetBuffer.length) {\r\n            let cache = formatContext.interval.packetBuffer.shift()\r\n            unrefAVPacket(avpacket)\r\n            refAVPacket(avpacket, cache)\r\n            destroyAVPacket(cache)\r\n            return packetNeedRead(formatContext, avpacket)\r\n          }\r\n          return ret\r\n        }\r\n        if (tmpPacket.streamIndex === avpacket.streamIndex) {\r\n          if (tmpPacket.size) {\r\n            copyAVPacketData(avpacket, tmpPacket)\r\n            destroyAVPacket(tmpPacket)\r\n            return 0\r\n          }\r\n          else {\r\n            unrefAVPacket(avpacket)\r\n            refAVPacket(avpacket, tmpPacket)\r\n            destroyAVPacket(tmpPacket)\r\n            continue\r\n          }\r\n        }\r\n        else {\r\n          formatContext.interval.packetBuffer.push(tmpPacket)\r\n        }\r\n      }\r\n    }\r\n    else if (avpacket.flags & AVPacketFlags.AV_PKT_FLAG_END) {\r\n      return readAVPacket(formatContext, avpacket)\r\n    }\r\n  }\r\n  if (formatContext.ioReader.flags & IOFlags.SEEKABLE) {\r\n    if (!stream.sampleIndexesPosMap.has(avpacket.pos)) {\r\n      if (stream.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_VIDEO) {\r\n        if (avpacket.flags & AVPacketFlags.AV_PKT_FLAG_KEY) {\r\n          addSample(stream, avpacket)\r\n        }\r\n      }\r\n      else if (stream.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_AUDIO) {\r\n        const index = array.binarySearch(stream.sampleIndexes, (sample) => {\r\n          if (sample.pts < avpacket.pts) {\r\n            return 1\r\n          }\r\n          else {\r\n            return -1\r\n          }\r\n        })\r\n\r\n        if (!stream.sampleIndexes.length\r\n          || (index < 0\r\n            && avRescaleQ(\r\n              avpacket.pts - stream.sampleIndexes[stream.sampleIndexes.length - 1].pts,\r\n              avpacket.timeBase,\r\n              AV_MILLI_TIME_BASE_Q\r\n            ) >= SAMPLE_INDEX_STEP\r\n          )\r\n          || (index > 0\r\n            && index < stream.sampleIndexes.length - 1\r\n            && avRescaleQ(\r\n              avpacket.pts - stream.sampleIndexes[index - 1].pts,\r\n              avpacket.timeBase,\r\n              AV_MILLI_TIME_BASE_Q\r\n            ) >= SAMPLE_INDEX_STEP\r\n          )\r\n          || (index === 0\r\n            && avRescaleQ(\r\n              stream.sampleIndexes[0].pts - avpacket.pts,\r\n              avpacket.timeBase,\r\n              AV_MILLI_TIME_BASE_Q\r\n            ) >= SAMPLE_INDEX_STEP\r\n          )\r\n        ) {\r\n          addSample(stream, avpacket)\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return 0\r\n}\r\n\r\n// @ts-ignore\r\n@deasync\r\nexport async function readAVPacket(formatContext: AVIFormatContext, avpacket: pointer<AVPacket>) {\r\n  let ret = 0\r\n  unrefAVPacket(avpacket)\r\n  if (formatContext.interval.packetBuffer.length) {\r\n    const cache = formatContext.interval.packetBuffer.shift()\r\n    refAVPacket(avpacket, cache)\r\n    destroyAVPacket(cache)\r\n    return packetNeedRead(formatContext, avpacket)\r\n  }\r\n\r\n  ret = await formatContext.iformat.readAVPacket(formatContext, avpacket)\r\n\r\n  if (ret !== 0) {\r\n    unrefAVPacket(avpacket)\r\n    return ret\r\n  }\r\n  return packetNeedRead(formatContext, avpacket)\r\n}\r\n\r\n// @ts-ignore\r\n@deasync\r\nexport async function seek(formatContext: AVIFormatContext, streamIndex: number, timestamp: int64, flags: int32): Promise<int64> {\r\n\r\n  let stream = streamIndex > -1 ? formatContext.streams.find((stream) => stream.index === streamIndex) : null\r\n\r\n  if (!stream) {\r\n    stream = formatContext.getStreamByMediaType(AVMediaType.AVMEDIA_TYPE_VIDEO)\r\n    if (!stream) {\r\n      stream = formatContext.getStreamByMediaType(AVMediaType.AVMEDIA_TYPE_AUDIO)\r\n    }\r\n    if (!stream) {\r\n      stream = formatContext.getStreamByMediaType(AVMediaType.AVMEDIA_TYPE_SUBTITLE)\r\n    }\r\n  }\r\n\r\n  if (!stream) {\r\n    logger.error(`not found any stream to seek, streamIndex: ${stream.index}`)\r\n    return static_cast<int64>(errorType.DATA_INVALID)\r\n  }\r\n\r\n  logger.debug(`seek in ${stream.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_VIDEO\r\n    ? 'video'\r\n    : 'audio'\r\n  } stream, streamIndex: ${stream.index}, timestamp: ${timestamp}, flags: ${flags}`)\r\n\r\n  timestamp = avRescaleQ(timestamp, AV_MILLI_TIME_BASE_Q, stream.timeBase)\r\n\r\n  const ret = await formatContext.iformat.seek(formatContext, stream, timestamp, flags)\r\n\r\n  if (ret >= 0n) {\r\n    array.each(formatContext.interval.packetBuffer, (avpacket) => {\r\n      destroyAVPacket(avpacket)\r\n    })\r\n    formatContext.interval.packetBuffer.length = 0\r\n    return 0n\r\n  }\r\n\r\n  return ret\r\n}\r\n","import { AVFormatContext, AVFormatContextInterface, AVIFormatContext, AVOFormatContext } from './AVFormatContext'\r\nimport { AVDisposition, AVStreamInterface } from './AVStream'\r\nimport * as object from 'common/util/object'\r\nimport * as stringEnum from 'avutil/stringEnum'\r\nimport * as is from 'common/util/is'\r\nimport { avQ2D, avReduce, avRescaleQ } from 'avutil/util/rational'\r\nimport { AV_MILLI_TIME_BASE_Q, NOPTS_VALUE } from 'avutil/constant'\r\nimport * as string from 'common/util/string'\r\nimport toString from 'common/function/toString'\r\nimport { AVCodecID, AVMediaType } from 'avutil/codec'\r\n\r\nimport * as aac from './codecs/aac'\r\nimport * as opus from './codecs/opus'\r\nimport * as h264 from './codecs/h264'\r\nimport * as hevc from './codecs/hevc'\r\nimport * as vvc from './codecs/vvc'\r\nimport * as av1 from './codecs/av1'\r\nimport * as vp9 from './codecs/vp9'\r\nimport * as mp3 from './codecs/mp3'\r\nimport { AVFormat } from './avformat'\r\n\r\nexport interface DumpIOInfo {\r\n  from: string\r\n  tag: 'Input' | 'Output'\r\n}\r\n\r\nexport function dumpTime(time: int64) {\r\n  if (time < 0) {\r\n    time = 0n\r\n  }\r\n  const ms = static_cast<int32>(time % 1000n)\r\n  const secs = static_cast<int32>(time / 1000n % 60n)\r\n  const mins = static_cast<int32>(time / 1000n / 60n % 60n)\r\n  const hours = static_cast<int32>(time / 1000n / 3600n)\r\n  return string.format('%02d:%02d:%02d.%03d', hours, mins, secs, ms)\r\n}\r\n\r\nexport function dumpInt64(v: int64) {\r\n  if (v < 10000n) {\r\n    return toString(static_cast<int32>(v))\r\n  }\r\n  return static_cast<int32>(v / 1000n) + 'k'\r\n}\r\n\r\nexport function dumpBitrate(v: int64) {\r\n  if (v < 10000n) {\r\n    return toString(static_cast<int32>(v)) + ' bps/s'\r\n  }\r\n  return static_cast<int32>(v / 1000n) + ' kbps/s'\r\n}\r\n\r\nexport function dumpKey<T>(obj: Record<string, T>, value: T, defaultValue: string = 'unknown') {\r\n  let name = defaultValue\r\n  object.each(obj, (v, k) => {\r\n    if (value === v) {\r\n      name = k\r\n      return false\r\n    }\r\n  })\r\n  return name\r\n}\r\n\r\nexport function dumpCodecName(codecType: AVMediaType, codecId: AVCodecID) {\r\n  if (codecType === AVMediaType.AVMEDIA_TYPE_AUDIO) {\r\n    return dumpKey(stringEnum.AudioCodecString2CodecId, codecId)\r\n  }\r\n  else if (codecType === AVMediaType.AVMEDIA_TYPE_VIDEO) {\r\n    return dumpKey(stringEnum.VideoCodecString2CodecId, codecId)\r\n  }\r\n  else if (codecType === AVMediaType.AVMEDIA_TYPE_SUBTITLE) {\r\n    return dumpKey(stringEnum.SubtitleCodecString2CodecId, codecId)\r\n  }\r\n  return 'unknown'\r\n}\r\n\r\nexport function dumpFormatName(format: AVFormat) {\r\n  return dumpKey(stringEnum.Format2AVFormat, format)\r\n}\r\n\r\nexport function dumpProfileName(codecId: AVCodecID, profile: int32) {\r\n  switch (codecId) {\r\n    case AVCodecID.AV_CODEC_ID_AAC:\r\n      return aac.AACProfile2Name[profile] || 'LC'\r\n    case AVCodecID.AV_CODEC_ID_MP3:\r\n      return mp3.MP3Profile2Name[profile] || 'Layer3'\r\n    case AVCodecID.AV_CODEC_ID_H264:\r\n      return h264.H264Profile2Name[profile] || 'High'\r\n    case AVCodecID.AV_CODEC_ID_HEVC:\r\n      return hevc.HEVCProfile2Name[profile] || 'Main'\r\n    case AVCodecID.AV_CODEC_ID_AV1:\r\n      return av1.AV1Profile2Name[profile] || 'Main'\r\n    case AVCodecID.AV_CODEC_ID_VP9:\r\n      return vp9.VP9Profile2Name[profile] || 'Profile0'\r\n  }\r\n}\r\n\r\nexport function dumpAVStreamInterface(stream: AVStreamInterface, index: number, prefix: string) {\r\n  const mediaType = dumpKey(stringEnum.mediaType2AVMediaType, stream.codecpar.codecType)\r\n\r\n  const list = []\r\n\r\n  if (stream.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_AUDIO) {\r\n    const profileName = dumpProfileName(stream.codecpar.codecId, stream.codecpar.profile)\r\n    const codecName = dumpKey(stringEnum.AudioCodecString2CodecId, stream.codecpar.codecId)\r\n    list.push(`${codecName}${profileName ? ` (${profileName})` : ''}`)\r\n\r\n    list.push(`${stream.codecpar.sampleRate} Hz`)\r\n    let channel = `${stream.codecpar.chLayout.nbChannels} channels`\r\n    if (stream.codecpar.chLayout.nbChannels === 1) {\r\n      channel = 'mono'\r\n    }\r\n    else if (stream.codecpar.chLayout.nbChannels === 2) {\r\n      channel = 'stereo'\r\n    }\r\n    list.push(channel)\r\n    list.push(dumpKey(stringEnum.SampleFmtString2SampleFormat, stream.codecpar.format))\r\n    if (stream.codecpar.bitrate > 0n) {\r\n      list.push(`${dumpBitrate(stream.codecpar.bitrate)}`)\r\n    }\r\n  }\r\n  else if (stream.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_VIDEO) {\r\n    const profileName = dumpProfileName(stream.codecpar.codecId, stream.codecpar.profile)\r\n    const codecName = dumpKey(stringEnum.VideoCodecString2CodecId, stream.codecpar.codecId)\r\n    list.push(`${codecName}${profileName ? ` (${profileName})` : ''}`)\r\n\r\n    if (stream.codecpar.format !== NOPTS_VALUE) {\r\n      const pixfmt = dumpKey(stringEnum.PixfmtString2AVPixelFormat, stream.codecpar.format)\r\n      const range = dumpKey(stringEnum.colorRange2AVColorRange, stream.codecpar.colorRange, 'tv')\r\n      const space = dumpKey(stringEnum.colorSpace2AVColorSpace, stream.codecpar.colorSpace, 'bt709')\r\n      list.push(`${pixfmt}(${range}, ${space})`)\r\n    }\r\n\r\n    const dar = {\r\n      num: stream.codecpar.width * stream.codecpar.sampleAspectRatio.num,\r\n      den: stream.codecpar.height * stream.codecpar.sampleAspectRatio.den\r\n    }\r\n    avReduce(dar)\r\n\r\n    list.push(`${stream.codecpar.width}x${stream.codecpar.height} [SAR: ${stream.codecpar.sampleAspectRatio.num}:${stream.codecpar.sampleAspectRatio.den} DAR ${dar.num}:${dar.den}]`)\r\n\r\n    if (stream.codecpar.bitrate > 0n) {\r\n      list.push(`${dumpBitrate(stream.codecpar.bitrate)}`)\r\n    }\r\n    if (avQ2D(stream.codecpar.framerate) > 0) {\r\n      list.push(`${avQ2D(stream.codecpar.framerate).toFixed(2)} fps`)\r\n      list.push(`${avQ2D(stream.codecpar.framerate).toFixed(2)} tbr`)\r\n    }\r\n    list.push(`${dumpInt64(static_cast<int64>(avQ2D({\r\n      num: stream.timeBase.den,\r\n      den: stream.timeBase.num\r\n    })))} tbn`)\r\n\r\n\r\n  }\r\n  else if (stream.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_SUBTITLE) {\r\n    const codecName = dumpKey(stringEnum.SubtitleCodecString2CodecId, stream.codecpar.codecId)\r\n    list.push(codecName)\r\n    if (stream.codecpar.bitrate > 0n) {\r\n      list.push(`${dumpBitrate(stream.codecpar.bitrate)}`)\r\n    }\r\n  }\r\n  else {\r\n    if (stream.codecpar.bitrate > 0n) {\r\n      list.push(`${dumpBitrate(stream.codecpar.bitrate)}`)\r\n    }\r\n  }\r\n\r\n  let disposition = ''\r\n  if (stream.disposition) {\r\n    disposition = ' '\r\n    if (stream.disposition & AVDisposition.DEFAULT) {\r\n      disposition += `(${dumpKey(stringEnum.disposition2AVDisposition, AVDisposition.DEFAULT)}) `\r\n    }\r\n    if (stream.disposition & AVDisposition.DUB) {\r\n      disposition += `(${dumpKey(stringEnum.disposition2AVDisposition, AVDisposition.DUB)}) `\r\n    }\r\n    if (stream.disposition & AVDisposition.ORIGINAL) {\r\n      disposition += `(${dumpKey(stringEnum.disposition2AVDisposition, AVDisposition.ORIGINAL)}) `\r\n    }\r\n    if (stream.disposition & AVDisposition.COMMENT) {\r\n      disposition += `(${dumpKey(stringEnum.disposition2AVDisposition, AVDisposition.COMMENT)}) `\r\n    }\r\n    if (stream.disposition & AVDisposition.LYRICS) {\r\n      disposition += `(${dumpKey(stringEnum.disposition2AVDisposition, AVDisposition.LYRICS)}) `\r\n    }\r\n    if (stream.disposition & AVDisposition.KARAOKE) {\r\n      disposition += `(${dumpKey(stringEnum.disposition2AVDisposition, AVDisposition.KARAOKE)}) `\r\n    }\r\n    if (stream.disposition & AVDisposition.FORCED) {\r\n      disposition += `(${dumpKey(stringEnum.disposition2AVDisposition, AVDisposition.FORCED)}) `\r\n    }\r\n    if (stream.disposition & AVDisposition.HEARING_IMPAIRED) {\r\n      disposition += `(${dumpKey(stringEnum.disposition2AVDisposition, AVDisposition.HEARING_IMPAIRED)}) `\r\n    }\r\n    if (stream.disposition & AVDisposition.VISUAL_IMPAIRED) {\r\n      disposition += `(${dumpKey(stringEnum.disposition2AVDisposition, AVDisposition.VISUAL_IMPAIRED)}) `\r\n    }\r\n    if (stream.disposition & AVDisposition.CLEAN_EFFECTS) {\r\n      disposition += `(${dumpKey(stringEnum.disposition2AVDisposition, AVDisposition.CLEAN_EFFECTS)}) `\r\n    }\r\n    if (stream.disposition & AVDisposition.ATTACHED_PIC) {\r\n      disposition += `(${dumpKey(stringEnum.disposition2AVDisposition, AVDisposition.ATTACHED_PIC)}) `\r\n    }\r\n    if (stream.disposition & AVDisposition.TIMED_THUMBNAILS) {\r\n      disposition += `(${dumpKey(stringEnum.disposition2AVDisposition, AVDisposition.TIMED_THUMBNAILS)}) `\r\n    }\r\n    if (stream.disposition & AVDisposition.CAPTIONS) {\r\n      disposition += `(${dumpKey(stringEnum.disposition2AVDisposition, AVDisposition.CAPTIONS)}) `\r\n    }\r\n    if (stream.disposition & AVDisposition.DESCRIPTIONS) {\r\n      disposition += `(${dumpKey(stringEnum.disposition2AVDisposition, AVDisposition.DESCRIPTIONS)}) `\r\n    }\r\n    if (stream.disposition & AVDisposition.METADATA) {\r\n      disposition += `(${dumpKey(stringEnum.disposition2AVDisposition, AVDisposition.METADATA)}) `\r\n    }\r\n    if (stream.disposition & AVDisposition.DEPENDENT) {\r\n      disposition += `(${dumpKey(stringEnum.disposition2AVDisposition, AVDisposition.DEPENDENT)}) `\r\n    }\r\n    if (stream.disposition & AVDisposition.STILL_IMAGE) {\r\n      disposition += `(${dumpKey(stringEnum.disposition2AVDisposition, AVDisposition.STILL_IMAGE)}) `\r\n    }\r\n  }\r\n\r\n  let dump = `${prefix}Stream #${index}:${stream.index} ${mediaType}: ${list.join(', ')}${disposition}\\n`\r\n\r\n  if (Object.keys(stream.metadata).length) {\r\n    dump += `${prefix}  Metadata:\\n`\r\n    object.each(stream.metadata, (value, key) => {\r\n      if (!is.object(value) && !is.array(value)) {\r\n        dump += `${prefix}    ${key}: ${value}\\n`\r\n      }\r\n    })\r\n  }\r\n\r\n  return dump\r\n}\r\n\r\nexport function dumpAVFormatContextInterface(formatContext: AVFormatContextInterface, index: number, input: DumpIOInfo) {\r\n  let dump = `${input.tag} #${index}, ${dumpKey(stringEnum.Format2AVFormat, formatContext.format)}, from '${input.from}':\\n`\r\n  if (Object.keys(formatContext.metadata).length) {\r\n    dump += '  Metadata:\\n'\r\n    object.each(formatContext.metadata, (value, key) => {\r\n      if (!is.object(value) || !is.array(value)) {\r\n        dump += `    ${key}: ${value}\\n`\r\n      }\r\n    })\r\n  }\r\n\r\n  let duration = 0n\r\n  let bitrate = 0n\r\n  let start = -1n\r\n\r\n  formatContext.streams.forEach((stream) => {\r\n    const d = avRescaleQ(stream.duration, stream.timeBase, AV_MILLI_TIME_BASE_Q)\r\n    const s = avRescaleQ(stream.startTime, stream.timeBase, AV_MILLI_TIME_BASE_Q)\r\n\r\n    if (d > duration) {\r\n      duration = d\r\n    }\r\n    if (s < start || start === -1n) {\r\n      start = s\r\n    }\r\n    bitrate += stream.codecpar.bitrate\r\n  })\r\n\r\n  dump += `  Duration: ${dumpTime(duration)}, start: ${dumpTime(start)}, bitrate: ${dumpBitrate(bitrate)}\\n`\r\n  formatContext.streams.forEach((stream, i) => {\r\n    dump += dumpAVStreamInterface(stream, index, '  ')\r\n  })\r\n  return dump\r\n}\r\n\r\nexport default function dump(formatContexts: (AVFormatContextInterface | AVIFormatContext | AVOFormatContext)[], inputs: DumpIOInfo[]) {\r\n  let dump = ''\r\n  formatContexts.forEach((formatContext, index) => {\r\n    if (formatContext instanceof AVFormatContext) {\r\n      const streams: AVStreamInterface[] = []\r\n      for (let i = 0; i < formatContext.streams.length; i++) {\r\n        const stream = formatContext.streams[i]\r\n        streams.push({\r\n          index: stream.index,\r\n          id: stream.id,\r\n          codecpar: addressof(stream.codecpar),\r\n          nbFrames: stream.nbFrames,\r\n          metadata: stream.metadata,\r\n          duration: stream.duration,\r\n          startTime: stream.startTime,\r\n          disposition: stream.disposition,\r\n          timeBase: stream.timeBase\r\n        })\r\n      }\r\n      formatContext = {\r\n        metadata: formatContext.metadata,\r\n        format: formatContext.format,\r\n        chapters: formatContext.chapters,\r\n        streams\r\n      }\r\n    }\r\n    dump += dumpAVFormatContextInterface(formatContext as AVFormatContextInterface, index, inputs[index])\r\n  })\r\n  return dump\r\n}\r\n","/*\r\n * libmedia abstract format encoder\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVCodecID } from 'avutil/codec'\r\nimport { AVFormat } from '../avformat'\r\nimport { AVOFormatContext } from '../AVFormatContext'\r\nimport AVPacket from 'avutil/struct/avpacket'\r\n\r\nexport default abstract class OFormat {\r\n\r\n  public type: AVFormat = AVFormat.UNKNOWN\r\n\r\n  public abstract init(formatContext: AVOFormatContext): number\r\n\r\n  public destroy(formatContext: AVOFormatContext): void {}\r\n\r\n  public abstract writeHeader(formatContext: AVOFormatContext): number\r\n\r\n  public abstract writeAVPacket(formatContext: AVOFormatContext, avpacket: pointer<AVPacket>): number\r\n\r\n  public abstract flush(formatContext: AVOFormatContext): number\r\n\r\n  public abstract writeTrailer(formatContext: AVOFormatContext): number\r\n\r\n}\r\n\r\nexport const OFormatSupportedCodecs: Record<Exclude<AVFormat, AVFormat.UNKNOWN>, AVCodecID[]> = {\r\n  [AVFormat.AAC]: [AVCodecID.AV_CODEC_ID_AAC],\r\n  [AVFormat.AVI]: [\r\n    AVCodecID.AV_CODEC_ID_MP3,\r\n    AVCodecID.AV_CODEC_ID_AC3,\r\n    AVCodecID.AV_CODEC_ID_AAC,\r\n\r\n    AVCodecID.AV_CODEC_ID_MPEG4,\r\n    AVCodecID.AV_CODEC_ID_H264\r\n  ],\r\n  [AVFormat.FLAC]: [AVCodecID.AV_CODEC_ID_FLAC],\r\n  [AVFormat.FLV]: [\r\n    AVCodecID.AV_CODEC_ID_MP3,\r\n    AVCodecID.AV_CODEC_ID_AAC,\r\n    AVCodecID.AV_CODEC_ID_SPEEX,\r\n    AVCodecID.AV_CODEC_ID_ADPCM_SWF,\r\n    AVCodecID.AV_CODEC_ID_NELLYMOSER,\r\n    AVCodecID.AV_CODEC_ID_PCM_ALAW,\r\n    AVCodecID.AV_CODEC_ID_PCM_MULAW,\r\n\r\n    AVCodecID.AV_CODEC_ID_MPEG4,\r\n    AVCodecID.AV_CODEC_ID_H264,\r\n    AVCodecID.AV_CODEC_ID_HEVC,\r\n    AVCodecID.AV_CODEC_ID_AV1,\r\n    AVCodecID.AV_CODEC_ID_VP9,\r\n    AVCodecID.AV_CODEC_ID_VVC\r\n  ],\r\n  [AVFormat.IVF]: [AVCodecID.AV_CODEC_ID_VP8, AVCodecID.AV_CODEC_ID_VP9],\r\n  [AVFormat.MATROSKA]: [\r\n    AVCodecID.AV_CODEC_ID_VORBIS,\r\n    AVCodecID.AV_CODEC_ID_OPUS,\r\n    AVCodecID.AV_CODEC_ID_AAC,\r\n    AVCodecID.AV_CODEC_ID_MP3,\r\n    AVCodecID.AV_CODEC_ID_FLAC,\r\n    AVCodecID.AV_CODEC_ID_ALAC,\r\n    AVCodecID.AV_CODEC_ID_DTS,\r\n    AVCodecID.AV_CODEC_ID_EAC3,\r\n    AVCodecID.AV_CODEC_ID_PCM_F32LE,\r\n    AVCodecID.AV_CODEC_ID_PCM_S16BE,\r\n    AVCodecID.AV_CODEC_ID_PCM_S16LE,\r\n\r\n    AVCodecID.AV_CODEC_ID_VP8,\r\n    AVCodecID.AV_CODEC_ID_VP9,\r\n    AVCodecID.AV_CODEC_ID_AV1,\r\n    AVCodecID.AV_CODEC_ID_H264,\r\n    AVCodecID.AV_CODEC_ID_HEVC,\r\n    AVCodecID.AV_CODEC_ID_VVC,\r\n    AVCodecID.AV_CODEC_ID_MPEG4,\r\n    AVCodecID.AV_CODEC_ID_THEORA,\r\n\r\n    AVCodecID.AV_CODEC_ID_WEBVTT\r\n  ],\r\n  [AVFormat.WEBM]: [\r\n    AVCodecID.AV_CODEC_ID_VORBIS,\r\n    AVCodecID.AV_CODEC_ID_OPUS,\r\n\r\n    AVCodecID.AV_CODEC_ID_VP8,\r\n    AVCodecID.AV_CODEC_ID_VP9,\r\n    AVCodecID.AV_CODEC_ID_AV1,\r\n\r\n    AVCodecID.AV_CODEC_ID_WEBVTT\r\n  ],\r\n  [AVFormat.MOV]: [\r\n    AVCodecID.AV_CODEC_ID_VORBIS,\r\n    AVCodecID.AV_CODEC_ID_OPUS,\r\n    AVCodecID.AV_CODEC_ID_AAC,\r\n    AVCodecID.AV_CODEC_ID_MP3,\r\n    AVCodecID.AV_CODEC_ID_FLAC,\r\n    AVCodecID.AV_CODEC_ID_SPEEX,\r\n    AVCodecID.AV_CODEC_ID_AC3,\r\n    AVCodecID.AV_CODEC_ID_EAC3,\r\n\r\n    AVCodecID.AV_CODEC_ID_VP9,\r\n    AVCodecID.AV_CODEC_ID_AV1,\r\n    AVCodecID.AV_CODEC_ID_H264,\r\n    AVCodecID.AV_CODEC_ID_HEVC,\r\n    AVCodecID.AV_CODEC_ID_VVC,\r\n    AVCodecID.AV_CODEC_ID_MPEG4,\r\n\r\n    AVCodecID.AV_CODEC_ID_WEBVTT,\r\n    AVCodecID.AV_CODEC_ID_MOV_TEXT\r\n  ],\r\n  [AVFormat.MP3]: [AVCodecID.AV_CODEC_ID_MP3],\r\n  [AVFormat.MPEGTS]: [\r\n    AVCodecID.AV_CODEC_ID_OPUS,\r\n    AVCodecID.AV_CODEC_ID_AAC,\r\n    AVCodecID.AV_CODEC_ID_MP3,\r\n    AVCodecID.AV_CODEC_ID_AC3,,\r\n    AVCodecID.AV_CODEC_ID_DTS,\r\n    AVCodecID.AV_CODEC_ID_AAC_LATM,\r\n    AVCodecID.AV_CODEC_ID_EAC3,\r\n\r\n    AVCodecID.AV_CODEC_ID_MPEG4,\r\n    AVCodecID.AV_CODEC_ID_AV1,\r\n    AVCodecID.AV_CODEC_ID_H264,\r\n    AVCodecID.AV_CODEC_ID_HEVC,\r\n    AVCodecID.AV_CODEC_ID_VVC\r\n  ],\r\n  [AVFormat.MPEGPS]: [\r\n    AVCodecID.AV_CODEC_ID_MP1,\r\n    AVCodecID.AV_CODEC_ID_MP2,\r\n    AVCodecID.AV_CODEC_ID_MP3,\r\n    AVCodecID.AV_CODEC_ID_AC3,,\r\n    AVCodecID.AV_CODEC_ID_DTS,\r\n\r\n    AVCodecID.AV_CODEC_ID_MPEG2VIDEO,\r\n    AVCodecID.AV_CODEC_ID_MPEG4,\r\n    AVCodecID.AV_CODEC_ID_H264,\r\n    AVCodecID.AV_CODEC_ID_HEVC,\r\n    AVCodecID.AV_CODEC_ID_VVC\r\n  ],\r\n  [AVFormat.OGG]: [\r\n    AVCodecID.AV_CODEC_ID_VORBIS,\r\n    AVCodecID.AV_CODEC_ID_OPUS,\r\n    AVCodecID.AV_CODEC_ID_FLAC,\r\n    AVCodecID.AV_CODEC_ID_SPEEX\r\n  ],\r\n  [AVFormat.WAV]: [],\r\n  [AVFormat.WEBVTT]: [AVCodecID.AV_CODEC_ID_WEBVTT],\r\n  [AVFormat.ASS]: [AVCodecID.AV_CODEC_ID_ASS, AVCodecID.AV_CODEC_ID_SSA],\r\n  [AVFormat.SUBRIP]: [AVCodecID.AV_CODEC_ID_SUBRIP],\r\n  [AVFormat.TTML]: [AVCodecID.AV_CODEC_ID_TTML],\r\n  [AVFormat.H264]: [AVCodecID.AV_CODEC_ID_H264],\r\n  [AVFormat.HEVC]: [AVCodecID.AV_CODEC_ID_HEVC],\r\n  [AVFormat.VVC]: [AVCodecID.AV_CODEC_ID_VVC]\r\n}\r\n","/*\r\n * libmedia check stream parameters\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVIFormatContext, AVOFormatContext } from '../AVFormatContext'\r\nimport {  NOPTS_VALUE } from 'avutil/constant'\r\nimport { AVCodecID, AVMediaType } from 'avutil/codec'\r\nimport * as array from 'common/util/array'\r\nimport { avQ2D } from 'avutil/util/rational'\r\n\r\nexport function checkStreamParameters(context: AVIFormatContext | AVOFormatContext) {\r\n  let result = true\r\n  array.each(context.streams, (stream) => {\r\n    switch (stream.codecpar.codecType) {\r\n      case AVMediaType.AVMEDIA_TYPE_AUDIO:\r\n        if (stream.codecpar.chLayout.nbChannels === NOPTS_VALUE\r\n          || stream.codecpar.sampleRate === NOPTS_VALUE\r\n          || stream.codecpar.frameSize === NOPTS_VALUE\r\n          || stream.codecpar.bitrate === 0n\r\n        ) {\r\n          result = false\r\n        }\r\n        break\r\n      case AVMediaType.AVMEDIA_TYPE_VIDEO:\r\n        if (avQ2D(stream.codecpar.framerate) === 0\r\n          || stream.codecpar.width === NOPTS_VALUE\r\n          || stream.codecpar.height === NOPTS_VALUE\r\n          || stream.codecpar.bitrate === 0n\r\n        ) {\r\n          result = false\r\n        }\r\n\r\n        if ((stream.codecpar.codecId === AVCodecID.AV_CODEC_ID_H264\r\n          || stream.codecpar.codecId === AVCodecID.AV_CODEC_ID_HEVC\r\n          || stream.codecpar.codecId === AVCodecID.AV_CODEC_ID_VVC\r\n          || stream.codecpar.codecId === AVCodecID.AV_CODEC_ID_MPEG4\r\n        )\r\n          && (\r\n            stream.codecpar.profile === NOPTS_VALUE\r\n              || stream.codecpar.level === NOPTS_VALUE\r\n          )\r\n        ) {\r\n          result = false\r\n        }\r\n        break\r\n    }\r\n  })\r\n\r\n  return result\r\n}\r\n","/*\r\n * libmedia mux util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVPacket from 'avutil/struct/avpacket'\r\nimport { AVOFormatContext } from './AVFormatContext'\r\nimport * as object from 'common/util/object'\r\nimport * as logger from 'common/util/logger'\r\nimport { OFormatSupportedCodecs } from './formats/OFormat'\r\nimport * as array from 'common/util/array'\r\nimport { AVFormat } from './avformat'\r\nimport { AVCodecID } from 'avutil/codec'\r\nimport * as errorType from 'avutil/error'\r\nimport { dumpCodecName, dumpFormatName } from './dump'\r\n\r\nexport type MuxOptions = {\r\n  paddingZero?: boolean\r\n}\r\n\r\ninterface MuxPrivateData {\r\n  first: Map<number, bigint>\r\n}\r\n\r\nconst defaultMuxOptions: MuxOptions = {\r\n  paddingZero: false\r\n}\r\n\r\nexport function open(formatContext: AVOFormatContext, options: MuxOptions = {}) {\r\n  const opts = object.extend({}, defaultMuxOptions, options)\r\n  if (!formatContext.ioWriter) {\r\n    logger.fatal('need ioWriter')\r\n  }\r\n  if (!formatContext.oformat) {\r\n    logger.fatal('need oformat')\r\n  }\r\n  formatContext.options = opts\r\n\r\n  formatContext.processPrivateData = {\r\n    first: new Map()\r\n  }\r\n\r\n  let supportCodecs = OFormatSupportedCodecs[formatContext.oformat.type]\r\n  if (supportCodecs) {\r\n    for (let i = 0; i < formatContext.streams.length; i++) {\r\n      const codecId = formatContext.streams[i].codecpar.codecId\r\n      if (formatContext.oformat.type === AVFormat.WAV) {\r\n        if (codecId < AVCodecID.AV_CODEC_ID_PCM_S16LE\r\n          || codecId > AVCodecID.AV_CODEC_ID_ADPCM_XMD\r\n        ) {\r\n          logger.error(`format ${dumpFormatName(formatContext.oformat.type)} not support codecId ${dumpCodecName(formatContext.streams[i].codecpar.codecType, codecId)}`)\r\n          return errorType.CODEC_NOT_SUPPORT\r\n        }\r\n      }\r\n      else if (!array.has(supportCodecs, codecId)) {\r\n        logger.error(`format ${dumpFormatName(formatContext.oformat.type)} not support codecId ${dumpCodecName(formatContext.streams[i].codecpar.codecType, codecId)}`)\r\n        return errorType.CODEC_NOT_SUPPORT\r\n      }\r\n    }\r\n  }\r\n  return formatContext.oformat.init(formatContext)\r\n}\r\n\r\nexport function writeHeader(formatContext: AVOFormatContext): number {\r\n  formatContext.oformat.writeHeader(formatContext)\r\n  return 0\r\n}\r\n\r\nexport function writeAVPacket(formatContext: AVOFormatContext, avpacket: pointer<AVPacket>): number {\r\n  const privateData = formatContext.processPrivateData as MuxPrivateData\r\n  if (!privateData.first.has(avpacket.streamIndex)) {\r\n    if (avpacket.dts > 0n) {\r\n      privateData.first.set(avpacket.streamIndex, avpacket.dts)\r\n    }\r\n    else {\r\n      privateData.first.set(avpacket.streamIndex, 0n)\r\n    }\r\n  }\r\n  if ((formatContext.options as MuxOptions).paddingZero) {\r\n    avpacket.dts -= privateData.first.get(avpacket.streamIndex)\r\n    avpacket.pts -= privateData.first.get(avpacket.streamIndex)\r\n  }\r\n\r\n  return formatContext.oformat.writeAVPacket(formatContext, avpacket)\r\n}\r\n\r\nexport function writeTrailer(formatContext: AVOFormatContext): number {\r\n  formatContext.oformat.writeTrailer(formatContext)\r\n  return 0\r\n}\r\n\r\nexport function flush(formatContext: AVOFormatContext) {\r\n  formatContext.oformat.flush(formatContext)\r\n}\r\n","/*\r\n * libmedia custom loader\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { Uint8ArrayInterface } from 'common/io/interface'\r\nimport { Data } from 'common/types/type'\r\n\r\nexport default abstract class CustomIOLoader {\r\n\r\n  constructor() {\r\n  }\r\n\r\n  /**\r\n   * 源扩展名，若无法自动分析出源的格式需要使用此数据获取默认的格式\r\n   */\r\n  get ext(): string {\r\n    throw new Error('need implemented ext getter')\r\n  }\r\n\r\n  /**\r\n   * 源的名字，主要用于日志打印，可不传\r\n   */\r\n  get name(): string {\r\n    return 'CustomIOLoader.' + Math.random()\r\n  }\r\n\r\n  /**\r\n   * 最小缓冲时长默认 4（秒）\r\n   * \r\n   * 开启 jitter buffer 需要\r\n   */\r\n  get minBuffer(): number {\r\n    return 4\r\n  }\r\n\r\n  /**\r\n   * 打开 ioloader\r\n   * \r\n   * @param info \r\n   * @param range \r\n   * \r\n   * @returns 成功返回 0, 失败返回错误码（负值）\r\n   */\r\n  public abstract open(): Promise<int32>\r\n\r\n  /**\r\n   * 读取数据到缓冲区\r\n   * \r\n   * @param buffer 可以放置数据的缓冲区，类 Uint8Array 结构\r\n   * @param options 一些配置（比如 hls 和 dash 有相关配置项）\r\n   * \r\n   * @returns 返回写入的数据长度，失败返回错误码（负值）\r\n   */\r\n  public abstract read(buffer: Uint8ArrayInterface, options?: Data): Promise<int32>\r\n\r\n  /**\r\n   * seek 到指定位置\r\n   * \r\n   * @param pos 位置\r\n   * @param options 一些配置（比如 hls 和 dash 有相关配置项）\r\n   * \r\n   * @returns 成功返回 0, 否则失败，可以返回错误码（负值）\r\n   */\r\n  public abstract seek(pos: int64, options?: Data): Promise<int32>\r\n\r\n  /**\r\n   * 数据总字节大小\r\n   * \r\n   * 没有返回 0n\r\n   */\r\n  public abstract size(): Promise<int64>\r\n\r\n  /**\r\n   * 停止 ioloader\r\n   */\r\n  public abstract stop(): Promise<void>\r\n}\r\n","/*\r\n * libmedia fetch loader\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport Sleep from 'common/timer/Sleep'\r\nimport IOLoader, { IOLoaderOptions, IOLoaderStatus, Range } from './IOLoader'\r\nimport * as object from 'common/util/object'\r\nimport { IOError } from 'common/io/error'\r\nimport { Uint8ArrayInterface } from 'common/io/interface'\r\nimport * as logger from 'common/util/logger'\r\nimport { Data } from 'common/types/type'\r\nimport * as errorType from 'avutil/error'\r\n\r\nexport interface FetchInfo {\r\n  url: string\r\n  headers?: Object\r\n  withCredentials?: boolean\r\n  referrerPolicy?: string\r\n}\r\n\r\nexport interface FetchIOLoaderOptions extends IOLoaderOptions {\r\n  disableSegment?: boolean\r\n}\r\n\r\nexport default class FetchIOLoader extends IOLoader {\r\n\r\n  declare public options: FetchIOLoaderOptions\r\n\r\n  private contentLength: number\r\n\r\n  private receivedLength: number\r\n\r\n  private info: FetchInfo\r\n\r\n  private range: Range\r\n\r\n  private startBytes: number\r\n\r\n  private endBytes: number\r\n\r\n  private eofIndex: number\r\n\r\n  private abortController: AbortController\r\n\r\n  private reader: ReadableStreamDefaultReader<Uint8Array>\r\n\r\n  private buffers: Uint8Array[]\r\n\r\n  constructor(options: FetchIOLoaderOptions = {}) {\r\n    super(options)\r\n  }\r\n\r\n  public async open(info: FetchInfo, range: Range) {\r\n\r\n    this.info = info\r\n    this.range = range\r\n\r\n    if (!this.range.to) {\r\n      this.range.to = -1\r\n    }\r\n\r\n    this.range.from = Math.max(this.range.from, 0)\r\n\r\n    if (this.eofIndex < 0) {\r\n      this.eofIndex = range.to\r\n    }\r\n\r\n    this.startBytes = 0\r\n    this.endBytes = -1\r\n    this.receivedLength = 0\r\n    this.buffers = []\r\n\r\n    if (this.range && !this.options.isLive) {\r\n      this.startBytes = this.range.from ?? 0\r\n    }\r\n\r\n    this.status = IOLoaderStatus.CONNECTING\r\n\r\n    if (!this.options.isLive && !this.options.disableSegment) {\r\n      const params: Data = {\r\n        method: 'HEAD',\r\n        headers: {},\r\n        mode: 'cors',\r\n        cache: 'default',\r\n        referrerPolicy: 'no-referrer-when-downgrade'\r\n      }\r\n      if (this.info.headers) {\r\n        object.each(this.info.headers, (value, key) => {\r\n          params.headers[key] = value\r\n        })\r\n      }\r\n\r\n      if (this.info.withCredentials) {\r\n        params.credentials = 'include'\r\n      }\r\n\r\n      if (this.info.referrerPolicy) {\r\n        params.referrerPolicy = this.info.referrerPolicy\r\n      }\r\n      if (AbortController) {\r\n        this.abortController = new AbortController()\r\n        params.signal = this.abortController.signal\r\n      }\r\n\r\n      try {\r\n        const res = await fetch(this.info.url, params)\r\n        if (res.ok && (res.status >= 200 && res.status <= 299)) {\r\n          const lengthHeader = res.headers.get('X-Content-Length') || res.headers.get('Content-Length')\r\n          if (lengthHeader != null) {\r\n            this.contentLength = parseInt(lengthHeader)\r\n            if (this.range.to < 0) {\r\n              this.eofIndex = this.contentLength + this.range.to\r\n            }\r\n          }\r\n          this.endBytes = Math.min(this.startBytes + this.options.preload - 1, this.eofIndex)\r\n          this.status = IOLoaderStatus.BUFFERING\r\n        }\r\n        else {\r\n          this.endBytes = -1\r\n        }\r\n      }\r\n      catch (error) {\r\n        this.endBytes = -1\r\n      }\r\n    }\r\n\r\n    return 0\r\n  }\r\n\r\n  private async openReader() {\r\n    const params: Data = {\r\n      method: 'GET',\r\n      headers: {},\r\n      mode: 'cors',\r\n      cache: 'default',\r\n      referrerPolicy: 'no-referrer-when-downgrade'\r\n    }\r\n    if (this.info.headers) {\r\n      object.each(this.info.headers, (value, key) => {\r\n        params.headers[key] = value\r\n      })\r\n    }\r\n    if (!this.options.isLive && !this.options.disableSegment) {\r\n      params.headers['range'] = `bytes=${this.startBytes}-${this.endBytes > 0 ? this.endBytes : ''}`\r\n    }\r\n\r\n    if (this.info.withCredentials) {\r\n      params.credentials = 'include'\r\n    }\r\n\r\n    if (this.info.referrerPolicy) {\r\n      params.referrerPolicy = this.info.referrerPolicy\r\n    }\r\n\r\n    if (this.abortController) {\r\n      this.abortController.abort()\r\n    }\r\n\r\n    if (typeof AbortController === 'function') {\r\n      this.abortController = new AbortController()\r\n      params.signal = this.abortController.signal\r\n    }\r\n\r\n    try {\r\n      const res = await fetch(this.info.url, params)\r\n      if (res.ok && (res.status >= 200 && res.status <= 299)) {\r\n        this.reader = res.body.getReader()\r\n      }\r\n      else {\r\n        this.status = IOLoaderStatus.ERROR\r\n        logger.fatal(`FetchStreamLoader: Http code invalid, ${res.status} ${res.statusText}`)\r\n      }\r\n    }\r\n    catch (error) {\r\n      if (this.retryCount < this.options.retryCount && (!this.options.isLive || !this.receivedLength)) {\r\n        this.retryCount++\r\n        this.status = IOLoaderStatus.CONNECTING\r\n\r\n        await new Sleep(this.options.retryInterval)\r\n\r\n        return this.openReader()\r\n      }\r\n      else {\r\n        logger.fatal(`FetchStreamLoader: exception ${error.message}`)\r\n      }\r\n    }\r\n  }\r\n\r\n  private async readInterval(buffer: Uint8ArrayInterface, preLen: int32 = 0): Promise<number> {\r\n\r\n    let pos = 0\r\n\r\n    while (this.buffers.length && pos < buffer.length) {\r\n      const cache = this.buffers.shift()\r\n      if (cache.length > buffer.length - pos) {\r\n        buffer.set(cache.subarray(0, buffer.length - pos), pos)\r\n        this.buffers.unshift(cache.subarray(buffer.length - pos))\r\n        pos = buffer.length\r\n      }\r\n      else {\r\n        buffer.set(cache, pos)\r\n        pos += cache.length\r\n      }\r\n    }\r\n\r\n    if (pos >= buffer.length) {\r\n      return buffer.length + preLen\r\n    }\r\n\r\n    if (this.status === IOLoaderStatus.COMPLETE) {\r\n      return pos > 0 ? (pos + preLen) : (preLen > 0 ? preLen : IOError.END)\r\n    }\r\n\r\n    if (!this.reader) {\r\n      await this.openReader()\r\n    }\r\n\r\n    const { value, done } = await this.reader.read()\r\n\r\n    if (done) {\r\n      if (this.contentLength !== null && (this.receivedLength + this.range.from) < this.endBytes + 1) {\r\n        this.status = IOLoaderStatus.ERROR\r\n        logger.fatal('Fetch stream meet Early-EOF')\r\n      }\r\n      else if (this.options.isLive || this.options.disableSegment || (this.receivedLength + this.range.from) >= this.eofIndex) {\r\n        this.status = IOLoaderStatus.COMPLETE\r\n        this.startBytes = 0\r\n        return pos > 0 ? (pos + preLen) : (preLen > 0 ? preLen : IOError.END)\r\n      }\r\n      else {\r\n\r\n        await this.reader.cancel()\r\n\r\n        if (this.abortController) {\r\n          this.abortController.abort()\r\n        }\r\n\r\n        this.reader = null\r\n\r\n        this.startBytes = this.endBytes + 1\r\n        this.endBytes = Math.min(this.startBytes + this.options.preload - 1, this.eofIndex)\r\n\r\n        return this.readInterval(buffer.subarray(pos), pos)\r\n      }\r\n    }\r\n    else {\r\n\r\n      this.receivedLength += value.length\r\n\r\n      if (value.length > buffer.length - pos) {\r\n        buffer.set(value.subarray(0, buffer.length - pos), pos)\r\n        this.buffers.push(value.subarray(buffer.length - pos))\r\n        return buffer.length + preLen\r\n      }\r\n      else {\r\n        buffer.set(value, pos)\r\n        pos += value.length\r\n        return pos + preLen\r\n      }\r\n    }\r\n  }\r\n\r\n  public async read(buffer: Uint8ArrayInterface): Promise<int32> {\r\n    return this.readInterval(buffer)\r\n  }\r\n\r\n  public async seek(pos: int64) {\r\n\r\n    if (!this.contentLength) {\r\n      return errorType.OPERATE_NOT_SUPPORT\r\n    }\r\n\r\n    await this.abort()\r\n    this.receivedLength = Number(pos) - this.range.from\r\n    this.startBytes = Number(pos)\r\n    if (!this.options.disableSegment) {\r\n      this.endBytes = Math.min(this.startBytes + this.options.preload, this.eofIndex)\r\n    }\r\n    this.buffers.length = 0\r\n    if (this.status === IOLoaderStatus.COMPLETE) {\r\n      this.status = IOLoaderStatus.BUFFERING\r\n    }\r\n\r\n    return 0\r\n  }\r\n\r\n  public async size() {\r\n    if (this.options.isLive) {\r\n      return 0n\r\n    }\r\n    return static_cast<int64>(this.contentLength || 0)\r\n  }\r\n\r\n  public async abort() {\r\n    if (!this.reader) {\r\n      return\r\n    }\r\n    await this.reader.cancel()\r\n    if (this.abortController) {\r\n      this.abortController.abort()\r\n    }\r\n    this.reader = null\r\n  }\r\n\r\n  public async stop() {\r\n    await this.abort()\r\n    this.status = IOLoaderStatus.IDLE\r\n  }\r\n}\r\n","/*\r\n * libmedia file loader\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport IOLoader, { IOLoaderStatus, Range } from './IOLoader'\r\nimport { IOError } from 'common/io/error'\r\nimport { Uint8ArrayInterface } from 'common/io/interface'\r\nimport * as is from 'common/util/is'\r\n\r\nexport interface FileInfo {\r\n  file: File\r\n}\r\n\r\nconst hasArrayBuffer = is.func(Blob.prototype.arrayBuffer)\r\n\r\nexport default class FileIOLoader extends IOLoader {\r\n\r\n  private info: FileInfo\r\n\r\n  private range: Range\r\n\r\n  private readPos: number\r\n\r\n  private endPos: number\r\n\r\n  private reader: FileReader\r\n  private readerResolve: (buffer: ArrayBuffer) => void\r\n\r\n  public async open(info: FileInfo, range: Range) {\r\n\r\n    this.info = info\r\n    this.range = range\r\n\r\n    this.readPos = 0\r\n    this.endPos = this.info.file.size\r\n\r\n    if (range.from > 0) {\r\n      this.readPos = range.from\r\n    }\r\n    if (range.to > 0) {\r\n      this.endPos = range.to\r\n    }\r\n\r\n    this.status = IOLoaderStatus.BUFFERING\r\n\r\n    return 0\r\n  }\r\n\r\n  private async readBufferByReader(len: number) {\r\n    if (!this.reader) {\r\n      this.reader = new FileReader()\r\n      this.reader.onloadend = (event) => {\r\n        if (this.readerResolve) {\r\n          this.readerResolve(event.target.result as ArrayBuffer)\r\n        }\r\n      }\r\n    }\r\n    const blobSlice = File.prototype.slice || File.prototype.mozSlice || File.prototype.webkitSlice\r\n\r\n    return new Promise<ArrayBuffer>((resolve) => {\r\n      this.readerResolve = resolve\r\n      this.reader.readAsArrayBuffer(blobSlice.call(this.info.file, this.readPos, this.readPos + len))\r\n    })\r\n  }\r\n\r\n  public async read(buffer: Uint8ArrayInterface) {\r\n    if (this.readPos >= this.endPos) {\r\n      this.status = IOLoaderStatus.COMPLETE\r\n      return IOError.END\r\n    }\r\n    const len = Math.min(buffer.length, this.endPos - this.readPos)\r\n\r\n    if (hasArrayBuffer) {\r\n      buffer.set(new Uint8Array(await (this.info.file.slice(this.readPos, this.readPos + len).arrayBuffer())), 0)\r\n    }\r\n    else {\r\n      buffer.set(new Uint8Array(await this.readBufferByReader(len)), 0)\r\n    }\r\n\r\n    this.readPos += len\r\n\r\n    if (this.readPos >= this.endPos) {\r\n      this.status = IOLoaderStatus.COMPLETE\r\n    }\r\n\r\n    return len\r\n  }\r\n\r\n  public async seek(pos: int64) {\r\n    this.readPos = Number(pos)\r\n    if (this.status === IOLoaderStatus.COMPLETE) {\r\n      this.status = IOLoaderStatus.BUFFERING\r\n    }\r\n    return 0\r\n  }\r\n\r\n  public async size() {\r\n    return static_cast<int64>(this.info.file.size)\r\n  }\r\n\r\n  public async stop() {\r\n    this.status = IOLoaderStatus.IDLE\r\n  }\r\n}\r\n","/*\r\n * libmedia abstract loader\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { Uint8ArrayInterface } from 'common/io/interface'\r\nimport { Data, Timeout } from 'common/types/type'\r\nimport * as object from 'common/util/object'\r\n\r\nexport interface Range {\r\n  from: number,\r\n  to: number\r\n}\r\n\r\nexport const enum IOLoaderStatus {\r\n  IDLE,\r\n  CONNECTING,\r\n  BUFFERING,\r\n  ERROR,\r\n  COMPLETE\r\n}\r\n\r\nexport interface IOLoaderVideoStreamInfo {\r\n  list: {\r\n    width: number\r\n    height: number\r\n    frameRate: number\r\n    codecs: string\r\n  }[]\r\n  selectedIndex: number\r\n}\r\n\r\nexport interface IOLoaderAudioStreamInfo {\r\n  list: {\r\n    lang: string\r\n    codecs: string\r\n  }[]\r\n  selectedIndex: number\r\n}\r\n\r\nexport interface IOLoaderSubtitleStreamInfo {\r\n  list: {\r\n    lang: string\r\n    codecs: string\r\n  }[]\r\n  selectedIndex: number\r\n}\r\n\r\nexport type IOLoaderOptions = {\r\n  isLive?: boolean\r\n  preload?: number\r\n  retryCount?: number\r\n  retryInterval?: number\r\n}\r\n\r\nconst optionsDefault = {\r\n  isLive: true,\r\n  preload: 5 * 1024 * 1024,\r\n  retryCount: 20,\r\n  retryInterval: 1\r\n}\r\n\r\nexport default abstract class IOLoader {\r\n\r\n  public options: IOLoaderOptions\r\n\r\n  protected status: IOLoaderStatus\r\n\r\n  protected retryCount: number\r\n\r\n  protected retryTimeout: Timeout\r\n\r\n  constructor(options: IOLoaderOptions = {}) {\r\n    this.options = options\r\n    this.status = IOLoaderStatus.IDLE\r\n    this.retryCount = 0\r\n\r\n    this.options = object.extend({}, optionsDefault)\r\n    object.extend(this.options, options)\r\n  }\r\n\r\n  /**\r\n   * 打开 ioloader\r\n   * \r\n   * @param info \r\n   * @param range \r\n   * \r\n   * @returns 成功返回 0, 失败返回错误码（负值）\r\n   */\r\n  public abstract open(info: Data, range: Range): Promise<int32>\r\n\r\n  /**\r\n   * 读取数据到缓冲区\r\n   * \r\n   * @param buffer 可以放置数据的缓冲区，类 Uint8Array 结构\r\n   * @param options 一些配置（比如 hls 和 dash 有相关配置项）\r\n   * \r\n   * @returns 返回写入的数据长度，失败返回错误码（负值）\r\n   */\r\n  public abstract read(buffer: Uint8ArrayInterface, options?: Data): Promise<int32>\r\n\r\n  /**\r\n   * seek 到指定位置\r\n   * \r\n   * @param pos 位置\r\n   * @param options 一些配置（比如 hls 和 dash 有相关配置项）\r\n   * \r\n   * @returns 成功返回 0, 否则失败，可以返回错误码（负值）\r\n   */\r\n  public abstract seek(pos: int64, options?: Data): Promise<int32>\r\n\r\n  /**\r\n   * 数据总字节大小\r\n   * \r\n   * 没有返回 0n\r\n   */\r\n  public abstract size(): Promise<int64>\r\n\r\n  /**\r\n   * 停止 ioloader\r\n   */\r\n  public abstract stop(): Promise<void>\r\n}\r\n","/*\r\n * libmedia AudioDecodePipeline\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport Pipeline, { TaskOptions } from './Pipeline'\r\nimport * as error from 'avutil/error'\r\nimport IPCPort from 'common/network/IPCPort'\r\nimport { REQUEST, RpcMessage } from 'common/network/IPCPort'\r\nimport List from 'cheap/std/collection/List'\r\nimport { AVFrameRef } from 'avutil/struct/avframe'\r\nimport { Mutex } from 'cheap/thread/mutex'\r\nimport WasmAudioDecoder from 'avcodec/wasmcodec/AudioDecoder'\r\nimport { WebAssemblyResource } from 'cheap/webassembly/compiler'\r\nimport * as logger from 'common/util/logger'\r\nimport AVFramePoolImpl from 'avutil/implement/AVFramePoolImpl'\r\nimport { IOError } from 'common/io/error'\r\nimport { AVPacketPool, AVPacketRef } from 'avutil/struct/avpacket'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport { Rational } from 'avutil/struct/rational'\r\nimport WebAudioDecoder from 'avcodec/webcodec/AudioDecoder'\r\nimport AVPacketPoolImpl from 'avutil/implement/AVPacketPoolImpl'\r\nimport * as array from 'common/util/array'\r\nimport getTimestamp from 'common/function/getTimestamp'\r\nimport { audioData2AVFrame } from 'avutil/function/audioData2AVFrame'\r\nimport { avRescaleQ } from 'avutil/util/rational'\r\nimport { AV_TIME_BASE_Q } from 'avutil/constant'\r\nimport * as errorType from 'avutil/error'\r\nimport { Data } from 'common/types/type'\r\nimport compileResource from 'avutil/function/compileResource'\r\nimport isPointer from 'cheap/std/function/isPointer'\r\nimport { AVCodecParametersSerialize, AVPacketSerialize, unserializeAVCodecParameters, unserializeAVPacket } from 'avutil/util/serialize'\r\nimport { avMallocz } from 'avutil/util/mem'\r\nimport { copyCodecParameters, freeCodecParameters } from 'avutil/util/codecparameters'\r\nimport * as is from 'common/util/is'\r\n\r\nexport interface AudioDecodeTaskOptions extends TaskOptions {\r\n  resource: ArrayBuffer | WebAssemblyResource\r\n  avpacketList: pointer<List<pointer<AVPacketRef>>>\r\n  avpacketListMutex: pointer<Mutex>\r\n  avframeList: pointer<List<pointer<AVFrameRef>>>\r\n  avframeListMutex: pointer<Mutex>\r\n  timeBase: Rational\r\n}\r\n\r\ntype SelfTask = Omit<AudioDecodeTaskOptions, 'resource'> & {\r\n  resource: WebAssemblyResource\r\n  decoder: WasmAudioDecoder | WebAudioDecoder\r\n  frameCaches: pointer<AVFrameRef>[]\r\n  inputEnd: boolean\r\n  parameters: pointer<AVCodecParameters>\r\n  openReject: (ret: number) => void\r\n\r\n  lastDecodeTimestamp: number\r\n\r\n  avframePool: AVFramePoolImpl\r\n  avpacketPool: AVPacketPool\r\n\r\n  wasmDecoderOptions?: Data\r\n}\r\n\r\nexport default class AudioDecodePipeline extends Pipeline {\r\n\r\n  declare tasks: Map<string, SelfTask>\r\n\r\n  constructor() {\r\n    super()\r\n  }\r\n\r\n  private createWebcodecDecoder(task: SelfTask) {\r\n    return new WebAudioDecoder({\r\n      onError: (error) => {\r\n        logger.error(`audio decode error, taskId: ${task.taskId}, error: ${error}`)\r\n        if (task.openReject) {\r\n          task.openReject(errorType.CODEC_NOT_SUPPORT)\r\n          task.openReject = null\r\n        }\r\n      },\r\n      onReceiveFrame(audioData) {\r\n        const avframe = audioData2AVFrame(audioData, task.avframePool.alloc())\r\n\r\n        avframe.pts = avRescaleQ(avframe.pts, AV_TIME_BASE_Q, task.timeBase)\r\n        avframe.timeBase.den = task.timeBase.den\r\n        avframe.timeBase.num = task.timeBase.num\r\n\r\n        task.frameCaches.push(reinterpret_cast<pointer<AVFrameRef>>(avframe))\r\n        task.stats.audioFrameDecodeCount++\r\n        if (task.lastDecodeTimestamp) {\r\n          task.stats.audioFrameDecodeIntervalMax = Math.max(\r\n            getTimestamp() - task.lastDecodeTimestamp,\r\n            task.stats.audioFrameDecodeIntervalMax\r\n          )\r\n        }\r\n        task.lastDecodeTimestamp = getTimestamp()\r\n        audioData.close()\r\n      }\r\n    })\r\n  }\r\n\r\n  private createWasmcodecDecoder(task: SelfTask, resource: WebAssemblyResource) {\r\n    return new WasmAudioDecoder({\r\n      resource: resource,\r\n      onError: (error) => {\r\n        logger.error(`audio decode error, taskId: ${task.taskId}, error: ${error}`)\r\n        if (task.openReject) {\r\n          task.openReject(errorType.CODEC_NOT_SUPPORT)\r\n          task.openReject = null\r\n        }\r\n      },\r\n      onReceiveFrame(frame) {\r\n        task.frameCaches.push(reinterpret_cast<pointer<AVFrameRef>>(frame))\r\n        task.stats.audioFrameDecodeCount++\r\n        if (task.lastDecodeTimestamp) {\r\n          task.stats.audioFrameDecodeIntervalMax = Math.max(\r\n            getTimestamp() - task.lastDecodeTimestamp,\r\n            task.stats.audioFrameDecodeIntervalMax\r\n          )\r\n        }\r\n        task.lastDecodeTimestamp = getTimestamp()\r\n      },\r\n      avframePool: task.avframePool\r\n    })\r\n  }\r\n\r\n  private async pullAVPacketInternal(task: SelfTask, leftIPCPort: IPCPort) {\r\n    const data = await leftIPCPort.request<pointer<AVPacketRef> | AVPacketSerialize>('pull')\r\n    if (is.number(data)) {\r\n      return data\r\n    }\r\n    else {\r\n      const avpacket = task.avpacketPool.alloc()\r\n      unserializeAVPacket(data, avpacket)\r\n      return avpacket\r\n    }\r\n  }\r\n\r\n  private async createTask(options: AudioDecodeTaskOptions): Promise<number> {\r\n\r\n    assert(options.leftPort)\r\n    assert(options.rightPort)\r\n\r\n    const leftIPCPort = new IPCPort(options.leftPort)\r\n    const rightIPCPort = new IPCPort(options.rightPort)\r\n    const frameCaches: pointer<AVFrameRef>[] = []\r\n\r\n    const avframePool = new AVFramePoolImpl(accessof(options.avframeList), options.avframeListMutex)\r\n\r\n    const task: SelfTask = {\r\n      ...options,\r\n      resource: await compileResource(options.resource),\r\n      frameCaches,\r\n      inputEnd: false,\r\n      decoder: null,\r\n      parameters: nullptr,\r\n      lastDecodeTimestamp: 0,\r\n\r\n      avframePool,\r\n      avpacketPool: new AVPacketPoolImpl(accessof(options.avpacketList), options.avpacketListMutex),\r\n      openReject: null\r\n    }\r\n\r\n    if (task.resource) {\r\n      task.decoder = this.createWasmcodecDecoder(task, task.resource)\r\n    }\r\n    else {\r\n      task.decoder = this.createWebcodecDecoder(task)\r\n    }\r\n\r\n    this.tasks.set(options.taskId, task)\r\n\r\n    rightIPCPort.on(REQUEST, async (request: RpcMessage) => {\r\n      switch (request.method) {\r\n        case 'pull': {\r\n          if (frameCaches.length) {\r\n            const frame = frameCaches.shift()\r\n            rightIPCPort.reply(request, frame)\r\n            break\r\n          }\r\n          else if (!task.inputEnd) {\r\n            while (true) {\r\n              if (frameCaches.length) {\r\n                const frame = frameCaches.shift()\r\n                rightIPCPort.reply(request, frame)\r\n                break\r\n              }\r\n\r\n              const avpacket = await this.pullAVPacketInternal(task, leftIPCPort)\r\n\r\n              if (avpacket === IOError.END) {\r\n                await task.decoder.flush()\r\n                task.inputEnd = true\r\n                if (frameCaches.length) {\r\n                  const frame = frameCaches.shift()\r\n                  rightIPCPort.reply(request, frame)\r\n                  break\r\n                }\r\n                else {\r\n                  logger.info(`audio decoder ended, taskId: ${task.taskId}`)\r\n                  rightIPCPort.reply(request, IOError.END)\r\n                  break\r\n                }\r\n              }\r\n              else if (avpacket > 0) {\r\n\r\n                const ret = task.decoder.decode(avpacket, avRescaleQ(avpacket.pts, avpacket.timeBase, AV_TIME_BASE_Q))\r\n\r\n                task.avpacketPool.release(avpacket)\r\n\r\n                if (ret < 0) {\r\n                  task.stats.audioDecodeErrorPacketCount++\r\n                  logger.error(`audio decode error, taskId: ${options.taskId}, ret: ${ret}`)\r\n                }\r\n                continue\r\n              }\r\n              else {\r\n                logger.error(`audio decode pull avpacket error, taskId: ${options.taskId}, ret: ${avpacket}`)\r\n                rightIPCPort.reply(request, avpacket)\r\n                break\r\n              }\r\n            }\r\n            break\r\n          }\r\n          rightIPCPort.reply(request, IOError.END)\r\n          break\r\n        }\r\n      }\r\n    })\r\n\r\n    return 0\r\n  }\r\n\r\n  public async open(taskId: string, parameters: AVCodecParametersSerialize | pointer<AVCodecParameters>, wasmDecoderOptions: Data = {}) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      task.wasmDecoderOptions = wasmDecoderOptions\r\n      const codecpar: pointer<AVCodecParameters> = avMallocz(sizeof(AVCodecParameters))\r\n      if (isPointer(parameters)) {\r\n        copyCodecParameters(codecpar, parameters)\r\n      }\r\n      else {\r\n        unserializeAVCodecParameters(parameters, codecpar)\r\n      }\r\n      if (task.parameters) {\r\n        freeCodecParameters(task.parameters)\r\n      }\r\n      task.parameters = codecpar\r\n      return new Promise<number>(async (resolve, reject) => {\r\n        task.openReject = resolve\r\n        try {\r\n          await task.decoder.open(codecpar, task.wasmDecoderOptions)\r\n        }\r\n        catch (error) {\r\n          logger.error(`open audio decoder failed, error: ${error}`)\r\n          resolve(errorType.CODEC_NOT_SUPPORT)\r\n          return\r\n        }\r\n        resolve(0)\r\n      })\r\n    }\r\n    logger.fatal('task not found')\r\n  }\r\n\r\n  public async reopenDecoder(\r\n    taskId: string,\r\n    parameters: AVCodecParametersSerialize | pointer<AVCodecParameters>,\r\n    resource?: string | ArrayBuffer | WebAssemblyResource,\r\n    wasmDecoderOptions?: Data\r\n  ) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (wasmDecoderOptions) {\r\n        task.wasmDecoderOptions = wasmDecoderOptions\r\n      }\r\n      const codecpar: pointer<AVCodecParameters> = avMallocz(sizeof(AVCodecParameters))\r\n      if (isPointer(parameters)) {\r\n        copyCodecParameters(codecpar, parameters)\r\n      }\r\n      else {\r\n        unserializeAVCodecParameters(parameters, codecpar)\r\n      }\r\n      if (task.parameters) {\r\n        freeCodecParameters(task.parameters)\r\n      }\r\n      task.parameters = codecpar\r\n      let decoder: WasmAudioDecoder | WebAudioDecoder\r\n      if (resource) {\r\n        resource = await compileResource(resource)\r\n        decoder = this.createWasmcodecDecoder(task, resource)\r\n      }\r\n      else {\r\n        decoder = this.createWebcodecDecoder(task)\r\n      }\r\n      return new Promise<number>(async (resolve, reject) => {\r\n        task.openReject = resolve\r\n        try {\r\n          await decoder.open(codecpar)\r\n          if (resource) {\r\n            task.resource = resource as WebAssemblyResource\r\n          }\r\n          task.decoder.close()\r\n          task.decoder = decoder\r\n\r\n          logger.debug(`reopen audio decoder, taskId: ${task.taskId}`)\r\n        }\r\n        catch (error) {\r\n          logger.error(`reopen audio decoder failed, error: ${error}`)\r\n          resolve(errorType.CODEC_NOT_SUPPORT)\r\n          return\r\n        }\r\n        resolve(0)\r\n      })\r\n    }\r\n    logger.fatal('task not found')\r\n  }\r\n\r\n  public async resetTask(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (task.decoder) {\r\n        await task.decoder.flush()\r\n      }\r\n      array.each(task.frameCaches, (frame) => {\r\n        task.avframePool.release(frame)\r\n      })\r\n      task.frameCaches.length = 0\r\n      task.inputEnd = false\r\n      task.lastDecodeTimestamp = getTimestamp()\r\n\r\n      logger.info(`reset audio decoder, taskId: ${task.taskId}`)\r\n    }\r\n  }\r\n\r\n  public async registerTask(options: AudioDecodeTaskOptions): Promise<number> {\r\n    if (this.tasks.has(options.taskId)) {\r\n      return error.INVALID_OPERATE\r\n    }\r\n    return this.createTask(options)\r\n  }\r\n\r\n  public async unregisterTask(taskId: string): Promise<void> {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      task.rightPort.close()\r\n      task.leftPort.close()\r\n      task.decoder.close()\r\n      task.frameCaches.forEach((frame) => {\r\n        task.avframePool.release(frame)\r\n      })\r\n      if (task.parameters) {\r\n        freeCodecParameters(task.parameters)\r\n      }\r\n      this.tasks.delete(taskId)\r\n    }\r\n  }\r\n}\r\n","/*\r\n * libmedia AudioEncodePipeline\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { WebAssemblyResource } from 'cheap/webassembly/compiler'\r\nimport Pipeline, { TaskOptions } from './Pipeline'\r\nimport List from 'cheap/std/collection/List'\r\nimport { AVPacketPool, AVPacketRef } from 'avutil/struct/avpacket'\r\nimport { Mutex } from 'cheap/thread/mutex'\r\nimport { AVFrameRef } from 'avutil/struct/avframe'\r\nimport WasmAudioEncoder from 'avcodec/wasmcodec/AudioEncoder'\r\nimport WebAudioEncoder from 'avcodec/webcodec/AudioEncoder'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport AVFramePoolImpl from 'avutil/implement/AVFramePoolImpl'\r\nimport IPCPort, { REQUEST, RpcMessage } from 'common/network/IPCPort'\r\nimport AVPacketPoolImpl from 'avutil/implement/AVPacketPoolImpl'\r\nimport * as logger from 'common/util/logger'\r\nimport { IOError } from 'common/io/error'\r\nimport * as array from 'common/util/array'\r\nimport * as error from 'avutil/error'\r\nimport Sleep from 'common/timer/Sleep'\r\nimport { Rational } from 'avutil/struct/rational'\r\nimport * as errorType from 'avutil/error'\r\nimport isPointer from 'cheap/std/function/isPointer'\r\nimport { Data } from 'common/types/type'\r\nimport compileResource from 'avutil/function/compileResource'\r\n\r\nexport interface AudioEncodeTaskOptions extends TaskOptions {\r\n  resource: ArrayBuffer | WebAssemblyResource\r\n  avpacketList: pointer<List<pointer<AVPacketRef>>>\r\n  avpacketListMutex: pointer<Mutex>\r\n  avframeList: pointer<List<pointer<AVFrameRef>>>\r\n  avframeListMutex: pointer<Mutex>\r\n}\r\n\r\ntype SelfTask = Omit<AudioEncodeTaskOptions, 'resource'> & {\r\n  encoder: WasmAudioEncoder | WebAudioEncoder\r\n  resource: WebAssemblyResource\r\n  avpacketCaches: pointer<AVPacketRef>[]\r\n  parameters: pointer<AVCodecParameters>\r\n  openReject?: (error: Error) => void\r\n  inputEnd: boolean\r\n  avframePool: AVFramePoolImpl\r\n  avpacketPool: AVPacketPool\r\n  wasmEncoderOptions?: Data\r\n}\r\n\r\nexport default class AudioEncodePipeline extends Pipeline {\r\n\r\n  declare tasks: Map<string, SelfTask>\r\n\r\n  constructor() {\r\n    super()\r\n  }\r\n\r\n  private createWebcodecEncoder(task: SelfTask) {\r\n    return new WebAudioEncoder({\r\n      onError: (error) => {\r\n        logger.error(`audio encode error, taskId: ${task.taskId}, error: ${error}`)\r\n        if (task.openReject) {\r\n          task.openReject(error)\r\n          task.openReject = null\r\n        }\r\n      },\r\n      onReceivePacket(avpacket) {\r\n        task.avpacketCaches.push(reinterpret_cast<pointer<AVPacketRef>>(avpacket))\r\n        task.stats.audioPacketEncodeCount++\r\n      },\r\n      avpacketPool: task.avpacketPool,\r\n      avframePool: task.avframePool\r\n    })\r\n  }\r\n\r\n  private async createTask(options: AudioEncodeTaskOptions): Promise<number> {\r\n\r\n    assert(options.leftPort)\r\n    assert(options.rightPort)\r\n\r\n    const leftIPCPort = new IPCPort(options.leftPort)\r\n    const rightIPCPort = new IPCPort(options.rightPort)\r\n    const avpacketCaches: pointer<AVPacketRef>[] = []\r\n\r\n    const avpacketPool = new AVPacketPoolImpl(accessof(options.avpacketList), options.avpacketListMutex)\r\n\r\n    const task: SelfTask = {\r\n      ...options,\r\n      resource: await compileResource(options.resource),\r\n      avpacketCaches,\r\n      encoder: null,\r\n      inputEnd: false,\r\n      parameters: nullptr,\r\n\r\n      avframePool: new AVFramePoolImpl(accessof(options.avframeList), options.avframeListMutex),\r\n      avpacketPool\r\n    }\r\n\r\n    if (task.resource) {\r\n      task.encoder = new WasmAudioEncoder({\r\n        resource: task.resource,\r\n        onError: (error) => {\r\n          logger.error(`audio encode error, taskId: ${options.taskId}, error: ${error}`)\r\n          const task = this.tasks.get(options.taskId)\r\n          if (task.openReject) {\r\n            task.openReject(error)\r\n            task.openReject = null\r\n          }\r\n        },\r\n        onReceiveAVPacket(avpacket) {\r\n          task.avpacketCaches.push(reinterpret_cast<pointer<AVPacketRef>>(avpacket))\r\n          task.stats.audioPacketEncodeCount++\r\n        },\r\n        avpacketPool: avpacketPool\r\n      })\r\n    }\r\n    else {\r\n      task.encoder = this.createWebcodecEncoder(task)\r\n    }\r\n\r\n    this.tasks.set(options.taskId, task)\r\n\r\n    rightIPCPort.on(REQUEST, async (request: RpcMessage) => {\r\n      switch (request.method) {\r\n        case 'pull': {\r\n          if (avpacketCaches.length) {\r\n            const avpacket = avpacketCaches.shift()\r\n            rightIPCPort.reply(request, avpacket)\r\n            break\r\n          }\r\n          else if (!task.inputEnd) {\r\n            while (true) {\r\n              if (avpacketCaches.length) {\r\n                const avpacket = avpacketCaches.shift()\r\n                rightIPCPort.reply(request, avpacket)\r\n                break\r\n              }\r\n\r\n              const avframe = await leftIPCPort.request<pointer<AVFrameRef> | AudioData>('pull')\r\n\r\n              if (isPointer(avframe) || avframe instanceof AudioData) {\r\n                const ret = task.encoder.encode(avframe)\r\n                if (isPointer(avframe)) {\r\n                  task.avframePool.release(avframe)\r\n                }\r\n                else {\r\n                  avframe.close()\r\n                }\r\n                if (ret < 0) {\r\n                  task.stats.audioEncodeErrorFrameCount++\r\n                  logger.error(`audio encode error, taskId: ${options.taskId}, ret: ${ret}`)\r\n                  rightIPCPort.reply(request, ret)\r\n                  break\r\n                }\r\n                // 硬解队列中的 EncodedVideoChunk 过多会报错， 这里判断做一下延时\r\n                while (task.encoder instanceof WebAudioEncoder\r\n                  && task.encoder.getQueueLength() > 4\r\n                ) {\r\n                  await new Sleep(0)\r\n                }\r\n                continue\r\n              }\r\n              else {\r\n                if (avframe === IOError.END) {\r\n                  await task.encoder.flush()\r\n                  task.inputEnd = true\r\n                  if (avpacketCaches.length) {\r\n                    const avpacket = avpacketCaches.shift()\r\n                    rightIPCPort.reply(request, avpacket)\r\n                    break\r\n                  }\r\n                  else {\r\n                    logger.info(`audio encoder ended, taskId: ${task.taskId}`)\r\n                    rightIPCPort.reply(request, IOError.END)\r\n                    break\r\n                  }\r\n                }\r\n                else {\r\n                  logger.error(`audio encoder pull avpacket error, taskId: ${options.taskId}, ret: ${avframe}`)\r\n                  rightIPCPort.reply(request, avframe)\r\n                  break\r\n                }\r\n              }\r\n            }\r\n            break\r\n          }\r\n          logger.info(`audio encoder ended, taskId: ${task.taskId}`)\r\n          rightIPCPort.reply(request, IOError.END)\r\n          break\r\n        }\r\n      }\r\n    })\r\n\r\n    return 0\r\n  }\r\n\r\n  public async open(taskId: string, parameters: pointer<AVCodecParameters>, timeBase: Rational, wasmEncoderOptions: Data = {}) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      task.wasmEncoderOptions = wasmEncoderOptions\r\n      return new Promise<number>(async (resolve, reject) => {\r\n        task.openReject = reject\r\n        try {\r\n          await task.encoder.open(parameters, timeBase, task.wasmEncoderOptions)\r\n          task.parameters = parameters\r\n        }\r\n        catch (error) {\r\n          logger.error(`open audio encoder failed, error: ${error}`)\r\n          resolve(errorType.CODEC_NOT_SUPPORT)\r\n          return\r\n        }\r\n        resolve(0)\r\n      })\r\n    }\r\n    logger.fatal('task not found')\r\n  }\r\n\r\n  public async getExtraData(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      return task.encoder.getExtraData()\r\n    }\r\n    logger.fatal('task not found')\r\n  }\r\n\r\n  public async resetTask(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (task.encoder) {\r\n        await task.encoder.flush()\r\n      }\r\n      array.each(task.avpacketCaches, (avpacket) => {\r\n        task.avpacketPool.release(avpacket)\r\n      })\r\n      task.avpacketCaches.length = 0\r\n      task.inputEnd = false\r\n\r\n      logger.info(`reset audio encoder, taskId: ${task.taskId}`)\r\n    }\r\n  }\r\n\r\n  public async registerTask(options: AudioEncodeTaskOptions): Promise<number> {\r\n    if (this.tasks.has(options.taskId)) {\r\n      return error.INVALID_OPERATE\r\n    }\r\n    return this.createTask(options)\r\n  }\r\n\r\n  public async unregisterTask(taskId: string): Promise<void> {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      task.rightPort.close()\r\n      task.leftPort.close()\r\n      task.encoder.close()\r\n      task.avpacketCaches.forEach((avpacket) => {\r\n        task.avpacketPool.release(avpacket)\r\n      })\r\n      this.tasks.delete(taskId)\r\n    }\r\n  }\r\n}\r\n","/*\r\n * libmedia DemuxPipeline\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n *\r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n *\r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { Data } from 'common/types/type'\r\nimport Pipeline, { TaskOptions } from './Pipeline'\r\nimport * as errorType from 'avutil/error'\r\nimport IPCPort from 'common/network/IPCPort'\r\nimport { REQUEST, RpcMessage } from 'common/network/IPCPort'\r\nimport { AVFormatContextInterface, AVIFormatContext, createAVIFormatContext } from 'avformat/AVFormatContext'\r\nimport IOReader from 'common/io/IOReader'\r\nimport IFormat from 'avformat/formats/IFormat'\r\nimport * as demux from 'avformat/demux'\r\nimport { AVFormat } from 'avformat/avformat'\r\nimport { avFree, avMalloc } from 'avutil/util/mem'\r\nimport SafeUint8Array from 'cheap/std/buffer/SafeUint8Array'\r\nimport List from 'cheap/std/collection/List'\r\nimport { AVPacketFlags, AVPacketPool, AVPacketRef } from 'avutil/struct/avpacket'\r\nimport { Mutex } from 'cheap/thread/mutex'\r\nimport * as logger from 'common/util/logger'\r\nimport AVPacketPoolImpl from 'avutil/implement/AVPacketPoolImpl'\r\nimport { IOError } from 'common/io/error'\r\nimport { AVCodecID, AVMediaType, AVPacketSideDataType } from 'avutil/codec'\r\nimport LoopTask from 'common/timer/LoopTask'\r\nimport { IOFlags } from 'common/io/flags'\r\nimport * as array from 'common/util/array'\r\nimport { avRescaleQ } from 'avutil/util/rational'\r\nimport { AV_MILLI_TIME_BASE_Q, NOPTS_VALUE, NOPTS_VALUE_BIGINT } from 'avutil/constant'\r\nimport * as bigint from 'common/util/bigint'\r\nimport { AVStreamInterface } from 'avformat/AVStream'\r\nimport { addAVPacketSideData, getAVPacketData, getAVPacketSideData } from 'avutil/util/avpacket'\r\nimport { memcpy, memcpyFromUint8Array } from 'cheap/std/memory'\r\nimport analyzeAVFormat from 'avutil/function/analyzeAVFormat'\r\nimport { WebAssemblyResource } from 'cheap/webassembly/compiler'\r\nimport compileResource from 'avutil/function/compileResource'\r\nimport isWorker from 'common/function/isWorker'\r\nimport * as cheapConfig from 'cheap/config'\r\nimport { serializeAVPacket } from 'avutil/util/serialize'\r\nimport isPointer from 'cheap/std/function/isPointer'\r\nimport * as is from 'common/util/is'\r\nimport * as h264 from 'avformat/codecs/h264'\r\nimport * as hevc from 'avformat/codecs/hevc'\r\nimport * as vvc from 'avformat/codecs/vvc'\r\n\r\nexport const STREAM_INDEX_ALL = -1\r\n\r\nexport interface DemuxTaskOptions extends TaskOptions {\r\n  format?: AVFormat\r\n  bufferLength?: number\r\n  isLive?: boolean\r\n  ioloaderOptions?: Data\r\n  mainTaskId?: string\r\n  avpacketList: pointer<List<pointer<AVPacketRef>>>\r\n  avpacketListMutex: pointer<Mutex>\r\n  flags?: int32\r\n}\r\n\r\ntype SelfTask = DemuxTaskOptions & {\r\n  leftIPCPort: IPCPort\r\n  rightIPCPorts: Map<number, IPCPort & { streamIndex?: number }>\r\n  controlIPCPort: IPCPort\r\n\r\n  formatContext: AVIFormatContext\r\n  ioReader: IOReader\r\n  buffer: pointer<uint8>\r\n\r\n  cacheAVPackets: Map<number, pointer<AVPacketRef>[]>\r\n  cacheRequests: Map<number, RpcMessage>\r\n  streamIndexFlush: Map<number, boolean>\r\n\r\n  realFormat: AVFormat\r\n\r\n  demuxEnded: boolean\r\n  loop: LoopTask\r\n\r\n  gopCounter: int32\r\n  lastKeyFramePts: int64\r\n  lastAudioDts: int64\r\n  lastVideoDts: int64\r\n\r\n  avpacketPool: AVPacketPool\r\n}\r\n\r\nexport default class DemuxPipeline extends Pipeline {\r\n\r\n  declare tasks: Map<string, SelfTask>\r\n\r\n  constructor() {\r\n    super()\r\n  }\r\n\r\n  private createTask(options: DemuxTaskOptions): number {\r\n    let leftIPCPort: IPCPort\r\n    let controlIPCPort: IPCPort\r\n\r\n    if (options.mainTaskId) {\r\n      const mainTask = this.tasks.get(options.mainTaskId)\r\n      leftIPCPort = mainTask.leftIPCPort\r\n      controlIPCPort = mainTask.controlIPCPort\r\n    }\r\n    else {\r\n      assert(options.leftPort)\r\n      leftIPCPort = new IPCPort(options.leftPort)\r\n      if (options.controlPort) {\r\n        controlIPCPort = new IPCPort(options.controlPort)\r\n      }\r\n    }\r\n\r\n    assert(leftIPCPort)\r\n\r\n    const bufferLength = options.bufferLength || 1 * 1024 * 1024\r\n\r\n    const buf = avMalloc(bufferLength)\r\n\r\n    if (!buf) {\r\n      return errorType.NO_MEMORY\r\n    }\r\n\r\n    const buffer = new SafeUint8Array(buf, bufferLength)\r\n    const ioReader = new IOReader(bufferLength, true, buffer)\r\n\r\n    if (!options.isLive) {\r\n      ioReader.flags |= IOFlags.SEEKABLE\r\n    }\r\n    if (options.flags) {\r\n      ioReader.flags |= options.flags\r\n    }\r\n\r\n    ioReader.onFlush = async (buffer) => {\r\n\r\n      assert(buffer.byteOffset >= buf && buffer.byteOffset < buf + bufferLength)\r\n\r\n      const params: {\r\n        pointer: pointer<uint8>,\r\n        length: int32\r\n        ioloaderOptions?: Data\r\n      } = {\r\n        pointer: reinterpret_cast<pointer<uint8>>(buffer.byteOffset),\r\n        length: buffer.length\r\n      }\r\n      if (options.ioloaderOptions) {\r\n        params.ioloaderOptions = options.ioloaderOptions\r\n      }\r\n      try {\r\n        const result = await leftIPCPort.request<int32 | Uint8Array>('read', params)\r\n        if (is.number(result)) {\r\n          return result\r\n        }\r\n        assert(result.length <= params.length)\r\n        memcpyFromUint8Array(params.pointer, result.length, result)\r\n        return result.length\r\n      }\r\n      catch (error) {\r\n        return IOError.INVALID_OPERATION\r\n      }\r\n    }\r\n\r\n    ioReader.onSeek = async (pos) => {\r\n      try {\r\n        const params: {\r\n          pos: int64,\r\n          ioloaderOptions?: Data\r\n        } = {\r\n          pos\r\n        }\r\n        if (options.ioloaderOptions) {\r\n          params.ioloaderOptions = options.ioloaderOptions\r\n        }\r\n        return leftIPCPort.request<int32>('seek', params)\r\n      }\r\n      catch (error) {\r\n        return IOError.INVALID_OPERATION\r\n      }\r\n    }\r\n\r\n    ioReader.onSize = async () => {\r\n      try {\r\n        return leftIPCPort.request<int64>('size')\r\n      }\r\n      catch (error) {\r\n        return static_cast<int64>(IOError.INVALID_OPERATION)\r\n      }\r\n    }\r\n\r\n    const formatContext = createAVIFormatContext()\r\n    formatContext.ioReader = ioReader\r\n\r\n    formatContext.getDecoderResource = async (mediaType, codecId) => {\r\n      if (!controlIPCPort) {\r\n        return\r\n      }\r\n      const wasm: ArrayBuffer | WebAssemblyResource = await controlIPCPort.request('getDecoderResource', {\r\n        codecId,\r\n        mediaType\r\n      })\r\n\r\n      return compileResource(wasm, mediaType === AVMediaType.AVMEDIA_TYPE_VIDEO)\r\n    }\r\n\r\n    this.tasks.set(options.taskId, {\r\n      ...options,\r\n\r\n      leftIPCPort,\r\n      rightIPCPorts: new Map(),\r\n      controlIPCPort,\r\n\r\n      formatContext,\r\n      ioReader,\r\n      buffer: buf,\r\n\r\n      cacheAVPackets: new Map(),\r\n      cacheRequests: new Map(),\r\n      streamIndexFlush: new Map(),\r\n\r\n      realFormat: AVFormat.UNKNOWN,\r\n\r\n      demuxEnded: false,\r\n      loop: null,\r\n\r\n      gopCounter: 0,\r\n      lastKeyFramePts: 0n,\r\n      lastAudioDts: 0n,\r\n      lastVideoDts: 0n,\r\n\r\n      avpacketPool: new AVPacketPoolImpl(accessof(options.avpacketList), options.avpacketListMutex)\r\n    })\r\n\r\n    return 0\r\n  }\r\n\r\n  public async openStream(taskId: string, maxProbeDuration: int32 = 3000) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      let ret = await task.leftIPCPort.request<int32>('open')\r\n\r\n      if (ret < 0) {\r\n        logger.error(`open ioloader failed, ret: ${ret}`)\r\n        return ret\r\n      }\r\n\r\n      let format: AVFormat\r\n      try {\r\n        format = await analyzeAVFormat(task.ioReader, task.format)\r\n        task.format = format\r\n      }\r\n      catch (error) {\r\n        return errorType.DATA_INVALID\r\n      }\r\n\r\n      let iformat: IFormat\r\n\r\n      switch (format) {\r\n        case AVFormat.FLV:\r\n          if (defined(ENABLE_DEMUXER_FLV)) {\r\n            iformat = new ((await import('avformat/formats/IFlvFormat')).default)\r\n          }\r\n          else {\r\n            logger.error('flv format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.MP4:\r\n          if (defined(ENABLE_DEMUXER_MP4) || defined(ENABLE_PROTOCOL_DASH)) {\r\n            iformat = new ((await import('avformat/formats/IMovFormat')).default)\r\n          }\r\n          else {\r\n            logger.error('mp4 format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.MPEGTS:\r\n          if (defined(ENABLE_DEMUXER_MPEGPS) || defined(ENABLE_PROTOCOL_HLS)) {\r\n            iformat = new ((await import('avformat/formats/IMpegtsFormat')).default)\r\n          }\r\n          else {\r\n            logger.error('mpegts format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.MPEGPS:\r\n          if (defined(ENABLE_DEMUXER_MPEGPS)) {\r\n            iformat = new ((await import('avformat/formats/IMpegpsFormat')).default)\r\n          }\r\n          else {\r\n            logger.error('mpegps format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.IVF:\r\n          if (defined(ENABLE_DEMUXER_IVF)) {\r\n            iformat = new ((await import('avformat/formats/IIvfFormat')).default)\r\n          }\r\n          else {\r\n            logger.error('ivf format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.OGG:\r\n          if (defined(ENABLE_DEMUXER_OGGS)) {\r\n            iformat = new ((await import('avformat/formats/IOggFormat')).default)\r\n          }\r\n          else {\r\n            logger.error('oggs format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.MP3:\r\n          if (defined(ENABLE_DEMUXER_MP3)) {\r\n            iformat = new ((await import('avformat/formats/IMp3Format')).default)\r\n          }\r\n          else {\r\n            logger.error('mp3 format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.MATROSKA:\r\n        case AVFormat.WEBM:\r\n          if (defined(ENABLE_DEMUXER_MATROSKA)) {\r\n            iformat = new (((await import('avformat/formats/IMatroskaFormat')).default))\r\n          }\r\n          else {\r\n            logger.error('matroska format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.AAC:\r\n          if (defined(ENABLE_DEMUXER_AAC)) {\r\n            iformat = new (((await import('avformat/formats/IAacFormat')).default))\r\n          }\r\n          else {\r\n            logger.error('aac format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.FLAC:\r\n          if (defined(ENABLE_DEMUXER_FLAC)) {\r\n            iformat = new (((await import('avformat/formats/IFlacFormat')).default))\r\n          }\r\n          else {\r\n            logger.error('flac format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.WAV:\r\n          if (defined(ENABLE_DEMUXER_WAV)) {\r\n            iformat = new (((await import('avformat/formats/IWavFormat')).default))\r\n          }\r\n          else {\r\n            logger.error('wav format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.WEBVTT:\r\n          if (defined(ENABLE_DEMUXER_WEBVTT)) {\r\n            iformat = new (((await import('avformat/formats/IWebVttFormat')).default))\r\n          }\r\n          else {\r\n            logger.error('webvtt format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.SUBRIP:\r\n          if (defined(ENABLE_DEMUXER_SUBRIP)) {\r\n            iformat = new (((await import('avformat/formats/ISubRipFormat')).default))\r\n          }\r\n          else {\r\n            logger.error('subrip format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.ASS:\r\n          if (defined(ENABLE_DEMUXER_ASS)) {\r\n            iformat = new (((await import('avformat/formats/IAssFormat')).default))\r\n          }\r\n          else {\r\n            logger.error('ass format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.TTML:\r\n          if (defined(ENABLE_DEMUXER_TTML)) {\r\n            iformat = new (((await import('avformat/formats/ITtmlFormat')).default))\r\n          }\r\n          else {\r\n            logger.error('ttml format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.H264:\r\n          if (defined(ENABLE_DEMUXER_H264)) {\r\n            iformat = new (((await import('avformat/formats/IH264Format')).default))\r\n          }\r\n          else {\r\n            logger.error('h264 format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.HEVC:\r\n          if (defined(ENABLE_DEMUXER_HEVC)) {\r\n            iformat = new (((await import('avformat/formats/IHevcFormat')).default))\r\n          }\r\n          else {\r\n            logger.error('hevc format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.VVC:\r\n          if (defined(ENABLE_DEMUXER_VVC)) {\r\n            iformat = new (((await import('avformat/formats/IVvcFormat')).default))\r\n          }\r\n          else {\r\n            logger.error('vvc format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        default:\r\n          logger.error('format not support')\r\n          return errorType.FORMAT_NOT_SUPPORT\r\n      }\r\n\r\n      assert(iformat)\r\n\r\n      task.realFormat = format\r\n      task.formatContext.iformat = iformat\r\n\r\n      return demux.open(task.formatContext, {\r\n        maxAnalyzeDuration: maxProbeDuration,\r\n        fastOpen: task.isLive\r\n      })\r\n    }\r\n    else {\r\n      logger.fatal('task not found')\r\n    }\r\n  }\r\n\r\n  public async getFormat(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      return task.realFormat\r\n    }\r\n    else {\r\n      logger.fatal('task not found')\r\n    }\r\n  }\r\n\r\n  public async analyzeStreams(taskId: string): Promise<AVFormatContextInterface> {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n\r\n      await demux.analyzeStreams(task.formatContext)\r\n\r\n      const streams: AVStreamInterface[] = []\r\n      for (let i = 0; i < task.formatContext.streams.length; i++) {\r\n        const stream = task.formatContext.streams[i]\r\n        streams.push({\r\n          index: stream.index,\r\n          id: stream.id,\r\n          codecpar: addressof(stream.codecpar),\r\n          nbFrames: stream.nbFrames,\r\n          metadata: stream.metadata,\r\n          duration: stream.duration,\r\n          startTime: stream.startTime,\r\n          disposition: stream.disposition,\r\n          timeBase: {\r\n            den: stream.timeBase.den,\r\n            num: stream.timeBase.num\r\n          }\r\n        })\r\n      }\r\n      return {\r\n        metadata: task.formatContext.metadata,\r\n        format: task.realFormat,\r\n        chapters: task.formatContext.chapters,\r\n        streams\r\n      }\r\n    }\r\n    else {\r\n      logger.fatal('task not found')\r\n    }\r\n  }\r\n\r\n  private replyAVPacket(task: SelfTask, ipcPort: IPCPort, request: RpcMessage, avpacket: pointer<AVPacketRef>) {\r\n    if (isWorker() && !cheapConfig.USE_THREADS && isPointer(avpacket)) {\r\n      const data = serializeAVPacket(avpacket)\r\n      const transfer = [data.data.buffer]\r\n      if (data.sideData.length) {\r\n        data.sideData.forEach((side) => {\r\n          transfer.push(side.data.buffer)\r\n        })\r\n      }\r\n      ipcPort.reply(request, data, null, transfer)\r\n      task.avpacketPool.release(avpacket)\r\n      return\r\n    }\r\n    ipcPort.reply(request, avpacket)\r\n  }\r\n\r\n  public async connectStreamTask(taskId: string, streamIndex: number, port: MessagePort) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      const ipcPort: IPCPort & { streamIndex?: number } = new IPCPort(port)\r\n\r\n      task.cacheAVPackets.set(streamIndex, [])\r\n\r\n      ipcPort.streamIndex = streamIndex\r\n      ipcPort.on(REQUEST, async (request: RpcMessage) => {\r\n        switch (request.method) {\r\n          case 'pull': {\r\n            const cacheAVPackets = task.cacheAVPackets.get(ipcPort.streamIndex)\r\n            if (cacheAVPackets.length) {\r\n              const avpacket = cacheAVPackets.shift()\r\n              if (task.stats !== nullptr) {\r\n                if (task.formatContext.streams[avpacket.streamIndex].codecpar.codecType === AVMediaType.AVMEDIA_TYPE_AUDIO) {\r\n                  task.stats.audioPacketQueueLength--\r\n                }\r\n                else if (task.formatContext.streams[avpacket.streamIndex].codecpar.codecType === AVMediaType.AVMEDIA_TYPE_VIDEO) {\r\n                  task.stats.videoPacketQueueLength--\r\n                }\r\n              }\r\n              this.replyAVPacket(task, ipcPort, request, avpacket)\r\n            }\r\n            else {\r\n              if (task.demuxEnded) {\r\n                ipcPort.reply(request, IOError.END)\r\n              }\r\n              else {\r\n                task.cacheRequests.set(ipcPort.streamIndex, request)\r\n                if (task.loop && task.loop.isStarted()) {\r\n                  task.loop.resetInterval()\r\n                }\r\n              }\r\n            }\r\n            break\r\n          }\r\n        }\r\n      })\r\n      task.rightIPCPorts.set(streamIndex, ipcPort)\r\n\r\n      logger.debug(`connect stream ${streamIndex}, taskId: ${task.taskId}`)\r\n    }\r\n    else {\r\n      logger.fatal('task not found')\r\n    }\r\n  }\r\n\r\n\r\n  public async changeConnectStream(taskId: string, newStreamIndex: number, oldStreamIndex: number, force: boolean = true) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n\r\n      if (newStreamIndex === oldStreamIndex) {\r\n        return\r\n      }\r\n\r\n      const cache = task.cacheAVPackets.get(oldStreamIndex)\r\n      const ipcPort = task.rightIPCPorts.get(oldStreamIndex)\r\n      const request = task.cacheRequests.get(oldStreamIndex)\r\n\r\n      if (!cache) {\r\n        logger.warn(`oldStreamIndex ${oldStreamIndex} not found`)\r\n      }\r\n\r\n      await task.loop.stopBeforeNextTick()\r\n\r\n      if (force) {\r\n        array.each(cache, (avpacket) => {\r\n          task.avpacketPool.release(avpacket)\r\n        })\r\n        cache.length = 0\r\n      }\r\n      else {\r\n        task.streamIndexFlush.set(newStreamIndex, true)\r\n      }\r\n\r\n      ipcPort.streamIndex = newStreamIndex\r\n\r\n      task.cacheAVPackets.set(newStreamIndex, cache)\r\n      task.rightIPCPorts.set(newStreamIndex, ipcPort)\r\n\r\n      task.cacheAVPackets.delete(oldStreamIndex)\r\n      task.rightIPCPorts.delete(oldStreamIndex)\r\n\r\n      if (request) {\r\n        task.cacheRequests.set(newStreamIndex, request)\r\n        task.cacheRequests.delete(oldStreamIndex)\r\n      }\r\n\r\n      if (!force) {\r\n        task.loop.start()\r\n      }\r\n\r\n      logger.debug(`changed connect stream, new ${newStreamIndex}, old: ${oldStreamIndex}, force: ${force}, taskId: ${task.taskId}`)\r\n    }\r\n    else {\r\n      logger.fatal('task not found')\r\n    }\r\n  }\r\n\r\n  public async startDemux(taskId: string, isLive: boolean, minQueueLength: int32) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      // mpegts 最小 20\r\n      minQueueLength = Math.max(minQueueLength, task.format === AVFormat.MPEGTS ? 20 : 10)\r\n\r\n      if (task.loop) {\r\n        task.loop.destroy()\r\n      }\r\n      task.loop = new LoopTask(async () => {\r\n        if (!isLive) {\r\n          let canDo = false\r\n          task.cacheAVPackets.forEach((list, streamIndex) => {\r\n            const stream = task.formatContext.streams.find((stream) => {\r\n              return stream.index === streamIndex\r\n            })\r\n            if (list.length < minQueueLength\r\n              && (stream.codecpar.codecType !== AVMediaType.AVMEDIA_TYPE_SUBTITLE\r\n                || task.cacheAVPackets.size === 1\r\n              )\r\n            ) {\r\n              canDo = true\r\n            }\r\n          })\r\n\r\n          if (!canDo) {\r\n            task.loop.emptyTask()\r\n            return\r\n          }\r\n        }\r\n\r\n        const avpacket = task.avpacketPool.alloc()\r\n\r\n        let ret = await demux.readAVPacket(task.formatContext, avpacket)\r\n\r\n        if (!ret) {\r\n\r\n          if (defined(ENABLE_LOG_TRACE)) {\r\n            logger.trace(`got packet, index: ${avpacket.streamIndex}, dts: ${avpacket.dts}, pts: ${avpacket.pts}, pos: ${\r\n              avpacket.pos\r\n            }, duration: ${avpacket.duration}, keyframe: ${(avpacket.flags & AVPacketFlags.AV_PKT_FLAG_KEY) ? 'true' : 'false'}`)\r\n          }\r\n\r\n          const streamIndex = avpacket.streamIndex\r\n\r\n          assert(streamIndex !== NOPTS_VALUE)\r\n\r\n          if (task.stats !== nullptr) {\r\n            if (task.formatContext.streams[streamIndex].codecpar.codecType === AVMediaType.AVMEDIA_TYPE_AUDIO\r\n              && task.cacheAVPackets.has(streamIndex)\r\n            ) {\r\n              task.stats.audioPacketCount++\r\n              task.stats.audioPacketBytes += static_cast<int64>(avpacket.size)\r\n              if (task.stats.audioPacketCount > 1 && avpacket.dts > task.lastAudioDts) {\r\n                const list = task.cacheAVPackets.get(streamIndex)\r\n                if (list && list.length) {\r\n                  task.stats.audioEncodeFramerate = Math.round(avpacket.timeBase.den / avpacket.timeBase.num\r\n                    / (static_cast<int32>(avpacket.dts - list[0].dts) / list.length))\r\n                }\r\n                else {\r\n                  task.stats.audioEncodeFramerate = Math.round(avpacket.timeBase.den / avpacket.timeBase.num\r\n                    / static_cast<int32>(avpacket.dts - task.lastAudioDts))\r\n                }\r\n              }\r\n              task.lastAudioDts = avpacket.dts\r\n            }\r\n            else if (task.formatContext.streams[streamIndex].codecpar.codecType === AVMediaType.AVMEDIA_TYPE_VIDEO\r\n              && task.cacheAVPackets.has(streamIndex)\r\n            ) {\r\n              task.stats.videoPacketCount++\r\n              task.stats.videoPacketBytes += static_cast<int64>(avpacket.size)\r\n\r\n              if (avpacket.flags & AVPacketFlags.AV_PKT_FLAG_KEY) {\r\n                task.stats.keyFrameCount++\r\n                if (task.stats.keyFrameCount > 1 && avpacket.pts > task.lastKeyFramePts) {\r\n                  task.stats.gop = task.gopCounter\r\n                  task.gopCounter = 1\r\n                  task.stats.keyFrameInterval = static_cast<int32>(avRescaleQ(\r\n                    avpacket.pts - task.lastKeyFramePts,\r\n                    avpacket.timeBase,\r\n                    AV_MILLI_TIME_BASE_Q\r\n                  ))\r\n                }\r\n                task.lastKeyFramePts = avpacket.pts\r\n              }\r\n              else {\r\n                task.gopCounter++\r\n              }\r\n              if (task.stats.videoPacketCount > 1 && avpacket.dts > task.lastVideoDts) {\r\n                const list = task.cacheAVPackets.get(streamIndex)\r\n                if (list && list.length) {\r\n                  task.stats.videoEncodeFramerate = Math.round(avpacket.timeBase.den / avpacket.timeBase.num\r\n                    / (static_cast<int32>(avpacket.dts - list[0].dts) / list.length))\r\n                }\r\n                else {\r\n                  task.stats.videoEncodeFramerate = Math.round(avpacket.timeBase.den / avpacket.timeBase.num\r\n                    / static_cast<int32>(avpacket.dts - task.lastVideoDts))\r\n                }\r\n              }\r\n              task.lastVideoDts = avpacket.dts\r\n            }\r\n          }\r\n\r\n          if (task.streamIndexFlush.get(streamIndex)) {\r\n            const stream = task.formatContext.streams.find((stream) => {\r\n              return stream.index === streamIndex\r\n            })\r\n            const ele = getAVPacketSideData(avpacket, AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA)\r\n            if (!ele && stream && stream.codecpar.extradataSize) {\r\n              const data = avMalloc(stream.codecpar.extradataSize)\r\n              memcpy(data, stream.codecpar.extradata, stream.codecpar.extradataSize)\r\n              addAVPacketSideData(avpacket, AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA, data, stream.codecpar.extradataSize)\r\n            }\r\n            task.streamIndexFlush.set(streamIndex, false)\r\n          }\r\n\r\n          if (task.cacheRequests.has(streamIndex)) {\r\n            this.replyAVPacket(task, task.rightIPCPorts.get(streamIndex), task.cacheRequests.get(streamIndex), avpacket)\r\n            task.cacheRequests.delete(streamIndex)\r\n          }\r\n          else {\r\n            if (task.cacheAVPackets.has(streamIndex)) {\r\n              task.cacheAVPackets.get(streamIndex).push(avpacket)\r\n              if (task.stats !== nullptr) {\r\n                if (task.formatContext.streams[streamIndex].codecpar.codecType === AVMediaType.AVMEDIA_TYPE_AUDIO) {\r\n                  task.stats.audioPacketQueueLength++\r\n                }\r\n                else if (task.formatContext.streams[streamIndex].codecpar.codecType === AVMediaType.AVMEDIA_TYPE_VIDEO) {\r\n                  task.stats.videoPacketQueueLength++\r\n                }\r\n              }\r\n              if (task.formatContext.streams[streamIndex].codecpar.codecType === AVMediaType.AVMEDIA_TYPE_SUBTITLE) {\r\n                if (task.cacheAVPackets.get(streamIndex).length > minQueueLength) {\r\n                  task.avpacketPool.release(task.cacheAVPackets.get(streamIndex).shift())\r\n                }\r\n              }\r\n            }\r\n            else {\r\n              if (task.rightIPCPorts.has(STREAM_INDEX_ALL)) {\r\n                if (task.cacheRequests.has(STREAM_INDEX_ALL)) {\r\n                  this.replyAVPacket(task, task.rightIPCPorts.get(STREAM_INDEX_ALL), task.cacheRequests.get(STREAM_INDEX_ALL), avpacket)\r\n                  task.cacheRequests.delete(STREAM_INDEX_ALL)\r\n                }\r\n                else {\r\n                  task.cacheAVPackets.get(STREAM_INDEX_ALL).push(avpacket)\r\n                }\r\n              }\r\n              else {\r\n                task.avpacketPool.release(avpacket)\r\n              }\r\n            }\r\n          }\r\n        }\r\n        else {\r\n          task.avpacketPool.release(avpacket)\r\n          if (ret !== IOError.END) {\r\n            logger.error(`demux error, ret: ${ret}, taskId: ${taskId}`)\r\n          }\r\n\r\n          task.demuxEnded = true\r\n\r\n          logger.info(`demuxer ended, taskId: ${task.taskId}`)\r\n\r\n          for (let streamIndex of task.cacheRequests.keys()) {\r\n            const cacheAVPackets = task.cacheAVPackets.get(streamIndex)\r\n            if (!cacheAVPackets.length) {\r\n              task.rightIPCPorts.get(streamIndex).reply(task.cacheRequests.get(streamIndex), IOError.END)\r\n              task.cacheRequests.delete(streamIndex)\r\n            }\r\n          }\r\n          task.loop.stop()\r\n        }\r\n      }, 0, 0, true, false)\r\n\r\n      task.loop.start()\r\n\r\n      logger.debug(`start demux loop, taskId: ${task.taskId}`)\r\n    }\r\n    else {\r\n      logger.fatal('task not found')\r\n    }\r\n  }\r\n\r\n  public async seek(taskId: string, timestamp: int64, flags: int32, streamIndex: int32 = -1): Promise<int64> {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (task.loop) {\r\n        await task.loop.stopBeforeNextTick()\r\n        let ret = await demux.seek(task.formatContext, streamIndex, timestamp, flags)\r\n        if (ret >= 0n) {\r\n          task.cacheAVPackets.forEach((list) => {\r\n            array.each(list, (avpacket) => {\r\n              task.avpacketPool.release(avpacket)\r\n            })\r\n            list.length = 0\r\n          })\r\n\r\n          if (task.stats !== nullptr) {\r\n            // 判断当前 task 处理的 stream 来重置\r\n            task.cacheAVPackets.forEach((list, streamIndex) => {\r\n              const stream = task.formatContext.streams.find((stream) => {\r\n                return stream.index === streamIndex\r\n              })\r\n              if (stream.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_AUDIO) {\r\n                task.stats.audioPacketQueueLength = 0\r\n              }\r\n              else if (stream.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_VIDEO) {\r\n                task.stats.videoPacketQueueLength = 0\r\n              }\r\n            })\r\n          }\r\n\r\n          const avpacket = task.avpacketPool.alloc() as pointer<AVPacketRef>\r\n\r\n          while (true) {\r\n            ret = await demux.readAVPacket(task.formatContext, avpacket)\r\n            if (ret < 0 || task.cacheAVPackets.has(avpacket.streamIndex)) {\r\n              break\r\n            }\r\n          }\r\n\r\n          if (ret >= 0) {\r\n            task.demuxEnded = false\r\n            const streamIndex = avpacket.streamIndex\r\n            task.cacheAVPackets.get(streamIndex).push(avpacket)\r\n\r\n            if (task.stats !== nullptr) {\r\n              if (task.formatContext.streams[avpacket.streamIndex].codecpar.codecType === AVMediaType.AVMEDIA_TYPE_AUDIO) {\r\n                task.stats.audioPacketQueueLength++\r\n              }\r\n              else if (task.formatContext.streams[avpacket.streamIndex].codecpar.codecType === AVMediaType.AVMEDIA_TYPE_VIDEO) {\r\n                task.stats.videoPacketQueueLength++\r\n              }\r\n            }\r\n\r\n            task.loop.start()\r\n            let duration = avpacket.pts\r\n            if (task.formatContext.streams[streamIndex].startTime !== NOPTS_VALUE_BIGINT) {\r\n              duration -= task.formatContext.streams[streamIndex].startTime\r\n            }\r\n            else {\r\n              duration -= task.formatContext.streams[streamIndex].firstDTS\r\n            }\r\n            return avRescaleQ(bigint.max(duration, 0n), avpacket.timeBase, AV_MILLI_TIME_BASE_Q)\r\n          }\r\n          else {\r\n\r\n            logger.warn(`got first packet failed after seek, taskId: ${task.taskId}`)\r\n\r\n            task.avpacketPool.release(avpacket)\r\n            task.demuxEnded = true\r\n            return timestamp\r\n          }\r\n        }\r\n        return ret\r\n      }\r\n      else {\r\n\r\n        logger.info('seek before demux loop start')\r\n\r\n        let ret = await demux.seek(task.formatContext, -1, timestamp, flags)\r\n        if (ret < 0) {\r\n          return ret\r\n        }\r\n        return timestamp\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 裁剪 avpacket 队列大小\r\n   *\r\n   * @param taskId\r\n   * @param max （毫秒）\r\n   */\r\n  public async croppingAVPacketQueue(taskId: string, max: int64) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n\r\n      let croppingMax = max\r\n\r\n      const indexes: Map<number, number> = new Map()\r\n\r\n      function hasSps(avpacket: pointer<AVPacketRef>, codecId: AVCodecID) {\r\n        if (!(avpacket.flags & AVPacketFlags.AV_PKT_FLAG_KEY)) {\r\n          return false\r\n        }\r\n        let hasNewSps = getAVPacketSideData(avpacket, AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA) !== nullptr\r\n        if (!hasNewSps && avpacket.bitFormat === h264.BitFormat.ANNEXB) {\r\n          if (codecId === AVCodecID.AV_CODEC_ID_H264) {\r\n            hasNewSps = !!h264.annexbExtradata2AvccExtradata(getAVPacketData(avpacket))\r\n          }\r\n          else if (codecId === AVCodecID.AV_CODEC_ID_HEVC) {\r\n            hasNewSps = !!hevc.annexbExtradata2AvccExtradata(getAVPacketData(avpacket))\r\n          }\r\n          else if (codecId === AVCodecID.AV_CODEC_ID_VVC) {\r\n            hasNewSps = !!vvc.annexbExtradata2AvccExtradata(getAVPacketData(avpacket))\r\n          }\r\n        }\r\n        return hasNewSps\r\n      }\r\n\r\n      // 先处理视频\r\n      task.cacheAVPackets.forEach((list, streamIndex) => {\r\n        const codecType = task.formatContext.streams[streamIndex].codecpar.codecType\r\n        const codecId = task.formatContext.streams[streamIndex].codecpar.codecId\r\n        if (codecType === AVMediaType.AVMEDIA_TYPE_VIDEO) {\r\n          const lastDts = list[list.length - 1].dts\r\n          let i = list.length - 2\r\n          for (i = list.length - 2; i >= 0; i--) {\r\n            if ((list[i].flags & AVPacketFlags.AV_PKT_FLAG_KEY)) {\r\n              if (avRescaleQ(lastDts - list[i].dts, list[i].timeBase, AV_MILLI_TIME_BASE_Q) >= max) {\r\n                croppingMax = bigint.max(croppingMax, avRescaleQ(lastDts - list[i].dts, list[i].timeBase, AV_MILLI_TIME_BASE_Q))\r\n                break\r\n              }\r\n            }\r\n          }\r\n          if (codecId === AVCodecID.AV_CODEC_ID_H264\r\n            || codecId === AVCodecID.AV_CODEC_ID_HEVC\r\n            || codecId === AVCodecID.AV_CODEC_ID_VVC\r\n          ) {\r\n            if (i > 0 && !hasSps(list[i], codecId)) {\r\n              for (let j = i - 1; j > 0; j--) {\r\n                if ((list[j].flags & AVPacketFlags.AV_PKT_FLAG_KEY)) {\r\n                  // 前面有新的 sps，裁剪到最新的 sps 处\r\n                  if (hasSps(list[j], codecId)) {\r\n                    croppingMax = bigint.max(croppingMax, avRescaleQ(lastDts - list[j].dts, list[j].timeBase, AV_MILLI_TIME_BASE_Q))\r\n                    i = j\r\n                    break\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n          if (i > 0) {\r\n            indexes.set(streamIndex, i)\r\n          }\r\n        }\r\n      })\r\n\r\n      // 再处理非视频，裁剪到视频处\r\n      task.cacheAVPackets.forEach((list, streamIndex) => {\r\n        const codecType = task.formatContext.streams[streamIndex].codecpar.codecType\r\n        if (codecType !== AVMediaType.AVMEDIA_TYPE_VIDEO) {\r\n          const lastDts = list[list.length - 1].dts\r\n          let i = list.length - 2\r\n          for (i = list.length - 2; i >= 0; i--) {\r\n            // 使用视频的裁剪时间\r\n            if (avRescaleQ(lastDts - list[i].dts, list[i].timeBase, AV_MILLI_TIME_BASE_Q) >= croppingMax) {\r\n              break\r\n            }\r\n          }\r\n          if (i >= 0) {\r\n            indexes.set(streamIndex, i)\r\n          }\r\n        }\r\n      })\r\n      // 判断所有流是否都支持裁剪\r\n      if (indexes.size === task.cacheAVPackets.size) {\r\n        indexes.forEach((index, streamIndex) => {\r\n\r\n          const list = task.cacheAVPackets.get(streamIndex)\r\n          list.splice(0, index).forEach((avpacket) => {\r\n            task.avpacketPool.release(avpacket)\r\n          })\r\n\r\n          const codecType = task.formatContext.streams[streamIndex].codecpar.codecType\r\n\r\n          if (task.stats !== nullptr) {\r\n            if (codecType === AVMediaType.AVMEDIA_TYPE_AUDIO) {\r\n              task.stats.audioPacketQueueLength = list.length\r\n            }\r\n            else if (codecType === AVMediaType.AVMEDIA_TYPE_VIDEO) {\r\n              task.stats.videoPacketQueueLength = list.length\r\n            }\r\n          }\r\n        })\r\n      }\r\n    }\r\n  }\r\n\r\n  public async registerTask(options: DemuxTaskOptions): Promise<number> {\r\n    if (this.tasks.has(options.taskId)) {\r\n      return errorType.INVALID_OPERATE\r\n    }\r\n    return this.createTask(options)\r\n  }\r\n\r\n  public async unregisterTask(taskId: string): Promise<void> {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (task.loop) {\r\n        await task.loop.stopBeforeNextTick()\r\n        task.loop.destroy()\r\n      }\r\n      task.leftIPCPort.destroy()\r\n      task.rightIPCPorts.forEach((ipcPort) => {\r\n        ipcPort.destroy()\r\n      })\r\n      task.rightIPCPorts.clear()\r\n      task.formatContext.destroy()\r\n\r\n      avFree(task.buffer)\r\n\r\n      task.cacheAVPackets.forEach((list) => {\r\n        list.forEach((avpacket) => {\r\n          task.avpacketPool.release(avpacket)\r\n        })\r\n      })\r\n\r\n      this.tasks.delete(taskId)\r\n    }\r\n  }\r\n}\r\n","/*\r\n * libmedia IOPipeline\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { Data } from 'common/types/type'\r\nimport Pipeline, { TaskOptions } from './Pipeline'\r\nimport FetchIOLoader from 'avnetwork/ioLoader/FetchIOLoader'\r\nimport IOLoader, { IOLoaderOptions, Range } from 'avnetwork/ioLoader/IOLoader'\r\nimport * as errorType from 'avutil/error'\r\nimport IPCPort from 'common/network/IPCPort'\r\nimport { REQUEST, RpcMessage } from 'common/network/IPCPort'\r\nimport { mapSafeUint8Array } from 'cheap/std/memory'\r\nimport FileIOLoader from 'avnetwork/ioLoader/FileIOLoader'\r\nimport * as logger from 'common/util/logger'\r\nimport DashIOLoader from 'avnetwork/ioLoader/DashIOLoader'\r\nimport HlsIOLoader from 'avnetwork/ioLoader/HlsIOLoader'\r\n\r\nexport const enum IOType {\r\n  Fetch,\r\n  File,\r\n  HLS,\r\n  DASH\r\n}\r\n\r\nexport interface IOTaskOptions extends TaskOptions {\r\n  type: IOType\r\n  options: IOLoaderOptions\r\n  info: Data\r\n  range: Range\r\n}\r\n\r\ntype SelfTask = IOTaskOptions & {\r\n  ioLoader: IOLoader\r\n  ipcPort: IPCPort\r\n}\r\n\r\nexport default class IOPipeline extends Pipeline {\r\n\r\n  declare tasks: Map<string, SelfTask>\r\n\r\n  constructor() {\r\n    super()\r\n  }\r\n\r\n  private async createTask(options: IOTaskOptions): Promise<number> {\r\n    let ioLoader: IOLoader\r\n\r\n    switch (options.type) {\r\n      case IOType.Fetch:\r\n        ioLoader = new FetchIOLoader(options.options)\r\n        break\r\n      case IOType.File:\r\n        ioLoader = new FileIOLoader(options.options)\r\n        break\r\n      case IOType.HLS:\r\n        if (defined(ENABLE_PROTOCOL_HLS)) {\r\n          ioLoader = new (await import('avnetwork/ioLoader/HlsIOLoader')).default(options.options)\r\n        }\r\n        else {\r\n          logger.error('hls protocol not support, maybe you can rebuild avmedia')\r\n          return errorType.FORMAT_NOT_SUPPORT\r\n        }\r\n        break\r\n      case IOType.DASH:\r\n        if (defined(ENABLE_PROTOCOL_DASH)) {\r\n          ioLoader = new (await import('avnetwork/ioLoader/DashIOLoader')).default(options.options)\r\n        }\r\n        else {\r\n          logger.error('dash protocol not support, maybe you can rebuild avmedia')\r\n          return errorType.FORMAT_NOT_SUPPORT\r\n        }\r\n        break\r\n    }\r\n\r\n    if (!ioLoader) {\r\n      return errorType.INVALID_ARGUMENT\r\n    }\r\n\r\n    assert(options.rightPort)\r\n\r\n    const ipcPort = new IPCPort(options.rightPort)\r\n\r\n    const task = {\r\n      ...options,\r\n      ioLoader,\r\n      ipcPort\r\n    }\r\n\r\n    ipcPort.on(REQUEST, async (request: RpcMessage) => {\r\n      switch (request.method) {\r\n        case 'open': {\r\n          try {\r\n            const ret = await ioLoader.open(options.info, options.range)\r\n            if (ret < 0) {\r\n              logger.error(`loader open error, ${ret}, taskId: ${options.taskId}`)\r\n              ipcPort.reply(request, null, ret)\r\n              break\r\n            }\r\n            ipcPort.reply(request, ret)\r\n          }\r\n          catch (error) {\r\n            logger.error(`loader open error, ${error}, taskId: ${options.taskId}`)\r\n            ipcPort.reply(request, null, error)\r\n          }\r\n          break\r\n        }\r\n        case 'read': {\r\n          const pointer = request.params.pointer\r\n          const length = request.params.length\r\n          const ioloaderOptions = request.params.ioloaderOptions\r\n\r\n          assert(pointer)\r\n          assert(length)\r\n\r\n          const buffer = mapSafeUint8Array(pointer, length)\r\n\r\n          try {\r\n            const len = await ioLoader.read(buffer, ioloaderOptions)\r\n            task.stats.bufferReceiveBytes += static_cast<int64>(len)\r\n            ipcPort.reply(request, len)\r\n          }\r\n          catch (error) {\r\n            logger.error(`loader read error, ${error}, taskId: ${options.taskId}`)\r\n            ipcPort.reply(request, errorType.DATA_INVALID)\r\n          }\r\n\r\n          break\r\n        }\r\n\r\n        case 'seek': {\r\n          const pos = request.params.pos\r\n          const ioloaderOptions = request.params.ioloaderOptions\r\n\r\n          assert(pos >= 0)\r\n\r\n          try {\r\n            const ret = await ioLoader.seek(pos, ioloaderOptions)\r\n            if (ret < 0) {\r\n              logger.error(`loader seek error, ${ret}, taskId: ${options.taskId}`)\r\n              ipcPort.reply(request, null, ret)\r\n              break\r\n            }\r\n            ipcPort.reply(request, ret)\r\n          }\r\n          catch (error) {\r\n            logger.error(`loader seek error, ${error}, taskId: ${options.taskId}`)\r\n            ipcPort.reply(request, null, error)\r\n          }\r\n          break\r\n        }\r\n\r\n        case 'size': {\r\n          ipcPort.reply(request, await ioLoader.size())\r\n          break\r\n        }\r\n      }\r\n    })\r\n\r\n    this.tasks.set(options.taskId, task)\r\n\r\n    return 0\r\n  }\r\n\r\n  public async open(id: string) {\r\n    const task = this.tasks.get(id)\r\n    if (task) {\r\n      await task.ioLoader.open(task.info, task.range)\r\n      return 0\r\n    }\r\n  }\r\n\r\n  public async getDuration(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (defined(ENABLE_PROTOCOL_DASH) || defined(ENABLE_PROTOCOL_HLS)) {\r\n        if (task.type === IOType.HLS || task.type === IOType.DASH) {\r\n          return (task.ioLoader as DashIOLoader).getDuration()\r\n        }\r\n      }\r\n      return 0\r\n    }\r\n  }\r\n\r\n  public async hasAudio(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (defined(ENABLE_PROTOCOL_DASH)) {\r\n        if (task.type === IOType.DASH) {\r\n          return (task.ioLoader as DashIOLoader).hasAudio()\r\n        }\r\n      }\r\n    }\r\n    return false\r\n  }\r\n\r\n  public async hasVideo(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (defined(ENABLE_PROTOCOL_DASH)) {\r\n        if (task.type === IOType.DASH) {\r\n          return (task.ioLoader as DashIOLoader).hasVideo()\r\n        }\r\n      }\r\n    }\r\n    return false\r\n  }\r\n\r\n  public async hasSubtitle(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (defined(ENABLE_PROTOCOL_DASH)) {\r\n        if (task.type === IOType.DASH) {\r\n          return (task.ioLoader as DashIOLoader).hasSubtitle()\r\n        }\r\n      }\r\n    }\r\n    return false\r\n  }\r\n\r\n  public async getVideoList(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (defined(ENABLE_PROTOCOL_DASH) || defined(ENABLE_PROTOCOL_HLS)) {\r\n        if (task.type === IOType.DASH) {\r\n          return (task.ioLoader as DashIOLoader).getVideoList()\r\n        }\r\n        else if (task.type === IOType.HLS) {\r\n          return (task.ioLoader as HlsIOLoader).getVideoList()\r\n        }\r\n      }\r\n    }\r\n    return {\r\n      list: [],\r\n      selectedIndex: 0\r\n    }\r\n  }\r\n\r\n  public async getAudioList(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (defined(ENABLE_PROTOCOL_DASH)) {\r\n        if (task.type === IOType.DASH) {\r\n          return (task.ioLoader as DashIOLoader).getAudioList()\r\n        }\r\n      }\r\n    }\r\n    return {\r\n      list: [],\r\n      selectedIndex: 0\r\n    }\r\n  }\r\n\r\n  public async getSubtitleList(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (defined(ENABLE_PROTOCOL_DASH)) {\r\n        if (task.type === IOType.DASH) {\r\n          return (task.ioLoader as DashIOLoader).getSubtitleList()\r\n        }\r\n      }\r\n    }\r\n    return {\r\n      list: [],\r\n      selectedIndex: 0\r\n    }\r\n  }\r\n\r\n  public async selectVideo(taskId: string, index: number) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (defined(ENABLE_PROTOCOL_DASH) || defined(ENABLE_PROTOCOL_HLS)) {\r\n        if (task.type === IOType.DASH) {\r\n          (task.ioLoader as DashIOLoader).selectVideo(index)\r\n        }\r\n        else if (task.type === IOType.HLS) {\r\n          return (task.ioLoader as HlsIOLoader).selectVideo(index)\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public async selectAudio(taskId: string, index: number) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (defined(ENABLE_PROTOCOL_DASH)) {\r\n        if (task.type === IOType.DASH) {\r\n          (task.ioLoader as DashIOLoader).selectAudio(index)\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public async selectSubtitle(taskId: string, index: number) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (defined(ENABLE_PROTOCOL_DASH)) {\r\n        if (task.type === IOType.DASH) {\r\n          (task.ioLoader as DashIOLoader).selectSubtitle(index)\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  public async getMinBuffer(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (defined(ENABLE_PROTOCOL_DASH)) {\r\n        if (task.type === IOType.DASH) {\r\n          return (task.ioLoader as DashIOLoader).getMinBuffer()\r\n        }\r\n      }\r\n      if (defined(ENABLE_PROTOCOL_HLS)) {\r\n        if (task.type === IOType.HLS) {\r\n          return (task.ioLoader as HlsIOLoader).getMinBuffer()\r\n        }\r\n      }\r\n    }\r\n    return 0\r\n  }\r\n\r\n  public async registerTask(options: IOTaskOptions): Promise<number> {\r\n    if (this.tasks.has(options.taskId)) {\r\n      return errorType.INVALID_OPERATE\r\n    }\r\n    return this.createTask(options)\r\n  }\r\n\r\n  public async unregisterTask(id: string): Promise<void> {\r\n    const task = this.tasks.get(id)\r\n    if (task) {\r\n      await task.ioLoader.stop()\r\n      task.ipcPort.destroy()\r\n      this.tasks.delete(id)\r\n    }\r\n  }\r\n}\r\n","/*\r\n * libmedia MuxPipeline\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport Pipeline, { TaskOptions } from './Pipeline'\r\nimport * as errorType from 'avutil/error'\r\nimport IPCPort from 'common/network/IPCPort'\r\nimport { AVOFormatContext, createAVOFormatContext } from 'avformat/AVFormatContext'\r\nimport * as mux from 'avformat/mux'\r\nimport { AVFormat } from 'avformat/avformat'\r\nimport List from 'cheap/std/collection/List'\r\nimport { AVPacketPool, AVPacketRef } from 'avutil/struct/avpacket'\r\nimport { Mutex } from 'cheap/thread/mutex'\r\nimport * as logger from 'common/util/logger'\r\nimport AVPacketPoolImpl from 'avutil/implement/AVPacketPoolImpl'\r\nimport { IOError } from 'common/io/error'\r\nimport LoopTask from 'common/timer/LoopTask'\r\nimport * as array from 'common/util/array'\r\nimport { avRescaleQ } from 'avutil/util/rational'\r\nimport { AV_MILLI_TIME_BASE_Q, NOPTS_VALUE_BIGINT } from 'avutil/constant'\r\nimport OFormat from 'avformat/formats/OFormat'\r\nimport IOWriterSync from 'common/io/IOWriterSync'\r\nimport { AVStreamInterface } from 'avformat/AVStream'\r\nimport { copyCodecParameters } from 'avutil/util/codecparameters'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport { AVMediaType } from 'avutil/codec'\r\nimport { Data } from 'common/types/type'\r\nimport * as object from 'common/util/object'\r\n\r\nexport interface MuxTaskOptions extends TaskOptions {\r\n  isLive?: boolean\r\n  format: AVFormat\r\n  formatOptions: Data\r\n  avpacketList: pointer<List<pointer<AVPacketRef>>>\r\n  avpacketListMutex: pointer<Mutex>\r\n}\r\n\r\ntype SelfTask = MuxTaskOptions & {\r\n  rightIPCPort: IPCPort\r\n  formatContext: AVOFormatContext\r\n  avpacketPool: AVPacketPool\r\n  loop: LoopTask\r\n  ended: boolean\r\n  streams: {\r\n    stream: AVStreamInterface\r\n    pullIPC: IPCPort\r\n    avpacket: pointer<AVPacketRef>\r\n    ended: boolean\r\n  }[]\r\n}\r\n\r\nexport default class MuxPipeline extends Pipeline {\r\n\r\n  declare tasks: Map<string, SelfTask>\r\n\r\n  constructor() {\r\n    super()\r\n  }\r\n\r\n  private createTask(options: MuxTaskOptions): number {\r\n\r\n    assert(options.rightPort)\r\n    const rightIPCPort = new IPCPort(options.rightPort)\r\n\r\n    const formatContext = createAVOFormatContext()\r\n    const ioWriter = new IOWriterSync(5 * 1024 * 1024)\r\n\r\n    ioWriter.onFlush = (data: Uint8Array, pos: int64) => {\r\n      const buffer = data.slice()\r\n      rightIPCPort.notify('write', {\r\n        data: buffer,\r\n        pos\r\n      }, [buffer.buffer])\r\n      return 0\r\n    }\r\n    ioWriter.onSeek = (pos) => {\r\n      rightIPCPort.notify('seek', {\r\n        pos\r\n      })\r\n      return 0\r\n    }\r\n\r\n    formatContext.ioWriter = ioWriter\r\n\r\n    this.tasks.set(options.taskId, {\r\n      ...options,\r\n      rightIPCPort,\r\n      formatContext,\r\n      loop: null,\r\n      ended: false,\r\n      streams: [],\r\n      avpacketPool: new AVPacketPoolImpl(accessof(options.avpacketList), options.avpacketListMutex)\r\n    })\r\n\r\n    return 0\r\n  }\r\n\r\n  public async open(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n\r\n      let oformat: OFormat\r\n\r\n      switch (task.format) {\r\n        case AVFormat.FLV:\r\n          if (defined(ENABLE_MUXER_FLV)) {\r\n            oformat = new ((await import('avformat/formats/OFlvFormat')).default)(task.formatOptions)\r\n          }\r\n          else {\r\n            logger.error('flv format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.MP4:\r\n          if (defined(ENABLE_MUXER_MP4) || defined(ENABLE_PROTOCOL_DASH)) {\r\n            oformat = new ((await import('avformat/formats/OMovFormat')).default)(task.formatOptions)\r\n          }\r\n          else {\r\n            logger.error('mp4 format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.MPEGTS:\r\n          if (defined(ENABLE_MUXER_MP4) || defined(ENABLE_PROTOCOL_HLS)) {\r\n            oformat = new ((await import('avformat/formats/OMpegtsFormat')).default)(task.formatOptions)\r\n          }\r\n          else {\r\n            logger.error('mpegts format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.IVF:\r\n          if (defined(ENABLE_MUXER_IVF)) {\r\n            oformat = new ((await import('avformat/formats/OIvfFormat')).default)\r\n          }\r\n          else {\r\n            logger.error('ivf format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.OGG:\r\n          if (defined(ENABLE_MUXER_OGGS)) {\r\n            oformat = new ((await import('avformat/formats/OOggFormat')).default)\r\n          }\r\n          else {\r\n            logger.error('oggs format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.MP3:\r\n          if (defined(ENABLE_MUXER_MP3)) {\r\n            oformat = new ((await import('avformat/formats/OMp3Format')).default)(task.formatOptions)\r\n          }\r\n          else {\r\n            logger.error('mp3 format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        case AVFormat.MATROSKA:\r\n        case AVFormat.WEBM:\r\n          if (defined(ENABLE_MUXER_MATROSKA)) {\r\n            const options = {\r\n              isLive: task.isLive,\r\n              docType: task.format === AVFormat.WEBM ? 'webm' : 'matroska'\r\n            }\r\n            oformat = new (((await import('avformat/formats/OMatroskaFormat')).default))(object.extend(task.formatOptions, options))\r\n          }\r\n          else {\r\n            logger.error('matroska format not support, maybe you can rebuild avmedia')\r\n            return errorType.FORMAT_NOT_SUPPORT\r\n          }\r\n          break\r\n        default:\r\n          logger.error('format not support')\r\n          return errorType.FORMAT_NOT_SUPPORT\r\n      }\r\n\r\n      assert(oformat)\r\n\r\n      task.formatContext.oformat = oformat\r\n\r\n      for (let i = 0; i < task.streams.length; i++) {\r\n        const avpacket = await task.streams[i].pullIPC.request<pointer<AVPacketRef>>('pull')\r\n        if (avpacket === IOError.END) {\r\n          task.streams[i].ended = true\r\n        }\r\n        else if (avpacket < 0) {\r\n          logger.error(`pull stream ${i} avpacket error, ret: ${avpacket}`)\r\n          task.streams[i].ended = true\r\n          return errorType.DATA_INVALID\r\n        }\r\n        else {\r\n          avpacket.streamIndex = task.streams[i].stream.index\r\n          task.streams[i].avpacket = avpacket\r\n          const currentDts = avRescaleQ(task.streams[i].avpacket.dts, task.streams[i].avpacket.timeBase, AV_MILLI_TIME_BASE_Q)\r\n          if (task.streams[i].stream.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_AUDIO) {\r\n            task.stats.firstAudioMuxDts = currentDts\r\n          }\r\n          else if (task.streams[i].stream.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_VIDEO) {\r\n            task.stats.firstVideoMuxDts = currentDts\r\n          }\r\n        }\r\n      }\r\n      return 0\r\n    }\r\n    else {\r\n      logger.fatal('task not found')\r\n    }\r\n  }\r\n\r\n  public async addStream(taskId: string, stream: AVStreamInterface, port: MessagePort) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      task.streams.push({\r\n        stream,\r\n        pullIPC: new IPCPort(port),\r\n        avpacket: nullptr,\r\n        ended: false\r\n      })\r\n      const ostream = task.formatContext.createStream()\r\n      ostream.id = stream.id\r\n      ostream.index = stream.index\r\n      copyCodecParameters(addressof(ostream.codecpar), stream.codecpar)\r\n      ostream.timeBase.num = stream.timeBase.num\r\n      ostream.timeBase.den = stream.timeBase.den\r\n      ostream.metadata = stream.metadata\r\n    }\r\n    else {\r\n      logger.fatal('task not found')\r\n    }\r\n  }\r\n\r\n  public async updateAVCodecParameters(taskId: string, streamIndex: int32, codecpar: pointer<AVCodecParameters>) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      const stream = task.formatContext.getStreamByIndex(streamIndex)\r\n      if (stream) {\r\n        copyCodecParameters(addressof(stream.codecpar), codecpar)\r\n      }\r\n    }\r\n    else {\r\n      logger.fatal('task not found')\r\n    }\r\n  }\r\n\r\n  public async start(taskId: string): Promise<number> {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n\r\n      if (task.loop) {\r\n        logger.error('task has started')\r\n        return errorType.INVALID_OPERATE\r\n      }\r\n\r\n      let ret = mux.open(task.formatContext)\r\n\r\n      if (ret < 0) {\r\n        logger.error('mux task open error')\r\n        return errorType.FORMAT_NOT_SUPPORT\r\n      }\r\n\r\n      mux.writeHeader(task.formatContext)\r\n\r\n      if (!task.streams.length) {\r\n        logger.error('task streams not found')\r\n        return errorType.INVALID_OPERATE\r\n      }\r\n\r\n      task.loop = new LoopTask(async () => {\r\n\r\n        for (let i = 0; i < task.streams.length; i++) {\r\n          if (!task.streams[i].ended && !task.streams[i].avpacket) {\r\n            const avpacket = await task.streams[i].pullIPC.request<pointer<AVPacketRef>>('pull')\r\n            if (avpacket === IOError.END) {\r\n              task.streams[i].ended = true\r\n            }\r\n            else if (avpacket < 0) {\r\n              logger.error(`pull stream ${i} avpacket error, ret: ${avpacket}`)\r\n              task.streams[i].ended = true\r\n              task.loop.stop()\r\n              task.ended = true\r\n              task.rightIPCPort.notify('error')\r\n              return\r\n            }\r\n            else {\r\n              avpacket.streamIndex = task.streams[i].stream.index\r\n              task.streams[i].avpacket = avpacket\r\n            }\r\n          }\r\n        }\r\n\r\n        let avpacket: pointer<AVPacketRef> = nullptr\r\n        let dts: int64 = NOPTS_VALUE_BIGINT\r\n        let index = 0\r\n        let type: AVMediaType = AVMediaType.AVMEDIA_TYPE_UNKNOWN\r\n\r\n        for (let i = 0; i < task.streams.length; i++) {\r\n          if (task.streams[i].avpacket) {\r\n            const currentDts = avRescaleQ(task.streams[i].avpacket.dts, task.streams[i].avpacket.timeBase, AV_MILLI_TIME_BASE_Q)\r\n            if (dts === NOPTS_VALUE_BIGINT || currentDts < dts) {\r\n              avpacket = task.streams[i].avpacket\r\n              dts = currentDts\r\n              index = i\r\n              type = task.streams[i].stream.codecpar.codecType\r\n            }\r\n          }\r\n        }\r\n        if (avpacket) {\r\n          const now = task.formatContext.ioWriter.getPos()\r\n          mux.writeAVPacket(task.formatContext, avpacket)\r\n          task.stats.bufferOutputBytes += task.formatContext.ioWriter.getPos() - now\r\n          task.avpacketPool.release(avpacket)\r\n          task.streams[index].avpacket = nullptr\r\n\r\n          if (type === AVMediaType.AVMEDIA_TYPE_AUDIO) {\r\n            task.stats.lastAudioMuxDts = dts\r\n          }\r\n          else if (type === AVMediaType.AVMEDIA_TYPE_VIDEO) {\r\n            task.stats.lastVideoMuxDts = dts\r\n          }\r\n        }\r\n        else {\r\n          mux.writeTrailer(task.formatContext)\r\n          mux.flush(task.formatContext)\r\n          task.rightIPCPort.notify('end')\r\n          task.loop.stop()\r\n          task.ended = true\r\n        }\r\n      }, 0, 0, false, false)\r\n      task.loop.start()\r\n\r\n      return 0\r\n    }\r\n    else {\r\n      logger.error('task not found')\r\n      return errorType.INVALID_OPERATE\r\n    }\r\n  }\r\n\r\n  public async pause(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (task.loop) {\r\n        await task.loop.stopBeforeNextTick()\r\n      }\r\n    }\r\n    else {\r\n      logger.fatal('task not found')\r\n    }\r\n  }\r\n\r\n  public async unpause(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (task.loop && !task.loop.isStarted() && !task.ended) {\r\n        task.loop.start()\r\n      }\r\n    }\r\n    else {\r\n      logger.fatal('task not found')\r\n    }\r\n  }\r\n\r\n  public async registerTask(options: MuxTaskOptions): Promise<number> {\r\n    if (this.tasks.has(options.taskId)) {\r\n      return errorType.INVALID_OPERATE\r\n    }\r\n    return this.createTask(options)\r\n  }\r\n\r\n  public async unregisterTask(taskId: string): Promise<void> {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (task.loop) {\r\n        await task.loop.stopBeforeNextTick()\r\n        task.loop.destroy()\r\n      }\r\n      array.each(task.streams, (stream) => {\r\n        if (stream.avpacket) {\r\n          task.avpacketPool.release(stream.avpacket)\r\n          stream.avpacket = nullptr\r\n        }\r\n        stream.pullIPC.destroy()\r\n      })\r\n      task.formatContext.destroy()\r\n      this.tasks.delete(taskId)\r\n    }\r\n  }\r\n}\r\n","/*\r\n * libmedia abstract Pipeline\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport Stats from './struct/stats'\r\nimport * as logger from 'common/util/logger'\r\n\r\nexport interface TaskOptions {\r\n  leftPort?: MessagePort\r\n  rightPort?: MessagePort\r\n  controlPort?: MessagePort\r\n  taskId: string\r\n  stats: pointer<Stats>\r\n}\r\n\r\nexport default abstract class Pipeline {\r\n\r\n  protected tasks: Map<string, TaskOptions>\r\n\r\n  abstract registerTask(options: TaskOptions): Promise<number>\r\n  abstract unregisterTask(id: string): Promise<void>\r\n\r\n  constructor() {\r\n    this.tasks = new Map()\r\n  }\r\n\r\n  public async clear() {\r\n    if (this.tasks.size) {\r\n      for (const key of this.tasks.keys()) {\r\n        await this.unregisterTask(key)\r\n      }\r\n    }\r\n  }\r\n\r\n  public async setLogLevel(level: number) {\r\n    logger.setLevel(level)\r\n  }\r\n\r\n  public async getTaskCount() {\r\n    return this.tasks.size\r\n  }\r\n}\r\n","/*\r\n * libmedia VideoDecodePipeline\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport Pipeline, { TaskOptions } from './Pipeline'\r\nimport * as errorType from 'avutil/error'\r\nimport IPCPort from 'common/network/IPCPort'\r\nimport { REQUEST, RpcMessage } from 'common/network/IPCPort'\r\nimport List from 'cheap/std/collection/List'\r\nimport { AVFrameRef } from 'avutil/struct/avframe'\r\nimport { Mutex } from 'cheap/thread/mutex'\r\nimport WasmVideoDecoder, { AVDiscard } from 'avcodec/wasmcodec/VideoDecoder'\r\nimport WebVideoDecoder from 'avcodec/webcodec/VideoDecoder'\r\nimport { WebAssemblyResource } from 'cheap/webassembly/compiler'\r\nimport * as logger from 'common/util/logger'\r\nimport AVFramePoolImpl from 'avutil/implement/AVFramePoolImpl'\r\nimport { IOError } from 'common/io/error'\r\nimport { AVPacketFlags, AVPacketPool, AVPacketRef } from 'avutil/struct/avpacket'\r\nimport * as is from 'common/util/is'\r\nimport * as array from 'common/util/array'\r\nimport Sleep from 'common/timer/Sleep'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport AVPacketPoolImpl from 'avutil/implement/AVPacketPoolImpl'\r\nimport isWorker from 'common/function/isWorker'\r\nimport { AVCodecID } from 'avutil/codec'\r\nimport { avQ2D, avRescaleQ } from 'avutil/util/rational'\r\nimport getTimestamp from 'common/function/getTimestamp'\r\nimport { AV_MILLI_TIME_BASE_Q } from 'avutil/constant'\r\nimport support from 'common/util/support'\r\nimport isPointer from 'cheap/std/function/isPointer'\r\nimport { Data } from 'common/types/type'\r\nimport compileResource from 'avutil/function/compileResource'\r\nimport { AVCodecParametersSerialize, AVPacketSerialize, unserializeAVCodecParameters, unserializeAVPacket } from 'avutil/util/serialize'\r\nimport { avMallocz } from 'avutil/util/mem'\r\nimport { copyCodecParameters, freeCodecParameters } from 'avutil/util/codecparameters'\r\n\r\nexport interface VideoDecodeTaskOptions extends TaskOptions {\r\n  resource: ArrayBuffer | WebAssemblyResource\r\n  enableHardware: boolean\r\n  avpacketList: pointer<List<pointer<AVPacketRef>>>\r\n  avpacketListMutex: pointer<Mutex>\r\n  avframeList: pointer<List<pointer<AVFrameRef>>>\r\n  avframeListMutex: pointer<Mutex>\r\n  preferWebCodecs?: boolean\r\n}\r\n\r\ntype SelfTask = Omit<VideoDecodeTaskOptions, 'resource'> & {\r\n  resource: WebAssemblyResource\r\n  leftIPCPort: IPCPort\r\n  rightIPCPort: IPCPort\r\n\r\n  softwareDecoder: WasmVideoDecoder | WebVideoDecoder\r\n  softwareDecoderOpened: boolean\r\n  hardwareDecoder?: WebVideoDecoder\r\n  targetDecoder: WasmVideoDecoder | WebVideoDecoder\r\n\r\n  frameCaches: (pointer<AVFrameRef> | VideoFrame)[]\r\n  inputEnd: boolean\r\n\r\n  openReject?: (ret: number) => void\r\n\r\n  needKeyFrame: boolean\r\n\r\n  parameters: pointer<AVCodecParameters>\r\n\r\n  hardwareRetryCount: number\r\n\r\n  lastDecodeTimestamp: number\r\n\r\n  firstDecoded: boolean\r\n\r\n  decoderReady: Promise<void>\r\n\r\n  avframePool: AVFramePoolImpl\r\n  avpacketPool: AVPacketPool\r\n\r\n  wasmDecoderOptions?: Data\r\n}\r\n\r\nexport interface VideoDecodeTaskInfo {\r\n  codecId: AVCodecID\r\n  width: int32\r\n  height: int32\r\n  framerate: float\r\n  hardware: boolean\r\n}\r\n\r\nexport default class VideoDecodePipeline extends Pipeline {\r\n\r\n  declare tasks: Map<string, SelfTask>\r\n\r\n  constructor() {\r\n    super()\r\n  }\r\n\r\n  private createWebcodecDecoder(task: SelfTask, enableHardwareAcceleration: boolean = true) {\r\n    return new WebVideoDecoder({\r\n      onError: (error) => {\r\n        if (task.hardwareRetryCount > 3 || !task.firstDecoded) {\r\n          if (task.targetDecoder === task.hardwareDecoder) {\r\n            task.targetDecoder = task.softwareDecoder\r\n            task.hardwareDecoder.close()\r\n            task.hardwareDecoder = null\r\n            task.decoderReady = this.openSoftwareDecoder(task)\r\n            logger.warn(`video decode error width hardware(${task.hardwareRetryCount}), taskId: ${task.taskId}, error: ${error}, try to fallback to software decoder`)\r\n          }\r\n        }\r\n        else {\r\n          task.hardwareRetryCount++\r\n          try {\r\n            logger.info(`retry open hardware decoder(${task.hardwareRetryCount}), taskId: ${task.taskId}`)\r\n            task.decoderReady = task.hardwareDecoder.open(task.parameters)\r\n          }\r\n          catch (error) {\r\n            logger.warn(`retry open hardware decoder failed, fallback to software decoder, taskId: ${task.taskId}`)\r\n          }\r\n        }\r\n        task.needKeyFrame = true\r\n        task.leftIPCPort.request('requestKeyframe')\r\n      },\r\n      onReceiveFrame(frame) {\r\n        task.firstDecoded = true\r\n        task.frameCaches.push(frame)\r\n        task.stats.videoFrameDecodeCount++\r\n        if (task.lastDecodeTimestamp) {\r\n          task.stats.videoFrameDecodeIntervalMax = Math.max(\r\n            getTimestamp() - task.lastDecodeTimestamp,\r\n            task.stats.videoFrameDecodeIntervalMax\r\n          )\r\n        }\r\n        task.lastDecodeTimestamp = getTimestamp()\r\n      },\r\n      enableHardwareAcceleration\r\n    })\r\n  }\r\n\r\n  private createWasmcodecDecoder(task: SelfTask, resource: WebAssemblyResource) {\r\n    return new WasmVideoDecoder({\r\n      resource: resource,\r\n      onError: (error) => {\r\n        logger.error(`video decode error, taskId: ${task.taskId}, error: ${error}`)\r\n        if (task.openReject) {\r\n          task.openReject(errorType.CODEC_NOT_SUPPORT)\r\n          task.openReject = null\r\n        }\r\n      },\r\n      onReceiveFrame(frame) {\r\n        task.firstDecoded = true\r\n        task.frameCaches.push(reinterpret_cast<pointer<AVFrameRef>>(frame))\r\n        task.stats.videoFrameDecodeCount++\r\n        if (task.lastDecodeTimestamp) {\r\n          task.stats.videoFrameDecodeIntervalMax = Math.max(\r\n            getTimestamp() - task.lastDecodeTimestamp,\r\n            task.stats.videoFrameDecodeIntervalMax\r\n          )\r\n        }\r\n        task.lastDecodeTimestamp = getTimestamp()\r\n      },\r\n      avframePool: task.avframePool\r\n    })\r\n  }\r\n\r\n  private async pullAVPacketInternal(task: SelfTask, leftIPCPort: IPCPort) {\r\n    const result = await leftIPCPort.request<pointer<AVPacketRef> | AVPacketSerialize>('pull')\r\n    if (is.number(result)) {\r\n      return result\r\n    }\r\n    else {\r\n      const avpacket = task.avpacketPool.alloc()\r\n      unserializeAVPacket(result, avpacket)\r\n      return avpacket\r\n    }\r\n  }\r\n\r\n  private async createTask(options: VideoDecodeTaskOptions): Promise<number> {\r\n\r\n    assert(options.leftPort)\r\n    assert(options.rightPort)\r\n\r\n    const leftIPCPort = new IPCPort(options.leftPort)\r\n    const rightIPCPort = new IPCPort(options.rightPort)\r\n    const frameCaches: (pointer<AVFrameRef> | VideoFrame)[] = []\r\n\r\n    const avframePool = new AVFramePoolImpl(accessof(options.avframeList), options.avframeListMutex)\r\n\r\n    const task: SelfTask = {\r\n      ...options,\r\n      resource: await compileResource(options.resource, true),\r\n      leftIPCPort,\r\n      rightIPCPort,\r\n      softwareDecoder: null,\r\n      hardwareDecoder: null,\r\n      frameCaches,\r\n      inputEnd: false,\r\n      targetDecoder: null,\r\n      needKeyFrame: true,\r\n      parameters: nullptr,\r\n      hardwareRetryCount: 0,\r\n      lastDecodeTimestamp: 0,\r\n      firstDecoded: false,\r\n      decoderReady: null,\r\n      softwareDecoderOpened: false,\r\n\r\n      avframePool,\r\n      avpacketPool: new AVPacketPoolImpl(accessof(options.avpacketList), options.avpacketListMutex)\r\n    }\r\n\r\n    task.softwareDecoder = task.resource\r\n      ? this.createWasmcodecDecoder(task, task.resource)\r\n      : (support.videoDecoder ? this.createWebcodecDecoder(task, false) : null)\r\n\r\n    if (!task.softwareDecoder) {\r\n      logger.error('software decoder not support')\r\n      return errorType.INVALID_OPERATE\r\n    }\r\n\r\n    if (support.videoDecoder && options.enableHardware) {\r\n      task.hardwareDecoder = this.createWebcodecDecoder(task)\r\n    }\r\n\r\n    task.targetDecoder = task.hardwareDecoder || task.softwareDecoder\r\n\r\n    this.tasks.set(options.taskId, task)\r\n\r\n    rightIPCPort.on(REQUEST, async (request: RpcMessage) => {\r\n      switch (request.method) {\r\n        case 'pull': {\r\n          if (frameCaches.length) {\r\n            const frame = frameCaches.shift()\r\n            rightIPCPort.reply(request, frame, null, (isPointer(frame) || is.number(frame)) ? null : [frame])\r\n            break\r\n          }\r\n          else if (!task.inputEnd) {\r\n            while (true) {\r\n              if (frameCaches.length) {\r\n                const frame = frameCaches.shift()\r\n                rightIPCPort.reply(request, frame, null, (isPointer(frame) || is.number(frame)) ? null : [frame])\r\n                break\r\n              }\r\n\r\n              if (task.decoderReady) {\r\n                await task.decoderReady\r\n                task.decoderReady = null\r\n              }\r\n\r\n              const avpacket = await this.pullAVPacketInternal(task, leftIPCPort)\r\n\r\n              if (avpacket === IOError.END) {\r\n                if (task.targetDecoder === task.hardwareDecoder) {\r\n                  // 硬解的 flush 有时会卡主，这里设置 2 秒超时，若超时只能丢弃还未 flush 出来的帧了\r\n                  let ret = await Promise.race([\r\n                    new Sleep(2),\r\n                    task.targetDecoder.flush()\r\n                  ])\r\n                  if (is.number(ret)) {\r\n                    logger.warn(`video hardware decoder flush failed, ignore it, taskId: ${task.taskId}`)\r\n                  }\r\n                }\r\n                else {\r\n                  await task.targetDecoder.flush()\r\n                }\r\n                task.inputEnd = true\r\n                // 等待 flush 出的帧入队\r\n                if (task.targetDecoder === task.hardwareDecoder) {\r\n                  await new Sleep(0)\r\n                }\r\n                if (frameCaches.length) {\r\n                  const frame = frameCaches.shift()\r\n                  rightIPCPort.reply(request, frame, null, task.targetDecoder === task.hardwareDecoder ? [frame] : null)\r\n                  break\r\n                }\r\n                else {\r\n                  logger.info(`video decoder ended, taskId: ${task.taskId}`)\r\n                  rightIPCPort.reply(request, IOError.END)\r\n                  break\r\n                }\r\n              }\r\n              else if (avpacket > 0) {\r\n                if (task.needKeyFrame) {\r\n                  if (avpacket.flags & AVPacketFlags.AV_PKT_FLAG_KEY) {\r\n                    task.needKeyFrame = false\r\n                  }\r\n                  else {\r\n                    // 需要关键帧但不是，跳过继续请求新的 avpacket\r\n                    if (defined(ENABLE_LOG_TRACE)) {\r\n                      logger.trace(`skip the packet because of not got one keyframe, dts: ${avpacket.dts}(${\r\n                        avRescaleQ(avpacket.dts, avpacket.timeBase, AV_MILLI_TIME_BASE_Q)\r\n                      }ms) taskId: ${task.taskId}`)\r\n                    }\r\n                    task.avpacketPool.release(avpacket)\r\n                    continue\r\n                  }\r\n                }\r\n                let ret = task.targetDecoder.decode(avpacket)\r\n                if (ret < 0) {\r\n                  task.stats.videoDecodeErrorPacketCount++\r\n                  // 硬解或者 webcodecs 软解失败\r\n                  if ((task.targetDecoder instanceof WebVideoDecoder) && task.softwareDecoder) {\r\n\r\n                    logger.warn(`video decode error from hardware, taskId: ${task.taskId}, error: ${ret}, try to fallback to software decoder`)\r\n\r\n                    if (task.targetDecoder === task.hardwareDecoder) {\r\n                      task.hardwareDecoder.close()\r\n                      task.hardwareDecoder = null\r\n                    }\r\n                    else if (task.resource) {\r\n                      task.softwareDecoder.close()\r\n                      task.softwareDecoder = this.createWasmcodecDecoder(task, task.resource)\r\n                    }\r\n                    else {\r\n                      logger.error(`cannot fallback to wasm video decoder because of resource not found , taskId: ${options.taskId}`)\r\n                      rightIPCPort.reply(request, errorType.CODEC_NOT_SUPPORT)\r\n                      break\r\n                    }\r\n\r\n                    try {\r\n                      await this.openSoftwareDecoder(task)\r\n                      task.targetDecoder = task.softwareDecoder\r\n                    }\r\n                    catch (error) {\r\n                      logger.error(`video software decoder open error, taskId: ${options.taskId}`)\r\n                      rightIPCPort.reply(request, errorType.CODEC_NOT_SUPPORT)\r\n                      break\r\n                    }\r\n\r\n                    if (avpacket.flags & AVPacketFlags.AV_PKT_FLAG_KEY) {\r\n                      ret = task.targetDecoder.decode(avpacket)\r\n                      if (ret >= 0) {\r\n                        task.avpacketPool.release(avpacket)\r\n                        continue\r\n                      }\r\n                      // webcodecs 软解失败，回退到 wasm 软解\r\n                      if ((task.targetDecoder instanceof WebVideoDecoder) && task.resource) {\r\n\r\n                        logger.warn(`video decode error width webcodecs soft decoder, taskId: ${task.taskId}, error: ${ret}, try to fallback to wasm software decoder`)\r\n\r\n                        task.softwareDecoder.close()\r\n                        task.softwareDecoder = this.createWasmcodecDecoder(task, task.resource)\r\n                        task.softwareDecoderOpened = false\r\n                        try {\r\n                          await this.openSoftwareDecoder(task)\r\n                          task.targetDecoder = task.softwareDecoder\r\n                        }\r\n                        catch (error) {\r\n                          logger.error(`video wasm software decoder open error, taskId: ${options.taskId}`)\r\n                          rightIPCPort.reply(request, errorType.CODEC_NOT_SUPPORT)\r\n                          break\r\n                        }\r\n                        ret = task.targetDecoder.decode(avpacket)\r\n                        if (ret >= 0) {\r\n                          task.avpacketPool.release(avpacket)\r\n                          continue\r\n                        }\r\n                      }\r\n                    }\r\n                    else {\r\n                      task.avpacketPool.release(avpacket)\r\n                      task.needKeyFrame = true\r\n                      task.leftIPCPort.request('requestKeyframe')\r\n                      continue\r\n                    }\r\n                  }\r\n                  task.avpacketPool.release(avpacket)\r\n                  logger.error(`video decode error, taskId: ${options.taskId}, ret: ${ret}`)\r\n                  rightIPCPort.reply(request, ret)\r\n                  break\r\n                }\r\n                task.avpacketPool.release(avpacket)\r\n                // WebVideoDecoder 队列中的 EncodedVideoChunk 过多会导致内存占用激增，这里控制一下\r\n                while (task.targetDecoder instanceof WebVideoDecoder\r\n                  && task.targetDecoder.getQueueLength() > 20\r\n                ) {\r\n                  await new Sleep(0)\r\n                }\r\n                continue\r\n              }\r\n              else {\r\n                logger.error(`video decode pull avpacket error, taskId: ${options.taskId}, ret: ${avpacket}`)\r\n                rightIPCPort.reply(request, avpacket)\r\n                break\r\n              }\r\n            }\r\n            break\r\n          }\r\n          logger.info(`video decoder ended, taskId: ${task.taskId}`)\r\n          rightIPCPort.reply(request, IOError.END)\r\n          break\r\n        }\r\n      }\r\n    })\r\n\r\n    return 0\r\n  }\r\n\r\n  private async openSoftwareDecoder(task: SelfTask) {\r\n    if (task.softwareDecoder && !task.softwareDecoderOpened) {\r\n      const parameters = task.parameters\r\n      let threadCount = 1\r\n\r\n      if (isWorker()) {\r\n        let pixels = parameters.width * parameters.height\r\n        let framerate = avQ2D(parameters.framerate)\r\n        if (pixels >= 1920 * 1080 && pixels <= 2048 * 1080) {\r\n          if (parameters.codecId === AVCodecID.AV_CODEC_ID_HEVC\r\n            || parameters.codecId === AVCodecID.AV_CODEC_ID_VVC\r\n            || parameters.codecId === AVCodecID.AV_CODEC_ID_AV1\r\n          ) {\r\n            threadCount = 2\r\n          }\r\n          if (framerate > 30) {\r\n            threadCount = 2\r\n            if (parameters.codecId === AVCodecID.AV_CODEC_ID_HEVC\r\n              || parameters.codecId === AVCodecID.AV_CODEC_ID_VVC\r\n              || parameters.codecId === AVCodecID.AV_CODEC_ID_AV1\r\n            ) {\r\n              threadCount = 4\r\n            }\r\n          }\r\n          else if (framerate > 60) {\r\n            threadCount = 4\r\n            if (parameters.codecId === AVCodecID.AV_CODEC_ID_HEVC\r\n              || parameters.codecId === AVCodecID.AV_CODEC_ID_VVC\r\n              || parameters.codecId === AVCodecID.AV_CODEC_ID_AV1\r\n            ) {\r\n              threadCount = 6\r\n            }\r\n          }\r\n        }\r\n        else if (pixels > 2048 * 1080 && pixels <= 3840 * 2160) {\r\n          threadCount = 4\r\n          if (parameters.codecId === AVCodecID.AV_CODEC_ID_HEVC\r\n            || parameters.codecId === AVCodecID.AV_CODEC_ID_VVC\r\n            || parameters.codecId === AVCodecID.AV_CODEC_ID_AV1\r\n          ) {\r\n            threadCount = 6\r\n          }\r\n        }\r\n        else if (pixels > 3840 * 2160) {\r\n          threadCount = 6\r\n          if (parameters.codecId === AVCodecID.AV_CODEC_ID_HEVC\r\n            || parameters.codecId === AVCodecID.AV_CODEC_ID_VVC\r\n            || parameters.codecId === AVCodecID.AV_CODEC_ID_AV1\r\n          ) {\r\n            threadCount = 8\r\n          }\r\n        }\r\n        threadCount = Math.min(threadCount, navigator.hardwareConcurrency)\r\n      }\r\n\r\n      try {\r\n        await task.softwareDecoder.open(parameters, threadCount, task.wasmDecoderOptions)\r\n      }\r\n      catch (error) {\r\n        if ((task.softwareDecoder instanceof WebVideoDecoder) && task.resource) {\r\n\r\n          logger.warn(`webcodecs software decoder open failed, ${error}, try to fallback to wasm software decoder`)\r\n\r\n          task.softwareDecoder.close()\r\n          task.softwareDecoder = this.createWasmcodecDecoder(task, task.resource)\r\n          await task.softwareDecoder.open(parameters, threadCount)\r\n          task.targetDecoder = task.softwareDecoder\r\n        }\r\n        else {\r\n          throw error\r\n        }\r\n      }\r\n\r\n      task.softwareDecoderOpened = true\r\n    }\r\n  }\r\n\r\n  public async reopenDecoder(\r\n    taskId: string,\r\n    parameters: AVCodecParametersSerialize | pointer<AVCodecParameters>,\r\n    resource?: string | ArrayBuffer | WebAssemblyResource,\r\n    wasmDecoderOptions?: Data\r\n  ) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      const codecpar: pointer<AVCodecParameters> = avMallocz(sizeof(AVCodecParameters))\r\n      if (isPointer(parameters)) {\r\n        copyCodecParameters(codecpar, parameters)\r\n      }\r\n      else {\r\n        unserializeAVCodecParameters(parameters, codecpar)\r\n      }\r\n      if (task.parameters) {\r\n        freeCodecParameters(task.parameters)\r\n      }\r\n      task.parameters = codecpar\r\n\r\n      if (wasmDecoderOptions) {\r\n        task.wasmDecoderOptions = wasmDecoderOptions\r\n      }\r\n\r\n      if (resource) {\r\n        resource = await compileResource(resource, true)\r\n      }\r\n\r\n      let softwareDecoder: WasmVideoDecoder | WebVideoDecoder\r\n\r\n      if (task.preferWebCodecs && support.videoDecoder && WebVideoDecoder.isSupported(codecpar, false)) {\r\n        softwareDecoder = this.createWebcodecDecoder(task, false)\r\n      }\r\n      else {\r\n        softwareDecoder = resource\r\n          ? this.createWasmcodecDecoder(task, resource as WebAssemblyResource)\r\n          : (support.videoDecoder ? this.createWebcodecDecoder(task, false) : null)\r\n      }\r\n\r\n      let hardwareDecoder: WebVideoDecoder = (support.videoDecoder && task.enableHardware)\r\n        ? this.createWebcodecDecoder(task, true)\r\n        : null\r\n      return new Promise<number>(async (resolve, reject) => {\r\n        task.openReject = resolve\r\n        if (task.softwareDecoder) {\r\n          task.softwareDecoder.close()\r\n        }\r\n        if (task.hardwareDecoder) {\r\n          task.hardwareDecoder.close()\r\n        }\r\n        task.softwareDecoder = softwareDecoder\r\n        task.hardwareDecoder = hardwareDecoder\r\n        task.targetDecoder = task.hardwareDecoder || task.softwareDecoder\r\n        task.hardwareRetryCount = 0\r\n\r\n        if (task.hardwareDecoder) {\r\n          try {\r\n            await task.hardwareDecoder.open(codecpar)\r\n\r\n            logger.debug(`reopen video hardware decoder, taskId: ${task.taskId}`)\r\n          }\r\n          catch (error) {\r\n            logger.error(`cannot reopen hardware decoder, ${error}, taskId: ${task.taskId}`)\r\n            task.hardwareDecoder.close()\r\n            task.hardwareDecoder = null\r\n            task.targetDecoder = task.softwareDecoder\r\n          }\r\n        }\r\n\r\n        if (resource) {\r\n          task.resource = resource as WebAssemblyResource\r\n        }\r\n\r\n        if (task.targetDecoder === task.softwareDecoder) {\r\n          try {\r\n            await this.openSoftwareDecoder(task)\r\n\r\n            logger.debug(`reopen video soft decoder, taskId: ${task.taskId}`)\r\n          }\r\n          catch (error) {\r\n            logger.error(`reopen video software decoder failed, error: ${error}`)\r\n            if (!task.hardwareDecoder) {\r\n              resolve(errorType.CODEC_NOT_SUPPORT)\r\n              return\r\n            }\r\n          }\r\n        }\r\n        resolve(0)\r\n      })\r\n    }\r\n    logger.fatal('task not found')\r\n  }\r\n\r\n  public async open(taskId: string, parameters: AVCodecParametersSerialize | pointer<AVCodecParameters>,  wasmDecoderOptions: Data = {}) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      task.wasmDecoderOptions = wasmDecoderOptions\r\n\r\n      const codecpar: pointer<AVCodecParameters> = avMallocz(sizeof(AVCodecParameters))\r\n      if (isPointer(parameters)) {\r\n        copyCodecParameters(codecpar, parameters)\r\n      }\r\n      else {\r\n        unserializeAVCodecParameters(parameters, codecpar)\r\n      }\r\n      if (task.parameters) {\r\n        freeCodecParameters(task.parameters)\r\n      }\r\n      task.parameters = codecpar\r\n\r\n      if (task.preferWebCodecs\r\n        && support.videoDecoder\r\n        && WebVideoDecoder.isSupported(codecpar, false)\r\n        && task.softwareDecoder instanceof WasmVideoDecoder\r\n      ) {\r\n        task.softwareDecoder.close()\r\n        const softwareDecoder = this.createWebcodecDecoder(task, false)\r\n        if (task.softwareDecoder === task.targetDecoder) {\r\n          task.targetDecoder = softwareDecoder\r\n        }\r\n        task.softwareDecoder = softwareDecoder\r\n      }\r\n\r\n      return new Promise<number>(async (resolve, reject) => {\r\n        task.openReject = resolve\r\n        if (task.hardwareDecoder) {\r\n          try {\r\n            await task.hardwareDecoder.open(codecpar)\r\n          }\r\n          catch (error) {\r\n            logger.error(`cannot open hardware decoder, ${error}`)\r\n            task.hardwareDecoder.close()\r\n            task.hardwareDecoder = null\r\n            task.targetDecoder = task.softwareDecoder\r\n          }\r\n        }\r\n\r\n        if (task.targetDecoder === task.softwareDecoder) {\r\n          try {\r\n            await this.openSoftwareDecoder(task)\r\n          }\r\n          catch (error) {\r\n            logger.error(`open video software decoder failed, error: ${error}`)\r\n            if (!task.hardwareDecoder) {\r\n              resolve(errorType.CODEC_NOT_SUPPORT)\r\n              return\r\n            }\r\n          }\r\n        }\r\n        resolve(0)\r\n      })\r\n    }\r\n    logger.fatal('task not found')\r\n  }\r\n\r\n  public async setPlayRate(taskId: string, rate: double) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task && task.softwareDecoder) {\r\n      let discard = AVDiscard.AVDISCARD_NONE\r\n      let framerate = avQ2D(task.parameters.framerate)\r\n      if (framerate >= 120) {\r\n        if (rate <= 1) {\r\n          discard = AVDiscard.AVDISCARD_NONE\r\n        }\r\n        else if (rate < 1.5) {\r\n          discard = AVDiscard.AVDISCARD_NONREF\r\n        }\r\n        else if (rate < 3) {\r\n          // 跳过所有帧间编码帧\r\n          discard = AVDiscard.AVDISCARD_NONREF\r\n        }\r\n        else {\r\n          // 跳过所有帧间编码帧\r\n          discard = AVDiscard.AVDISCARD_NONKEY\r\n        }\r\n      }\r\n      else if (framerate >= 60) {\r\n        if (rate < 1.5) {\r\n          discard = AVDiscard.AVDISCARD_NONE\r\n        }\r\n        else if (rate < 3) {\r\n          discard = AVDiscard.AVDISCARD_NONREF\r\n        }\r\n        else if (rate < 8) {\r\n          discard = AVDiscard.AVDISCARD_NONINTRA\r\n        }\r\n        else {\r\n          discard = AVDiscard.AVDISCARD_NONKEY\r\n        }\r\n      }\r\n      else {\r\n        discard = AVDiscard.AVDISCARD_NONE\r\n      }\r\n      task.softwareDecoder.setSkipFrameDiscard(discard)\r\n    }\r\n  }\r\n\r\n  public async resetTask(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (task.targetDecoder === task.softwareDecoder) {\r\n        await task.targetDecoder.flush()\r\n      }\r\n      // webcodec flush 有可能会卡主，这里重新创建解码器\r\n      else if (task.targetDecoder === task.hardwareDecoder) {\r\n        task.hardwareDecoder.close()\r\n        task.hardwareDecoder = this.createWebcodecDecoder(task)\r\n        await task.hardwareDecoder.open(task.parameters)\r\n        task.targetDecoder = task.hardwareDecoder\r\n      }\r\n      array.each(task.frameCaches, (frame) => {\r\n        if (isPointer(frame)) {\r\n          task.avframePool.release(frame)\r\n        }\r\n        else {\r\n          frame.close()\r\n        }\r\n      })\r\n      task.frameCaches.length = 0\r\n      task.needKeyFrame = true\r\n      task.inputEnd = false\r\n      task.lastDecodeTimestamp = getTimestamp()\r\n\r\n      logger.info(`reset video decoder, taskId: ${task.taskId}`)\r\n    }\r\n  }\r\n\r\n  public async registerTask(options: VideoDecodeTaskOptions): Promise<number> {\r\n    if (this.tasks.has(options.taskId)) {\r\n      return errorType.INVALID_OPERATE\r\n    }\r\n    return this.createTask(options)\r\n  }\r\n\r\n  public async unregisterTask(taskId: string): Promise<void> {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      task.rightPort.close()\r\n      task.leftPort.close()\r\n      if (task.softwareDecoder) {\r\n        task.softwareDecoder.close()\r\n      }\r\n      if (task.hardwareDecoder) {\r\n        task.hardwareDecoder.close()\r\n      }\r\n      task.frameCaches.forEach((frame) => {\r\n        if (isPointer(frame)) {\r\n          task.avframePool.release(frame)\r\n        }\r\n        else {\r\n          frame.close()\r\n        }\r\n      })\r\n      if (task.parameters) {\r\n        freeCodecParameters(task.parameters)\r\n      }\r\n      this.tasks.delete(taskId)\r\n    }\r\n  }\r\n\r\n  public async getTasksInfo() {\r\n    const info: VideoDecodeTaskInfo[] = []\r\n    this.tasks.forEach((task) => {\r\n      info.push({\r\n        codecId: task.parameters.codecId,\r\n        width: task.parameters.width,\r\n        height: task.parameters.height,\r\n        framerate: avQ2D(task.parameters.framerate),\r\n        hardware: task.targetDecoder === task.hardwareDecoder\r\n      })\r\n    })\r\n    return info\r\n  }\r\n}\r\n","/*\r\n * libmedia VideoEncodePipeline\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport Pipeline, { TaskOptions } from './Pipeline'\r\nimport * as errorType from 'avutil/error'\r\nimport IPCPort from 'common/network/IPCPort'\r\nimport { REQUEST, RpcMessage } from 'common/network/IPCPort'\r\nimport List from 'cheap/std/collection/List'\r\nimport { AVFrameRef } from 'avutil/struct/avframe'\r\nimport { Mutex } from 'cheap/thread/mutex'\r\nimport { WebAssemblyResource } from 'cheap/webassembly/compiler'\r\nimport * as logger from 'common/util/logger'\r\nimport AVFramePoolImpl from 'avutil/implement/AVFramePoolImpl'\r\nimport { IOError } from 'common/io/error'\r\nimport { AVPacketPool, AVPacketRef } from 'avutil/struct/avpacket'\r\nimport * as is from 'common/util/is'\r\nimport * as array from 'common/util/array'\r\nimport * as object from 'common/util/object'\r\nimport Sleep from 'common/timer/Sleep'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport AVPacketPoolImpl from 'avutil/implement/AVPacketPoolImpl'\r\nimport isWorker from 'common/function/isWorker'\r\nimport { AVCodecID } from 'avutil/codec'\r\nimport { avQ2D } from 'avutil/util/rational'\r\nimport support from 'common/util/support'\r\nimport WasmVideoEncoder from 'avcodec/wasmcodec/VideoEncoder'\r\nimport WebVideoEncoder from 'avcodec/webcodec/VideoEncoder'\r\nimport { Rational } from 'avutil/struct/rational'\r\nimport isPointer from 'cheap/std/function/isPointer'\r\nimport { Data } from 'common/types/type'\r\nimport compileResource from 'avutil/function/compileResource'\r\n\r\nexport interface VideoEncodeTaskOptions extends TaskOptions {\r\n  resource: ArrayBuffer | WebAssemblyResource\r\n  resourceExtraData?: Data\r\n  enableHardware: boolean\r\n  avpacketList: pointer<List<pointer<AVPacketRef>>>\r\n  avpacketListMutex: pointer<Mutex>\r\n  avframeList: pointer<List<pointer<AVFrameRef>>>\r\n  avframeListMutex: pointer<Mutex>\r\n\r\n  gop: int32\r\n  preferWebCodecs?: boolean\r\n}\r\n\r\ntype SelfTask = Omit<VideoEncodeTaskOptions, 'resource'> & {\r\n  leftIPCPort: IPCPort\r\n  rightIPCPort: IPCPort\r\n  resource: WebAssemblyResource\r\n\r\n  softwareEncoder: WasmVideoEncoder | WebVideoEncoder\r\n  softwareEncoderOpened: boolean\r\n  hardwareEncoder?: WebVideoEncoder\r\n  targetEncoder: WasmVideoEncoder | WebVideoEncoder\r\n\r\n  avpacketCaches: pointer<AVPacketRef>[]\r\n  inputEnd: boolean\r\n  encodeEnd: boolean\r\n\r\n  openReject?: (error: Error) => void\r\n\r\n  parameters: pointer<AVCodecParameters>\r\n  timeBase: Rational\r\n\r\n  encoderReady: Promise<void>\r\n\r\n  avframePool: AVFramePoolImpl\r\n  avpacketPool: AVPacketPool\r\n\r\n  gopCounter: int32\r\n\r\n  firstEncoded: boolean\r\n  wasmEncoderOptions?: Data\r\n}\r\n\r\nexport interface VideoEncodeTaskInfo {\r\n  codecId: AVCodecID\r\n  width: int32\r\n  height: int32\r\n  framerate: float\r\n  hardware: boolean\r\n}\r\n\r\nexport default class VideoEncodePipeline extends Pipeline {\r\n\r\n  declare tasks: Map<string, SelfTask>\r\n\r\n  constructor() {\r\n    super()\r\n  }\r\n\r\n  private createWebcodecEncoder(task: SelfTask, enableHardwareAcceleration: boolean = true) {\r\n    return new WebVideoEncoder({\r\n      onError: (error) => {\r\n        if (task.targetEncoder === task.hardwareEncoder) {\r\n          task.targetEncoder = task.softwareEncoder\r\n          task.hardwareEncoder.close()\r\n          task.hardwareEncoder = null\r\n          task.encoderReady = this.openSoftwareEncoder(task)\r\n          logger.warn(`video encode error width hardware, taskId: ${task.taskId}, error: ${error}, try to fallback to software encoder`)\r\n        }\r\n        else {\r\n          logger.error(`video encode error width hardware, taskId: ${task.taskId}, error: ${error}`)\r\n        }\r\n      },\r\n      onReceivePacket(avpacket) {\r\n        task.avpacketCaches.push(reinterpret_cast<pointer<AVPacketRef>>(avpacket))\r\n        task.stats.videoPacketEncodeCount++\r\n      },\r\n      enableHardwareAcceleration,\r\n      avpacketPool: task.avpacketPool,\r\n      avframePool: task.avframePool\r\n    })\r\n  }\r\n\r\n  private createWasmcodecEncoder(task: SelfTask, resource: WebAssemblyResource) {\r\n    return new WasmVideoEncoder({\r\n      resource: task.resource,\r\n      onError: (error) => {\r\n        logger.error(`video encode error, taskId: ${task.taskId}, error: ${error}`)\r\n        if (task.openReject) {\r\n          task.openReject(error)\r\n          task.openReject = null\r\n        }\r\n      },\r\n      onReceiveAVPacket(avpacket) {\r\n        task.avpacketCaches.push(reinterpret_cast<pointer<AVPacketRef>>(avpacket))\r\n        task.stats.videoPacketEncodeCount++\r\n      },\r\n      avpacketPool: task.avpacketPool\r\n    })\r\n  }\r\n\r\n  private async createTask(options: VideoEncodeTaskOptions): Promise<number> {\r\n\r\n    assert(options.leftPort)\r\n    assert(options.rightPort)\r\n\r\n    const leftIPCPort = new IPCPort(options.leftPort)\r\n    const rightIPCPort = new IPCPort(options.rightPort)\r\n    const avpacketCaches: pointer<AVPacketRef>[] = []\r\n\r\n    const avframePool = new AVFramePoolImpl(accessof(options.avframeList), options.avframeListMutex)\r\n    const avpacketPool = new AVPacketPoolImpl(accessof(options.avpacketList), options.avpacketListMutex)\r\n\r\n    const resource = await compileResource(options.resource, true)\r\n\r\n    if (options.resourceExtraData) {\r\n      object.extend(resource, options.resourceExtraData)\r\n    }\r\n\r\n    const task: SelfTask = {\r\n      ...options,\r\n      resource,\r\n      leftIPCPort,\r\n      rightIPCPort,\r\n      softwareEncoder: null,\r\n      hardwareEncoder: null,\r\n      avpacketCaches,\r\n      inputEnd: false,\r\n      encodeEnd: false,\r\n      targetEncoder: null,\r\n      parameters: nullptr,\r\n      timeBase: null,\r\n      encoderReady: null,\r\n      softwareEncoderOpened: false,\r\n      gopCounter: 0,\r\n      firstEncoded: false,\r\n\r\n      avframePool,\r\n      avpacketPool\r\n    }\r\n\r\n    task.softwareEncoder = task.resource\r\n      ? this.createWasmcodecEncoder(task, task.resource)\r\n      : (support.videoEncoder ? this.createWebcodecEncoder(task, false) : null)\r\n\r\n    if (!task.softwareEncoder) {\r\n      logger.error('software encoder not support')\r\n      return errorType.INVALID_OPERATE\r\n    }\r\n\r\n    if (support.videoEncoder && options.enableHardware) {\r\n      task.hardwareEncoder = this.createWebcodecEncoder(task)\r\n    }\r\n\r\n    task.targetEncoder = task.hardwareEncoder || task.softwareEncoder\r\n\r\n    this.tasks.set(options.taskId, task)\r\n\r\n    const caches: (pointer<AVFrameRef> | VideoFrame)[] = []\r\n\r\n    let pullPadding: Promise<any>\r\n    const MAX = 4\r\n\r\n    async function pullAVFrame() {\r\n      if (!task.inputEnd) {\r\n        if (!caches.length) {\r\n          if (pullPadding) {\r\n            await pullPadding\r\n          }\r\n          const avframe = await leftIPCPort.request<pointer<AVFrameRef> | VideoFrame>('pull')\r\n          if (is.number(avframe) && avframe < 0) {\r\n            task.inputEnd = true\r\n          }\r\n          caches.push(avframe)\r\n        }\r\n        if (caches.length < MAX && !pullPadding) {\r\n          pullPadding = leftIPCPort.request<pointer<AVFrameRef> | VideoFrame>('pull').then((avframe) => {\r\n            if (is.number(avframe) && avframe < 0) {\r\n              task.inputEnd = true\r\n            }\r\n            caches.push(avframe)\r\n            pullPadding = null\r\n          })\r\n        }\r\n      }\r\n      return caches.length ? caches.shift() : IOError.END as pointer<AVFrameRef>\r\n    }\r\n\r\n    rightIPCPort.on(REQUEST, async (request: RpcMessage) => {\r\n      switch (request.method) {\r\n        case 'pull': {\r\n          if (avpacketCaches.length) {\r\n            const avpacket = avpacketCaches.shift()\r\n            rightIPCPort.reply(request, avpacket)\r\n            break\r\n          }\r\n          else if (!task.encodeEnd) {\r\n            while (true) {\r\n              if (avpacketCaches.length) {\r\n                const avpacket = avpacketCaches.shift()\r\n                rightIPCPort.reply(request, avpacket)\r\n                break\r\n              }\r\n\r\n              if (task.encoderReady) {\r\n                await task.encoderReady\r\n                task.encoderReady = null\r\n              }\r\n\r\n              const avframe = await pullAVFrame()\r\n\r\n              if (isPointer(avframe) || avframe instanceof VideoFrame) {\r\n                let ret = (!task.firstEncoded && task.targetEncoder instanceof WasmVideoEncoder)\r\n                  ? await task.targetEncoder.encodeAsync(avframe, task.gopCounter === 0)\r\n                  : task.targetEncoder.encode(avframe, task.gopCounter === 0)\r\n                if (ret < 0) {\r\n                  task.stats.videoEncodeErrorFrameCount++\r\n                  if (task.targetEncoder instanceof WebVideoEncoder && task.softwareEncoder) {\r\n\r\n                    logger.warn(`video encode error from hardware, taskId: ${task.taskId}, error: ${ret}, try to fallback to software decoder`)\r\n\r\n                    if (task.targetEncoder === task.hardwareEncoder) {\r\n                      task.hardwareEncoder.close()\r\n                      task.hardwareEncoder = null\r\n                    }\r\n                    else if (task.resource) {\r\n                      task.softwareEncoder.close()\r\n                      task.softwareEncoder = this.createWasmcodecEncoder(task, task.resource)\r\n                    }\r\n                    else {\r\n                      logger.error(`cannot fallback to wasm video encoder because of resource not found , taskId: ${options.taskId}`)\r\n                      rightIPCPort.reply(request, errorType.CODEC_NOT_SUPPORT)\r\n                      break\r\n                    }\r\n                    try {\r\n                      await this.openSoftwareEncoder(task)\r\n                      task.targetEncoder = task.softwareEncoder\r\n                    }\r\n                    catch (error) {\r\n                      logger.error(`video software encoder open error, taskId: ${options.taskId}`)\r\n                      rightIPCPort.reply(request, errorType.CODEC_NOT_SUPPORT)\r\n                      break\r\n                    }\r\n\r\n                    task.gopCounter = 0\r\n\r\n                    ret = task.targetEncoder instanceof WasmVideoEncoder\r\n                      ? await task.targetEncoder.encodeAsync(avframe, task.gopCounter === 0)\r\n                      : task.targetEncoder.encode(avframe, task.gopCounter === 0)\r\n                  }\r\n                  if (ret < 0) {\r\n                    if (isPointer(avframe)) {\r\n                      task.avframePool.release(avframe)\r\n                    }\r\n                    else {\r\n                      avframe.close()\r\n                    }\r\n                    logger.error(`video encode error, taskId: ${options.taskId}, ret: ${ret}`)\r\n                    rightIPCPort.reply(request, ret)\r\n                    break\r\n                  }\r\n                }\r\n                task.firstEncoded = true\r\n                task.gopCounter++\r\n                if (task.gopCounter === task.gop) {\r\n                  task.gopCounter = 0\r\n                }\r\n                if (isPointer(avframe)) {\r\n                  task.avframePool.release(avframe)\r\n                }\r\n                else {\r\n                  avframe.close()\r\n                }\r\n                // 硬解队列中的 EncodedVideoChunk 过多会报错， 这里判断做一下延时\r\n                while (task.targetEncoder instanceof WebVideoEncoder\r\n                    && task.targetEncoder.getQueueLength() > 10\r\n                // || task.targetEncoder instanceof WasmVideoEncoder\r\n                    // && task.targetEncoder.getQueueLength() > 40\r\n                ) {\r\n                  await new Sleep(0)\r\n                }\r\n                continue\r\n              }\r\n              else {\r\n                task.encodeEnd = true\r\n                if (avframe === IOError.END) {\r\n                  if (task.targetEncoder === task.hardwareEncoder) {\r\n                    // 硬解的 flush 有时会卡主，这里设置 2 秒超时，若超时只能丢弃还未 flush 出来的帧了\r\n                    let ret = await Promise.race([\r\n                      new Sleep(2),\r\n                      task.targetEncoder.flush()\r\n                    ])\r\n                    if (is.number(ret)) {\r\n                      logger.warn(`video hardware encoder flush failed, ignore it, taskId: ${task.taskId}`)\r\n                    }\r\n                  }\r\n                  else {\r\n                    await task.targetEncoder.flush()\r\n                  }\r\n                  // 等待 flush 出的帧入队\r\n                  if (task.targetEncoder === task.hardwareEncoder) {\r\n                    await new Sleep(0)\r\n                  }\r\n                  if (avpacketCaches.length) {\r\n                    const avpacket = avpacketCaches.shift()\r\n                    rightIPCPort.reply(request, avpacket)\r\n                    break\r\n                  }\r\n                  else {\r\n                    logger.info(`video encoder ended, taskId: ${task.taskId}`)\r\n                    rightIPCPort.reply(request, IOError.END)\r\n                    break\r\n                  }\r\n                }\r\n                else {\r\n                  logger.error(`video encoder pull avframe error, taskId: ${options.taskId}, ret: ${avframe}`)\r\n                  rightIPCPort.reply(request, avframe)\r\n                  break\r\n                }\r\n              }\r\n            }\r\n            break\r\n          }\r\n          logger.info(`video encoder ended, taskId: ${task.taskId}`)\r\n          rightIPCPort.reply(request, IOError.END)\r\n          break\r\n        }\r\n      }\r\n    })\r\n\r\n    return 0\r\n  }\r\n\r\n  private async openSoftwareEncoder(task: SelfTask) {\r\n    if (task.softwareEncoder && !task.softwareEncoderOpened) {\r\n      const parameters = task.parameters\r\n      let threadCount = 1\r\n      if (isWorker()) {\r\n        threadCount = Math.max(threadCount, navigator.hardwareConcurrency)\r\n      }\r\n      try {\r\n        await task.softwareEncoder.open(parameters, task.timeBase, threadCount, task.wasmEncoderOptions)\r\n      }\r\n      catch (error) {\r\n        if ((task.softwareEncoder instanceof WebVideoEncoder) && task.resource) {\r\n\r\n          logger.warn(`webcodecs software encoder open failed, ${error}, try to fallback to wasm software encoder`)\r\n\r\n          task.softwareEncoder.close()\r\n          task.softwareEncoder = this.createWasmcodecEncoder(task, task.resource)\r\n          await task.softwareEncoder.open(parameters, task.timeBase, threadCount, task.wasmEncoderOptions)\r\n          task.targetEncoder = task.softwareEncoder\r\n        }\r\n        else {\r\n          throw error\r\n        }\r\n      }\r\n\r\n      task.softwareEncoderOpened = true\r\n      if (task.softwareEncoder instanceof WasmVideoEncoder) {\r\n        task.firstEncoded = false\r\n      }\r\n    }\r\n  }\r\n\r\n  public async open(taskId: string, codecpar: pointer<AVCodecParameters>, timeBase: Rational, wasmEncoderOptions: Data = {}) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      task.wasmEncoderOptions = wasmEncoderOptions\r\n\r\n      if (task.preferWebCodecs\r\n        && support.videoEncoder\r\n        && WebVideoEncoder.isSupported(codecpar, false)\r\n        && task.softwareEncoder instanceof WasmVideoEncoder\r\n      ) {\r\n        task.softwareEncoder.close()\r\n        const softwareEncoder = this.createWebcodecEncoder(task, false)\r\n        if (task.softwareEncoder === task.targetEncoder) {\r\n          task.targetEncoder = softwareEncoder\r\n        }\r\n        task.softwareEncoder = softwareEncoder\r\n      }\r\n\r\n      return new Promise<number>(async (resolve, reject) => {\r\n        task.openReject = reject\r\n        if (task.hardwareEncoder) {\r\n          try {\r\n            await task.hardwareEncoder.open(codecpar, timeBase)\r\n          }\r\n          catch (error) {\r\n            logger.error(`cannot open hardware encoder, ${error}`)\r\n            task.hardwareEncoder.close()\r\n            task.hardwareEncoder = null\r\n            task.targetEncoder = task.softwareEncoder\r\n          }\r\n        }\r\n\r\n        task.parameters = codecpar\r\n        task.timeBase = timeBase\r\n\r\n        if (task.targetEncoder === task.softwareEncoder) {\r\n          try {\r\n            await this.openSoftwareEncoder(task)\r\n          }\r\n          catch (error) {\r\n            logger.error(`open video software encoder failed, error: ${error}`)\r\n            if (!task.hardwareEncoder) {\r\n              resolve(errorType.CODEC_NOT_SUPPORT)\r\n              return\r\n            }\r\n          }\r\n        }\r\n        resolve(0)\r\n      })\r\n    }\r\n    logger.fatal('task not found')\r\n  }\r\n\r\n  public async resetTask(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (task.targetEncoder === task.softwareEncoder) {\r\n        await task.targetEncoder.flush()\r\n      }\r\n      // webcodec flush 有可能会卡主，这里重新创建编码器\r\n      else if (task.targetEncoder === task.hardwareEncoder) {\r\n        task.hardwareEncoder.close()\r\n        task.hardwareEncoder = this.createWebcodecEncoder(task)\r\n        await task.hardwareEncoder.open(task.parameters, task.timeBase)\r\n        task.targetEncoder = task.hardwareEncoder\r\n      }\r\n      array.each(task.avpacketCaches, (avpacket) => {\r\n        task.avpacketPool.release(avpacket)\r\n      })\r\n      task.avpacketCaches.length = 0\r\n      task.inputEnd = false\r\n      task.encodeEnd = false\r\n\r\n      logger.info(`reset video encode, taskId: ${task.taskId}`)\r\n    }\r\n  }\r\n\r\n  public async getExtraData(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      return task.targetEncoder.getExtraData()\r\n    }\r\n    logger.fatal('task not found')\r\n  }\r\n\r\n  public async getColorSpace(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      return task.targetEncoder.getColorSpace()\r\n    }\r\n    logger.fatal('task not found')\r\n  }\r\n\r\n  public async registerTask(options: VideoEncodeTaskOptions): Promise<number> {\r\n    if (this.tasks.has(options.taskId)) {\r\n      return errorType.INVALID_OPERATE\r\n    }\r\n    return this.createTask(options)\r\n  }\r\n\r\n  public async unregisterTask(taskId: string): Promise<void> {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      task.rightPort.close()\r\n      task.leftPort.close()\r\n      if (task.softwareEncoder) {\r\n        task.softwareEncoder.close()\r\n      }\r\n      if (task.hardwareEncoder) {\r\n        task.hardwareEncoder.close()\r\n      }\r\n      array.each(task.avpacketCaches, (avpacket) => {\r\n        task.avpacketPool.release(avpacket)\r\n      })\r\n      this.tasks.delete(taskId)\r\n    }\r\n  }\r\n\r\n  public async getTasksInfo() {\r\n    const info: VideoEncodeTaskInfo[] = []\r\n    this.tasks.forEach((task) => {\r\n      info.push({\r\n        codecId: task.parameters.codecId,\r\n        width: task.parameters.width,\r\n        height: task.parameters.height,\r\n        framerate: avQ2D(task.parameters.framerate),\r\n        hardware: task.targetEncoder === task.hardwareEncoder\r\n      })\r\n    })\r\n    return info\r\n  }\r\n}\r\n","/*\r\n * libmedia stats struct defined\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\n@struct\r\nexport class JitterBuffer {\r\n  min: int32\r\n  max: int32\r\n}\r\n\r\n@struct\r\nexport default class Stats {\r\n  /**\r\n   * 音频通道数\r\n   */\r\n  channels: int32\r\n  /**\r\n   * 音频采样率\r\n   */\r\n  sampleRate: int32\r\n  /**\r\n   * 音频帧大小\r\n   */\r\n  audioFrameSize: int32\r\n  /**\r\n   * 音频包总字节数\r\n   */\r\n  audioPacketBytes: int64\r\n  /**\r\n   * 音频包总数\r\n   */\r\n  audioPacketCount: int64\r\n  /**\r\n   * 当前音频包队列长度\r\n   */\r\n  audioPacketQueueLength: int32\r\n  /**\r\n   * 音频包丢弃总数\r\n   */\r\n  audioDropPacketCount: int64\r\n  /**\r\n   * 音频解码错误包总数\r\n   */\r\n  audioDecodeErrorPacketCount: int32\r\n  /**\r\n   * 音频编码错误帧总数\r\n   */\r\n  audioEncodeErrorFrameCount: int32\r\n  /**\r\n   * 音频解码帧总数\r\n   */\r\n  audioFrameDecodeCount: int64\r\n  /**\r\n   * 音频编码包总数\r\n   */\r\n  audioPacketEncodeCount: int64\r\n  /**\r\n   * 音频渲染帧总数\r\n   */\r\n  audioFrameRenderCount: int64\r\n  /**\r\n   * 音频帧丢弃总数\r\n   */\r\n  audioFrameDropCount: int32\r\n  /**\r\n   * 视频宽度\r\n   */\r\n  width: int32\r\n  /**\r\n   * 视频高度\r\n   */\r\n  height: int32\r\n  /**\r\n   * 视频关键帧间隔\r\n   */\r\n  keyFrameInterval: int32\r\n  /**\r\n   * 视频 gop 长度\r\n   */\r\n  gop: int32\r\n  /**\r\n   * 视频包总字节数\r\n   */\r\n  videoPacketBytes: int64\r\n  /**\r\n   * 视频包总数\r\n   */\r\n  videoPacketCount: int64\r\n  /**\r\n   * 当前视频包队列总数\r\n   */\r\n  videoPacketQueueLength: int32\r\n  /**\r\n   * 视频包丢弃总数\r\n   */\r\n  videoDropPacketCount: int64\r\n  /**\r\n   * 视频包解码错误总数\r\n   */\r\n  videoDecodeErrorPacketCount: int32\r\n  /**\r\n   * 视频编码错误帧总数\r\n   */\r\n  videoEncodeErrorFrameCount: int32\r\n  /**\r\n   * 视频解码帧总数\r\n   */\r\n  videoFrameDecodeCount: int64\r\n  /**\r\n   * 视频编码包总数\r\n   */\r\n  videoPacketEncodeCount: int64\r\n  /**\r\n   * 视频渲染帧总数\r\n   */\r\n  videoFrameRenderCount: int64\r\n  /**\r\n   * 视频帧丢弃总数（解码未渲染）\r\n   */\r\n  videoFrameDropCount: int32\r\n  /**\r\n   * 视频关键帧总数\r\n   */\r\n  keyFrameCount: int64\r\n\r\n  /**\r\n   * buffer 丢弃总字节数\r\n   */\r\n  bufferDropBytes: int64\r\n  /**\r\n   * buffer 接收总字节数\r\n   */\r\n  bufferReceiveBytes: int64\r\n  /**\r\n   * buffer 总输出字节数\r\n   * \r\n   */\r\n  bufferOutputBytes: int64\r\n  /**\r\n   * 音频码率\r\n   */\r\n  audioBitrate: int32\r\n  /**\r\n   * 视频码率\r\n   */\r\n  videoBitrate: int32\r\n  /**\r\n   * 视频解码帧率\r\n   */\r\n  videoDecodeFramerate: int32\r\n  /**\r\n   * 视频渲染帧率\r\n   */\r\n  videoRenderFramerate: int32\r\n  /**\r\n   * 视频编码帧率（根据 dts 计算）\r\n   */\r\n  videoEncodeFramerate: int32\r\n  /**\r\n   * 音频解码帧率\r\n   */\r\n  audioDecodeFramerate: int32\r\n  /**\r\n   * 音频渲染帧率\r\n   */\r\n  audioRenderFramerate: int32\r\n  /**\r\n   * 音视频编码帧率（根据 dts 计算）\r\n   */\r\n  audioEncodeFramerate: int32\r\n\r\n  /**\r\n   * 音频最大解码帧间隔（毫秒）\r\n   */\r\n  audioFrameDecodeIntervalMax: int32\r\n  /**\r\n   * 音频最大渲染帧间隔（毫秒）\r\n   */\r\n  audioFrameRenderIntervalMax: int32\r\n  /**\r\n   * 视频最大解码帧间隔（毫秒）\r\n   */\r\n  videoFrameDecodeIntervalMax: int32\r\n  /**\r\n   * 视频最大渲染帧间隔（毫秒）\r\n   */\r\n  videoFrameRenderIntervalMax: int32\r\n  /**\r\n   * 接收带宽\r\n   */\r\n  bandwidth: int32\r\n  /**\r\n   * 抖动指标\r\n   */\r\n  jitter: double\r\n\r\n  /**\r\n   * jitter buffer\r\n   */\r\n  jitterBuffer: JitterBuffer\r\n\r\n  /**\r\n   * 音频卡顿次数\r\n   */\r\n  audioStutter: int32\r\n  /**\r\n   * 视频卡顿次数\r\n   */\r\n  videoStutter: int32\r\n\r\n  /**\r\n   * 音频 codec string\r\n   */\r\n  audiocodec: string\r\n  /**\r\n   * 视频 codec string\r\n   */\r\n  videocodec: string\r\n\r\n  /**\r\n   * 首个 audio mux dts\r\n   */\r\n  firstAudioMuxDts: int64\r\n  /**\r\n   * 上一次 audio mux dts\r\n   */\r\n  lastAudioMuxDts: int64\r\n\r\n  /**\r\n   * 首个 audio mux dts\r\n   */\r\n  firstVideoMuxDts: int64\r\n  /**\r\n   * 上一次 video mux dts\r\n   */\r\n  lastVideoMuxDts: int64\r\n  /**\r\n   * 当前音频播放时间戳\r\n   */\r\n  audioCurrentTime: int64\r\n  /**\r\n   * 当前视频播放时间戳\r\n   */\r\n  videoCurrentTime: int64\r\n}\r\n","/*\r\n * libmedia AVTranscoder\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVCodecID, AVMediaType } from 'avutil/codec'\r\nimport IOPipeline, { IOType } from 'avpipeline/IOPipeline'\r\nimport DemuxPipeline from 'avpipeline/DemuxPipeline'\r\nimport VideoDecodePipeline from 'avpipeline/VideoDecodePipeline'\r\nimport AudioDecodePipeline from 'avpipeline/AudioDecodePipeline'\r\nimport { Thread, closeThread, createThreadFromClass } from 'cheap/thread/thread'\r\nimport generateUUID from 'common/function/generateUUID'\r\nimport * as is from 'common/util/is'\r\nimport * as object from 'common/util/object'\r\nimport * as array from 'common/util/array'\r\nimport { AVPacketRef } from 'avutil/struct/avpacket'\r\nimport List from 'cheap/std/collection/List'\r\nimport { AVFrameRef } from 'avutil/struct/avframe'\r\nimport { Mutex } from 'cheap/thread/mutex'\r\nimport compile, { WebAssemblyResource } from 'cheap/webassembly/compiler'\r\nimport { AVFormat, AVSeekFlags } from 'avformat/avformat'\r\nimport * as urlUtils from 'common/util/url'\r\nimport * as logger from 'common/util/logger'\r\nimport support from 'common/util/support'\r\nimport browser from 'common/util/browser'\r\nimport { avQ2D, avRescaleQ } from 'avutil/util/rational'\r\nimport { AV_MILLI_TIME_BASE_Q, NOPTS_VALUE } from 'avutil/constant'\r\nimport { mapSafeUint8Array, memcpyFromUint8Array } from 'cheap/std/memory'\r\nimport getVideoCodec from 'avcodec/function/getVideoCodec'\r\nimport * as mutex from 'cheap/thread/mutex'\r\nimport { IOFlags } from 'common/io/flags'\r\nimport AudioEncodePipeline from 'avpipeline/AudioEncodePipeline'\r\nimport VideoEncodePipeline from 'avpipeline/VideoEncodePipeline'\r\nimport { AudioCodecString2CodecId, Ext2Format, Ext2IOLoader,\r\n  Format2AVFormat, PixfmtString2AVPixelFormat, SampleFmtString2SampleFormat,\r\n  VideoCodecString2CodecId\r\n} from 'avutil/stringEnum'\r\nimport MuxPipeline from 'avpipeline/MuxPipeline'\r\nimport IOWriterSync from 'common/io/IOWriterSync'\r\nimport { AVStreamInterface } from 'avformat/AVStream'\r\nimport Stats from 'avpipeline/struct/stats'\r\nimport IPCPort, { NOTIFY, REQUEST, RpcMessage } from 'common/network/IPCPort'\r\nimport * as errorType from 'avutil/error'\r\nimport getAudioCodec from 'avcodec/function/getAudioCodec'\r\nimport { avFree, avMalloc, avMallocz } from 'avutil/util/mem'\r\nimport AVCodecParameters from 'avutil/struct/avcodecparameters'\r\nimport { copyCodecParameters, freeCodecParameters } from 'avutil/util/codecparameters'\r\nimport SafeFileIO from 'common/io/SafeFileIO'\r\nimport Emitter from 'common/event/Emitter'\r\nimport * as eventType from './eventType'\r\nimport { BitFormat } from 'avformat/codecs/h264'\r\nimport { unrefAVFrame } from 'avutil/util/avframe'\r\nimport { unrefAVPacket } from 'avutil/util/avpacket'\r\n\r\nimport * as aac from 'avformat/codecs/aac'\r\nimport * as opus from 'avformat/codecs/opus'\r\nimport * as h264 from 'avformat/codecs/h264'\r\nimport * as hevc from 'avformat/codecs/hevc'\r\nimport * as vvc from 'avformat/codecs/vvc'\r\nimport * as av1 from 'avformat/codecs/av1'\r\nimport * as vp9 from 'avformat/codecs/vp9'\r\nimport Sleep from 'common/timer/Sleep'\r\nimport AVFilterPipeline from './filter/AVFilterPipeline'\r\nimport { AVFilterGraphDesVertex, FilterGraphPortDes, GraphNodeType, createGraphDesVertex } from 'avfilter/graph'\r\nimport { AVSampleFormat } from 'avutil/audiosamplefmt'\r\nimport { AVPixelFormat } from 'avutil/pixfmt'\r\nimport getTimestamp from 'common/function/getTimestamp'\r\nimport Timer from 'common/timer/Timer'\r\nimport createMessageChannel from './function/createMessageChannel'\r\nimport Controller, { ControllerObserver } from './Controller'\r\nimport { AVFormatContextInterface } from 'avformat/AVFormatContext'\r\nimport dump, { dumpCodecName, dumpTime } from 'avformat/dump'\r\nimport { Data } from 'common/types/type'\r\nimport os from 'common/util/os'\r\nimport compileResource from 'avutil/function/compileResource'\r\nimport CustomIOLoader from 'avnetwork/ioLoader/CustomIOLoader'\r\nimport FetchIOLoader from 'avnetwork/ioLoader/FetchIOLoader'\r\nimport FileIOLoader from 'avnetwork/ioLoader/FileIOLoader'\r\nimport HlsIOLoader from 'avnetwork/ioLoader/HlsIOLoader'\r\nimport DashIOLoader from 'avnetwork/ioLoader/DashIOLoader'\r\n\r\nexport interface AVTranscoderOptions {\r\n  getWasm: (type: 'decoder' | 'resampler' | 'scaler' | 'encoder', codec?: AVCodecID, mediaType?: AVMediaType) => string | ArrayBuffer | WebAssemblyResource\r\n  onprogress?: (taskId: string, progress: number) => void\r\n}\r\n\r\nexport interface TaskOptions {\r\n  input: {\r\n    file: string | File | CustomIOLoader\r\n    format?: keyof (typeof Format2AVFormat)\r\n    protocol?: 'hls' | 'dash'\r\n  }\r\n  start?: number\r\n  duration?: number\r\n  nbFrame?: number\r\n  output: {\r\n    file: FileSystemFileHandle | IOWriterSync\r\n    format?: keyof (typeof Format2AVFormat)\r\n    formatOptions?: Data\r\n    video?: {\r\n      /**\r\n       * 输出编码类型\r\n       */\r\n      codec?: keyof (typeof VideoCodecString2CodecId)\r\n      /**\r\n       * 是否不输出\r\n       */\r\n      disable?: boolean\r\n      /**\r\n       * 输出宽度\r\n       */\r\n      width?: number\r\n      /**\r\n       * 输出高度\r\n       */\r\n      height?: number\r\n      /**\r\n       * 输出帧率\r\n       */\r\n      framerate?: number\r\n      /**\r\n       * 输出码率\r\n       */\r\n      bitrate?: number\r\n      /**\r\n       * 输出视频高宽比\r\n       */\r\n      aspect?: {\r\n        den: number\r\n        num: number\r\n      }\r\n      /**\r\n       * 输出像素格式\r\n       */\r\n      pixfmt?: keyof (typeof PixfmtString2AVPixelFormat)\r\n      /**\r\n       * 输出关键帧间隔（毫秒）\r\n       */\r\n      keyFrameInterval?: number\r\n\r\n      /**\r\n       * 是否启动硬件编码\r\n       */\r\n      enableHardware?: boolean\r\n\r\n      profile?: number\r\n      level?: number\r\n      delay?: number\r\n    }\r\n    audio?: {\r\n      /**\r\n       * 输出编码类型\r\n       */\r\n      codec?: keyof (typeof AudioCodecString2CodecId)\r\n      /**\r\n       * 是否不输出\r\n       */\r\n      disable?: boolean\r\n      /**\r\n       * 输出声道数\r\n       */\r\n      channels?: number\r\n      /**\r\n       * 输出采样率\r\n       */\r\n      sampleRate?: number\r\n      /**\r\n       * 输出码率\r\n       */\r\n      bitrate?: number\r\n      /**\r\n       * 输出采样格式\r\n       */\r\n      sampleFmt?: keyof (typeof SampleFmtString2SampleFormat)\r\n\r\n      profile?: number\r\n    }\r\n  }\r\n}\r\n\r\ninterface SelfTask {\r\n  taskId: string\r\n  startTime: number\r\n  subTaskId?: string\r\n  ext?: string\r\n  options: TaskOptions\r\n  ioloader2DemuxerChannel: MessageChannel\r\n  muxer2OutputChannel: MessageChannel\r\n  stats: Stats\r\n  inputIPCPort?: IPCPort\r\n  outputIPCPort?: IPCPort\r\n  safeFileIO?: SafeFileIO\r\n  format: AVFormat\r\n  formatContext: AVFormatContextInterface\r\n  streams: {\r\n    taskId?: string\r\n    input: AVStreamInterface\r\n    output?: AVStreamInterface\r\n    demuxer2DecoderChannel?: MessageChannel\r\n    decoder2EncoderChannel?: MessageChannel\r\n    decoder2FilterChannel?: MessageChannel\r\n    filter2EncoderChannel?: MessageChannel\r\n    encoder2MuxerChannel?: MessageChannel\r\n    demuxer2MuxerChannel?: MessageChannel\r\n  }[]\r\n  controller: Controller\r\n}\r\n\r\n@struct\r\nclass AVTranscoderGlobalData {\r\n  avpacketList: List<pointer<AVPacketRef>>\r\n  avframeList: List<pointer<AVFrameRef>>\r\n  avpacketListMutex: Mutex\r\n  avframeListMutex: Mutex\r\n}\r\n\r\nconst defaultAVTranscoderOptions: Partial<AVTranscoderOptions> = {\r\n}\r\n\r\nexport default class AVTranscoder extends Emitter implements ControllerObserver {\r\n\r\n  static Util = {\r\n    compile,\r\n    browser,\r\n    os\r\n  }\r\n\r\n  static IOLoader = {\r\n    CustomIOLoader,\r\n    FetchIOLoader,\r\n    FileIOLoader\r\n  }\r\n\r\n  static Resource: Map<string, WebAssemblyResource | ArrayBuffer> = new Map()\r\n\r\n  private level: number = logger.INFO\r\n\r\n  private DemuxThreadReady: Promise<void>\r\n  private AudioThreadReady: Promise<void>\r\n  private VideoThreadReady: Promise<void>\r\n  private MuxThreadReady: Promise<void>\r\n\r\n  // 下面的线程所有 AVTranscoder 实例共享\r\n  private IOThread: Thread<IOPipeline>\r\n  private DemuxerThread: Thread<DemuxPipeline>\r\n  private MuxThread: Thread<MuxPipeline>\r\n\r\n  private AudioDecoderThread: Thread<AudioDecodePipeline>\r\n  private AudioFilterThread: Thread<AVFilterPipeline>\r\n  private AudioEncoderThread: Thread<AudioEncodePipeline>\r\n\r\n  private VideoDecoderThread: Thread<VideoDecodePipeline>\r\n  private VideoFilterThread: Thread<AVFilterPipeline>\r\n  private VideoEncoderThread: Thread<VideoEncodePipeline>\r\n\r\n  // AVTranscoder 各个线程间共享的数据\r\n  private GlobalData: AVTranscoderGlobalData\r\n\r\n  private tasks: Map<string, SelfTask>\r\n  private options: AVTranscoderOptions\r\n\r\n  private reportTimer: Timer\r\n\r\n  constructor(options: AVTranscoderOptions) {\r\n    super(true)\r\n    this.options = object.extend({}, defaultAVTranscoderOptions, options)\r\n\r\n    this.GlobalData = make<AVTranscoderGlobalData>()\r\n\r\n    mutex.init(addressof(this.GlobalData.avpacketListMutex))\r\n    mutex.init(addressof(this.GlobalData.avframeListMutex))\r\n    this.tasks = new Map()\r\n\r\n    this.reportTimer = new Timer(() => {\r\n      this.report()\r\n    }, 0, 1000)\r\n\r\n    logger.info('create transcoder')\r\n  }\r\n\r\n  private async getResource(type: 'decoder' | 'resampler' | 'scaler' | 'encoder', codecId?: AVCodecID, mediaType?: AVMediaType) {\r\n    const key = codecId != null ? `${type}-${codecId}` : type\r\n\r\n    if (AVTranscoder.Resource.has(key)) {\r\n      return AVTranscoder.Resource.get(key)\r\n    }\r\n\r\n    const wasmUrl = this.options.getWasm(type, codecId, mediaType)\r\n    let resource: WebAssemblyResource\r\n\r\n    if (wasmUrl) {\r\n      let resource: WebAssemblyResource | ArrayBuffer\r\n      // safari 16 以下不支持将 WebAssembly.Module 传递到 worker 中\r\n      if (browser.safari && !browser.checkVersion(browser.version, '16.1', true) && (is.string(wasmUrl) || is.arrayBuffer(wasmUrl))) {\r\n        if (is.string(wasmUrl)) {\r\n          const params: Partial<Data> = {\r\n            method: 'GET',\r\n            headers: {},\r\n            mode: 'cors',\r\n            cache: 'default',\r\n            referrerPolicy: 'no-referrer-when-downgrade'\r\n          }\r\n          const response = await fetch(wasmUrl, params)\r\n          resource = await response.arrayBuffer()\r\n        }\r\n        else {\r\n          resource = wasmUrl\r\n        }\r\n      }\r\n      else {\r\n        resource = await compileResource(wasmUrl, mediaType === AVMediaType.AVMEDIA_TYPE_VIDEO)\r\n      }\r\n\r\n      AVTranscoder.Resource.set(key, resource)\r\n\r\n      return resource\r\n    }\r\n  }\r\n\r\n  private report() {\r\n    this.tasks.forEach((task) => {\r\n      if (task.startTime) {\r\n        const frameCount = task.stats.videoPacketEncodeCount || task.stats.audioPacketEncodeCount\r\n        const time = (getTimestamp() - task.startTime)\r\n        let dts: int64 = 0n\r\n        let duration: int64 = 0n\r\n        if (task.stats.lastVideoMuxDts) {\r\n          const stream =  task.streams.find((s) => s.input.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_VIDEO)\r\n          dts = task.stats.lastVideoMuxDts - task.stats.firstVideoMuxDts\r\n          if (stream.output) {\r\n            duration = avRescaleQ(stream.output.duration, stream.output.timeBase, AV_MILLI_TIME_BASE_Q)\r\n          }\r\n          else {\r\n            duration = avRescaleQ(stream.input.duration, stream.input.timeBase, AV_MILLI_TIME_BASE_Q)\r\n          }\r\n        }\r\n        if (task.stats.lastAudioMuxDts && !dts) {\r\n          const stream =  task.streams.find((s) => s.input.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_AUDIO)\r\n          dts = task.stats.lastAudioMuxDts - task.stats.firstAudioMuxDts\r\n          if (stream.output) {\r\n            duration = avRescaleQ(stream.output.duration, stream.output.timeBase, AV_MILLI_TIME_BASE_Q)\r\n          }\r\n          else {\r\n            duration = avRescaleQ(stream.input.duration, stream.input.timeBase, AV_MILLI_TIME_BASE_Q)\r\n          }\r\n        }\r\n\r\n        const fps = time ? (static_cast<double>(frameCount) / (time / 1000)) : static_cast<double>(frameCount)\r\n        const size = static_cast<double>(task.stats.bufferOutputBytes) / 1000\r\n        const bitrate = (dts ? size * 8 / (static_cast<double>(dts) / 1000) : 0)\r\n        const speed = static_cast<double>(dts) / 1000 / (time / 1000)\r\n        let progress = duration ? ((static_cast<double>(dts) / static_cast<double>(duration) * 100)) : 0\r\n        if (progress > 100) {\r\n          progress = 100\r\n        }\r\n\r\n        logger.info(`[${task.taskId}] frame=${frameCount} fps=${fps.toFixed(2)} size=${size}kB time=${dumpTime(dts)} bitrate=${bitrate.toFixed(2)}kbps speed=${speed.toFixed(2)}x progress=${progress.toFixed(2)}%`)\r\n\r\n        if (this.options.onprogress) {\r\n          this.options.onprogress(task.taskId, progress)\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  private async startDemuxPipeline() {\r\n    if (this.DemuxThreadReady) {\r\n      return this.DemuxThreadReady\r\n    }\r\n    return this.DemuxThreadReady = new Promise(async (resolve) => {\r\n      this.IOThread = await createThreadFromClass(IOPipeline, {\r\n        name: 'IOThread'\r\n      }).run()\r\n      this.IOThread.setLogLevel(this.level)\r\n\r\n      this.DemuxerThread = await createThreadFromClass(DemuxPipeline, {\r\n        name: 'DemuxerThread'\r\n      }).run()\r\n      this.DemuxerThread.setLogLevel(this.level)\r\n      resolve()\r\n    })\r\n  }\r\n\r\n  private async startVideoPipeline() {\r\n    if (this.VideoThreadReady) {\r\n      return this.VideoThreadReady\r\n    }\r\n    return this.VideoThreadReady = new Promise(async (resolve) => {\r\n      this.VideoDecoderThread = await createThreadFromClass(VideoDecodePipeline, {\r\n        name: 'VideoDecoderThread',\r\n        disableWorker: browser.safari && !browser.checkVersion(browser.version, '16.1', true)\r\n      }).run()\r\n      this.VideoDecoderThread.setLogLevel(this.level)\r\n\r\n      this.VideoFilterThread = await createThreadFromClass(AVFilterPipeline, {\r\n        name: 'VideoFilterThread',\r\n        disableWorker: browser.safari && !browser.checkVersion(browser.version, '16.1', true)\r\n      }).run()\r\n      this.VideoFilterThread.setLogLevel(this.level)\r\n\r\n      this.VideoEncoderThread = await createThreadFromClass(VideoEncodePipeline, {\r\n        name: 'VideoEncoderThread',\r\n        disableWorker: browser.safari && !browser.checkVersion(browser.version, '16.1', true)\r\n      }).run()\r\n      this.VideoEncoderThread.setLogLevel(this.level)\r\n      resolve()\r\n    })\r\n  }\r\n\r\n  private async startAudioPipeline() {\r\n    if (this.AudioThreadReady) {\r\n      return this.AudioThreadReady\r\n    }\r\n    return this.AudioThreadReady = new Promise(async (resolve) => {\r\n      this.AudioDecoderThread = await createThreadFromClass(AudioDecodePipeline, {\r\n        name: 'AudioDecoderThread',\r\n        disableWorker: browser.safari && !browser.checkVersion(browser.version, '16.1', true)\r\n      }).run()\r\n      this.AudioDecoderThread.setLogLevel(this.level)\r\n\r\n      this.AudioFilterThread = await createThreadFromClass(AVFilterPipeline, {\r\n        name: 'AudioFilterThread',\r\n        disableWorker: browser.safari && !browser.checkVersion(browser.version, '16.1', true)\r\n      }).run()\r\n      this.AudioFilterThread.setLogLevel(this.level)\r\n\r\n      this.AudioEncoderThread = await createThreadFromClass(AudioEncodePipeline, {\r\n        name: 'AudioEncoderThread',\r\n        disableWorker: browser.safari && !browser.checkVersion(browser.version, '16.1', true)\r\n      }).run()\r\n      this.AudioEncoderThread.setLogLevel(this.level)\r\n      resolve()\r\n    })\r\n  }\r\n\r\n  private async startMuxPipeline() {\r\n    if (this.MuxThreadReady) {\r\n      return this.MuxThreadReady\r\n    }\r\n    return this.MuxThreadReady = new Promise(async (resolve) => {\r\n      this.MuxThread = await createThreadFromClass(MuxPipeline, {\r\n        name: 'MuxThread',\r\n        disableWorker: !support.workerMSE\r\n      }).run()\r\n      this.MuxThread.setLogLevel(this.level)\r\n      resolve()\r\n    })\r\n  }\r\n\r\n  private isHls(task: SelfTask) {\r\n    if (task.ext) {\r\n      return task.ext === 'm3u8' || task.ext === 'm3u'\r\n    }\r\n    return task.options.input.protocol === 'hls'\r\n  }\r\n\r\n  private isDash(task: SelfTask) {\r\n    if (task.ext) {\r\n      return task.ext === 'mpd'\r\n    }\r\n    return task.options.input.protocol === 'dash'\r\n  }\r\n\r\n  public async ready() {\r\n    await this.startDemuxPipeline()\r\n    await this.startAudioPipeline()\r\n    await this.startVideoPipeline()\r\n    await this.startMuxPipeline()\r\n    logger.info('AVTranscoder pipelines started')\r\n  }\r\n\r\n  private copyAVStreamInterface(task: SelfTask, stream: AVStreamInterface) {\r\n    const newStream = object.extend({}, stream)\r\n    newStream.codecpar = avMallocz(sizeof(AVCodecParameters))\r\n    copyCodecParameters(newStream.codecpar, stream.codecpar)\r\n    newStream.timeBase = {\r\n      den: 1,\r\n      num: 1\r\n    }\r\n\r\n    newStream.timeBase.den = stream.timeBase.den\r\n    newStream.timeBase.num = stream.timeBase.num\r\n\r\n    if (newStream.codecpar.extradata) {\r\n      avFree(newStream.codecpar.extradata)\r\n      newStream.codecpar.extradata = nullptr\r\n      newStream.codecpar.extradataSize = 0\r\n    }\r\n\r\n    if (task.options.duration) {\r\n      newStream.duration = avRescaleQ(static_cast<int64>(task.options.duration), AV_MILLI_TIME_BASE_Q, newStream.timeBase)\r\n    }\r\n\r\n    newStream.metadata['encoder'] = `libmedia-${defined(VERSION)}`\r\n\r\n    return newStream\r\n  }\r\n\r\n  private async setTaskInput(task: SelfTask) {\r\n    const taskId = task.taskId\r\n    const taskOptions = task.options\r\n    const ioloader2DemuxerChannel = task.ioloader2DemuxerChannel = createMessageChannel()\r\n    const stats = task.stats\r\n\r\n    let ret = 0\r\n    let ext: string\r\n    if (is.string(taskOptions.input.file)) {\r\n      ext = urlUtils.parse(taskOptions.input.file).file.split('.').pop()\r\n      // 注册一个 url io 任务\r\n      ret = await this.IOThread.registerTask\r\n        .transfer(ioloader2DemuxerChannel.port1)\r\n        .invoke({\r\n          type: Ext2IOLoader[ext] ?? IOType.Fetch,\r\n          info: {\r\n            url: taskOptions.input.file\r\n          },\r\n          range: {\r\n            from: -1,\r\n            to: -1\r\n          },\r\n          taskId,\r\n          options: {\r\n            isLive: false\r\n          },\r\n          rightPort: ioloader2DemuxerChannel.port1,\r\n          stats: addressof(stats)\r\n        })\r\n    }\r\n    else if (taskOptions.input.file instanceof File) {\r\n      ext = taskOptions.input.file.name.split('.').pop()\r\n      // 注册一个文件 io 任务\r\n      ret = await this.IOThread.registerTask\r\n        .transfer(ioloader2DemuxerChannel.port1)\r\n        .invoke({\r\n          type: IOType.File,\r\n          info: {\r\n            file: taskOptions.input.file\r\n          },\r\n          range: {\r\n            from: -1,\r\n            to: -1\r\n          },\r\n          taskId,\r\n          options: {\r\n            isLive: false\r\n          },\r\n          rightPort: ioloader2DemuxerChannel.port1,\r\n          stats: addressof(stats)\r\n        })\r\n    }\r\n    else if (taskOptions.input.file instanceof CustomIOLoader) {\r\n      const ipcPort = task.inputIPCPort = new IPCPort(ioloader2DemuxerChannel.port1)\r\n      ipcPort.on(REQUEST, async (request: RpcMessage) => {\r\n        switch (request.method) {\r\n          case 'open': {\r\n            const ret = await (task.options.input.file as CustomIOLoader).open()\r\n            if (ret < 0) {\r\n              logger.error(`custom loader open error, ${ret}, taskId: ${task.taskId}`)\r\n              ipcPort.reply(request, null, ret)\r\n              break\r\n            }\r\n            ipcPort.reply(request, ret)\r\n            break\r\n          }\r\n          case 'read': {\r\n            const pointer = request.params.pointer\r\n            const length = request.params.length\r\n\r\n            assert(pointer)\r\n            assert(length)\r\n\r\n            const buffer = mapSafeUint8Array(pointer, length)\r\n\r\n            try {\r\n              const len = await (task.options.input.file as CustomIOLoader).read(length, buffer)\r\n              task.stats.bufferReceiveBytes += static_cast<int64>(len)\r\n              ipcPort.reply(request, len)\r\n            }\r\n            catch (error) {\r\n              logger.error(`loader read error, ${error}, taskId: ${task.taskId}`)\r\n              ipcPort.reply(request, errorType.DATA_INVALID)\r\n            }\r\n\r\n            break\r\n          }\r\n\r\n          case 'seek': {\r\n            const pos = request.params.pos\r\n\r\n            assert(pos >= 0)\r\n\r\n            try {\r\n              const ret = await (task.options.input.file as CustomIOLoader).seek(pos)\r\n              if (ret < 0) {\r\n                logger.error(`custom loader seek error, ${ret}, taskId: ${task.taskId}`)\r\n                ipcPort.reply(request, null, ret)\r\n                break\r\n              }\r\n              ipcPort.reply(request, ret)\r\n            }\r\n            catch (error) {\r\n              logger.error(`loader seek error, ${error}, taskId: ${task.taskId}`)\r\n              ipcPort.reply(request, null, error)\r\n            }\r\n            break\r\n          }\r\n\r\n          case 'size': {\r\n            ipcPort.reply(request, await (task.options.input.file as CustomIOLoader).size())\r\n            break\r\n          }\r\n        }\r\n      })\r\n    }\r\n    else {\r\n      logger.fatal('invalid source')\r\n    }\r\n\r\n\r\n    if (ext) {\r\n      task.ext = ext\r\n    }\r\n\r\n    if (ret < 0) {\r\n      logger.fatal(`register io task failed, ret: ${ret}, taskId: ${taskId}`)\r\n    }\r\n  }\r\n\r\n  private async setTaskOutput(task: SelfTask) {\r\n    const muxer2OutputChannel = task.muxer2OutputChannel = createMessageChannel()\r\n    const ipcPort = task.outputIPCPort = new IPCPort(muxer2OutputChannel.port2)\r\n\r\n    let format: AVFormat\r\n\r\n    if (task.options.output.format) {\r\n      format = Format2AVFormat[task.options.output.format]\r\n    }\r\n    else if (task.options.output.file instanceof FileSystemFileHandle) {\r\n      let ext = task.options.output.file.name.split('.').pop()\r\n      format = Ext2Format[ext]\r\n    }\r\n\r\n    if (!is.number(format)) {\r\n      logger.fatal('invalid output format')\r\n    }\r\n\r\n    task.format = format\r\n\r\n    let ret = await this.MuxThread.registerTask.transfer(muxer2OutputChannel.port1)\r\n      .invoke({\r\n        taskId: task.taskId,\r\n        format,\r\n        avpacketList: addressof(this.GlobalData.avpacketList),\r\n        avpacketListMutex: addressof(this.GlobalData.avpacketListMutex),\r\n        stats: addressof(task.stats),\r\n        rightPort: muxer2OutputChannel.port1,\r\n        formatOptions: task.options.output.formatOptions\r\n      })\r\n\r\n    if (ret < 0) {\r\n      logger.fatal(`register mux task failed, ret: ${ret}, taskId: ${task.taskId}`)\r\n    }\r\n\r\n    let ioWriter: {\r\n      write: (buffer: Uint8Array) => void\r\n      appendBufferByPosition: (buffer: Uint8Array, pos: number) => void\r\n      seek: (pos: number) => void\r\n      close: () => void | Promise<void>\r\n    }\r\n\r\n    if (task.options.output.file instanceof FileSystemFileHandle) {\r\n      ioWriter = task.safeFileIO = new SafeFileIO(task.options.output.file)\r\n      await task.safeFileIO.ready()\r\n    }\r\n    else {\r\n      ioWriter = {\r\n        write: (buffer) => {\r\n          (task.options.output.file as IOWriterSync).writeBuffer(buffer)\r\n        },\r\n        appendBufferByPosition: (buffer, pos) => {\r\n          (task.options.output.file as IOWriterSync).flush()\r\n          ;(task.options.output.file as IOWriterSync).writeBuffer(buffer)\r\n          ;(task.options.output.file as IOWriterSync).flushToPos(static_cast<int64>(pos))\r\n        },\r\n        seek: (pos) => {\r\n          (task.options.output.file as IOWriterSync).seek(static_cast<int64>(pos))\r\n        },\r\n        close: () => {\r\n          (task.options.output.file as IOWriterSync).flush()\r\n        }\r\n      }\r\n    }\r\n\r\n    ipcPort.on(NOTIFY, async (request: RpcMessage) => {\r\n      switch (request.method) {\r\n        case 'write': {\r\n          try {\r\n            if (request.params.pos != null) {\r\n              ioWriter.appendBufferByPosition(request.params.data, Number(request.params.pos))\r\n            }\r\n            else {\r\n              ioWriter.write(request.params.data)\r\n            }\r\n            if (task.options.output.file instanceof FileSystemFileHandle) {\r\n              if (task.safeFileIO.writeQueueSize > 5) {\r\n                try {\r\n                  await this.MuxThread.pause(task.taskId)\r\n                  while (task.safeFileIO.writeQueueSize > 5) {\r\n                    await new Sleep(0)\r\n                  }\r\n                  await this.MuxThread.unpause(task.taskId)\r\n                }\r\n                catch (e) {}\r\n              }\r\n            }\r\n          }\r\n          catch (error) {\r\n            logger.error(`ioWriter write error, ${error}, taskId: ${task.taskId}`)\r\n          }\r\n          break\r\n        }\r\n        case 'seek': {\r\n          const pos = request.params.pos\r\n\r\n          assert(pos >= 0)\r\n\r\n          try {\r\n            ioWriter.seek(Number(pos))\r\n          }\r\n          catch (error) {\r\n            logger.error(`ioWriter seek error, ${error}, taskId: ${task.taskId}`)\r\n          }\r\n          break\r\n        }\r\n        case 'end': {\r\n          await ioWriter.close()\r\n          await this.clearTask(task)\r\n          this.fire(eventType.TASK_ENDED, [task.taskId])\r\n          logger.info(`transcode ended, taskId: ${task.taskId}, cost: ${dumpTime(static_cast<int64>(getTimestamp() - task.startTime))}`)\r\n          break\r\n        }\r\n\r\n        case 'error': {\r\n          await ioWriter.close()\r\n          await this.clearTask(task)\r\n          this.fire(eventType.TASK_ERROR, [task.taskId])\r\n          logger.info(`transcode error, taskId: ${task.taskId}`)\r\n          break\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  private async analyzeInputStreams(task: SelfTask) {\r\n    const taskId = task.taskId\r\n    const ioloader2DemuxerChannel = task.ioloader2DemuxerChannel\r\n    const ext = task.ext\r\n    const stats = task.stats\r\n\r\n    let ret = 0\r\n    let subTaskId: string\r\n    if (defined(ENABLE_PROTOCOL_DASH) && this.isDash(task)) {\r\n      await this.IOThread.open(taskId)\r\n      const hasAudio = await this.IOThread.hasAudio(taskId)\r\n      const hasVideo = await this.IOThread.hasVideo(taskId)\r\n      if (hasAudio && hasVideo) {\r\n        // dash 因为音视频各自独立，因此这里注册两个解封装任务\r\n        subTaskId = generateUUID()\r\n        await this.DemuxerThread.registerTask\r\n          .transfer(ioloader2DemuxerChannel.port2, task.controller.getDemuxerRenderControlPort())\r\n          .invoke({\r\n            taskId,\r\n            leftPort: ioloader2DemuxerChannel.port2,\r\n            controlPort: task.controller.getDemuxerRenderControlPort(),\r\n            format: Ext2Format[ext],\r\n            stats: addressof(stats),\r\n            isLive: false,\r\n            flags: IOFlags.SLICE,\r\n            ioloaderOptions: {\r\n              mediaType: 'audio'\r\n            },\r\n            avpacketList: addressof(this.GlobalData.avpacketList),\r\n            avpacketListMutex: addressof(this.GlobalData.avpacketListMutex),\r\n          })\r\n        await this.DemuxerThread.registerTask({\r\n          taskId: subTaskId,\r\n          mainTaskId: taskId,\r\n          flags: IOFlags.SLICE,\r\n          format: Ext2Format[ext],\r\n          stats: addressof(stats),\r\n          isLive: false,\r\n          ioloaderOptions: {\r\n            mediaType: 'video'\r\n          },\r\n          avpacketList: addressof(this.GlobalData.avpacketList),\r\n          avpacketListMutex: addressof(this.GlobalData.avpacketListMutex)\r\n        })\r\n      }\r\n      else {\r\n        // dash 只有一个媒体类型\r\n        await this.DemuxerThread.registerTask\r\n          .transfer(ioloader2DemuxerChannel.port2, task.controller.getDemuxerRenderControlPort())\r\n          .invoke({\r\n            taskId,\r\n            leftPort: ioloader2DemuxerChannel.port2,\r\n            controlPort: task.controller.getDemuxerRenderControlPort(),\r\n            format: Ext2Format[ext],\r\n            stats: addressof(stats),\r\n            isLive: false,\r\n            flags: IOFlags.SLICE,\r\n            ioloaderOptions: {\r\n              mediaType: hasAudio ? 'audio' : 'video'\r\n            },\r\n            avpacketList: addressof(this.GlobalData.avpacketList),\r\n            avpacketListMutex: addressof(this.GlobalData.avpacketListMutex),\r\n          })\r\n      }\r\n    }\r\n    else {\r\n      await this.DemuxerThread.registerTask\r\n        .transfer(ioloader2DemuxerChannel.port2, task.controller.getDemuxerRenderControlPort())\r\n        .invoke({\r\n          taskId,\r\n          leftPort: ioloader2DemuxerChannel.port2,\r\n          controlPort: task.controller.getDemuxerRenderControlPort(),\r\n          format: Ext2Format[ext],\r\n          stats: addressof(stats),\r\n          isLive: false,\r\n          flags: this.isHls(task) ? IOFlags.SLICE : 0,\r\n          avpacketList: addressof(this.GlobalData.avpacketList),\r\n          avpacketListMutex: addressof(this.GlobalData.avpacketListMutex)\r\n        })\r\n    }\r\n\r\n    ret = await this.DemuxerThread.openStream(taskId, 10000)\r\n    if (ret < 0) {\r\n      logger.fatal(`open stream failed, ret: ${ret}, taskId: ${taskId}`)\r\n    }\r\n    let formatContext = await this.DemuxerThread.analyzeStreams(taskId)\r\n    if (is.number(formatContext) || !formatContext.streams.length) {\r\n      logger.fatal(`analyze stream failed, ret: ${formatContext}`)\r\n    }\r\n\r\n    if (defined(ENABLE_PROTOCOL_DASH) && subTaskId) {\r\n      ret = await this.DemuxerThread.openStream(subTaskId, 10000)\r\n      if (ret < 0) {\r\n        logger.fatal(`open stream failed, ret: ${ret}, taskId: ${taskId}`)\r\n      }\r\n      const subFormatContext = await this.DemuxerThread.analyzeStreams(subTaskId)\r\n      if (is.number(subFormatContext) || !subFormatContext.streams.length) {\r\n        logger.fatal(`analyze stream failed, ret: ${subFormatContext}`)\r\n      }\r\n      formatContext.streams = formatContext.streams.concat(subFormatContext.streams)\r\n    }\r\n\r\n    if (subTaskId) {\r\n      task.subTaskId = subTaskId\r\n    }\r\n\r\n    if (defined(ENABLE_PROTOCOL_DASH) || defined(ENABLE_PROTOCOL_HLS)) {\r\n      // m3u8 和 dash 的 duration 来自于协议本身\r\n      if (this.isHls(task) || this.isDash(task)) {\r\n        const duration: double = (await this.IOThread.getDuration(taskId)) * 1000\r\n        if (duration > 0) {\r\n          for (let i = 0; i < formatContext.streams.length; i++) {\r\n            formatContext.streams[i].duration = avRescaleQ(\r\n              static_cast<int64>(duration),\r\n              AV_MILLI_TIME_BASE_Q,\r\n              formatContext.streams[i].timeBase\r\n            )\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return formatContext\r\n  }\r\n\r\n  private async handleAudioStream(stream: AVStreamInterface, task: SelfTask): Promise<number> {\r\n    const audioConfig = task.options.output.audio\r\n    if (audioConfig?.disable) {\r\n      return 0\r\n    }\r\n    else if (audioConfig?.codec === 'copy' && !(task.options.start || task.options.duration)) {\r\n      const demuxer2MuxerChannel = createMessageChannel()\r\n      await this.DemuxerThread.connectStreamTask\r\n        .transfer(demuxer2MuxerChannel.port1)\r\n        .invoke(task.taskId, stream.index, demuxer2MuxerChannel.port1)\r\n\r\n      await this.MuxThread.addStream\r\n        .transfer(demuxer2MuxerChannel.port2)\r\n        .invoke(task.taskId, stream, demuxer2MuxerChannel.port2)\r\n\r\n      task.streams.push({\r\n        input: stream,\r\n        demuxer2MuxerChannel\r\n      })\r\n\r\n      return 0\r\n    }\r\n    else {\r\n      const demuxer2DecoderChannel = createMessageChannel()\r\n      const encoder2MuxerChannel = createMessageChannel()\r\n\r\n      const decoder2FilterChannel = createMessageChannel()\r\n      const filter2EncoderChannel = createMessageChannel()\r\n\r\n      const newStream = this.copyAVStreamInterface(task, stream)\r\n      const taskId = generateUUID()\r\n\r\n      let ret = 0\r\n\r\n      if (audioConfig) {\r\n        if (audioConfig.codec && audioConfig.codec !== 'copy') {\r\n          const codecId = AudioCodecString2CodecId[audioConfig.codec]\r\n          if (!is.number(codecId)) {\r\n            logger.fatal(`invalid codec name(${audioConfig.codec})`)\r\n          }\r\n          newStream.codecpar.codecId = codecId\r\n\r\n          if (newStream.codecpar.codecId !== stream.codecpar.codecId) {\r\n            newStream.codecpar.profile = NOPTS_VALUE\r\n            newStream.codecpar.level = NOPTS_VALUE\r\n          }\r\n        }\r\n        if (audioConfig.bitrate) {\r\n          newStream.codecpar.bitrate = static_cast<int64>(audioConfig.bitrate)\r\n        }\r\n        if (audioConfig.channels) {\r\n          newStream.codecpar.chLayout.nbChannels = audioConfig.channels\r\n        }\r\n        if (audioConfig.sampleRate) {\r\n          newStream.codecpar.sampleRate = audioConfig.sampleRate\r\n        }\r\n        if (audioConfig.sampleFmt) {\r\n          const sampleFmt = SampleFmtString2SampleFormat[audioConfig.sampleFmt]\r\n          if (!is.number(sampleFmt)) {\r\n            logger.fatal(`invalid sampleFmt name(${audioConfig.sampleFmt})`)\r\n          }\r\n          newStream.codecpar.format = sampleFmt\r\n        }\r\n        if (audioConfig.profile) {\r\n          newStream.codecpar.profile = audioConfig.profile\r\n        }\r\n      }\r\n\r\n      if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_AAC) {\r\n        newStream.codecpar.format = AVSampleFormat.AV_SAMPLE_FMT_FLTP\r\n        if (newStream.codecpar.sampleRate > 48000) {\r\n          newStream.codecpar.sampleRate = 48000\r\n        }\r\n      }\r\n      else if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_MP3) {\r\n        newStream.codecpar.format = AVSampleFormat.AV_SAMPLE_FMT_FLTP\r\n        if (newStream.codecpar.sampleRate > 48000) {\r\n          newStream.codecpar.sampleRate = 48000\r\n        }\r\n      }\r\n      else if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_FLAC) {\r\n        if (newStream.codecpar.format !== AVSampleFormat.AV_SAMPLE_FMT_S16\r\n          && newStream.codecpar.format !== AVSampleFormat.AV_SAMPLE_FMT_S32\r\n        ) {\r\n          newStream.codecpar.format = AVSampleFormat.AV_SAMPLE_FMT_S16\r\n        }\r\n      }\r\n      else if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_PCM_ALAW\r\n        || newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_PCM_MULAW\r\n      ) {\r\n        newStream.codecpar.sampleRate = 8000\r\n        newStream.codecpar.bitrate = 64000n\r\n        newStream.codecpar.format = AVSampleFormat.AV_SAMPLE_FMT_S16\r\n      }\r\n      else if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_SPEEX) {\r\n        newStream.codecpar.format = AVSampleFormat.AV_SAMPLE_FMT_S16\r\n      }\r\n\r\n      if (newStream.codecpar.profile === NOPTS_VALUE) {\r\n        if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_AAC) {\r\n          newStream.codecpar.profile = aac.MPEG4AudioObjectTypes.AAC_LC\r\n        }\r\n        else if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_MP3) {\r\n          newStream.codecpar.profile = 34\r\n        }\r\n      }\r\n\r\n      await this.DemuxerThread.connectStreamTask\r\n        .transfer(demuxer2DecoderChannel.port1)\r\n        .invoke(task.taskId, stream.index, demuxer2DecoderChannel.port1)\r\n\r\n      let decoderResource = await this.getResource('decoder', stream.codecpar.codecId, stream.codecpar.codecType)\r\n      if (!decoderResource) {\r\n        if (support.audioDecoder) {\r\n          const isSupport = await AudioDecoder.isConfigSupported({\r\n            codec: getVideoCodec(stream.codecpar),\r\n            sampleRate: stream.codecpar.sampleRate,\r\n            numberOfChannels: stream.codecpar.chLayout.nbChannels\r\n          })\r\n          if (!isSupport.supported) {\r\n            logger.fatal(`AudioDecoder codecId ${stream.codecpar.codecId} not support`)\r\n          }\r\n        }\r\n        else {\r\n          logger.fatal(`audio decoder codecId ${stream.codecpar.codecId} not support`)\r\n        }\r\n      }\r\n\r\n      // 注册一个音频解码任务\r\n      await this.AudioDecoderThread.registerTask\r\n        .transfer(demuxer2DecoderChannel.port2, decoder2FilterChannel.port1)\r\n        .invoke({\r\n          taskId: taskId,\r\n          resource: decoderResource,\r\n          leftPort: demuxer2DecoderChannel.port2,\r\n          rightPort: decoder2FilterChannel.port1,\r\n          stats: addressof(task.stats),\r\n          avpacketList: addressof(this.GlobalData.avpacketList),\r\n          avpacketListMutex: addressof(this.GlobalData.avpacketListMutex),\r\n          avframeList: addressof(this.GlobalData.avframeList),\r\n          avframeListMutex: addressof(this.GlobalData.avframeListMutex),\r\n          timeBase: {\r\n            num: stream.timeBase.num,\r\n            den: stream.timeBase.den\r\n          }\r\n        })\r\n\r\n      ret = await this.AudioDecoderThread.open(taskId, stream.codecpar)\r\n\r\n      if (ret < 0) {\r\n        logger.error(`cannot open audio ${dumpCodecName(stream.codecpar.codecType, stream.codecpar.codecId)} decoder`)\r\n        return ret\r\n      }\r\n\r\n      let resamplerResource = await this.getResource('resampler')\r\n      if (!resamplerResource) {\r\n        logger.fatal('resampler not found')\r\n      }\r\n\r\n      const vertices: AVFilterGraphDesVertex<GraphNodeType>[] = []\r\n      const edges: { parent: number, child: number }[] = []\r\n      let input: FilterGraphPortDes\r\n      let output: FilterGraphPortDes\r\n\r\n      const resampleNode = createGraphDesVertex('resampler', {\r\n        resource: resamplerResource,\r\n        output: {\r\n          channels: newStream.codecpar.chLayout.nbChannels,\r\n          sampleRate: newStream.codecpar.sampleRate,\r\n          format: newStream.codecpar.format as AVSampleFormat\r\n        }\r\n      })\r\n      vertices.push(resampleNode)\r\n      input = {\r\n        id: resampleNode.id,\r\n        port: decoder2FilterChannel.port2\r\n      }\r\n      output = {\r\n        id: resampleNode.id,\r\n        port: filter2EncoderChannel.port1\r\n      }\r\n\r\n      if (task.options.start || task.options.duration) {\r\n        const start = avRescaleQ(static_cast<int64>(task.options.start || 0), AV_MILLI_TIME_BASE_Q, stream.timeBase)\r\n        const rangeNode = createGraphDesVertex('range', {\r\n          start: start,\r\n          end: task.options.duration\r\n            ? (avRescaleQ(static_cast<int64>(task.options.duration), AV_MILLI_TIME_BASE_Q, stream.timeBase) + start)\r\n            : -1n\r\n        })\r\n        vertices.push(rangeNode)\r\n        input = {\r\n          id: rangeNode.id,\r\n          port: decoder2FilterChannel.port2\r\n        }\r\n        edges.push({\r\n          parent: rangeNode.id,\r\n          child: resampleNode.id\r\n        })\r\n      }\r\n\r\n      await this.AudioFilterThread.registerTask\r\n        .transfer(decoder2FilterChannel.port2, filter2EncoderChannel.port1)\r\n        .invoke({\r\n          taskId: taskId,\r\n          graph: {\r\n            vertices: vertices,\r\n            edges: edges\r\n          },\r\n          inputPorts: [input],\r\n          outputPorts: [output],\r\n          stats: addressof(task.stats),\r\n          avframeList: addressof(this.GlobalData.avframeList),\r\n          avframeListMutex: addressof(this.GlobalData.avframeListMutex),\r\n        })\r\n\r\n      let encoderResource = await this.getResource('encoder', newStream.codecpar.codecId, newStream.codecpar.codecType)\r\n      if (!encoderResource) {\r\n        if (support.audioEncoder) {\r\n          const isSupport = await AudioEncoder.isConfigSupported({\r\n            codec: getAudioCodec(newStream.codecpar),\r\n            sampleRate: newStream.codecpar.sampleRate,\r\n            numberOfChannels: newStream.codecpar.chLayout.nbChannels,\r\n            bitrate: static_cast<int32>(newStream.codecpar.bitrate),\r\n            bitrateMode: 'constant'\r\n          })\r\n          if (!isSupport.supported) {\r\n            logger.fatal(`AudioEncoder ${dumpCodecName(newStream.codecpar.codecType, newStream.codecpar.codecId)} codecId ${newStream.codecpar.codecId} not support`)\r\n          }\r\n        }\r\n        else {\r\n          logger.fatal(`${dumpCodecName(newStream.codecpar.codecType, newStream.codecpar.codecId)} encoder codecId ${newStream.codecpar.codecId} not support`)\r\n        }\r\n      }\r\n\r\n      // 注册一个音频编码任务\r\n      await this.AudioEncoderThread.registerTask\r\n        .transfer(filter2EncoderChannel.port2, encoder2MuxerChannel.port1)\r\n        .invoke({\r\n          taskId: taskId,\r\n          resource: encoderResource,\r\n          leftPort: filter2EncoderChannel.port2,\r\n          rightPort: encoder2MuxerChannel.port1,\r\n          stats: addressof(task.stats),\r\n          avpacketList: addressof(this.GlobalData.avpacketList),\r\n          avpacketListMutex: addressof(this.GlobalData.avpacketListMutex),\r\n          avframeList: addressof(this.GlobalData.avframeList),\r\n          avframeListMutex: addressof(this.GlobalData.avframeListMutex),\r\n        })\r\n\r\n      ret = await this.AudioEncoderThread.open(taskId, newStream.codecpar, { num: newStream.timeBase.num, den: newStream.timeBase.den })\r\n\r\n      if (ret < 0) {\r\n        logger.error(`cannot open audio ${dumpCodecName(newStream.codecpar.codecType, newStream.codecpar.codecId)} encoder`)\r\n        return ret\r\n      }\r\n\r\n      await this.MuxThread.addStream\r\n        .transfer(encoder2MuxerChannel.port2)\r\n        .invoke(task.taskId, newStream, encoder2MuxerChannel.port2)\r\n\r\n      task.streams.push({\r\n        taskId,\r\n        input: stream,\r\n        output: newStream,\r\n        demuxer2DecoderChannel,\r\n        decoder2FilterChannel,\r\n        filter2EncoderChannel,\r\n        encoder2MuxerChannel\r\n      })\r\n\r\n      return 0\r\n    }\r\n  }\r\n\r\n  private async handleVideoStream(stream: AVStreamInterface, task: SelfTask): Promise<number> {\r\n    const videoConfig = task.options.output.video\r\n    if (videoConfig?.disable) {\r\n      return 0\r\n    }\r\n    else if (videoConfig?.codec === 'copy' && !(task.options.start || task.options.duration)) {\r\n      const demuxer2MuxerChannel = createMessageChannel()\r\n      await this.DemuxerThread.connectStreamTask\r\n        .transfer(demuxer2MuxerChannel.port1)\r\n        .invoke(task.subTaskId || task.taskId, stream.index, demuxer2MuxerChannel.port1)\r\n\r\n      await this.MuxThread.addStream\r\n        .transfer(demuxer2MuxerChannel.port2)\r\n        .invoke(task.taskId, stream, demuxer2MuxerChannel.port2)\r\n\r\n      task.streams.push({\r\n        input: stream,\r\n        demuxer2MuxerChannel\r\n      })\r\n\r\n      return 0\r\n    }\r\n    else {\r\n      const demuxer2DecoderChannel = createMessageChannel()\r\n      const encoder2MuxerChannel = createMessageChannel()\r\n\r\n      const decoder2FilterChannel = createMessageChannel()\r\n      const filter2EncoderChannel = createMessageChannel()\r\n\r\n      const newStream = this.copyAVStreamInterface(task, stream)\r\n\r\n      const taskId = generateUUID()\r\n\r\n      let ret = 0\r\n\r\n      if (videoConfig) {\r\n        if (videoConfig.codec && videoConfig.codec !== 'copy') {\r\n          const codecId = VideoCodecString2CodecId[videoConfig.codec]\r\n          if (!is.number(codecId)) {\r\n            logger.fatal(`invalid codec name(${videoConfig.codec})`)\r\n          }\r\n          newStream.codecpar.codecId = codecId\r\n\r\n          if (newStream.codecpar.codecId !== stream.codecpar.codecId) {\r\n            newStream.codecpar.profile = NOPTS_VALUE\r\n            newStream.codecpar.level = NOPTS_VALUE\r\n          }\r\n        }\r\n        if (videoConfig.width) {\r\n          newStream.codecpar.width = videoConfig.width\r\n        }\r\n        if (videoConfig.height) {\r\n          newStream.codecpar.height = videoConfig.height\r\n        }\r\n        if (videoConfig.bitrate) {\r\n          newStream.codecpar.bitrate = static_cast<int64>(videoConfig.bitrate)\r\n        }\r\n        if (videoConfig.pixfmt) {\r\n          const pixfmt = PixfmtString2AVPixelFormat[videoConfig.pixfmt]\r\n          if (!is.number(pixfmt)) {\r\n            logger.fatal(`invalid pixfmt name(${videoConfig.pixfmt})`)\r\n          }\r\n          newStream.codecpar.format = pixfmt\r\n        }\r\n        if (videoConfig.framerate) {\r\n          newStream.codecpar.framerate.num = videoConfig.framerate >>> 0\r\n          newStream.codecpar.framerate.den = 1\r\n        }\r\n        if (videoConfig.aspect) {\r\n          newStream.codecpar.sampleAspectRatio.den = videoConfig.aspect.den\r\n          newStream.codecpar.sampleAspectRatio.num = videoConfig.aspect.num\r\n        }\r\n        if (videoConfig.profile) {\r\n          newStream.codecpar.profile = videoConfig.profile\r\n        }\r\n        if (videoConfig.level) {\r\n          newStream.codecpar.level = videoConfig.level\r\n        }\r\n        if (videoConfig.delay) {\r\n          newStream.codecpar.videoDelay = videoConfig.delay\r\n        }\r\n      }\r\n\r\n      if (newStream.codecpar.profile === NOPTS_VALUE) {\r\n        if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_H264) {\r\n          newStream.codecpar.profile = h264.H264Profile.kHigh\r\n        }\r\n        else if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_HEVC) {\r\n          newStream.codecpar.profile = hevc.HEVCProfile.Main\r\n        }\r\n        else if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_VVC) {\r\n\r\n        }\r\n        else if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_AV1) {\r\n          newStream.codecpar.profile = av1.AV1Profile.Main\r\n        }\r\n        else if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_VP9) {\r\n          newStream.codecpar.profile = vp9.VP9Profile.Profile0\r\n        }\r\n        else if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_VP8) {\r\n          newStream.codecpar.profile = 0\r\n        }\r\n      }\r\n      if (newStream.codecpar.level === NOPTS_VALUE) {\r\n        if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_H264) {\r\n          newStream.codecpar.level = h264.getLevelByResolution(newStream.codecpar.width, newStream.codecpar.height, avQ2D(newStream.codecpar.framerate))\r\n        }\r\n        else if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_HEVC) {\r\n          newStream.codecpar.level = hevc.getLevelByResolution(\r\n            newStream.codecpar.profile,\r\n            newStream.codecpar.width,\r\n            newStream.codecpar.height,\r\n            avQ2D(newStream.codecpar.framerate),\r\n            static_cast<double>(newStream.codecpar.bitrate)\r\n          )\r\n        }\r\n        else if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_VVC) {\r\n\r\n        }\r\n        else if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_AV1) {\r\n          newStream.codecpar.level = av1.getLevelByResolution(newStream.codecpar.width, newStream.codecpar.height, avQ2D(newStream.codecpar.framerate))\r\n        }\r\n        else if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_VP9) {\r\n          newStream.codecpar.level = vp9.getLevelByResolution(newStream.codecpar.width, newStream.codecpar.height, avQ2D(newStream.codecpar.framerate))\r\n        }\r\n      }\r\n\r\n      if (!videoConfig || videoConfig.delay == null) {\r\n        newStream.codecpar.videoDelay = 4\r\n      }\r\n\r\n      if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_H264\r\n        || newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_MPEG4\r\n        || newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_HEVC\r\n        || newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_VVC\r\n      ) {\r\n        if (task.format === AVFormat.MPEGTS) {\r\n          newStream.codecpar.bitFormat = BitFormat.ANNEXB\r\n        }\r\n        else {\r\n          newStream.codecpar.bitFormat = BitFormat.AVCC\r\n        }\r\n      }\r\n\r\n      if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_MPEG4 && newStream.timeBase.den > 65535) {\r\n        const newTimebase = {\r\n          den: 65535,\r\n          num: 1\r\n        }\r\n        newStream.startTime = avRescaleQ(newStream.startTime, newStream.timeBase, newTimebase)\r\n        newStream.duration = avRescaleQ(newStream.duration, newStream.timeBase, newTimebase)\r\n        newStream.timeBase.den = newTimebase.den\r\n        newStream.timeBase.num = newTimebase.num\r\n      }\r\n\r\n      await this.DemuxerThread.connectStreamTask\r\n        .transfer(demuxer2DecoderChannel.port1)\r\n        .invoke(task.subTaskId || task.taskId, stream.index, demuxer2DecoderChannel.port1)\r\n\r\n      let decoderResource = await this.getResource('decoder', stream.codecpar.codecId, stream.codecpar.codecType)\r\n      if (!decoderResource) {\r\n        if (support.videoDecoder) {\r\n          const isSupport = await VideoDecoder.isConfigSupported({\r\n            codec: getVideoCodec(stream.codecpar)\r\n          })\r\n          if (!isSupport.supported) {\r\n            logger.fatal(`VideoDecoder codecId ${stream.codecpar.codecId} not support`)\r\n          }\r\n        }\r\n        else {\r\n          logger.fatal(`video decoder codecId ${stream.codecpar.codecId} not support`)\r\n        }\r\n      }\r\n\r\n      // 注册一个视频解码任务\r\n      await this.VideoDecoderThread.registerTask\r\n        .transfer(demuxer2DecoderChannel.port2, decoder2FilterChannel.port1)\r\n        .invoke({\r\n          taskId: taskId,\r\n          resource: decoderResource,\r\n          leftPort: demuxer2DecoderChannel.port2,\r\n          rightPort: decoder2FilterChannel.port1,\r\n          stats: addressof(task.stats),\r\n          enableHardware: !!videoConfig.enableHardware,\r\n          avpacketList: addressof(this.GlobalData.avpacketList),\r\n          avpacketListMutex: addressof(this.GlobalData.avpacketListMutex),\r\n          avframeList: addressof(this.GlobalData.avframeList),\r\n          avframeListMutex: addressof(this.GlobalData.avframeListMutex)\r\n        })\r\n\r\n      ret = await this.VideoDecoderThread.open(taskId, stream.codecpar)\r\n\r\n      if (ret < 0) {\r\n        logger.error(`cannot open video ${dumpCodecName(stream.codecpar.codecType, stream.codecpar.codecId)} decoder`)\r\n        return ret\r\n      }\r\n\r\n      let scalerResource = await this.getResource('scaler')\r\n      if (!scalerResource) {\r\n        logger.fatal('scaler not found')\r\n      }\r\n\r\n      const vertices: AVFilterGraphDesVertex<GraphNodeType>[] = []\r\n      const edges: { parent: number, child: number }[] = []\r\n      let input: FilterGraphPortDes\r\n      let output: FilterGraphPortDes\r\n\r\n      let rangeNodeId: number\r\n\r\n      const scaleNode = createGraphDesVertex('scaler', {\r\n        resource: scalerResource,\r\n        output: {\r\n          width: newStream.codecpar.width,\r\n          height: newStream.codecpar.height,\r\n          format: newStream.codecpar.format as AVPixelFormat\r\n        }\r\n      })\r\n\r\n      vertices.push(scaleNode)\r\n      input = {\r\n        id: scaleNode.id,\r\n        port: decoder2FilterChannel.port2\r\n      }\r\n      output = {\r\n        id: scaleNode.id,\r\n        port: filter2EncoderChannel.port1\r\n      }\r\n\r\n      if (task.options.start || task.options.duration) {\r\n        const start = avRescaleQ(static_cast<int64>(task.options.start || 0), AV_MILLI_TIME_BASE_Q, stream.timeBase)\r\n        const rangeNode = createGraphDesVertex('range', {\r\n          start: start,\r\n          end: task.options.duration\r\n            ? (avRescaleQ(static_cast<int64>(task.options.duration), AV_MILLI_TIME_BASE_Q, stream.timeBase) + start)\r\n            : -1n\r\n        })\r\n        vertices.push(rangeNode)\r\n        input = {\r\n          id: rangeNode.id,\r\n          port: decoder2FilterChannel.port2\r\n        }\r\n        edges.push({\r\n          parent: rangeNode.id,\r\n          child: scaleNode.id\r\n        })\r\n        rangeNodeId = rangeNode.id\r\n      }\r\n\r\n      if (avQ2D(stream.codecpar.framerate) > avQ2D(newStream.codecpar.framerate)) {\r\n        const framerateNode = createGraphDesVertex('framerate', {\r\n          framerate: {\r\n            num: newStream.codecpar.framerate.num,\r\n            den: newStream.codecpar.framerate.den\r\n          },\r\n          timeBase: {\r\n            num: stream.timeBase.num,\r\n            den: stream.timeBase.den\r\n          }\r\n        })\r\n        vertices.push(framerateNode)\r\n\r\n        edges.length = 0\r\n        if (rangeNodeId) {\r\n          edges.push({\r\n            parent: rangeNodeId,\r\n            child: framerateNode.id\r\n          })\r\n          edges.push({\r\n            parent: framerateNode.id,\r\n            child: scaleNode.id\r\n          })\r\n        }\r\n        else {\r\n          input = {\r\n            id: framerateNode.id,\r\n            port: decoder2FilterChannel.port2\r\n          }\r\n          edges.push({\r\n            parent: framerateNode.id,\r\n            child: scaleNode.id\r\n          })\r\n        }\r\n      }\r\n\r\n      await this.VideoFilterThread.registerTask\r\n        .transfer(decoder2FilterChannel.port2, filter2EncoderChannel.port1)\r\n        .invoke({\r\n          taskId: taskId,\r\n          graph: {\r\n            vertices,\r\n            edges\r\n          },\r\n          inputPorts: [input],\r\n          outputPorts: [output],\r\n          stats: addressof(task.stats),\r\n          avframeList: addressof(this.GlobalData.avframeList),\r\n          avframeListMutex: addressof(this.GlobalData.avframeListMutex),\r\n        })\r\n\r\n      let encoderResource = await this.getResource('encoder', newStream.codecpar.codecId, newStream.codecpar.codecType)\r\n      if (!encoderResource) {\r\n        if (support.videoEncoder) {\r\n          const isSupport = await VideoEncoder.isConfigSupported({\r\n            codec: getVideoCodec(newStream.codecpar),\r\n            width: newStream.codecpar.width,\r\n            height: newStream.codecpar.height\r\n          })\r\n          if (!isSupport.supported) {\r\n            logger.fatal(`VideoEncoder ${dumpCodecName(newStream.codecpar.codecType, newStream.codecpar.codecId)} codecId ${newStream.codecpar.codecId} not support`)\r\n          }\r\n        }\r\n        else {\r\n          logger.fatal(`${dumpCodecName(newStream.codecpar.codecType, newStream.codecpar.codecId)} encoder codecId ${newStream.codecpar.codecId} not support`)\r\n        }\r\n      }\r\n\r\n      const wasmEncoderOptions: Data = {}\r\n      const resourceExtraData: Data = {}\r\n\r\n      // x265 需要提前创建线程\r\n      if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_HEVC) {\r\n        resourceExtraData.enableThreadPool = true\r\n        resourceExtraData.enableThreadCountRate = 2\r\n      }\r\n      // libvpx 需要提前创建线程\r\n      else if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_VP9) {\r\n        resourceExtraData.enableThreadPool = true\r\n      }\r\n      else if (newStream.codecpar.codecId === AVCodecID.AV_CODEC_ID_AV1) {\r\n        wasmEncoderOptions['cpu-used'] = '5'\r\n      }\r\n\r\n      // 注册一个视频编码任务\r\n      await this.VideoEncoderThread.registerTask\r\n        .transfer(filter2EncoderChannel.port2, encoder2MuxerChannel.port1)\r\n        .invoke({\r\n          taskId: taskId,\r\n          resource: encoderResource,\r\n          resourceExtraData,\r\n          leftPort: filter2EncoderChannel.port2,\r\n          rightPort: encoder2MuxerChannel.port1,\r\n          stats: addressof(task.stats),\r\n          enableHardware: !!videoConfig.enableHardware,\r\n          avpacketList: addressof(this.GlobalData.avpacketList),\r\n          avpacketListMutex: addressof(this.GlobalData.avpacketListMutex),\r\n          avframeList: addressof(this.GlobalData.avframeList),\r\n          avframeListMutex: addressof(this.GlobalData.avframeListMutex),\r\n          gop: static_cast<int32>(avQ2D(newStream.codecpar.framerate) * (videoConfig?.keyFrameInterval ?? 5000) / 1000),\r\n          preferWebCodecs: array.has([AVCodecID.AV_CODEC_ID_AV1, AVCodecID.AV_CODEC_ID_VP9, AVCodecID.AV_CODEC_ID_VP8], newStream.codecpar.codecId)\r\n        })\r\n\r\n      ret = await this.VideoEncoderThread.open(taskId, newStream.codecpar, { num: newStream.timeBase.num, den: newStream.timeBase.den }, wasmEncoderOptions)\r\n\r\n      if (ret < 0) {\r\n        logger.error(`cannot open video ${dumpCodecName(newStream.codecpar.codecType, newStream.codecpar.codecId)} encoder`)\r\n        return ret\r\n      }\r\n\r\n      await this.MuxThread.addStream.transfer(encoder2MuxerChannel.port2)\r\n        .invoke(task.taskId, newStream, encoder2MuxerChannel.port2)\r\n\r\n      task.streams.push({\r\n        taskId,\r\n        input: stream,\r\n        output: newStream,\r\n        demuxer2DecoderChannel,\r\n        decoder2FilterChannel,\r\n        filter2EncoderChannel,\r\n        encoder2MuxerChannel\r\n      })\r\n\r\n      return 0\r\n    }\r\n  }\r\n\r\n  private async handleCopyStream(stream: AVStreamInterface, task: SelfTask): Promise<number> {\r\n    const demuxer2MuxerChannel = createMessageChannel()\r\n    await this.DemuxerThread.connectStreamTask\r\n      .transfer(demuxer2MuxerChannel.port1)\r\n      .invoke(task.subTaskId || task.taskId, stream.index, demuxer2MuxerChannel.port1)\r\n\r\n    await this.MuxThread.addStream\r\n      .transfer(demuxer2MuxerChannel.port2)\r\n      .invoke(task.taskId, stream, demuxer2MuxerChannel.port2)\r\n\r\n    task.streams.push({\r\n      input: stream,\r\n      demuxer2MuxerChannel\r\n    })\r\n\r\n    return 0\r\n  }\r\n\r\n  private async clearTask(task: SelfTask) {\r\n    this.MuxThread.unregisterTask(task.taskId)\r\n    for (let i = 0; i < task.streams.length; i++) {\r\n      if (task.streams[i].taskId) {\r\n        if (task.streams[i].input.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_AUDIO) {\r\n          await this.AudioEncoderThread.unregisterTask(task.streams[i].taskId)\r\n          await this.AudioFilterThread.unregisterTask(task.streams[i].taskId)\r\n          await this.AudioDecoderThread.unregisterTask(task.streams[i].taskId)\r\n        }\r\n        else if (task.streams[i].input.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_VIDEO) {\r\n          await this.VideoEncoderThread.unregisterTask(task.streams[i].taskId)\r\n          await this.VideoFilterThread.unregisterTask(task.streams[i].taskId)\r\n          await this.VideoDecoderThread.unregisterTask(task.streams[i].taskId)\r\n        }\r\n      }\r\n      if (task.streams[i].output) {\r\n        freeCodecParameters(task.streams[i].output.codecpar)\r\n      }\r\n    }\r\n\r\n    this.DemuxerThread.unregisterTask(task.taskId)\r\n    if (task.subTaskId) {\r\n      this.DemuxerThread.unregisterTask(task.subTaskId)\r\n    }\r\n    this.IOThread.unregisterTask(task.taskId)\r\n\r\n    if (task.inputIPCPort) {\r\n      task.inputIPCPort.destroy()\r\n    }\r\n    if (task.outputIPCPort) {\r\n      task.outputIPCPort.destroy()\r\n    }\r\n    if (task.safeFileIO) {\r\n      task.safeFileIO.destroy()\r\n    }\r\n    if (task.stats) {\r\n      unmake(task.stats)\r\n    }\r\n\r\n    this.tasks.delete(task.taskId)\r\n\r\n    if (!this.tasks.size) {\r\n      this.reportTimer.stop()\r\n    }\r\n  }\r\n\r\n  public async addTask(taskOptions: TaskOptions) {\r\n    if (taskOptions.output.audio?.disable && taskOptions.output.video?.disable) {\r\n      logger.fatal('audio and video are all disable')\r\n    }\r\n\r\n    const taskId = generateUUID()\r\n    const stats = make<Stats>()\r\n    const task: SelfTask = {\r\n      taskId,\r\n      startTime: 0,\r\n      options: taskOptions,\r\n      ioloader2DemuxerChannel: null,\r\n      muxer2OutputChannel: null,\r\n      stats,\r\n      format: AVFormat.UNKNOWN,\r\n      streams: [],\r\n      formatContext: null,\r\n      controller: new Controller(this)\r\n    }\r\n    try {\r\n\r\n      let ret = 0\r\n\r\n      await this.setTaskInput(task)\r\n      await this.setTaskOutput(task)\r\n\r\n      const formatContext = task.formatContext = await this.analyzeInputStreams(task)\r\n\r\n      for (let i = 0; i < formatContext.streams.length; i++) {\r\n        const mediaType = formatContext.streams[i].codecpar.codecType\r\n        if (mediaType === AVMediaType.AVMEDIA_TYPE_AUDIO) {\r\n          ret = await this.handleAudioStream(formatContext.streams[i], task)\r\n        }\r\n        else if (mediaType === AVMediaType.AVMEDIA_TYPE_VIDEO) {\r\n          ret = await this.handleVideoStream(formatContext.streams[i], task)\r\n        }\r\n        else {\r\n          ret = await this.handleCopyStream(formatContext.streams[i], task)\r\n        }\r\n\r\n        if (ret < 0) {\r\n          logger.fatal(`config transcode error, ret: ${ret}`)\r\n        }\r\n      }\r\n\r\n      const oformatContext: AVFormatContextInterface = {\r\n        streams: [],\r\n        format: task.format,\r\n        metadata: {},\r\n        chapters: []\r\n      }\r\n\r\n      let mappingDump = ''\r\n      task.streams.forEach((stream) => {\r\n        if (stream.output) {\r\n          oformatContext.streams.push(stream.output)\r\n          mappingDump += `  Stream #0:${stream.input.index} -> #0:${stream.output.index} (${\r\n            dumpCodecName(stream.input.codecpar.codecType, stream.input.codecpar.codecId)\r\n          } -> ${dumpCodecName(stream.output.codecpar.codecType, stream.output.codecpar.codecId)})\\n`\r\n        }\r\n        else {\r\n          oformatContext.streams.push(stream.input)\r\n          mappingDump += `  Stream #0:${stream.input.index} -> #0:${stream.input.index} (${\r\n            dumpCodecName(stream.input.codecpar.codecType, stream.input.codecpar.codecId)} -> copy)\\n`\r\n        }\r\n      })\r\n      logger.info(`\\nAVTranscoder version ${defined(VERSION)} Copyright (c) 2024-present the libmedia developers\\n`\r\n        + dump([formatContext], [{\r\n          from: is.string(task.options.input.file) ? task.options.input.file : (task.options.input.file instanceof File ? task.options.input.file.name : 'ioReader'),\r\n          tag: 'Input'\r\n        }])\r\n        + mappingDump\r\n        + '\\n'\r\n        + dump([oformatContext], [{\r\n          from: task.options.output.file instanceof FileSystemFileHandle ? task.options.output.file.name : 'IOWriter',\r\n          tag: 'Output'\r\n        }]))\r\n\r\n      this.tasks.set(taskId, task)\r\n      return taskId\r\n    }\r\n    catch (error) {\r\n      await this.clearTask(task)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  public async startTask(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      if (task.options.start) {\r\n        await this.DemuxerThread.seek(task.taskId, static_cast<int64>(task.options.start), AVSeekFlags.TIMESTAMP)\r\n      }\r\n      let ret = 0\r\n      await this.DemuxerThread.startDemux(taskId, false, 10)\r\n      ret = await this.MuxThread.open(taskId)\r\n\r\n      if (ret < 0) {\r\n        await this.clearTask(task)\r\n        logger.fatal(`start transcode error, ret ${ret}`)\r\n      }\r\n\r\n      const streams = task.streams\r\n\r\n      for (let i = 0; i < streams.length; i++) {\r\n        if (!streams[i].output) {\r\n          continue\r\n        }\r\n\r\n        let buffer: Uint8Array\r\n        let updated = false\r\n        if (streams[i].output.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_AUDIO) {\r\n          buffer = await this.AudioEncoderThread.getExtraData(streams[i].taskId)\r\n        }\r\n        else if (streams[i].output.codecpar.codecType === AVMediaType.AVMEDIA_TYPE_VIDEO) {\r\n          buffer = await this.VideoEncoderThread.getExtraData(streams[i].taskId)\r\n          const colorSpace = await this.VideoEncoderThread.getColorSpace(streams[i].taskId)\r\n          if (colorSpace) {\r\n            streams[i].output.codecpar.colorSpace = colorSpace.colorSpace\r\n            streams[i].output.codecpar.colorPrimaries = colorSpace.colorPrimaries\r\n            streams[i].output.codecpar.colorTrc = colorSpace.colorTrc\r\n            updated = true\r\n          }\r\n        }\r\n        if (!buffer) {\r\n          const codecId = streams[i].output.codecpar.codecId\r\n          if (codecId === AVCodecID.AV_CODEC_ID_AAC) {\r\n            buffer = aac.avCodecParameters2Extradata(accessof(streams[i].output.codecpar))\r\n          }\r\n          else if (codecId === AVCodecID.AV_CODEC_ID_OPUS) {\r\n            buffer = opus.avCodecParameters2Extradata(accessof(streams[i].output.codecpar))\r\n          }\r\n        }\r\n        if (buffer) {\r\n          const extradata = avMalloc(buffer.length)\r\n          memcpyFromUint8Array(extradata, buffer.length, buffer)\r\n          streams[i].output.codecpar.extradata = extradata\r\n          streams[i].output.codecpar.extradataSize = buffer.length\r\n          updated = true\r\n        }\r\n        if (updated) {\r\n          await this.MuxThread.updateAVCodecParameters(task.taskId, streams[i].output.index, streams[i].output.codecpar)\r\n        }\r\n      }\r\n\r\n      ret = await this.MuxThread.start(taskId)\r\n\r\n      if (ret < 0) {\r\n        await this.clearTask(task)\r\n        logger.fatal(`start transcode error, ret ${ret}`)\r\n      }\r\n\r\n      task.startTime = getTimestamp()\r\n      if (!this.reportTimer.isStarted()) {\r\n        this.reportTimer.start()\r\n      }\r\n    }\r\n    else {\r\n      logger.fatal(`task ${taskId} not found`)\r\n    }\r\n  }\r\n\r\n  public async pauseTask(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      await this.MuxThread.pause(taskId)\r\n    }\r\n    else {\r\n      logger.fatal(`task ${taskId} not found`)\r\n    }\r\n  }\r\n\r\n  public async unpauseTask(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      await this.MuxThread.unpause(taskId)\r\n    }\r\n    else {\r\n      logger.fatal(`task ${taskId} not found`)\r\n    }\r\n  }\r\n\r\n  public async cancelTask(taskId: string) {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      await this.MuxThread.unpause(taskId)\r\n      await this.clearTask(task)\r\n    }\r\n    else {\r\n      logger.fatal(`task ${taskId} not found`)\r\n    }\r\n  }\r\n\r\n  public async destroy() {\r\n    if (this.MuxThread) {\r\n      await this.MuxThread.clear()\r\n      closeThread(this.MuxThread)\r\n    }\r\n    if (this.AudioEncoderThread) {\r\n      await this.AudioEncoderThread.clear()\r\n      closeThread(this.AudioEncoderThread)\r\n    }\r\n    if (this.AudioFilterThread) {\r\n      await this.AudioFilterThread.clear()\r\n      closeThread(this.AudioFilterThread)\r\n    }\r\n    if (this.AudioDecoderThread) {\r\n      await this.AudioDecoderThread.clear()\r\n      closeThread(this.AudioDecoderThread)\r\n    }\r\n    if (this.VideoEncoderThread) {\r\n      await this.VideoEncoderThread.clear()\r\n      closeThread(this.VideoEncoderThread)\r\n    }\r\n    if (this.VideoFilterThread) {\r\n      await this.VideoFilterThread.clear()\r\n      closeThread(this.VideoFilterThread)\r\n    }\r\n    if (this.VideoDecoderThread) {\r\n      await this.VideoDecoderThread.clear()\r\n      closeThread(this.VideoDecoderThread)\r\n    }\r\n    if (this.DemuxerThread) {\r\n      await this.DemuxerThread.clear()\r\n      closeThread(this.DemuxerThread)\r\n    }\r\n    if (this.IOThread) {\r\n      await this.IOThread.clear()\r\n      closeThread(this.IOThread)\r\n    }\r\n\r\n    this.VideoEncoderThread = null\r\n    this.VideoFilterThread = null\r\n    this.VideoDecoderThread = null\r\n    this.AudioEncoderThread = null\r\n    this.AudioFilterThread = null\r\n    this.AudioDecoderThread = null\r\n    this.DemuxerThread = null\r\n    this.IOThread = null\r\n    this.MuxThread = null\r\n\r\n    if (this.GlobalData) {\r\n      this.GlobalData.avframeList.clear((avframe) => {\r\n        unrefAVFrame(avframe)\r\n      })\r\n      this.GlobalData.avpacketList.clear((avpacket) => {\r\n        unrefAVPacket(avpacket)\r\n      })\r\n\r\n      mutex.destroy(addressof(this.GlobalData.avpacketListMutex))\r\n      mutex.destroy(addressof(this.GlobalData.avframeListMutex))\r\n\r\n      unmake(this.GlobalData)\r\n      this.GlobalData = null\r\n    }\r\n\r\n    logger.info('AVTranscoder pipelines stopped')\r\n\r\n  }\r\n\r\n  public setLogLevel(level: number) {\r\n    this.level = level\r\n    logger.setLevel(level)\r\n\r\n    if (this.IOThread) {\r\n      this.IOThread.setLogLevel(level)\r\n    }\r\n    if (this.DemuxerThread) {\r\n      this.DemuxerThread.setLogLevel(level)\r\n    }\r\n    if (this.AudioDecoderThread) {\r\n      this.AudioDecoderThread.setLogLevel(level)\r\n    }\r\n    if (this.AudioFilterThread) {\r\n      this.AudioFilterThread.setLogLevel(level)\r\n    }\r\n    if (this.AudioEncoderThread) {\r\n      this.AudioEncoderThread.setLogLevel(level)\r\n    }\r\n    if (this.VideoDecoderThread) {\r\n      this.VideoDecoderThread.setLogLevel(level)\r\n    }\r\n    if (this.VideoFilterThread) {\r\n      this.VideoFilterThread.setLogLevel(level)\r\n    }\r\n    if (this.VideoEncoderThread) {\r\n      this.VideoEncoderThread.setLogLevel(level)\r\n    }\r\n    if (this.MuxThread) {\r\n      this.MuxThread.setLogLevel(level)\r\n    }\r\n\r\n    logger.info(`set log level: ${level}`)\r\n  }\r\n\r\n  public async onGetDecoderResource(mediaType: AVMediaType, codecId: AVCodecID): Promise<WebAssemblyResource | ArrayBuffer> {\r\n    return this.getResource('decoder', codecId, mediaType)\r\n  }\r\n}\r\n","/*\r\n * libmedia AVTranscoder Controller\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVCodecID, AVMediaType } from 'avutil/codec'\r\nimport IPCPort, { REQUEST, RpcMessage } from 'common/network/IPCPort'\r\nimport createMessageChannel from './function/createMessageChannel'\r\nimport { WebAssemblyResource } from 'cheap/webassembly/compiler'\r\n\r\nexport interface ControllerObserver {\r\n  onGetDecoderResource: (mediaType: AVMediaType, codecId: AVCodecID) => Promise<WebAssemblyResource | ArrayBuffer>\r\n}\r\n\r\nexport default class Controller {\r\n  private demuxerControlChannel: MessageChannel\r\n\r\n  private demuxerControlIPCPort: IPCPort\r\n\r\n  private observer: ControllerObserver\r\n\r\n  constructor(observer: ControllerObserver) {\r\n    this.observer = observer\r\n    this.demuxerControlChannel = createMessageChannel()\r\n\r\n    this.demuxerControlIPCPort = new IPCPort(this.demuxerControlChannel.port2)\r\n\r\n    this.demuxerControlIPCPort.on(REQUEST, async (request: RpcMessage) => {\r\n      switch (request.method) {\r\n        case 'getDecoderResource':\r\n          this.demuxerControlIPCPort.reply(\r\n            request,\r\n            await this.observer.onGetDecoderResource(request.params.mediaType, request.params.codecId)\r\n          )\r\n          break\r\n      }\r\n    })\r\n  }\r\n\r\n  public getDemuxerRenderControlPort() {\r\n    return this.demuxerControlChannel.port1\r\n  }\r\n\r\n  public destroy() {\r\n    if (this.demuxerControlIPCPort) {\r\n      this.demuxerControlIPCPort.destroy()\r\n    }\r\n    this.demuxerControlChannel = null\r\n  }\r\n}\r\n","export const TASK_ENDED = 'task-ended'\r\n\r\nexport const TASK_ERROR = 'task-error'\r\n","/*\r\n * libmedia AudioEncodePipeline\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport List from 'cheap/std/collection/List'\r\nimport { Mutex } from 'cheap/thread/mutex'\r\nimport { AVFrameRef } from 'avutil/struct/avframe'\r\nimport AVFramePoolImpl from 'avutil/implement/AVFramePoolImpl'\r\nimport * as error from 'avutil/error'\r\nimport Pipeline, { TaskOptions } from 'avpipeline/Pipeline'\r\nimport { FilterGraph, FilterGraphDes, FilterGraphPortDes, checkFilterGraphInvalid, createFilterGraph } from 'avfilter/graph'\r\nimport AVInputNode from 'avfilter/AVInputNode'\r\nimport AVOutputNode from 'avfilter/AVOutputNode'\r\n\r\n\r\nexport interface AVFilterTaskOptions extends TaskOptions {\r\n  avframeList: pointer<List<pointer<AVFrameRef>>>\r\n  avframeListMutex: pointer<Mutex>\r\n  graph: FilterGraphDes\r\n  inputPorts: FilterGraphPortDes[]\r\n  outputPorts: FilterGraphPortDes[]\r\n}\r\n\r\ntype SelfTask = AVFilterTaskOptions & {\r\n  avframePool: AVFramePoolImpl\r\n  filterGraph: FilterGraph\r\n  inputNodes: AVInputNode[]\r\n  outputNodes: AVOutputNode[]\r\n}\r\n\r\nexport default class AVFilterPipeline extends Pipeline {\r\n\r\n  declare tasks: Map<string, SelfTask>\r\n\r\n  constructor() {\r\n    super()\r\n  }\r\n\r\n  private async createTask(options: AVFilterTaskOptions): Promise<number> {\r\n\r\n    const avframePool = new AVFramePoolImpl(accessof(options.avframeList), options.avframeListMutex)\r\n\r\n    const filterGraph = createFilterGraph(options.graph, avframePool)\r\n    if (!checkFilterGraphInvalid(filterGraph, options.inputPorts, options.outputPorts)) {\r\n      return error.INVALID_OPERATE\r\n    }\r\n\r\n    const inputNodes: AVInputNode[] = []\r\n    const outputNodes: AVOutputNode[] = []\r\n    for (let i = 0; i < options.inputPorts.length; i++) {\r\n      const inputNode = new AVInputNode(options.inputPorts[i].port)\r\n      inputNodes.push(inputNode)\r\n      const next = filterGraph.inputs.find((vertex) => {\r\n        return vertex.id === options.inputPorts[i].id\r\n      })\r\n      inputNode.connect(next.filter)\r\n    }\r\n\r\n    for (let i = 0; i < options.outputPorts.length; i++) {\r\n      const outputNode = new AVOutputNode(options.outputPorts[i].port)\r\n      outputNodes.push(outputNode)\r\n      const prev = filterGraph.outputs.find((vertex) => {\r\n        return vertex.id === options.outputPorts[i].id\r\n      })\r\n      prev.filter.connect(outputNode)\r\n    }\r\n\r\n    for (let i = 0; i < filterGraph.vertices.length; i++) {\r\n      await filterGraph.vertices[i].filter.ready()\r\n    }\r\n\r\n    this.tasks.set(options.taskId, {\r\n      ...options,\r\n      filterGraph,\r\n      inputNodes,\r\n      outputNodes,\r\n      avframePool\r\n    })\r\n\r\n    return 0\r\n  }\r\n\r\n  public async registerTask(options: AVFilterTaskOptions): Promise<number> {\r\n    if (this.tasks.has(options.taskId)) {\r\n      return error.INVALID_OPERATE\r\n    }\r\n    return this.createTask(options)\r\n  }\r\n\r\n  public async unregisterTask(taskId: string): Promise<void> {\r\n    const task = this.tasks.get(taskId)\r\n    if (task) {\r\n      for (let i = 0; i < task.filterGraph.vertices.length; i++) {\r\n        task.filterGraph.vertices[i].filter.disconnect()\r\n        await task.filterGraph.vertices[i].filter.destroy()\r\n      }\r\n      this.tasks.delete(taskId)\r\n    }\r\n  }\r\n}\r\n","/*\r\n * libmedia create MessageChannel\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport * as cheapConfig from 'cheap/config'\r\nimport FakeMessageChannel from 'common/network/FakeMessageChannel'\r\n\r\nexport default function createMessageChannel() {\r\n  if (cheapConfig.USE_THREADS && defined(ENABLE_THREADS)) {\r\n    return new MessageChannel()\r\n  }\r\n  return new FakeMessageChannel() as any as MessageChannel\r\n}\r\n","/*\r\n * libmedia constant\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { Rational } from './struct/rational'\r\n\r\nexport const NOPTS_VALUE_BIGINT: int64 = -1n\r\n\r\nexport const NOPTS_VALUE: int32 = -1\r\n\r\nexport const AV_TIME_BASE: int32 = 1000000\r\n\r\nexport const AV_MILLI_TIME_BASE: int32 = 1000\r\n\r\n/**\r\n * 微秒时间基\r\n */\r\nexport const AV_TIME_BASE_Q = new Rational({den: AV_TIME_BASE, num: 1})\r\n\r\n/**\r\n * 毫秒时间基\r\n */\r\nexport const AV_MILLI_TIME_BASE_Q = new Rational({den: AV_MILLI_TIME_BASE, num: 1})\r\n\r\n/**\r\n * 秒时间基\r\n */\r\nexport const AV_TIME_BASE1_Q = new Rational({den: 1, num: 1})\r\n\r\nexport const INT8_MAX: int8 = 127\r\nexport const INT16_MAX: int16 = 32767\r\nexport const INT32_MAX: int32 = 2147483647\r\n\r\nexport const INT8_MIN: int8  = -128\r\nexport const INT16_MIN: int16 = -32768\r\nexport const INT32_MIN: int32 = -INT32_MAX - 1\r\n\r\nexport const UINT8_MAX: uint8 = 255\r\nexport const UINT16_MAX: uint16 = 65535\r\nexport const UINT32_MAX: uint32 = 4294967295\r\n","\r\n/*\r\n * libmedia error defined\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nexport const FORMAT_NOT_SUPPORT = -1\r\n\r\nexport const DATA_INVALID = -2\r\n\r\nexport const INVALID_ARGUMENT = -3\r\n\r\nexport const NO_MEMORY = -4\r\n\r\nexport const INVALID_OPERATE = -5\r\n\r\nexport const EAGAIN = -6\r\n\r\nexport const EOF = -7\r\n\r\nexport const CODEC_NOT_SUPPORT = -8\r\n\r\nexport const OPERATE_NOT_SUPPORT = -9\r\n","/*\r\n * libmedia analyzeAVFormat\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVFormat } from 'avformat/avformat'\r\nimport IOReader from 'common/io/IOReader'\r\n\r\nexport default async function analyzeAVFormat(ioReader: IOReader, defaultFormat: AVFormat = AVFormat.UNKNOWN) {\r\n  let signature = await ioReader.peekString(8)\r\n  if (/^FLV/.test(signature)) {\r\n    return AVFormat.FLV\r\n  }\r\n  else if (/^DKIF/.test(signature)) {\r\n    return AVFormat.IVF\r\n  }\r\n  else if (/^ftyp/.test(signature.slice(4, 8))) {\r\n    return AVFormat.MP4\r\n  }\r\n  else if (/^OggS/.test(signature)) {\r\n    return AVFormat.OGG\r\n  }\r\n  else if (/^ID3/.test(signature)) {\r\n    return AVFormat.MP3\r\n  }\r\n  else if (/^fLaC/.test(signature)) {\r\n    return AVFormat.FLAC\r\n  }\r\n  else if (/^RIFF/.test(signature)) {\r\n    const dataType = (await ioReader.peekString(12)).slice(8)\r\n    if (/^WAVE/.test(dataType)) {\r\n      return AVFormat.WAV\r\n    }\r\n  }\r\n  else if (/^ADIF/.test(signature)) {\r\n    return AVFormat.AAC\r\n  }\r\n  else if ((await ioReader.peekUint32()) === 0x1A45DFA3) {\r\n    return AVFormat.MATROSKA\r\n  }\r\n  else {\r\n    const buf = await ioReader.peekBuffer(2)\r\n    switch (buf[0]) {\r\n      case 0x56:\r\n        if ((buf[1] & 0xe0) === 0xe0) {\r\n          return AVFormat.AAC\r\n        }\r\n        break\r\n      case 0xff:\r\n        if ((buf[1] & 0xf6) === 0xf0) {\r\n          return AVFormat.AAC\r\n        }\r\n        else if ([0xf2, 0xf4, 0xf6, 0xfa, 0xfc].includes(buf[1] & 0xfe)) {\r\n          return AVFormat.MP3\r\n        }\r\n        break\r\n    }\r\n  }\r\n  return defaultFormat\r\n}\r\n","/* libmedia AudioData to AVFrame utils\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { createAVFrame, getAudioBuffer } from '../util/avframe'\r\nimport { AVSampleFormat } from '../audiosamplefmt'\r\nimport AVFrame from '../struct/avframe'\r\nimport { sampleFormatIsPlanar } from '../util/sample'\r\nimport { mapUint8Array } from 'cheap/std/memory'\r\n\r\nfunction mapFormat(format: AudioDataFormat) {\r\n  switch (format) {\r\n    case 'u8':\r\n      return AVSampleFormat.AV_SAMPLE_FMT_U8\r\n    case 's16':\r\n      return AVSampleFormat.AV_SAMPLE_FMT_S16\r\n    case 's32':\r\n      return AVSampleFormat.AV_SAMPLE_FMT_S32\r\n    case 'f32':\r\n      return AVSampleFormat.AV_SAMPLE_FMT_FLT\r\n    case 'u8-planar':\r\n      return AVSampleFormat.AV_SAMPLE_FMT_U8P\r\n    case 's16-planar':\r\n      return AVSampleFormat.AV_SAMPLE_FMT_S16P\r\n    case 's32-planar':\r\n      return AVSampleFormat.AV_SAMPLE_FMT_S32P\r\n    case 'f32-planar':\r\n      return AVSampleFormat.AV_SAMPLE_FMT_FLTP\r\n    default:\r\n      throw new Error('not support')\r\n  }\r\n}\r\n\r\nexport function audioData2AVFrame(audioData: AudioData, avframe: pointer<AVFrame> = nullptr) {\r\n  if (avframe === nullptr) {\r\n    avframe = createAVFrame()\r\n  }\r\n\r\n  avframe.sampleRate = audioData.sampleRate\r\n  avframe.nbSamples = audioData.numberOfFrames\r\n  avframe.chLayout.nbChannels = audioData.numberOfChannels\r\n  avframe.format = mapFormat(audioData.format)\r\n  avframe.pts = static_cast<int64>(audioData.timestamp)\r\n\r\n  getAudioBuffer(avframe)\r\n\r\n  const planar = sampleFormatIsPlanar(avframe.format)\r\n  const planes = planar ? avframe.chLayout.nbChannels : 1\r\n\r\n  for (let i = 0; i < planes; i++) {\r\n    audioData.copyTo(mapUint8Array(avframe.extendedData[i], avframe.linesize[0]), {\r\n      planeIndex: i\r\n    })\r\n  }\r\n\r\n  return avframe\r\n}\r\n","/*\r\n * libmedia AVFrame to AudioData utils\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { mapFloat32Array, mapInt16Array, mapInt32Array, mapUint8Array } from 'cheap/std/memory'\r\nimport AVFrame from '../struct/avframe'\r\nimport { AVSampleFormat } from '../audiosamplefmt'\r\nimport { getBytesPerSample, sampleFormatIsPlanar } from '../util/sample'\r\nimport { Rational } from '../struct/rational'\r\nimport { avRescaleQ } from '../util/rational'\r\nimport { AV_TIME_BASE_Q } from '../constant'\r\n\r\nfunction mapFormat(avframe: pointer<AVFrame>) {\r\n  switch (avframe.format) {\r\n    case AVSampleFormat.AV_SAMPLE_FMT_U8:\r\n      return 'u8'\r\n    case AVSampleFormat.AV_SAMPLE_FMT_S16:\r\n      return 's16'\r\n    case AVSampleFormat.AV_SAMPLE_FMT_S32:\r\n      return 's32'\r\n    case AVSampleFormat.AV_SAMPLE_FMT_FLT:\r\n      return 'f32'\r\n    case AVSampleFormat.AV_SAMPLE_FMT_U8P:\r\n      return 'u8-planar'\r\n    case AVSampleFormat.AV_SAMPLE_FMT_S16P:\r\n      return 's16-planar'\r\n    case AVSampleFormat.AV_SAMPLE_FMT_S32P:\r\n      return 's32-planar'\r\n    case AVSampleFormat.AV_SAMPLE_FMT_FLTP:\r\n      return 'f32-planar'\r\n    default:\r\n      throw new Error('not support')\r\n  }\r\n}\r\n\r\nfunction mapBuffer(format: AVSampleFormat, data: Uint8Array) {\r\n  switch (format) {\r\n    case AVSampleFormat.AV_SAMPLE_FMT_U8:\r\n    case AVSampleFormat.AV_SAMPLE_FMT_U8P:\r\n      return data\r\n    case AVSampleFormat.AV_SAMPLE_FMT_S16:\r\n    case AVSampleFormat.AV_SAMPLE_FMT_S16P:\r\n      return new Int16Array(data.buffer)\r\n    case AVSampleFormat.AV_SAMPLE_FMT_S32:\r\n    case AVSampleFormat.AV_SAMPLE_FMT_S32P:\r\n      return new Int32Array(data.buffer)\r\n    case AVSampleFormat.AV_SAMPLE_FMT_FLT:\r\n    case AVSampleFormat.AV_SAMPLE_FMT_FLTP:\r\n      return new Float32Array(data.buffer)\r\n    default:\r\n      throw new Error('not support')\r\n  }\r\n}\r\n\r\nfunction mapTypeBuffer(format: AVSampleFormat, pointer: pointer<void>, size: int32) {\r\n  switch (format) {\r\n    case AVSampleFormat.AV_SAMPLE_FMT_U8:\r\n    case AVSampleFormat.AV_SAMPLE_FMT_U8P:\r\n      return mapUint8Array(pointer, size)\r\n    case AVSampleFormat.AV_SAMPLE_FMT_S16:\r\n    case AVSampleFormat.AV_SAMPLE_FMT_S16P:\r\n      return mapInt16Array(reinterpret_cast<pointer<int16>>(pointer), size >>> 1)\r\n    case AVSampleFormat.AV_SAMPLE_FMT_S32:\r\n    case AVSampleFormat.AV_SAMPLE_FMT_S32P:\r\n      return mapInt32Array(reinterpret_cast<pointer<int32>>(pointer), size >>> 2)\r\n    case AVSampleFormat.AV_SAMPLE_FMT_FLT:\r\n    case AVSampleFormat.AV_SAMPLE_FMT_FLTP:\r\n      return mapFloat32Array(reinterpret_cast<pointer<float>>(pointer), size >>> 2)\r\n    default:\r\n      throw new Error('not support')\r\n  }\r\n}\r\n\r\nexport function avframe2AudioData(avframe: pointer<AVFrame>, timeBase?: Rational) {\r\n\r\n  const planar = sampleFormatIsPlanar(avframe.format)\r\n  const planes = planar ? avframe.chLayout.nbChannels : 1\r\n\r\n  let data: ArrayBufferView\r\n\r\n  const sampleSize = getBytesPerSample(avframe.format)\r\n\r\n  if (planar) {\r\n    const linesize = avframe.nbSamples *  sampleSize\r\n    const buffer = new Uint8Array(planes * linesize)\r\n    let offset = 0\r\n    for (let i = 0; i < planes; i++) {\r\n      buffer.set(mapUint8Array(avframe.data[i], linesize), offset)\r\n      offset += linesize\r\n    }\r\n    data = mapBuffer(avframe.format, buffer)\r\n  }\r\n  else {\r\n    data = mapTypeBuffer(avframe.format, avframe.data[0], sampleSize * avframe.nbSamples * avframe.chLayout.nbChannels)\r\n  }\r\n\r\n  const audioData = new AudioData({\r\n    data,\r\n    format: mapFormat(avframe),\r\n    sampleRate: avframe.sampleRate,\r\n    numberOfFrames: avframe.nbSamples,\r\n    numberOfChannels: avframe.chLayout.nbChannels,\r\n    timestamp: static_cast<double>(timeBase ? avRescaleQ(avframe.pts, timeBase, AV_TIME_BASE_Q) : avframe.pts)\r\n  })\r\n  return audioData\r\n}\r\n","/*\r\n * libmedia AVFrame to VideoFrame utils\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVFrame from '../struct/avframe'\r\nimport { PixelFormatDescriptorsMap } from '../pixelFormatDescriptor'\r\nimport { AVColorPrimaries, AVColorRange, AVColorSpace, AVColorTransferCharacteristic, AVPixelFormat } from '../pixfmt'\r\nimport { Rational } from '../struct/rational'\r\nimport { avRescaleQ } from '../util/rational'\r\nimport { AV_TIME_BASE_Q } from '../constant'\r\nimport { getHeapU8 } from 'cheap/heap'\r\n\r\nexport function avPixelFormat2Format(pixfmt: AVPixelFormat) {\r\n  switch (pixfmt) {\r\n    case AVPixelFormat.AV_PIX_FMT_YUV420P:\r\n      return 'I420'\r\n    case AVPixelFormat.AV_PIX_FMT_YUVA420P:\r\n      return 'I420A'\r\n    case AVPixelFormat.AV_PIX_FMT_YUV422P:\r\n      return 'I422'\r\n    case AVPixelFormat.AV_PIX_FMT_YUV444P:\r\n      return 'I444'\r\n    case AVPixelFormat.AV_PIX_FMT_BGRA:\r\n      return 'BGRA'\r\n    case AVPixelFormat.AV_PIX_FMT_RGBA:\r\n      return 'RGBA'\r\n    case AVPixelFormat.AV_PIX_FMT_NV12:\r\n      return 'NV12'\r\n    default:\r\n      return null\r\n  }\r\n}\r\n\r\nexport function getVideoColorSpaceInit(avframe: pointer<AVFrame>) {\r\n  const init: VideoColorSpaceInit = {\r\n    fullRange: false,\r\n    matrix: null,\r\n    primaries: null,\r\n    transfer: null\r\n  }\r\n\r\n  switch (avframe.colorSpace) {\r\n    case AVColorSpace.AVCOL_SPC_BT709:\r\n      init.matrix = 'bt709'\r\n      break\r\n    case AVColorSpace.AVCOL_SPC_SMPTE170M:\r\n      init.matrix = 'smpte170m'\r\n      break\r\n    case AVColorSpace.AVCOL_SPC_BT470BG:\r\n      init.matrix = 'bt470bg'\r\n      break\r\n    case AVColorSpace.AVCOL_SPC_RGB:\r\n      init.matrix = 'rgb'\r\n      break\r\n    default:\r\n      init.matrix = 'bt709'\r\n      break\r\n  }\r\n\r\n  switch (avframe.colorPrimaries) {\r\n    case AVColorPrimaries.AVCOL_PRI_BT709:\r\n      init.primaries = 'bt709'\r\n      break\r\n    case AVColorPrimaries.AVCOL_PRI_BT470BG:\r\n      init.primaries = 'bt470bg'\r\n      break\r\n    case AVColorPrimaries.AVCOL_PRI_SMPTE170M:\r\n      init.primaries = 'smpte170m'\r\n      break\r\n    default:\r\n      init.primaries = 'bt709'\r\n      break\r\n  }\r\n\r\n  switch (avframe.colorTrc) {\r\n    case AVColorTransferCharacteristic.AVCOL_TRC_BT709:\r\n      init.transfer = 'bt709'\r\n      break\r\n    case AVColorTransferCharacteristic.AVCOL_TRC_IEC61966_2_1:\r\n      init.transfer = 'iec61966-2-1'\r\n      break\r\n    case AVColorTransferCharacteristic.AVCOL_TRC_SMPTE170M:\r\n      init.transfer = 'smpte170m'\r\n      break\r\n    default:\r\n      init.transfer = 'bt709'\r\n      break\r\n  }\r\n\r\n  if (avframe.colorRange === AVColorRange.AVCOL_RANGE_JPEG) {\r\n    init.fullRange = true\r\n  }\r\n\r\n  return init\r\n}\r\n\r\nexport function avframe2VideoFrame(avframe: pointer<AVFrame>, timeBase?: Rational) {\r\n\r\n  let height = avframe.height\r\n\r\n  const des = PixelFormatDescriptorsMap[avframe.format as AVPixelFormat]\r\n\r\n  const layout: PlaneLayout[] = []\r\n\r\n  for (let i = 0; i < des.nbComponents; i++) {\r\n    layout.push({\r\n      offset: avframe.data[i],\r\n      stride: avframe.linesize[i]\r\n    })\r\n  }\r\n\r\n  const init: VideoFrameBufferInit = {\r\n    codedWidth: avframe.width,\r\n    codedHeight: height,\r\n    timestamp: static_cast<double>(timeBase ? avRescaleQ(avframe.pts, timeBase, AV_TIME_BASE_Q) : avframe.pts),\r\n    format: avPixelFormat2Format(avframe.format),\r\n    duration: static_cast<double>(timeBase ? avRescaleQ(avframe.duration, timeBase, AV_TIME_BASE_Q) : avframe.duration),\r\n    layout,\r\n    colorSpace: getVideoColorSpaceInit(avframe),\r\n    visibleRect: {\r\n      x: avframe.cropLeft,\r\n      y: avframe.cropTop,\r\n      width: avframe.width - (avframe.cropLeft + avframe.cropRight),\r\n      height: avframe.height - (avframe.cropTop + avframe.cropBottom)\r\n    }\r\n  }\r\n\r\n  return new VideoFrame(getHeapU8(), init)\r\n}\r\n","/* libmedia AVPacket to EncodedAudioChunk utils\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVPacket, { AVPacketFlags } from '../struct/avpacket'\r\nimport { mapUint8Array } from 'cheap/std/memory'\r\n\r\nexport default function avpacket2EncodedAudioChunk(avpacket: pointer<AVPacket>, pts?: int64) {\r\n  const timestamp = static_cast<double>(pts ?? avpacket.pts)\r\n  const key = avpacket.flags & AVPacketFlags.AV_PKT_FLAG_KEY\r\n  return new EncodedAudioChunk({\r\n    type: key ? 'key' : 'delta',\r\n    timestamp,\r\n    data: mapUint8Array(avpacket.data, avpacket.size)\r\n  })\r\n}\r\n","/* libmedia AVPacket to EncodedVideoChunk utils\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVPacket, { AVPacketFlags } from '../struct/avpacket'\r\nimport { mapUint8Array } from 'cheap/std/memory'\r\n\r\nexport default function avpacket2EncodedVideoChunk(avpacket: pointer<AVPacket>, pts?: int64) {\r\n  const timestamp = static_cast<double>(pts ?? avpacket.pts)\r\n  const key = avpacket.flags & AVPacketFlags.AV_PKT_FLAG_KEY\r\n  return new EncodedVideoChunk({\r\n    type: key ? 'key' : 'delta',\r\n    timestamp,\r\n    data: mapUint8Array(avpacket.data, avpacket.size)\r\n  })\r\n}\r\n","import * as cheapConfig from 'cheap/config'\r\nimport compile, { WebAssemblyResource } from 'cheap/webassembly/compiler'\r\nimport * as is from 'common/util/is'\r\nimport browser from 'common/util/browser'\r\n\r\nexport default async function compileResource(wasmUrl: string | ArrayBuffer | WebAssemblyResource, thread: boolean = false) {\r\n  let resource: WebAssemblyResource\r\n\r\n  if (is.string(wasmUrl) || is.arrayBuffer(wasmUrl)) {\r\n    resource = await compile({\r\n      source: wasmUrl\r\n    })\r\n    if (cheapConfig.USE_THREADS && defined(ENABLE_THREADS) && thread) {\r\n      resource.threadModule = await compile(\r\n        {\r\n          // firefox 使用 arraybuffer 会卡主\r\n          source: browser.firefox ? wasmUrl : resource.buffer\r\n        },\r\n        {\r\n          child: true\r\n        }\r\n      )\r\n    }\r\n    delete resource.buffer\r\n  }\r\n  else {\r\n    resource = wasmUrl\r\n  }\r\n\r\n  return resource\r\n}\r\n","/* libmedia EncodedAudioChunk to AVPacket utils\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { addAVPacketData, addAVPacketSideData, createAVPacket } from '../util/avpacket'\r\nimport AVPacket, { AVPacketFlags } from '../struct/avpacket'\r\nimport { avMalloc } from '../util/mem'\r\nimport { mapUint8Array, memcpyFromUint8Array } from 'cheap/std/memory'\r\nimport { AV_TIME_BASE } from '../constant'\r\nimport { AVPacketSideDataType } from '../codec'\r\n\r\nexport default function encodedAudioChunk2AVPacket(chunk: EncodedAudioChunk, avpacket: pointer<AVPacket> = nullptr, metadata?: EncodedAudioChunkMetadata) {\r\n  if (avpacket === nullptr) {\r\n    avpacket = createAVPacket()\r\n  }\r\n\r\n  avpacket.pts = avpacket.dts = static_cast<int64>(chunk.timestamp)\r\n  avpacket.duration = static_cast<int64>(chunk.duration)\r\n  avpacket.timeBase.den = AV_TIME_BASE\r\n  avpacket.timeBase.num = 1\r\n  avpacket.flags |= AVPacketFlags.AV_PKT_FLAG_KEY\r\n  const data = avMalloc(chunk.byteLength)\r\n  chunk.copyTo(mapUint8Array(data, chunk.byteLength))\r\n  addAVPacketData(avpacket, data, chunk.byteLength)\r\n\r\n  if (metadata) {\r\n    if (metadata.decoderConfig?.description) {\r\n      let buffer: Uint8Array\r\n      if (metadata.decoderConfig.description instanceof ArrayBuffer) {\r\n        buffer = new Uint8Array(metadata.decoderConfig.description)\r\n      }\r\n      else {\r\n        buffer = new Uint8Array(metadata.decoderConfig.description.buffer)\r\n      }\r\n      const extradata = avMalloc(buffer.length)\r\n      memcpyFromUint8Array(extradata, buffer.length, buffer)\r\n      addAVPacketSideData(avpacket, AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA, extradata, buffer.length)\r\n    }\r\n  }\r\n}\r\n","/* libmedia EncodedVideoChunk to AVPacket utils\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { addAVPacketData, addAVPacketSideData, createAVPacket } from '../util/avpacket'\r\nimport AVPacket, { AVPacketFlags } from '../struct/avpacket'\r\nimport { avMalloc } from '../util/mem'\r\nimport { mapUint8Array, memcpyFromUint8Array } from 'cheap/std/memory'\r\nimport { AV_TIME_BASE } from '../constant'\r\nimport { AVPacketSideDataType } from '../codec'\r\n\r\nexport default function encodedVideoChunk2AVPacket(chunk: EncodedVideoChunk, avpacket: pointer<AVPacket> = nullptr, metadata?: EncodedVideoChunkMetadata & {\r\n  svc?: {\r\n    temporalLayerId: number\r\n  }\r\n  alphaSideData?: BufferSource\r\n}) {\r\n  if (avpacket === nullptr) {\r\n    avpacket = createAVPacket()\r\n  }\r\n\r\n  avpacket.pts = static_cast<int64>(chunk.timestamp)\r\n  avpacket.timeBase.den = AV_TIME_BASE\r\n  avpacket.timeBase.num = 1\r\n  avpacket.duration = static_cast<int64>(chunk.duration)\r\n  const data = avMalloc(chunk.byteLength)\r\n  chunk.copyTo(mapUint8Array(data, chunk.byteLength))\r\n\r\n  addAVPacketData(avpacket, data, chunk.byteLength)\r\n\r\n  if (metadata) {\r\n    if (metadata.decoderConfig?.description) {\r\n      let buffer: Uint8Array\r\n      if (metadata.decoderConfig.description instanceof ArrayBuffer) {\r\n        buffer = new Uint8Array(metadata.decoderConfig.description)\r\n      }\r\n      else {\r\n        buffer = new Uint8Array(metadata.decoderConfig.description.buffer)\r\n      }\r\n      const extradata = avMalloc(buffer.length)\r\n      memcpyFromUint8Array(extradata, buffer.length, buffer)\r\n      addAVPacketSideData(avpacket, AVPacketSideDataType.AV_PKT_DATA_NEW_EXTRADATA, extradata, buffer.length)\r\n    }\r\n    if (metadata.alphaSideData) {\r\n      const extradata = avMalloc(metadata.alphaSideData.byteLength)\r\n      let buffer: Uint8Array\r\n      if (metadata.alphaSideData instanceof ArrayBuffer) {\r\n        buffer = new Uint8Array(metadata.alphaSideData)\r\n      }\r\n      else {\r\n        buffer = new Uint8Array(metadata.alphaSideData.buffer)\r\n      }\r\n      memcpyFromUint8Array(extradata, buffer.length, buffer)\r\n      addAVPacketSideData(avpacket, AVPacketSideDataType.AV_PKT_DATA_MATROSKA_BLOCKADDITIONAL, extradata, buffer.length)\r\n    }\r\n  }\r\n\r\n  if (chunk.type === 'key') {\r\n    avpacket.flags |= AVPacketFlags.AV_PKT_FLAG_KEY\r\n  }\r\n}\r\n","/* libmedia VideoFrame to AVFrame utils\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { createAVFrame, getVideoBuffer } from '../util/avframe'\r\nimport AVFrame from '../struct/avframe'\r\nimport { AVColorPrimaries, AVColorRange, AVColorSpace, AVColorTransferCharacteristic, AVPixelFormat } from '../pixfmt'\r\nimport { PixelFormatDescriptorsMap } from '../pixelFormatDescriptor'\r\nimport { getHeapU8 } from 'cheap/heap'\r\n\r\nexport function mapFormat(format: VideoPixelFormat) {\r\n  switch (format) {\r\n    case 'BGRA':\r\n      return AVPixelFormat.AV_PIX_FMT_BGRA\r\n    case 'BGRX':\r\n      return AVPixelFormat.AV_PIX_FMT_BGR0\r\n    case 'I420':\r\n      return AVPixelFormat.AV_PIX_FMT_YUV420P\r\n    case 'I420A':\r\n      return AVPixelFormat.AV_PIX_FMT_YUVA420P\r\n    case 'I422':\r\n      return AVPixelFormat.AV_PIX_FMT_YUV422P\r\n    case 'I444':\r\n      return AVPixelFormat.AV_PIX_FMT_YUV444P\r\n    case 'NV12':\r\n      return AVPixelFormat.AV_PIX_FMT_NV12\r\n    case 'RGBA':\r\n      return AVPixelFormat.AV_PIX_FMT_RGBA\r\n    case 'RGBX':\r\n      return AVPixelFormat.AV_PIX_FMT_RGB0\r\n    default:\r\n      return AVPixelFormat.AV_PIX_FMT_NONE\r\n  }\r\n}\r\n\r\nexport function mapColorSpace(colorSpace: string) {\r\n  switch (colorSpace) {\r\n    case 'bt709' :\r\n      return AVColorSpace.AVCOL_SPC_BT709\r\n    case 'smpte170m':\r\n      return AVColorSpace.AVCOL_SPC_SMPTE170M\r\n    case 'bt470bg':\r\n      return AVColorSpace.AVCOL_SPC_BT470BG\r\n    case 'rgb':\r\n      return AVColorSpace.AVCOL_SPC_RGB\r\n    default:\r\n      return AVColorSpace.AVCOL_SPC_BT709\r\n  }\r\n}\r\n\r\nexport function mapColorPrimaries(colorPrimaries: string) {\r\n  switch (colorPrimaries) {\r\n    case 'bt709':\r\n      return AVColorPrimaries.AVCOL_PRI_BT709\r\n    case 'bt470bg':\r\n      return AVColorPrimaries.AVCOL_PRI_BT470BG\r\n    case 'smpte170m':\r\n      return AVColorPrimaries.AVCOL_PRI_SMPTE170M\r\n    default:\r\n      return AVColorPrimaries.AVCOL_PRI_BT709\r\n  }\r\n}\r\n\r\nexport function mapColorTrc(colorTrc: string) {\r\n  switch (colorTrc) {\r\n    case 'bt709':\r\n      return AVColorTransferCharacteristic.AVCOL_TRC_BT709\r\n    case 'iec61966-2-1':\r\n      return AVColorTransferCharacteristic.AVCOL_TRC_IEC61966_2_1\r\n    case 'smpte170m':\r\n      return AVColorTransferCharacteristic.AVCOL_TRC_SMPTE170M\r\n    default:\r\n      return AVColorTransferCharacteristic.AVCOL_TRC_BT709\r\n  }\r\n}\r\n\r\nexport function videoFrame2AVFrame(videoFrame: VideoFrame, avframe: pointer<AVFrame> = nullptr) {\r\n  if (avframe === nullptr) {\r\n    avframe = createAVFrame()\r\n  }\r\n\r\n  avframe.format = mapFormat(videoFrame.format)\r\n  avframe.pts = static_cast<int64>(videoFrame.timestamp)\r\n  avframe.width = videoFrame.codedWidth\r\n  avframe.height = videoFrame.codedHeight\r\n  avframe.duration = static_cast<int64>(videoFrame.duration)\r\n\r\n  avframe.colorSpace = mapColorSpace(videoFrame.colorSpace.matrix)\r\n  avframe.colorPrimaries = mapColorPrimaries(videoFrame.colorSpace.primaries)\r\n  avframe.colorTrc = mapColorTrc(videoFrame.colorSpace.transfer)\r\n  avframe.colorRange = videoFrame.colorSpace.fullRange ? AVColorRange.AVCOL_RANGE_JPEG : AVColorRange.AVCOL_RANGE_MPEG\r\n\r\n  if (videoFrame.visibleRect) {\r\n    avframe.cropLeft = videoFrame.visibleRect.left\r\n    avframe.cropRight = videoFrame.visibleRect.right\r\n    avframe.cropTop = videoFrame.visibleRect.top\r\n    avframe.cropBottom = videoFrame.visibleRect.bottom\r\n  }\r\n\r\n  getVideoBuffer(avframe)\r\n\r\n  const des = PixelFormatDescriptorsMap[avframe.format as AVPixelFormat]\r\n  const layout: PlaneLayout[] = []\r\n  for (let i = 0; i < des.nbComponents; i++) {\r\n    if (des.comp[i].plane >= i) {\r\n      layout.push({\r\n        offset: avframe.data[i],\r\n        stride: avframe.linesize[i]\r\n      })\r\n    }\r\n  }\r\n\r\n  videoFrame.copyTo(getHeapU8(), {\r\n    layout\r\n  })\r\n\r\n  return avframe\r\n}\r\n","/*\r\n * libmedia AVFrame pool implement\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVFramePool, AVFrameRef } from '../struct/avframe'\r\nimport List from 'cheap/std/collection/List'\r\nimport { Mutex } from 'cheap/thread/mutex'\r\nimport * as atomics from 'cheap/thread/atomics'\r\nimport * as mutex from 'cheap/thread/mutex'\r\nimport { avMallocz } from '../util/mem'\r\nimport { getAVFrameDefault, unrefAVFrame } from '../util/avframe'\r\n\r\nexport default class AVFramePoolImpl implements AVFramePool {\r\n\r\n  private list: List<pointer<AVFrameRef>>\r\n\r\n  private mutex: pointer<Mutex>\r\n\r\n  constructor(list: List<pointer<AVFrameRef>>, mutex?: pointer<Mutex>) {\r\n    this.list = list\r\n    this.mutex = mutex\r\n  }\r\n\r\n  public alloc(): pointer<AVFrameRef> {\r\n    let avframe = this.list.find((avframe) => {\r\n      return atomics.compareExchange(addressof(avframe.refCount), -1, 1) === -1\r\n    })\r\n    if (!avframe) {\r\n      avframe = avMallocz(sizeof(AVFrameRef))\r\n\r\n      getAVFrameDefault(avframe)\r\n\r\n      avframe.refCount = 1\r\n\r\n      if (defined(ENABLE_THREADS)) {\r\n        assert(this.mutex)\r\n        mutex.lock(this.mutex)\r\n      }\r\n\r\n      this.list.push(avframe)\r\n\r\n      if (defined(ENABLE_THREADS)) {\r\n        mutex.unlock(this.mutex)\r\n      }\r\n    }\r\n\r\n    return avframe\r\n  }\r\n  public release(avframe: pointer<AVFrameRef>): void {\r\n    if (atomics.load(addressof(avframe.refCount)) <= 0) {\r\n      return\r\n    }\r\n    if (atomics.sub(addressof(avframe.refCount), 1) === 1) {\r\n      unrefAVFrame(avframe)\r\n      atomics.store(addressof(avframe.refCount), -1)\r\n    }\r\n  }\r\n}\r\n","/*\r\n * libmedia AVPacket pool implement\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport List from 'cheap/std/collection/List'\r\nimport { Mutex } from 'cheap/thread/mutex'\r\nimport * as atomics from 'cheap/thread/atomics'\r\nimport * as mutex from 'cheap/thread/mutex'\r\nimport { avMallocz } from '../util/mem'\r\nimport { AVPacketPool, AVPacketRef } from '../struct/avpacket'\r\nimport { getAVPacketDefault, unrefAVPacket } from '../util/avpacket'\r\n\r\nexport default class AVPacketPoolImpl implements AVPacketPool {\r\n\r\n  private list: List<pointer<AVPacketRef>>\r\n\r\n  private mutex: pointer<Mutex>\r\n\r\n  constructor(list: List<pointer<AVPacketRef>>, mutex?: pointer<Mutex>) {\r\n    this.list = list\r\n    this.mutex = mutex\r\n  }\r\n\r\n  public alloc(): pointer<AVPacketRef> {\r\n    let avpacket = this.list.find((avpacket) => {\r\n      return atomics.compareExchange(addressof(avpacket.refCount), -1, 1) === -1\r\n    })\r\n    if (!avpacket) {\r\n      avpacket = avMallocz(sizeof(AVPacketRef))\r\n      getAVPacketDefault(avpacket)\r\n\r\n      avpacket.refCount = 1\r\n\r\n      if (defined(ENABLE_THREADS)) {\r\n        assert(this.mutex)\r\n        mutex.lock(this.mutex)\r\n      }\r\n\r\n      this.list.push(avpacket)\r\n\r\n      if (defined(ENABLE_THREADS)) {\r\n        mutex.unlock(this.mutex)\r\n      }\r\n    }\r\n\r\n    return avpacket\r\n  }\r\n  public release(avpacket: pointer<AVPacketRef>): void {\r\n    if (atomics.load(addressof(avpacket.refCount)) <= 0) {\r\n      return\r\n    }\r\n    if (atomics.sub(addressof(avpacket.refCount), 1) === 1) {\r\n      unrefAVPacket(avpacket)\r\n      atomics.store(addressof(avpacket.refCount), -1)\r\n    }\r\n  }\r\n}\r\n","/*\r\n * libmedia pixel format descriptor\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVPixelFormat } from './pixfmt'\r\n\r\nexport const enum PixelFormatFlags {\r\n  /**\r\n   * Pixel format is big-endian.\r\n   */\r\n  BIG_ENDIAN = 1 << 0,\r\n  /**\r\n   * Pixel format has a palette in data[1], values are indexes in this palette.\r\n   */\r\n  PALETTE = 1 << 1,\r\n  /**\r\n   * All values of a component are bit-wise packed end to end.\r\n   */\r\n  BIT_STREAM = 1 << 2,\r\n  /**\r\n   * At least one pixel component is not in the first data plane.\r\n   */\r\n  PLANER = 1 << 4,\r\n  /**\r\n   * The pixel format contains RGB-like data (as opposed to YUV/grayscale).\r\n   */\r\n  RGB = 1 << 5,\r\n  /**\r\n   * The pixel format has an alpha channel. This is set on all formats that\r\n   * support alpha in some way, including AV_PIX_FMT_PAL8. The alpha is always\r\n   * straight, never pre-multiplied.\r\n   *\r\n   * If a codec or a filter does not support alpha, it should set all alpha to\r\n   * opaque, or use the equivalent pixel formats without alpha component, e.g.\r\n   * AV_PIX_FMT_RGB0 (or AV_PIX_FMT_RGB24 etc.) instead of AV_PIX_FMT_RGBA.\r\n   */\r\n  ALPHA = 1 << 7,\r\n  /**\r\n   * The pixel format is following a Bayer pattern\r\n   */\r\n  BAYER = 1 << 8,\r\n  /**\r\n   * The pixel format contains IEEE-754 floating point values. Precision (double,\r\n   * single, or half) should be determined by the pixel size (64, 32, or 16 bits).\r\n   */\r\n  FLOAT = 1 << 9\r\n}\r\n\r\nexport type PixelFormatDescriptor = {\r\n  nbComponents: number\r\n  /**\r\n   * Amount to shift the luma width right to find the chroma width.\r\n   * For YV12 this is 1 for example.\r\n   * chroma_width = AV_CEIL_RSHIFT(luma_width, log2_chroma_w)\r\n   * The note above is needed to ensure rounding up.\r\n   * This value only refers to the chroma components.\r\n   */\r\n  log2ChromaW: number\r\n\r\n  /**\r\n   * Amount to shift the luma height right to find the chroma height.\r\n   * For YV12 this is 1 for example.\r\n   * chroma_height= AV_CEIL_RSHIFT(luma_height, log2_chroma_h)\r\n   * The note above is needed to ensure rounding up.\r\n   * This value only refers to the chroma components.\r\n   */\r\n  log2ChromaH: number\r\n\r\n  /**\r\n   * Combination of AV_PIX_FMT_FLAG_... flags.\r\n   */\r\n  flags: number\r\n\r\n  /**\r\n   * Parameters that describe how pixels are packed.\r\n   * If the format has 1 or 2 components, then luma is 0.\r\n   * If the format has 3 or 4 components:\r\n   *   if the RGB flag is set then 0 is red, 1 is green and 2 is blue;\r\n   *   otherwise 0 is luma, 1 is chroma-U and 2 is chroma-V.\r\n   *\r\n   * If present, the Alpha channel is always the last component.\r\n   */\r\n  comp: {\r\n    /**\r\n     * Which of the 4 planes contains the component.\r\n     */\r\n    plane: number\r\n    /**\r\n     * Number of elements between 2 horizontally consecutive pixels.\r\n     * Elements are bits for bitstream formats, bytes otherwise.\r\n     */\r\n    step: number\r\n\r\n    /**\r\n     * Number of elements before the component of the first pixel.\r\n     * Elements are bits for bitstream formats, bytes otherwise.\r\n     */\r\n    offset: number\r\n\r\n    /**\r\n     * Number of least significant bits that must be shifted away\r\n     * to get the value.\r\n     */\r\n    shift: number\r\n\r\n    /**\r\n     * Number of bits in the component.\r\n     */\r\n    depth: number\r\n  }[]\r\n}\r\n\r\nexport const PixelFormatDescriptorsMap: Partial<Record<AVPixelFormat, PixelFormatDescriptor>> = {\r\n  /**\r\n   * 1 字节\r\n   */\r\n  [AVPixelFormat.AV_PIX_FMT_YUV420P]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 1,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUVJ420P]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 1,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV422P]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUVJ422P]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV444P]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 0,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUVJ444P]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 0,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      }\r\n    ]\r\n  },\r\n\r\n  [AVPixelFormat.AV_PIX_FMT_NV12]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 1,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 2,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 2,\r\n        offset: 1,\r\n        shift: 0,\r\n        depth: 8\r\n      }\r\n    ]\r\n  },\r\n\r\n  /**\r\n   * 2 字节 yuv420\r\n   */\r\n  [AVPixelFormat.AV_PIX_FMT_YUV420P9BE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 1,\r\n    flags: PixelFormatFlags.BIG_ENDIAN | PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 9\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 9\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 9\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV420P9LE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 1,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 9\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 9\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 9\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV420P10BE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 1,\r\n    flags: PixelFormatFlags.BIG_ENDIAN | PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 10\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 10\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 10\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV420P10LE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 1,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 10\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 10\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 10\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV420P12BE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 1,\r\n    flags: PixelFormatFlags.BIG_ENDIAN | PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 12\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 12\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 12\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV420P12LE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 1,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 12\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 12\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 12\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV420P14BE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 1,\r\n    flags: PixelFormatFlags.BIG_ENDIAN | PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 14\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 14\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 14\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV420P14LE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 1,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 14\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 14\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 14\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV420P16BE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 1,\r\n    flags: PixelFormatFlags.BIG_ENDIAN | PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 16\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 16\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 16\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV420P16LE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 1,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 16\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 16\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 16\r\n      }\r\n    ]\r\n  },\r\n\r\n  /**\r\n   * 2 字节 yuv422\r\n   */\r\n  [AVPixelFormat.AV_PIX_FMT_YUV422P9BE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.BIG_ENDIAN | PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 9\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 9\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 9\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV422P9LE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 9\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 9\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 9\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV422P10BE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.BIG_ENDIAN | PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 10\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 10\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 10\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV422P10LE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 10\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 10\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 10\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV422P12BE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.BIG_ENDIAN | PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 12\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 12\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 12\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV422P12LE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 12\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 12\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 12\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV422P14BE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.BIG_ENDIAN | PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 14\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 14\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 14\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV422P14LE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 14\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 14\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 14\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV422P16BE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.BIG_ENDIAN | PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 16\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 16\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 16\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV422P16LE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 16\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 16\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 16\r\n      }\r\n    ]\r\n  },\r\n\r\n  /**\r\n   * 2 字节 yuv444\r\n   */\r\n  [AVPixelFormat.AV_PIX_FMT_YUV444P9BE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 0,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.BIG_ENDIAN | PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 9\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 9\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 9\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV444P9LE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 0,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 9\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 9\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 9\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV444P10BE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 0,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.BIG_ENDIAN | PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 10\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 10\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 10\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV444P10LE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 0,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 10\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 10\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 10\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV444P12BE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 0,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.BIG_ENDIAN | PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 12\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 12\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 12\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV444P12LE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 0,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 12\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 12\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 12\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV444P14BE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 0,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.BIG_ENDIAN | PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 14\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 14\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 14\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV444P14LE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 0,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 14\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 14\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 14\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV444P16BE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 0,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.BIG_ENDIAN | PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 16\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 16\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 16\r\n      }\r\n    ]\r\n  },\r\n  [AVPixelFormat.AV_PIX_FMT_YUV444P16LE]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 0,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.PLANER,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 16\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 16\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 16\r\n      }\r\n    ]\r\n  },\r\n\r\n  [AVPixelFormat.AV_PIX_FMT_RGBA]: {\r\n    nbComponents: 4,\r\n    log2ChromaW: 0,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.RGB | PixelFormatFlags.ALPHA,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 4,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 0,\r\n        step: 4,\r\n        offset: 1,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 0,\r\n        step: 4,\r\n        offset: 2,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 0,\r\n        step: 4,\r\n        offset: 3,\r\n        shift: 0,\r\n        depth: 8\r\n      }\r\n    ]\r\n  },\r\n\r\n  [AVPixelFormat.AV_PIX_FMT_RGB0]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 0,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.RGB,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 4,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 0,\r\n        step: 4,\r\n        offset: 1,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 0,\r\n        step: 4,\r\n        offset: 2,\r\n        shift: 0,\r\n        depth: 8\r\n      }\r\n    ]\r\n  },\r\n\r\n  [AVPixelFormat.AV_PIX_FMT_BGRA]: {\r\n    nbComponents: 4,\r\n    log2ChromaW: 0,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.RGB | PixelFormatFlags.ALPHA,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 4,\r\n        offset: 2,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 0,\r\n        step: 4,\r\n        offset: 1,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 0,\r\n        step: 4,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 0,\r\n        step: 4,\r\n        offset: 3,\r\n        shift: 0,\r\n        depth: 8\r\n      }\r\n    ]\r\n  },\r\n\r\n  [AVPixelFormat.AV_PIX_FMT_BGR0]: {\r\n    nbComponents: 3,\r\n    log2ChromaW: 0,\r\n    log2ChromaH: 0,\r\n    flags: PixelFormatFlags.RGB,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 4,\r\n        offset: 2,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 0,\r\n        step: 4,\r\n        offset: 1,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 0,\r\n        step: 4,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      }\r\n    ]\r\n  },\r\n\r\n  [AVPixelFormat.AV_PIX_FMT_YUVA420P]: {\r\n    nbComponents: 4,\r\n    log2ChromaW: 1,\r\n    log2ChromaH: 1,\r\n    flags: PixelFormatFlags.PLANER | PixelFormatFlags.ALPHA,\r\n    comp: [\r\n      {\r\n        plane: 0,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 1,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 2,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      },\r\n      {\r\n        plane: 3,\r\n        step: 1,\r\n        offset: 0,\r\n        shift: 0,\r\n        depth: 8\r\n      }\r\n    ]\r\n  }\r\n}\r\n\r\n","import { AVSampleFormat } from './audiosamplefmt'\r\n\r\nexport interface AVSampleFormatDescriptor {\r\n  bits: number\r\n  planar: boolean\r\n}\r\n\r\nexport const AVSampleFormatDescriptors: Partial<Record<AVSampleFormat, AVSampleFormatDescriptor>> = {\r\n  [AVSampleFormat.AV_SAMPLE_FMT_U8]: {\r\n    bits: 8,\r\n    planar: false\r\n  },\r\n  [AVSampleFormat.AV_SAMPLE_FMT_S16]: {\r\n    bits: 16,\r\n    planar: false\r\n  },\r\n  [AVSampleFormat.AV_SAMPLE_FMT_S32]: {\r\n    bits: 32,\r\n    planar: false\r\n  },\r\n  [AVSampleFormat.AV_SAMPLE_FMT_S64]: {\r\n    bits: 64,\r\n    planar: false\r\n  },\r\n  [AVSampleFormat.AV_SAMPLE_FMT_FLT]: {\r\n    bits: 32,\r\n    planar: false\r\n  },\r\n  [AVSampleFormat.AV_SAMPLE_FMT_DBL]: {\r\n    bits: 64,\r\n    planar: false\r\n  },\r\n  [AVSampleFormat.AV_SAMPLE_FMT_U8P]: {\r\n    bits: 8,\r\n    planar: true\r\n  },\r\n  [AVSampleFormat.AV_SAMPLE_FMT_S16P]: {\r\n    bits: 16,\r\n    planar: true\r\n  },\r\n  [AVSampleFormat.AV_SAMPLE_FMT_S32P]: {\r\n    bits: 32,\r\n    planar: true\r\n  },\r\n  [AVSampleFormat.AV_SAMPLE_FMT_S64P]: {\r\n    bits: 64,\r\n    planar: true\r\n  },\r\n  [AVSampleFormat.AV_SAMPLE_FMT_FLTP]: {\r\n    bits: 32,\r\n    planar: true\r\n  },\r\n  [AVSampleFormat.AV_SAMPLE_FMT_DBLP]: {\r\n    bits: 64,\r\n    planar: true\r\n  },\r\n}\r\n","import { AVFormat } from 'avformat/avformat'\r\nimport { AVCodecID, AVMediaType } from './codec'\r\nimport { AVColorPrimaries, AVColorRange, AVColorSpace, AVColorTransferCharacteristic, AVPixelFormat } from './pixfmt'\r\nimport { AVSampleFormat } from './audiosamplefmt'\r\nimport { AVDisposition } from 'avformat/AVStream'\r\nimport { IOType } from 'avpipeline/IOPipeline'\r\n\r\nexport const CodecId2MimeType = {\r\n  [AVCodecID.AV_CODEC_ID_MP3]: 'mp3',\r\n  [AVCodecID.AV_CODEC_ID_AAC]: 'mp4a.40',\r\n  [AVCodecID.AV_CODEC_ID_VORBIS]: 'vorbis',\r\n  [AVCodecID.AV_CODEC_ID_FLAC]: 'flac',\r\n  [AVCodecID.AV_CODEC_ID_OPUS]: 'opus',\r\n  [AVCodecID.AV_CODEC_ID_PCM_MULAW]: 'ulaw',\r\n  [AVCodecID.AV_CODEC_ID_PCM_ALAW]: 'alaw',\r\n\r\n  [AVCodecID.AV_CODEC_ID_AV1]: 'av01',\r\n  [AVCodecID.AV_CODEC_ID_H264]: 'avc1',\r\n  [AVCodecID.AV_CODEC_ID_HEVC]: 'hev1',\r\n  [AVCodecID.AV_CODEC_ID_VVC]: 'vvc1',\r\n  [AVCodecID.AV_CODEC_ID_VP8]: 'vp8',\r\n  [AVCodecID.AV_CODEC_ID_VP9]: 'vp09',\r\n  [AVCodecID.AV_CODEC_ID_MPEG4]: 'mp4v'\r\n}\r\n\r\nexport const Ext2Format: Record<string, AVFormat> = {\r\n  'flv': AVFormat.FLV,\r\n  'mp4': AVFormat.MOV,\r\n  'mov': AVFormat.MOV,\r\n  'ts': AVFormat.MPEGTS,\r\n  'ivf': AVFormat.IVF,\r\n  'opus': AVFormat.OGG,\r\n  'oggs': AVFormat.OGG,\r\n  'ogg': AVFormat.OGG,\r\n  'm3u8': AVFormat.MPEGTS,\r\n  'm3u': AVFormat.MPEGTS,\r\n  'mpd': AVFormat.MOV,\r\n  'mp3': AVFormat.MP3,\r\n  'mkv': AVFormat.MATROSKA,\r\n  'mka': AVFormat.MATROSKA,\r\n  'webm': AVFormat.WEBM,\r\n  'aac': AVFormat.AAC,\r\n  'flac': AVFormat.FLAC,\r\n  'wav': AVFormat.WAV,\r\n  'srt': AVFormat.SUBRIP,\r\n  'vtt': AVFormat.WEBVTT,\r\n  'ssa': AVFormat.ASS,\r\n  'ass': AVFormat.ASS,\r\n  'xml': AVFormat.TTML,\r\n  'ttml': AVFormat.TTML,\r\n  'h264': AVFormat.H264,\r\n  '264': AVFormat.H264,\r\n  'avc': AVFormat.H264,\r\n  'h265': AVFormat.HEVC,\r\n  '265': AVFormat.HEVC,\r\n  'hevc': AVFormat.HEVC,\r\n  'h266': AVFormat.VVC,\r\n  '266': AVFormat.VVC,\r\n  'vvc': AVFormat.VVC,\r\n  'mpeg': AVFormat.MPEGPS,\r\n  'mpg': AVFormat.MPEGPS\r\n}\r\n\r\nexport const Ext2IOLoader: Record<string, IOType> = {\r\n  'm3u8': IOType.HLS,\r\n  'm3u': IOType.HLS,\r\n  'mpd': IOType.DASH\r\n}\r\n\r\nexport const VideoCodecString2CodecId = {\r\n  'copy': AVCodecID.AV_CODEC_ID_NONE,\r\n  'h264': AVCodecID.AV_CODEC_ID_H264,\r\n  'avc': AVCodecID.AV_CODEC_ID_H264,\r\n  'hevc': AVCodecID.AV_CODEC_ID_HEVC,\r\n  'h265': AVCodecID.AV_CODEC_ID_HEVC,\r\n  'vvc': AVCodecID.AV_CODEC_ID_VVC,\r\n  'h266': AVCodecID.AV_CODEC_ID_VVC,\r\n  'av1': AVCodecID.AV_CODEC_ID_AV1,\r\n  'vp9': AVCodecID.AV_CODEC_ID_VP9,\r\n  'vp8': AVCodecID.AV_CODEC_ID_VP8,\r\n  'mpeg4': AVCodecID.AV_CODEC_ID_MPEG4,\r\n  'theora': AVCodecID.AV_CODEC_ID_THEORA,\r\n  'mpeg2video': AVCodecID.AV_CODEC_ID_MPEG2VIDEO\r\n}\r\n\r\nexport const AudioCodecString2CodecId = {\r\n  'copy': AVCodecID.AV_CODEC_ID_NONE,\r\n  'aac': AVCodecID.AV_CODEC_ID_AAC,\r\n  'ac3': AVCodecID.AV_CODEC_ID_AC3,\r\n  'eac3': AVCodecID.AV_CODEC_ID_EAC3,\r\n  'dca': AVCodecID.AV_CODEC_ID_DTS,\r\n  'mp3': AVCodecID.AV_CODEC_ID_MP3,\r\n  'opus': AVCodecID.AV_CODEC_ID_OPUS,\r\n  'flac': AVCodecID.AV_CODEC_ID_FLAC,\r\n  'speex': AVCodecID.AV_CODEC_ID_SPEEX,\r\n  'vorbis': AVCodecID.AV_CODEC_ID_VORBIS,\r\n  'pcm_alaw': AVCodecID.AV_CODEC_ID_PCM_ALAW,\r\n  'pcm_mulaw': AVCodecID.AV_CODEC_ID_PCM_MULAW\r\n}\r\n\r\nexport const SubtitleCodecString2CodecId = {\r\n  'webvtt': AVCodecID.AV_CODEC_ID_WEBVTT,\r\n  'subrip': AVCodecID.AV_CODEC_ID_SUBRIP,\r\n  'ass': AVCodecID.AV_CODEC_ID_ASS,\r\n  'ttml': AVCodecID.AV_CODEC_ID_TTML,\r\n  'mov_text': AVCodecID.AV_CODEC_ID_MOV_TEXT,\r\n  'hdmv_pgs': AVCodecID.AV_CODEC_ID_HDMV_PGS_SUBTITLE,\r\n  'hdmv_text': AVCodecID.AV_CODEC_ID_HDMV_TEXT_SUBTITLE,\r\n  'dvd': AVCodecID.AV_CODEC_ID_DVD_SUBTITLE,\r\n  'dvb': AVCodecID.AV_CODEC_ID_DVB_SUBTITLE,\r\n  'eia_608': AVCodecID.AV_CODEC_ID_EIA_608\r\n}\r\n\r\nexport const PixfmtString2AVPixelFormat = {\r\n  'yuv420p': AVPixelFormat.AV_PIX_FMT_YUV420P,\r\n  'yuv422p': AVPixelFormat.AV_PIX_FMT_YUV422P,\r\n  'yuv444p': AVPixelFormat.AV_PIX_FMT_YUV444P,\r\n  'yuva420p': AVPixelFormat.AV_PIX_FMT_YUVA420P,\r\n  'yuva422p': AVPixelFormat.AV_PIX_FMT_YUVA422P,\r\n  'yuva444p': AVPixelFormat.AV_PIX_FMT_YUVA444P,\r\n\r\n  'yuv420p10le': AVPixelFormat.AV_PIX_FMT_YUV420P10LE,\r\n  'yuv422p10le': AVPixelFormat.AV_PIX_FMT_YUV422P10LE,\r\n  'yuv444p10le': AVPixelFormat.AV_PIX_FMT_YUV444P10LE,\r\n  'yuva420p10le': AVPixelFormat.AV_PIX_FMT_YUVA420P10LE,\r\n  'yuva422p10le': AVPixelFormat.AV_PIX_FMT_YUVA422P10LE,\r\n  'yuva444p10le': AVPixelFormat.AV_PIX_FMT_YUVA444P10LE,\r\n\r\n  'yuv420p10be': AVPixelFormat.AV_PIX_FMT_YUV420P10BE,\r\n  'yuv422p10be': AVPixelFormat.AV_PIX_FMT_YUV422P10BE,\r\n  'yuv444p10be': AVPixelFormat.AV_PIX_FMT_YUV444P10BE,\r\n  'yuva420p10be': AVPixelFormat.AV_PIX_FMT_YUVA420P10BE,\r\n  'yuva422p10be': AVPixelFormat.AV_PIX_FMT_YUVA422P10BE,\r\n  'yuva444p10be': AVPixelFormat.AV_PIX_FMT_YUVA444P10BE,\r\n}\r\n\r\nexport const SampleFmtString2SampleFormat = {\r\n  'u8': AVSampleFormat.AV_SAMPLE_FMT_U8,\r\n  'u8-planar': AVSampleFormat.AV_SAMPLE_FMT_U8P,\r\n  's16': AVSampleFormat.AV_SAMPLE_FMT_S16,\r\n  's16-planar': AVSampleFormat.AV_SAMPLE_FMT_S16P,\r\n  's32': AVSampleFormat.AV_SAMPLE_FMT_S32,\r\n  's32-planar': AVSampleFormat.AV_SAMPLE_FMT_S32P,\r\n  's64': AVSampleFormat.AV_SAMPLE_FMT_S64,\r\n  's64-planar': AVSampleFormat.AV_SAMPLE_FMT_S64P,\r\n  'float': AVSampleFormat.AV_SAMPLE_FMT_FLT,\r\n  'float-planar': AVSampleFormat.AV_SAMPLE_FMT_FLTP,\r\n  'double': AVSampleFormat.AV_SAMPLE_FMT_DBL,\r\n  'double-planar': AVSampleFormat.AV_SAMPLE_FMT_DBLP,\r\n}\r\n\r\nexport const Format2AVFormat: Record<string, AVFormat> = {\r\n  'flv': AVFormat.FLV,\r\n  'mp4': AVFormat.MOV,\r\n  'mov': AVFormat.MOV,\r\n  'ts': AVFormat.MPEGTS,\r\n  'mpegts': AVFormat.MPEGTS,\r\n  'mpeg': AVFormat.MPEGPS,\r\n  'ivf': AVFormat.IVF,\r\n  'ogg': AVFormat.OGG,\r\n  'opus': AVFormat.OGG,\r\n  'm3u8': AVFormat.MPEGTS,\r\n  'm3u': AVFormat.MPEGTS,\r\n  'mpd': AVFormat.MOV,\r\n  'mp3': AVFormat.MP3,\r\n  'mkv': AVFormat.MATROSKA,\r\n  'matroska': AVFormat.MATROSKA,\r\n  'mka': AVFormat.MATROSKA,\r\n  'webm': AVFormat.WEBM,\r\n  'aac': AVFormat.AAC,\r\n  'flac': AVFormat.FLAC,\r\n  'wav': AVFormat.WAV,\r\n  'raw_h264': AVFormat.H264,\r\n  'raw_h265': AVFormat.HEVC,\r\n  'raw_vvc': AVFormat.VVC\r\n}\r\n\r\nexport const colorRange2AVColorRange: Record<string, AVColorRange> = {\r\n  'tv': AVColorRange.AVCOL_RANGE_MPEG,\r\n  'pc': AVColorRange.AVCOL_RANGE_JPEG\r\n}\r\n\r\nexport const colorSpace2AVColorSpace: Record<string, AVColorSpace> = {\r\n  'bt709': AVColorSpace.AVCOL_SPC_BT709,\r\n  'fcc': AVColorSpace.AVCOL_SPC_FCC,\r\n  'bt470bg': AVColorSpace.AVCOL_SPC_BT470BG,\r\n  'smpte170m': AVColorSpace.AVCOL_SPC_SMPTE170M,\r\n  'smpte240m': AVColorSpace.AVCOL_SPC_SMPTE240M,\r\n  'ycgco': AVColorSpace.AVCOL_SPC_YCGCO,\r\n  'gbr': AVColorSpace.AVCOL_SPC_RGB,\r\n  'bt2020ncl': AVColorSpace.AVCOL_SPC_BT2020_NCL\r\n}\r\n\r\nexport const colorPrimaries2AVColorPrimaries: Record<string, AVColorPrimaries> = {\r\n  'bt709': AVColorPrimaries.AVCOL_PRI_BT709,\r\n  'bt470m': AVColorPrimaries.AVCOL_PRI_BT470M,\r\n  'bt470bg': AVColorPrimaries.AVCOL_PRI_BT470BG,\r\n  'smpte170m': AVColorPrimaries.AVCOL_PRI_SMPTE170M,\r\n  'smpte240m': AVColorPrimaries.AVCOL_PRI_SMPTE240M,\r\n  'smpte428': AVColorPrimaries.AVCOL_PRI_SMPTE428,\r\n  'film': AVColorPrimaries.AVCOL_PRI_FILM,\r\n  'smpte431': AVColorPrimaries.AVCOL_PRI_SMPTE431,\r\n  'smpte432': AVColorPrimaries.AVCOL_PRI_SMPTE432,\r\n  'bt2020': AVColorPrimaries.AVCOL_PRI_BT2020,\r\n  'jedec-p22': AVColorPrimaries.AVCOL_PRI_JEDEC_P22,\r\n  'ebu3213': AVColorPrimaries.AVCOL_PRI_EBU3213\r\n}\r\n\r\nexport const colorTrc2AVColorTransferCharacteristic: Record<string, AVColorTransferCharacteristic> = {\r\n  'bt709': AVColorTransferCharacteristic.AVCOL_TRC_BT709,\r\n  'gamma22': AVColorTransferCharacteristic.AVCOL_TRC_GAMMA22,\r\n  'gamma28': AVColorTransferCharacteristic.AVCOL_TRC_GAMMA28,\r\n  'smpte170m': AVColorTransferCharacteristic.AVCOL_TRC_SMPTE170M,\r\n  'smpte240m': AVColorTransferCharacteristic.AVCOL_TRC_SMPTE240M,\r\n  'srgb': AVColorTransferCharacteristic.AVCOL_TRC_IEC61966_2_1,\r\n  'xvycc': AVColorTransferCharacteristic.AVCOL_TRC_IEC61966_2_4,\r\n  'bt2020-10': AVColorTransferCharacteristic.AVCOL_TRC_BT2020_10,\r\n  'bt2020-12': AVColorTransferCharacteristic.AVCOL_TRC_BT2020_12\r\n}\r\n\r\nexport const mediaType2AVMediaType: Record<string, AVMediaType> = {\r\n  'Audio': AVMediaType.AVMEDIA_TYPE_AUDIO,\r\n  'Video': AVMediaType.AVMEDIA_TYPE_VIDEO,\r\n  'Subtitle': AVMediaType.AVMEDIA_TYPE_SUBTITLE,\r\n  'Attachment': AVMediaType.AVMEDIA_TYPE_ATTACHMENT,\r\n  'Data': AVMediaType.AVMEDIA_TYPE_DATA\r\n}\r\n\r\nexport const disposition2AVDisposition: Record<string, AVDisposition> = {\r\n  'default': AVDisposition.DEFAULT,\r\n  'dub': AVDisposition.DUB,\r\n  'original': AVDisposition.ORIGINAL,\r\n  'comment': AVDisposition.COMMENT,\r\n  'lyrics': AVDisposition.LYRICS,\r\n  'karaoke': AVDisposition.KARAOKE,\r\n  'forced': AVDisposition.FORCED,\r\n  'hearing impaired': AVDisposition.HEARING_IMPAIRED,\r\n  'visual impaired': AVDisposition.VISUAL_IMPAIRED,\r\n  'clean effects': AVDisposition.CLEAN_EFFECTS,\r\n  'attached pic': AVDisposition.ATTACHED_PIC,\r\n  'timed thumbnails': AVDisposition.TIMED_THUMBNAILS,\r\n  'captions': AVDisposition.CAPTIONS,\r\n  'descriptions': AVDisposition.DESCRIPTIONS,\r\n  'metadata': AVDisposition.METADATA,\r\n  'dependent': AVDisposition.DEPENDENT,\r\n  'still image': AVDisposition.STILL_IMAGE\r\n}\r\n","/*\r\n * libmedia AVChannelLayout\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVChannel, AVChannelOrder } from '../audiosamplefmt'\r\n\r\n@struct\r\nexport class AVChannelCustom {\r\n  id: AVChannel\r\n  name: array<char, 16>\r\n  opaque: pointer<void>\r\n}\r\n\r\n@struct\r\nexport class AVChannelLayout {\r\n  /**\r\n   * Channel order used in this layout.\r\n   * This is a mandatory field.\r\n   */\r\n  order: AVChannelOrder\r\n\r\n  /**\r\n   * Number of channels in this layout. Mandatory field.\r\n   */\r\n  nbChannels: int32\r\n\r\n  /**\r\n   * Details about which channels are present in this layout.\r\n   * For AV_CHANNEL_ORDER_UNSPEC, this field is undefined and must not be\r\n   * used.\r\n   */\r\n  u: union<{\r\n    /**\r\n     * This member must be used for AV_CHANNEL_ORDER_NATIVE, and may be used\r\n     * for AV_CHANNEL_ORDER_AMBISONIC to signal non-diegetic channels.\r\n     * It is a bitmask, where the position of each set bit means that the\r\n     * AVChannel with the corresponding value is present.\r\n     *\r\n     * I.e. when (mask & (1 << AV_CHAN_FOO)) is non-zero, then AV_CHAN_FOO\r\n     * is present in the layout. Otherwise it is not present.\r\n     *\r\n     * @note when a channel layout using a bitmask is constructed or\r\n     * modified manually (i.e.  not using any of the av_channel_layout_*\r\n     * functions), the code doing it must ensure that the number of set bits\r\n     * is equal to nb_channels.\r\n     */\r\n    mask: uint64\r\n\r\n    /**\r\n     * This member must be used when the channel order is\r\n     * AV_CHANNEL_ORDER_CUSTOM. It is a nb_channels-sized array, with each\r\n     * element signalling the presence of the AVChannel with the\r\n     * corresponding value in map[i].id.\r\n     *\r\n     * I.e. when map[i].id is equal to AV_CHAN_FOO, then AV_CH_FOO is the\r\n     * i-th channel in the audio data.\r\n     *\r\n     * When map[i].id is in the range between AV_CHAN_AMBISONIC_BASE and\r\n     * AV_CHAN_AMBISONIC_END (inclusive), the channel contains an ambisonic\r\n     * component with ACN index (as defined above)\r\n     * n = map[i].id - AV_CHAN_AMBISONIC_BASE.\r\n     *\r\n     * map[i].name may be filled with a 0-terminated string, in which case\r\n     * it will be used for the purpose of identifying the channel with the\r\n     * convenience functions below. Otherwise it must be zeroed.\r\n     */\r\n    map: pointer<AVChannelCustom>\r\n  }>\r\n\r\n  /**\r\n   * For some private data of the user.\r\n   */\r\n  opaque: pointer<void>\r\n}\r\n","/*\r\n * libmedia AVBuffer defined\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { avFree } from '../util/mem'\r\nimport { Mutex } from 'cheap/thread/mutex'\r\n\r\nexport const enum AVBufferFlags {\r\n  NONE = 0,\r\n  READONLY = 1 << 0\r\n}\r\n\r\n@struct\r\nexport class AVBuffer {\r\n  /**\r\n   * data described by this buffer\r\n   */\r\n  data: pointer<uint8> = nullptr\r\n\r\n  /**\r\n   * size of data in bytes\r\n   */\r\n  size: size = 0\r\n\r\n  /**\r\n   *  number of existing AVBufferRef instances referring to this buffer\r\n   */\r\n  refcount: atomic_uint32 = 0\r\n\r\n  /**\r\n   * a callback for freeing the data\r\n   */\r\n  free: pointer<(opaque: pointer<void>, data: pointer<uint8>) => void> = nullptr\r\n\r\n  /**\r\n   * an opaque pointer, to be used by the freeing callback\r\n   */\r\n  opaque: pointer<void> = nullptr\r\n\r\n  /**\r\n   * A combination of AV_BUFFER_FLAG_*\r\n   */\r\n  flags: AVBufferFlags = AVBufferFlags.NONE\r\n\r\n  /**\r\n   * A combination of BUFFER_FLAG_*\r\n   */\r\n  flagsInternal: int32 = 0\r\n}\r\n\r\nfunction avbufferDefaultFree(opaque: pointer<void>, data: pointer<uint8>) {\r\n  avFree(data)\r\n}\r\n\r\n@struct\r\nexport class AVBufferRef {\r\n  buffer: pointer<AVBuffer> = nullptr\r\n\r\n  /**\r\n   * The data buffer. It is considered writable if and only if\r\n   * this is the only reference to the buffer, in which case\r\n   * av_buffer_is_writable() returns 1.\r\n   */\r\n  data: pointer<uint8> = nullptr\r\n\r\n  /**\r\n   * Size of data in bytes.\r\n   */\r\n  size: size = 0\r\n}\r\n\r\n@struct\r\nexport class AVBufferPool {\r\n  mutex: Mutex\r\n\r\n  pool: pointer<BufferPoolEntry> = nullptr\r\n\r\n  /**\r\n   *  number of existing AVBufferRef instances referring to this buffer\r\n   */\r\n  refcount: atomic_uint32 = 0\r\n\r\n  /**\r\n   * Size of data in bytes.\r\n   */\r\n  size: size = 0\r\n\r\n  /**\r\n   * an opaque pointer, to be used by the freeing callback\r\n   */\r\n  opaque: pointer<void> = nullptr\r\n  alloc: pointer<(size: size) => AVBufferRef> = nullptr\r\n  alloc2: pointer<(opaque: pointer<void>, size: size) => AVBufferRef> = nullptr\r\n  poolFree: pointer<(opaque: pointer<void>) => void> = nullptr\r\n}\r\n\r\n@struct\r\nexport class BufferPoolEntry {\r\n  data: pointer<uint8> = nullptr\r\n  /**\r\n   * an opaque pointer, to be used by the freeing callback\r\n   */\r\n  opaque: pointer<void> = nullptr\r\n\r\n  /**\r\n   * a callback for freeing the data\r\n   */\r\n  free: pointer<(opaque: pointer<void>, data: pointer<uint8>) => void> = nullptr\r\n\r\n  pool: pointer<AVBufferPool> = nullptr\r\n\r\n  next: pointer<BufferPoolEntry> = nullptr\r\n  /*\r\n   * An AVBuffer structure to (re)use as AVBuffer for subsequent uses\r\n   * of this BufferPoolEntry.\r\n   */\r\n  buffer: AVBuffer\r\n}\r\n","/*\r\n * libmedia AVCodecParameters defined\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { NOPTS_VALUE } from '../constant'\r\nimport { AVCodecID, AVMediaType } from '../codec'\r\nimport { AVChromaLocation, AVColorPrimaries, AVColorRange, AVColorSpace,\r\n  AVColorTransferCharacteristic, AVFieldOrder, AVPixelFormat\r\n} from '../pixfmt'\r\nimport { AVSampleFormat } from '../audiosamplefmt'\r\nimport { Rational } from './rational'\r\nimport { AVPacketSideData } from './avpacket'\r\nimport { AVChannelLayout } from './audiosample'\r\nimport { freeCodecParameters } from '../util/codecparameters'\r\nimport { symbolStructAddress } from 'cheap/symbol'\r\n\r\n/**\r\n * FFmpeg AVCodecParameters 定义\r\n */\r\n@struct\r\nexport default class AVCodecParameters {\r\n  /**\r\n   * General type of the encoded data.\r\n   */\r\n  codecType: AVMediaType = AVMediaType.AVMEDIA_TYPE_UNKNOWN\r\n  /**\r\n   * Specific type of the encoded data (the codec used).\r\n   */\r\n  codecId: AVCodecID = AVCodecID.AV_CODEC_ID_NONE\r\n  /**\r\n   * Additional information about the codec (corresponds to the AVI FOURCC).\r\n   */\r\n  codecTag: uint32 = 0\r\n\r\n  /**\r\n   * Extra binary data needed for initializing the decoder, codec-dependent.\r\n   *\r\n   * Must be allocated with av_malloc() and will be freed by\r\n   * avcodec_parameters_free(). The allocated size of extradata must be at\r\n   * least extradata_size + AV_INPUT_BUFFER_PADDING_SIZE, with the padding\r\n   * bytes zeroed.\r\n   */\r\n  extradata: pointer<uint8> = nullptr\r\n  extradataSize: int32 = 0\r\n\r\n  /**\r\n   * Additional data associated with the entire stream.\r\n   *\r\n   * Should be allocated with av_packet_side_data_new() or\r\n   * av_packet_side_data_add(), and will be freed by avcodec_parameters_free().\r\n   */\r\n  codedSideData: pointer<AVPacketSideData> = nullptr\r\n\r\n  /**\r\n   * Amount of entries in @ref coded_side_data.\r\n   */\r\n  nbCodedSideData: int32 = 0\r\n\r\n  /**\r\n   * - video: the pixel format, the value corresponds to enum AVPixelFormat.\r\n   * - audio: the sample format, the value corresponds to enum AVSampleFormat.\r\n   */\r\n  format: AVPixelFormat | AVSampleFormat = NOPTS_VALUE\r\n\r\n  /**\r\n   * The average bitrate of the encoded data (in bits per second).\r\n   */\r\n  bitrate: int64 = 0n\r\n\r\n  /**\r\n   * The number of bits per sample in the codedwords.\r\n   *\r\n   * This is basically the bitrate per sample. It is mandatory for a bunch of\r\n   * formats to actually decode them. It's the number of bits for one sample in\r\n   * the actual coded bitstream.\r\n   *\r\n   * This could be for example 4 for ADPCM\r\n   * For PCM formats this matches bits_per_raw_sample\r\n   * Can be 0\r\n   */\r\n  bitsPerCodedSample: int32 = 0\r\n  /**\r\n   * This is the number of valid bits in each output sample. If the\r\n   * sample format has more bits, the least significant bits are additional\r\n   * padding bits, which are always 0. Use right shifts to reduce the sample\r\n   * to its actual size. For example, audio formats with 24 bit samples will\r\n   * have bits_per_raw_sample set to 24, and format set to AV_SAMPLE_FMT_S32.\r\n   * To get the original sample use \"(int32_t)sample >> 8\".\"\r\n   *\r\n   * For ADPCM this might be 12 or 16 or similar\r\n   * Can be 0\r\n   */\r\n  bitsPerRawSample: int32 = 0\r\n\r\n  /**\r\n   * Codec-specific bitstream restrictions that the stream conforms to.\r\n   */\r\n  profile: int32 = NOPTS_VALUE\r\n  level: int32 = NOPTS_VALUE\r\n\r\n  /**\r\n   * Video only. The dimensions of the video frame in pixels.\r\n   */\r\n  width: int32 = 0\r\n  height: int32 = 0\r\n\r\n  /**\r\n   * Video only. The aspect ratio (width / height) which a single pixel\r\n   * should have when displayed.\r\n   *\r\n   * When the aspect ratio is unknown / undefined, the numerator should be\r\n   * set to 0 (the denominator may have any value).\r\n   */\r\n  sampleAspectRatio: Rational = new Rational({den: 1, num: 1})\r\n\r\n  /**\r\n   * Video only. Number of frames per second, for streams with constant frame\r\n   * durations. Should be set to { 0, 1 } when some frames have differing\r\n   * durations or if the value is not known.\r\n   *\r\n   * @note This field correponds to values that are stored in codec-level\r\n   * headers and is typically overridden by container/transport-layer\r\n   * timestamps, when available. It should thus be used only as a last resort,\r\n   * when no higher-level timing information is available.\r\n   */\r\n  framerate: Rational = new Rational({den: 1, num: 0})\r\n\r\n  /**\r\n   * Video only. The order of the fields in interlaced video.\r\n   */\r\n  fieldOrder: AVFieldOrder = AVFieldOrder.AV_FIELD_UNKNOWN\r\n\r\n  /**\r\n   * Video only. Additional colorspace characteristics.\r\n   */\r\n  colorRange: AVColorRange = AVColorRange.AVCOL_RANGE_UNSPECIFIED\r\n  colorPrimaries: AVColorPrimaries = AVColorPrimaries.AVCOL_PRI_UNSPECIFIED\r\n  colorTrc: AVColorTransferCharacteristic = AVColorTransferCharacteristic.AVCOL_TRC_UNSPECIFIED\r\n  colorSpace: AVColorSpace = AVColorSpace.AVCOL_SPC_UNSPECIFIED\r\n  chromaLocation: AVChromaLocation = AVChromaLocation.AVCHROMA_LOC_UNSPECIFIED\r\n\r\n  /**\r\n   * Video only. Number of delayed frames.\r\n   */\r\n  videoDelay: int32 = 0\r\n\r\n  /**\r\n   * Audio only. The channel layout and number of channels.\r\n   */\r\n  chLayout: AVChannelLayout\r\n\r\n  /**\r\n   * Audio only. The number of audio samples per second.\r\n   */\r\n  sampleRate: int32 = NOPTS_VALUE\r\n  /**\r\n   * Audio only. The number of bytes per coded audio frame, required by some\r\n   * formats.\r\n   *\r\n   * Corresponds to nBlockAlign in WAVEFORMATEX.\r\n   */\r\n  blockAlign: int32 = 0\r\n\r\n  /**\r\n   * Audio only. Audio frame size, if known. Required by some formats to be static.\r\n   */\r\n  frameSize: int32 = 0\r\n\r\n  /**\r\n   * Audio only. The amount of padding (in samples) inserted by the encoder at\r\n   * the beginning of the audio. I.e. this number of leading decoded samples\r\n   * must be discarded by the caller to get the original audio without leading\r\n   * padding.\r\n   */\r\n  initialPadding: int32 = 0\r\n\r\n  /**\r\n   * Audio only. The amount of padding (in samples) appended by the encoder to\r\n   * the end of the audio. I.e. this number of decoded samples must be\r\n   * discarded by the caller from the end of the stream to get the original\r\n   * audio without any trailing padding.\r\n   */\r\n  trailingPadding: int32 = 0\r\n  /**\r\n   * Audio only. Number of samples to skip after a discontinuity.\r\n   */\r\n  seekPreroll: int32 = 0\r\n\r\n  /**\r\n   * 码流格式\r\n   * 对于 h264/h265/h266 标记是 annexb 还是 avcc 格式\r\n   */\r\n  bitFormat: int32 = 0\r\n\r\n  destroy() {\r\n    freeCodecParameters(addressof(this as AVCodecParameters))\r\n    this[symbolStructAddress] = nullptr\r\n  }\r\n}\r\n","/*\r\n * libmedia AVDictionary defined\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nexport const enum AVDictFlags {\r\n  MATCH_CASE = 1,\r\n  IGNORE_SUFFIX = 2,\r\n  DONT_OVERWRITE = 16,\r\n  APPEND = 32,\r\n  MULTIKEY = 64\r\n}\r\n\r\n@struct\r\nexport class AVDictionaryEntry {\r\n  key: pointer<void> = nullptr\r\n  value: pointer<void> = nullptr\r\n}\r\n\r\n@struct\r\nexport class AVDictionary {\r\n  count: int32 = 0\r\n  elems: pointer<AVDictionaryEntry> = nullptr\r\n}\r\n","/*\r\n * libmedia AVFrame defined\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { NOPTS_VALUE, NOPTS_VALUE_BIGINT } from '../constant'\r\nimport { AVChromaLocation, AVColorPrimaries, AVColorRange, AVColorSpace, AVColorTransferCharacteristic } from '../pixfmt'\r\nimport { AVBufferRef } from './avbuffer'\r\nimport { unrefAVFrame } from '../util/avframe'\r\nimport { AVDictionary } from './avdict'\r\nimport { Rational } from './rational'\r\nimport { symbolStructAddress } from 'cheap/symbol'\r\nimport { AVChannelLayout } from './audiosample'\r\n\r\nexport const AV_NUM_DATA_POINTERS = 8\r\n\r\nexport const enum AVFrameFlags {\r\n  AV_FRAME_FLAG_NONE = 0,\r\n  /**\r\n   * The frame data may be corrupted, e.g. due to decoding errors.\r\n   */\r\n  AV_FRAME_FLAG_CORRUPT = 1 << 0,\r\n  /**\r\n   * A flag to mark frames that are keyframes.\r\n   */\r\n  AV_FRAME_FLAG_KEY = 1 << 1,\r\n  /**\r\n   * A flag to mark the frames which need to be decoded, but shouldn't be output.\r\n   */\r\n  AV_FRAME_FLAG_DISCARD = 1 << 2,\r\n  /**\r\n   * A flag to mark frames whose content is interlaced.\r\n   */\r\n  AV_FRAME_FLAG_INTERLACED = 1 << 3,\r\n  /**\r\n   * A flag to mark frames where the top field is displayed first if the content\r\n   * is interlaced.\r\n   */\r\n  AV_FRAME_FLAG_TOP_FIELD_FIRST = 1 << 4\r\n}\r\n\r\nexport const enum FFDecodeError {\r\n  NONE = 0,\r\n  INVALID_BITSTREAM = 1,\r\n  MISSING_REFERENCE = 2,\r\n  CONCEALMENT_ACTIVE = 4,\r\n  DECODE_SLICES = 8\r\n}\r\n\r\nexport const enum AVPictureType {\r\n  /**\r\n   * Undefined\r\n   */\r\n  AV_PICTURE_TYPE_NONE = 0,\r\n  /**\r\n   * Intra\r\n   */\r\n  AV_PICTURE_TYPE_I,\r\n  /**\r\n   * Predicted\r\n   */\r\n  AV_PICTURE_TYPE_P,\r\n  /**\r\n   * Bi-dir predicted\r\n   */\r\n  AV_PICTURE_TYPE_B,\r\n  /**\r\n   * S(GMC)-VOP MPEG-4\r\n   */\r\n  AV_PICTURE_TYPE_S,\r\n  /**\r\n   * Switching Intra\r\n   */\r\n  AV_PICTURE_TYPE_SI,\r\n  /**\r\n   * Switching Predicted\r\n   */\r\n  AV_PICTURE_TYPE_SP,\r\n  /**\r\n   * BI type\r\n   */\r\n  AV_PICTURE_TYPE_BI\r\n}\r\n\r\n/**\r\n * @defgroup lavu_frame AVFrame\r\n * @ingroup lavu_data\r\n *\r\n * @{\r\n * AVFrame is an abstraction for reference-counted raw multimedia data.\r\n */\r\n\r\nexport const enum AVFrameSideDataType {\r\n  /**\r\n   * The data is the AVPanScan struct defined in libavcodec.\r\n   */\r\n  AV_FRAME_DATA_PANSCAN,\r\n  /**\r\n   * ATSC A53 Part 4 Closed Captions.\r\n   * A53 CC bitstream is stored as uint8_t in AVFrameSideData.data.\r\n   * The number of bytes of CC data is AVFrameSideData.size.\r\n   */\r\n  AV_FRAME_DATA_A53_CC,\r\n  /**\r\n   * Stereoscopic 3d metadata.\r\n   * The data is the AVStereo3D struct defined in libcommon/stereo3d.h.\r\n   */\r\n  AV_FRAME_DATA_STEREO3D,\r\n  /**\r\n   * The data is the AVMatrixEncoding enum defined in libcommon/channel_layout.h.\r\n   */\r\n  AV_FRAME_DATA_MATRIXENCODING,\r\n  /**\r\n   * Metadata relevant to a downmix procedure.\r\n   * The data is the AVDownmixInfo struct defined in libcommon/downmix_info.h.\r\n   */\r\n  AV_FRAME_DATA_DOWNMIX_INFO,\r\n  /**\r\n   * ReplayGain information in the form of the AVReplayGain struct.\r\n   */\r\n  AV_FRAME_DATA_REPLAYGAIN,\r\n  /**\r\n   * This side data contains a 3x3 transformation matrix describing an affine\r\n   * transformation that needs to be applied to the frame for correct\r\n   * presentation.\r\n   *\r\n   * See libcommon/display.h for a detailed description of the data.\r\n   */\r\n  AV_FRAME_DATA_DISPLAYMATRIX,\r\n  /**\r\n   * Active Format Description data consisting of a single byte as specified\r\n   * in ETSI TS 101 154 using AVActiveFormatDescription enum.\r\n   */\r\n  AV_FRAME_DATA_AFD,\r\n  /**\r\n   * Motion vectors exported by some codecs (on demand through the export_mvs\r\n   * flag set in the libavcodec AVCodecContext flags2 option).\r\n   * The data is the AVMotionVector struct defined in\r\n   * libcommon/motion_vector.h.\r\n   */\r\n  AV_FRAME_DATA_MOTION_VECTORS,\r\n  /**\r\n   * Recommmends skipping the specified number of samples. This is exported\r\n   * only if the \"skip_manual\" AVOption is set in libavcodec.\r\n   * This has the same format as AV_PKT_DATA_SKIP_SAMPLES.\r\n   * @code\r\n   * u32le number of samples to skip from start of this packet\r\n   * u32le number of samples to skip from end of this packet\r\n   * u8    reason for start skip\r\n   * u8    reason for end   skip (0=padding silence, 1=convergence)\r\n   * @endcode\r\n   */\r\n  AV_FRAME_DATA_SKIP_SAMPLES,\r\n  /**\r\n   * This side data must be associated with an audio frame and corresponds to\r\n   * enum AVAudioServiceType defined in avcodec.h.\r\n   */\r\n  AV_FRAME_DATA_AUDIO_SERVICE_TYPE,\r\n  /**\r\n   * Mastering display metadata associated with a video frame. The payload is\r\n   * an AVMasteringDisplayMetadata type and contains information about the\r\n   * mastering display color volume.\r\n   */\r\n  AV_FRAME_DATA_MASTERING_DISPLAY_METADATA,\r\n  /**\r\n   * The GOP timecode in 25 bit timecode format. Data format is 64-bit integer.\r\n   * This is set on the first frame of a GOP that has a temporal reference of 0.\r\n   */\r\n  AV_FRAME_DATA_GOP_TIMECODE,\r\n\r\n  /**\r\n   * The data represents the AVSphericalMapping structure defined in\r\n   * libcommon/spherical.h.\r\n   */\r\n  AV_FRAME_DATA_SPHERICAL,\r\n\r\n  /**\r\n   * Content light level (based on CTA-861.3). This payload contains data in\r\n   * the form of the AVContentLightMetadata struct.\r\n   */\r\n  AV_FRAME_DATA_CONTENT_LIGHT_LEVEL,\r\n\r\n  /**\r\n   * The data contains an ICC profile as an opaque octet buffer following the\r\n   * format described by ISO 15076-1 with an optional name defined in the\r\n   * metadata key entry \"name\".\r\n   */\r\n  AV_FRAME_DATA_ICC_PROFILE,\r\n\r\n  /**\r\n   * Timecode which conforms to SMPTE ST 12-1. The data is an array of 4 uint32_t\r\n   * where the first uint32_t describes how many (1-3) of the other timecodes are used.\r\n   * The timecode format is described in the documentation of av_timecode_get_smpte_from_framenum()\r\n   * function in libcommon/timecode.h.\r\n   */\r\n  AV_FRAME_DATA_S12M_TIMECODE,\r\n\r\n  /**\r\n   * HDR dynamic metadata associated with a video frame. The payload is\r\n   * an AVDynamicHDRPlus type and contains information for color\r\n   * volume transform - application 4 of SMPTE 2094-40:2016 standard.\r\n   */\r\n  AV_FRAME_DATA_DYNAMIC_HDR_PLUS,\r\n\r\n  /**\r\n   * Regions Of Interest, the data is an array of AVRegionOfInterest type, the number of\r\n   * array element is implied by AVFrameSideData.size / AVRegionOfInterest.self_size.\r\n   */\r\n  AV_FRAME_DATA_REGIONS_OF_INTEREST,\r\n\r\n  /**\r\n   * Encoding parameters for a video frame, as described by AVVideoEncParams.\r\n   */\r\n  AV_FRAME_DATA_VIDEO_ENC_PARAMS,\r\n\r\n  /**\r\n   * User data unregistered metadata associated with a video frame.\r\n   * This is the H.26[45] UDU SEI message, and shouldn't be used for any other purpose\r\n   * The data is stored as uint8_t in AVFrameSideData.data which is 16 bytes of\r\n   * uuid_iso_iec_11578 followed by AVFrameSideData.size - 16 bytes of user_data_payload_byte.\r\n   */\r\n  AV_FRAME_DATA_SEI_UNREGISTERED,\r\n\r\n  /**\r\n   * Film grain parameters for a frame, described by AVFilmGrainParams.\r\n   * Must be present for every frame which should have film grain applied.\r\n   */\r\n  AV_FRAME_DATA_FILM_GRAIN_PARAMS,\r\n\r\n  /**\r\n   * Bounding boxes for object detection and classification,\r\n   * as described by AVDetectionBBoxHeader.\r\n   */\r\n  AV_FRAME_DATA_DETECTION_BBOXES\r\n}\r\n\r\n@struct\r\nexport class AVFrameSideData {\r\n  type: AVFrameSideDataType = 0\r\n\r\n  data: pointer<uint8> = nullptr\r\n\r\n  size: size = 0\r\n\r\n  metadata: pointer<AVDictionary> = nullptr\r\n\r\n  buf: pointer<AVBufferRef> = nullptr\r\n}\r\n\r\n@struct\r\nexport class AVMasteringDisplayMetadata {\r\n  /**\r\n   * CIE 1931 xy chromaticity coords of color primaries (r, g, b order).\r\n   */\r\n  displayPrimaries: array<array<Rational, 2>, 3>\r\n  /**\r\n   * CIE 1931 xy chromaticity coords of white point.\r\n   */\r\n  whitePoint: array<Rational, 2>\r\n  /**\r\n   * Min luminance of mastering display (cd/m^2).\r\n   */\r\n  minLuminance: Rational\r\n  /**\r\n   * Max luminance of mastering display (cd/m^2).\r\n   */\r\n  maxLuminance: Rational\r\n  /**\r\n   * Flag indicating whether the display primaries (and white point) are set.\r\n   */\r\n  hasPrimaries: int32\r\n  /**\r\n   * Flag indicating whether the luminance (min_ and max_) have been set.\r\n   */\r\n  hasLuminance: int32\r\n}\r\n\r\n@struct\r\nexport class AVContentLightMetadata {\r\n  /**\r\n   * Max content light level (cd/m^2).\r\n   */\r\n  maxCLL: uint32\r\n  /**\r\n   * Max average light level per frame (cd/m^2).\r\n   */\r\n  maxFALL: uint32\r\n}\r\n\r\n/**\r\n * FFmpeg AVFrame 定义\r\n */\r\n@struct\r\nexport default class AVFrame {\r\n  /**\r\n   * pointer to the picture/channel planes.\r\n   * This might be different from the first allocated byte\r\n   *\r\n   * Some decoders access areas outside 0,0 - width, height, please\r\n   * see avcodec_align_dimensions2(). Some filters and swscale can read\r\n   * up to 16 bytes beyond the planes, if these filters are to be used,\r\n   * then 16 extra bytes must be allocated.\r\n   *\r\n   * NOTE: Except for hwaccel formats, pointers not needed by the format\r\n   * MUST be set to NULL.\r\n   */\r\n  data: array<pointer<uint8>, typeof AV_NUM_DATA_POINTERS> = new Array(AV_NUM_DATA_POINTERS).fill(nullptr, 0, AV_NUM_DATA_POINTERS)\r\n\r\n  /**\r\n   * For video, size in bytes of each picture line.\r\n   * For audio, size in bytes of each plane.\r\n   *\r\n   * For audio, only linesize[0] may be set. For planar audio, each channel\r\n   * plane must be the same size.\r\n   *\r\n   * For video the linesizes should be multiples of the CPUs alignment\r\n   * preference, this is 16 or 32 for modern desktop CPUs.\r\n   * Some code requires such alignment other code can be slower without\r\n   * correct alignment, for yet other it makes no difference.\r\n   *\r\n   * @note The linesize may be larger than the size of usable data -- there\r\n   * may be extra padding present for performance reasons.\r\n   */\r\n  linesize: array<int32, typeof AV_NUM_DATA_POINTERS> = new Array(AV_NUM_DATA_POINTERS).fill(0, 0, AV_NUM_DATA_POINTERS)\r\n\r\n  /**\r\n   * pointers to the data planes/channels.\r\n   *\r\n   * For video, this should simply point to data[].\r\n   *\r\n   * For planar audio, each channel has a separate data pointer, and\r\n   * linesize[0] contains the size of each channel buffer.\r\n   * For packed audio, there is just one data pointer, and linesize[0]\r\n   * contains the total size of the buffer for all channels.\r\n   *\r\n   * Note: Both data and extended_data should always be set in a valid frame,\r\n   * but for planar audio with more channels that can fit in data,\r\n   * extended_data must be used in order to access all channels.\r\n   */\r\n  extendedData: pointer<pointer<uint8>> = nullptr\r\n\r\n  /**\r\n   * @name Video dimensions\r\n   * Video frames only. The coded dimensions (in pixels) of the video frame,\r\n   * i.e. the size of the rectangle that contains some well-defined values.\r\n   *\r\n   * @note The part of the frame intended for display/presentation is further\r\n   * restricted by the @ref cropping \"Cropping rectangle\".\r\n   * \r\n   */\r\n  width: int32 = NOPTS_VALUE\r\n  height: int32 = NOPTS_VALUE\r\n\r\n  /**\r\n   * number of audio samples (per channel) described by this frame\r\n   */\r\n  nbSamples: int32 = NOPTS_VALUE\r\n\r\n  /**\r\n   * format of the frame, -1 if unknown or unset\r\n   * Values correspond to enum AVPixelFormat for video frames,\r\n   * enum AVSampleFormat for audio)\r\n   */\r\n  format: int32 = NOPTS_VALUE\r\n\r\n  /**\r\n   * 1 -> keyframe, 0-> not\r\n   *\r\n   * @deprecated Use AV_FRAME_FLAG_KEY instead\r\n   */\r\n  @ignore(!defined(API_FRAME_KEY))\r\n  keyFrame: int32 = 0\r\n\r\n  /**\r\n   * Picture type of the frame.\r\n   */\r\n  pictType: AVPictureType = AVPictureType.AV_PICTURE_TYPE_NONE\r\n\r\n  /**\r\n   * Sample aspect ratio for the video frame, 0/1 if unknown/unspecified.\r\n   */\r\n  sampleAspectRatio: Rational = new Rational({den: 1, num: 0})\r\n\r\n  /**\r\n   * Presentation timestamp in time_base units (time when frame should be shown to user).\r\n   */\r\n  pts: int64 = NOPTS_VALUE_BIGINT\r\n\r\n  /**\r\n   * DTS copied from the AVPacket that triggered returning this frame. (if frame threading isn't used)\r\n   * This is also the Presentation time of this AVFrame calculated from\r\n   * only AVPacket.dts values without pts values.\r\n   */\r\n  pktDts: int64 = NOPTS_VALUE_BIGINT\r\n\r\n  /**\r\n   * Time base for the timestamps in this frame.\r\n   * In the future, this field may be set on frames output by decoders or\r\n   * filters, but its value will be by default ignored on input to encoders\r\n   * or filters.\r\n   */\r\n  timeBase: Rational\r\n\r\n  /**\r\n   * quality (between 1 (good) and FF_LAMBDA_MAX (bad))\r\n   */\r\n  quality: int32 = NOPTS_VALUE\r\n\r\n  /**\r\n   * Frame owner's private data.\r\n   *\r\n   * This field may be set by the code that allocates/owns the frame data.\r\n   * It is then not touched by any library functions, except:\r\n   * - it is copied to other references by av_frame_copy_props() (and hence by\r\n   *   av_frame_ref());\r\n   * - it is set to NULL when the frame is cleared by av_frame_unref()\r\n   * - on the caller's explicit request. E.g. libavcodec encoders/decoders\r\n   *   will copy this field to/from @ref AVPacket \"AVPackets\" if the caller sets\r\n   *   @ref AV_CODEC_FLAG_COPY_OPAQUE.\r\n   *\r\n   * @see opaque_ref the reference-counted analogue\r\n   */\r\n  opaque: pointer<void> = nullptr\r\n\r\n  /**\r\n   * Number of fields in this frame which should be repeated, i.e. the total\r\n   * duration of this frame should be repeat_pict + 2 normal field durations.\r\n   *\r\n   * For interlaced frames this field may be set to 1, which signals that this\r\n   * frame should be presented as 3 fields: beginning with the first field (as\r\n   * determined by AV_FRAME_FLAG_TOP_FIELD_FIRST being set or not), followed\r\n   * by the second field, and then the first field again.\r\n   *\r\n   * For progressive frames this field may be set to a multiple of 2, which\r\n   * signals that this frame's duration should be (repeat_pict + 2) / 2\r\n   * normal frame durations.\r\n   *\r\n   * @note This field is computed from MPEG2 repeat_first_field flag and its\r\n   * associated flags, H.264 pic_struct from picture timing SEI, and\r\n   * their analogues in other codecs. Typically it should only be used when\r\n   * higher-layer timing information is not available.\r\n   */\r\n  repeatPict: int32 = NOPTS_VALUE\r\n\r\n  /**\r\n   * The content of the picture is interlaced.\r\n   *\r\n   * @deprecated Use AV_FRAME_FLAG_INTERLACED instead\r\n   */\r\n  @ignore(!defined(API_INTERLACED_FRAME))\r\n  interlacedFrame: int32 = NOPTS_VALUE\r\n\r\n  /**\r\n   * If the content is interlaced, is top field displayed first.\r\n   *\r\n   * @deprecated Use AV_FRAME_FLAG_TOP_FIELD_FIRST instead\r\n   */\r\n  @ignore(!defined(API_INTERLACED_FRAME))\r\n  topFieldFirst: int32 = NOPTS_VALUE\r\n\r\n  /**\r\n   * Tell user application that palette has changed from previous frame.\r\n   *  @deprecated\r\n   */\r\n  @ignore(!defined(API_PALETTE_HAS_CHANGED))\r\n  paletteHasChanged: int32 = NOPTS_VALUE\r\n\r\n  /**\r\n   * Sample rate of the audio data.\r\n   */\r\n  sampleRate: int32 = NOPTS_VALUE\r\n\r\n  /**\r\n   * AVBuffer references backing the data for this frame. If all elements of\r\n   * this array are NULL, then this frame is not reference counted. This array\r\n   * must be filled contiguously -- if buf[i] is non-NULL then buf[j] must\r\n   * also be non-NULL for all j < i.\r\n   *\r\n   * There may be at most one AVBuffer per data plane, so for video this array\r\n   * always contains all the references. For planar audio with more than\r\n   * AV_NUM_DATA_POINTERS channels, there may be more buffers than can fit in\r\n   * this array. Then the extra AVBufferRef pointers are stored in the\r\n   * extended_buf array.\r\n   */\r\n  buf: array<pointer<AVBufferRef>, typeof AV_NUM_DATA_POINTERS> = new Array(AV_NUM_DATA_POINTERS).fill(nullptr, 0, AV_NUM_DATA_POINTERS)\r\n\r\n  /**\r\n   * For planar audio which requires more than AV_NUM_DATA_POINTERS\r\n   * AVBufferRef pointers, this array will hold all the references which\r\n   * cannot fit into AVFrame.buf.\r\n   *\r\n   * Note that this is different from AVFrame.extended_data, which always\r\n   * contains all the pointers. This array only contains the extra pointers,\r\n   * which cannot fit into AVFrame.buf.\r\n   *\r\n   * This array is always allocated using av_malloc() by whoever constructs\r\n   * the frame. It is freed in av_frame_unref().\r\n   */\r\n  extendedBuf: pointer<pointer<AVBufferRef>> = nullptr\r\n\r\n  /**\r\n   * Number of elements in extended_buf.\r\n   */\r\n  nbExtendedBuf: int32 = 0\r\n\r\n  sideData: pointer<pointer<AVFrameSideData>> = nullptr\r\n\r\n  nbSideData: int32 = 0\r\n\r\n  /**\r\n   * Frame flags, a combination of @ref lavu_frame_flags\r\n   */\r\n  flags: AVFrameFlags = AVFrameFlags.AV_FRAME_FLAG_NONE\r\n\r\n  /**\r\n   * MPEG vs JPEG YUV range.\r\n   * - encoding: Set by user\r\n   * - decoding: Set by libavcodec\r\n   */\r\n  colorRange: AVColorRange = AVColorRange.AVCOL_RANGE_UNSPECIFIED\r\n  colorPrimaries: AVColorPrimaries = AVColorPrimaries.AVCOL_PRI_UNSPECIFIED\r\n  colorTrc: AVColorTransferCharacteristic = AVColorTransferCharacteristic.AVCOL_TRC_UNSPECIFIED\r\n\r\n  /**\r\n   * YUV colorspace type.\r\n   * - encoding: Set by user\r\n   * - decoding: Set by libavcodec\r\n   */\r\n  colorSpace: AVColorSpace = AVColorSpace.AVCOL_SPC_UNSPECIFIED\r\n  chromaLocation: AVChromaLocation = AVChromaLocation.AVCHROMA_LOC_UNSPECIFIED\r\n\r\n  /**\r\n   * frame timestamp estimated using various heuristics, in stream time base\r\n   * - encoding: unused\r\n   * - decoding: set by libavcodec, read by user.\r\n   */\r\n  bestEffortTimestamp: int64 = NOPTS_VALUE_BIGINT\r\n\r\n  /**\r\n   * reordered pos from the last AVPacket that has been input into the decoder\r\n   * - encoding: unused\r\n   * - decoding: Read by user.\r\n   * @deprecated use AV_CODEC_FLAG_COPY_OPAQUE to pass through arbitrary user\r\n   *             data from packets to frames\r\n   */\r\n  @ignore(!defined(API_FRAME_PKT))\r\n  pktPos: int64 = NOPTS_VALUE_BIGINT\r\n\r\n  /**\r\n   * metadata.\r\n   * - encoding: Set by user.\r\n   * - decoding: Set by libavcodec.\r\n   */\r\n  metadata: pointer<AVDictionary> = nullptr\r\n\r\n  /**\r\n   * decode error flags of the frame, set to a combination of\r\n   * FF_DECODE_ERROR_xxx flags if the decoder produced a frame, but there\r\n   * were errors during the decoding.\r\n   * - encoding: unused\r\n   * - decoding: set by libavcodec, read by user.\r\n   */\r\n  decodeErrorFlags: FFDecodeError = FFDecodeError.NONE\r\n\r\n  /**\r\n   * size of the corresponding packet containing the compressed\r\n   * frame.\r\n   * It is set to a negative value if unknown.\r\n   * - encoding: unused\r\n   * - decoding: set by libavcodec, read by user.\r\n   * @deprecated use AV_CODEC_FLAG_COPY_OPAQUE to pass through arbitrary user\r\n   *             data from packets to frames\r\n   */\r\n  @ignore(!defined(API_FRAME_PKT))\r\n  pktSize: int32 = NOPTS_VALUE\r\n\r\n  /**\r\n   * For hwaccel-format frames, this should be a reference to the\r\n   * AVHWFramesContext describing the frame.\r\n   */\r\n  hwFramesCtx: pointer<AVBufferRef> = nullptr\r\n\r\n  /**\r\n   * AVBufferRef for free use by the API user. FFmpeg will never check the\r\n   * contents of the buffer ref. FFmpeg calls av_buffer_unref() on it when\r\n   * the frame is unreferenced. av_frame_copy_props() calls create a new\r\n   * reference with av_buffer_ref() for the target frame's opaque_ref field.\r\n   *\r\n   * This is unrelated to the opaque field, although it serves a similar\r\n   * purpose.\r\n   */\r\n  opaqueRef: pointer<AVBufferRef> = nullptr\r\n\r\n  /**\r\n   * @anchor cropping\r\n   * @name Cropping\r\n   * Video frames only. The number of pixels to discard from the the\r\n   * top/bottom/left/right border of the frame to obtain the sub-rectangle of\r\n   * the frame intended for presentation.\r\n   */\r\n  cropTop: size = 0\r\n\r\n  cropBottom: size = 0\r\n\r\n  cropLeft: size = 0\r\n\r\n  cropRight: size = 0\r\n\r\n  /**\r\n   * AVBufferRef for internal use by a single libav* library.\r\n   * Must not be used to transfer data between libraries.\r\n   * Has to be NULL when ownership of the frame leaves the respective library.\r\n   *\r\n   * Code outside the FFmpeg libs should never check or change the contents of the buffer ref.\r\n   *\r\n   * FFmpeg calls av_buffer_unref() on it when the frame is unreferenced.\r\n   * av_frame_copy_props() calls create a new reference with av_buffer_ref()\r\n   * for the target frame's private_ref field.\r\n   */\r\n  privateRef: pointer<AVBufferRef> = nullptr\r\n\r\n  /**\r\n   * Channel layout of the audio data.\r\n   */\r\n  chLayout: AVChannelLayout\r\n\r\n  /**\r\n   * Duration of the frame, in the same units as pts. 0 if unknown.\r\n   */\r\n  duration: int64 = 0n\r\n\r\n  public close() {\r\n    unrefAVFrame(this[symbolStructAddress])\r\n    unmake(this)\r\n  }\r\n}\r\n\r\n@struct\r\nexport class AVFrameRef extends AVFrame {\r\n  refCount: atomic_int32\r\n}\r\n\r\nexport interface AVFramePool {\r\n  alloc: () => pointer<AVFrameRef>\r\n  release: (avframe: pointer<AVFrameRef>) => void\r\n}\r\n","/*\r\n * libmedia AVPacket defined\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVPacketSideDataType } from '../codec'\r\nimport { AV_TIME_BASE, NOPTS_VALUE, NOPTS_VALUE_BIGINT } from '../constant'\r\nimport { AVBufferRef } from './avbuffer'\r\nimport { Rational } from './rational'\r\n\r\nexport const enum AVPacketType {\r\n  AUDIO,\r\n  VIDEO\r\n}\r\n\r\nexport const enum AVPacketFlags {\r\n  /**\r\n   * The packet contains a keyframe\r\n   */\r\n  AV_PKT_FLAG_KEY = 1,\r\n  /**\r\n   * The packet content is corrupted\r\n   */\r\n  AV_PKT_FLAG_CORRUPT = 2,\r\n  /**\r\n   * Flag is used to discard packets which are required to maintain valid\r\n   * decoder state but are not required for output and should be dropped\r\n   * after decoding.\r\n   */\r\n  AV_PKT_FLAG_DISCARD = 4,\r\n  /**\r\n   * The packet comes from a trusted source.\r\n   *\r\n   * Otherwise-unsafe constructs such as arbitrary pointers to data\r\n   * outside the packet may be followed.\r\n   */\r\n  AV_PKT_FLAG_TRUSTED = 8,\r\n  /**\r\n   * Flag is used to indicate packets that contain frames that can\r\n   * be discarded by the decoder.  I.e. Non-reference frames.\r\n   */\r\n  AV_PKT_FLAG_DISPOSABLE = 16,\r\n\r\n  /**\r\n   * The stream is end\r\n   */\r\n  AV_PKT_FLAG_END = 32\r\n}\r\n\r\n@struct\r\nexport class AVPacketSideData {\r\n  data: pointer<uint8> = nullptr\r\n\r\n  size: size = NOPTS_VALUE\r\n\r\n  type: AVPacketSideDataType = AVPacketSideDataType.AV_PKT_DATA_UNKNOWN\r\n}\r\n\r\n\r\n/**\r\n * FFmpeg AVPacket 定义\r\n */\r\n@struct\r\nexport default class AVPacket {\r\n  /**\r\n   * A reference to the reference-counted buffer where the packet data is\r\n   * stored.\r\n   * May be NULL, then the packet data is not reference-counted.\r\n   */\r\n  buf: pointer<AVBufferRef> = nullptr\r\n\r\n  /**\r\n   * Presentation timestamp in AVStream->time_base units; the time at which\r\n   * the decompressed packet will be presented to the user.\r\n   * Can be AV_NOPTS_VALUE if it is not stored in the file.\r\n   * pts MUST be larger or equal to dts as presentation cannot happen before\r\n   * decompression, unless one wants to view hex dumps. Some formats misuse\r\n   * the terms dts and pts/cts to mean something different. Such timestamps\r\n   * must be converted to true pts/dts before they are stored in AVPacket.\r\n   */\r\n  pts: int64 = NOPTS_VALUE_BIGINT\r\n\r\n  /**\r\n   * Decompression timestamp in AVStream->time_base units; the time at which\r\n   * the packet is decompressed.\r\n   * Can be AV_NOPTS_VALUE if it is not stored in the file.\r\n   */\r\n  dts: int64 = NOPTS_VALUE_BIGINT\r\n\r\n  data: pointer<uint8> = nullptr\r\n\r\n  size: int32 = 0\r\n\r\n  streamIndex: int32 = NOPTS_VALUE\r\n\r\n  /**\r\n   * A combination of @AVPacketFlags values\r\n   */\r\n  flags: int32 = 0\r\n\r\n  /**\r\n   * Additional packet data that can be provided by the container.\r\n   * Packet can contain several types of side information.\r\n   */\r\n  sideData: pointer<AVPacketSideData> = nullptr\r\n  sideDataElems: int32 = 0\r\n\r\n  /**\r\n   * Duration of this packet in AVStream->time_base units, 0 if unknown.\r\n   * Equals next_pts - this_pts in presentation order.\r\n   */\r\n  duration: int64 = NOPTS_VALUE_BIGINT\r\n\r\n  pos: int64 = NOPTS_VALUE_BIGINT\r\n\r\n  /**\r\n   * for some private data of the user\r\n   */\r\n  opaque: pointer<void> = nullptr\r\n\r\n  /**\r\n   * AVBufferRef for free use by the API user. FFmpeg will never check the\r\n   * contents of the buffer ref. FFmpeg calls av_buffer_unref() on it when\r\n   * the packet is unreferenced. av_packet_copy_props() calls create a new\r\n   * reference with av_buffer_ref() for the target packet's opaque_ref field.\r\n   *\r\n   * This is unrelated to the opaque field, although it serves a similar\r\n   * purpose.\r\n   */\r\n  opaqueRef: pointer<AVBufferRef> = nullptr\r\n\r\n  /**\r\n   * 编码时间基\r\n   * \r\n   * 封装时用户设置\r\n   */\r\n  timeBase: Rational = new Rational({ den: AV_TIME_BASE, num: 1 })\r\n\r\n  /**\r\n   * 码流格式\r\n   * 对于 h264/h265/h266 标记是 annexb 还是 avcc 格式\r\n   */\r\n  bitFormat: int32 = 0\r\n}\r\n\r\n@struct\r\nexport class AVPacketRef extends AVPacket {\r\n  refCount: atomic_int32\r\n}\r\n\r\nexport interface AVPacketPool {\r\n  alloc: () => pointer<AVPacketRef>\r\n  release: (avpacket: pointer<AVPacketRef>) => void\r\n}\r\n","/*\r\n * libmedia AVPCMBuffer defined\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\n@struct\r\nexport default class AVPCMBuffer {\r\n  /**\r\n   * pcm 数据\r\n   * 可同时存放多个 channel 数据\r\n   */\r\n  data: pointer<pointer<uint8>>\r\n  /**\r\n   * data 每一个 channel 的缓冲区大小\r\n   */\r\n  linesize: int32\r\n  /**\r\n   * 当前存放了多少个采样点\r\n   */\r\n  nbSamples: int32\r\n  /**\r\n   * 当前 data 每个 channel 能存放的最大采样点数\r\n   */\r\n  maxnbSamples: int32\r\n  /**\r\n   * 声道数\r\n   */\r\n  channels: int32\r\n  /**\r\n   * 采样率\r\n   */\r\n  sampleRate: int32\r\n  /**\r\n   * pts\r\n   */\r\n  timestamp: int64\r\n  /**\r\n   * 时长\r\n   */\r\n  duration: double\r\n}\r\n\r\n@struct\r\nexport class AVPCMBufferRef extends AVPCMBuffer {\r\n  refCount: atomic_int32\r\n}\r\n\r\nexport interface AVPCMBufferPool {\r\n  alloc: () => pointer<AVPCMBufferRef>\r\n  release: (buffer: pointer<AVPCMBufferRef>) => void\r\n}\r\n","/*\r\n * libmedia Rational defined\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\n@struct\r\nexport class Rational {\r\n  /**\r\n   * 分子\r\n   */\r\n  num: int32 = 1\r\n  /**\r\n   * 分母\r\n   */\r\n  den: int32 = 1\r\n\r\n  constructor(init?: {den: number, num: number}) {\r\n    if (init) {\r\n      this.den = init.den\r\n      this.num = init.num\r\n    }\r\n  }\r\n}\r\n","/*\r\n * libmedia av1 syntax util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport BitReader from 'common/io/BitReader'\r\n\r\nexport function f(bitReader: BitReader, n: number) {\r\n  let x = 0\r\n  for (let i = 0; i < n; i++ ) {\r\n    x = 2 * x + bitReader.readU1()\r\n  }\r\n  return x\r\n}\r\n\r\nexport function uvlc(bitReader: BitReader) {\r\n  let leadingZeros = 0\r\n  while (true) {\r\n    let done = f(bitReader, 1)\r\n    if (done) {\r\n      break\r\n    }\r\n    leadingZeros++\r\n  }\r\n  if (leadingZeros >= 32) {\r\n    return (1 << 32) - 1\r\n  }\r\n  const value =\tf(bitReader, leadingZeros)\r\n  return value + (1 << leadingZeros) - 1\r\n}\r\n\r\nexport function le(bitReader: BitReader, n: number) {\r\n  let t = 0\r\n  for (let i = 0; i < n; i++) {\r\n    let byte = f(bitReader, 8)\r\n    t += (byte << (i * 8))\r\n  }\r\n  return t\r\n}\r\n\r\nexport function leb128(bitReader: BitReader) {\r\n  let value = 0\r\n  let Leb128Bytes = 0\r\n  for (let i = 0; i < 8; i++ ) {\r\n    let leb128Byte_ = f(bitReader, 8)\r\n    value |= ((leb128Byte_ & 0x7f) << (i * 7))\r\n    Leb128Bytes += 1\r\n    if (!(leb128Byte_ & 0x80)) {\r\n      break\r\n    }\r\n  }\r\n  return value\r\n}\r\n\r\nexport function su(bitReader: BitReader, n: number) {\r\n  let value = f(bitReader, n)\r\n  let signMask = 1 << (n - 1)\r\n  if (value & signMask) {\r\n    value = value - 2 * signMask\r\n  }\r\n  return value\r\n}\r\n\r\nexport function ns(bitReader: BitReader, n: number) {\r\n  let w = Math.floor(Math.log2(n)) + 1\r\n  let m = (1 << w) - n\r\n  let v =\tf(bitReader, w - 1)\r\n  if (v < m) {\r\n    return v\r\n  }\r\n  let extraBit =\tf(bitReader, 1)\r\n  return (v << 1) - m + extraBit\r\n}\r\n\r\nexport function L(bitReader: BitReader, n: number) {\r\n  let x = 0\r\n  for (let i = 0 ; i < n; i++ ) {\r\n    x = 2 * x + bitReader.readU1()\r\n  }\r\n  return x\r\n}\r\n\r\nexport function NS(bitReader: BitReader, n: number) {\r\n  let w = Math.floor(Math.log2(n)) + 1\r\n  let m = (1 << w) - n\r\n  let v =\tL(bitReader, w - 1)\r\n  if (v < m) {\r\n    return v\r\n  }\r\n  let extraBit = L(bitReader, 1)\r\n  return (v << 1) - m + extraBit\r\n}\r\n","/*\r\n * libmedia avbuffer util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { avFree, avFreep, avMalloc, avMallocz, avRealloc } from './mem'\r\nimport * as atomics from 'cheap/thread/atomics'\r\nimport { memcpy, memset } from 'cheap/std/memory'\r\nimport { AVBuffer, AVBufferPool, AVBufferRef, AVBufferFlags, BufferPoolEntry } from '../struct/avbuffer'\r\nimport * as mutex from 'cheap/thread/mutex'\r\nimport * as stack from 'cheap/stack'\r\n\r\nconst BUFFER_FLAG_REALLOCATABLE = 1\r\n\r\nconst enum BufferFlags {\r\n  BUFFER_FLAG_REALLOCATABLE = 1,\r\n  BUFFER_FLAG_NO_FREE = 2\r\n}\r\n\r\nexport function bufferCreate(\r\n  buf: pointer<AVBuffer>,\r\n  data: pointer<uint8>,\r\n  size: size,\r\n  free: pointer<(opaque: pointer<void>, data: pointer<uint8>) => void> = nullptr,\r\n  opaque: pointer<void> = nullptr,\r\n  flags: int32 = 0\r\n): pointer<AVBufferRef> {\r\n  buf.data = data\r\n  buf.size = size\r\n  buf.free = free\r\n  buf.opaque = opaque\r\n\r\n  atomics.store(addressof(buf.refcount), 1)\r\n  buf.flags = flags\r\n\r\n  const ref = avMallocz(sizeof(AVBufferRef)) as pointer<AVBufferRef>\r\n\r\n  if (!ref) {\r\n    return nullptr\r\n  }\r\n\r\n  ref.buffer = buf\r\n  ref.data = data\r\n  ref.size = size\r\n  return ref\r\n}\r\n\r\nexport function avbufferCreate(\r\n  data: pointer<uint8>,\r\n  size: size,\r\n  free: pointer<(opaque: pointer<void>, data: pointer<uint8>) => void> = nullptr,\r\n  opaque: pointer<void> = nullptr,\r\n  flags: int32 = 0\r\n): pointer<AVBufferRef> {\r\n  const buf = avMallocz(sizeof(AVBuffer)) as pointer<AVBuffer>\r\n  if (!buf) {\r\n    return nullptr\r\n  }\r\n\r\n  const ref = bufferCreate(buf, data, size, free, opaque, flags)\r\n\r\n  if (!ref) {\r\n    avFree(buf)\r\n    return nullptr\r\n  }\r\n\r\n  return ref\r\n}\r\n\r\nexport function avbufferAlloc(size: size) {\r\n  const data = reinterpret_cast<pointer<uint8>>(avMalloc(size))\r\n  return avbufferCreate(data, size)\r\n}\r\n\r\nexport function avbufferAllocz(size: size) {\r\n  const p = avbufferAlloc(size)\r\n  memset(p.data, 0, size)\r\n  return p\r\n}\r\n\r\nexport function avbufferRef(buf: pointer<AVBufferRef>) {\r\n  const ref: pointer<AVBufferRef> = reinterpret_cast<pointer<AVBufferRef>>(avMallocz(sizeof(AVBufferRef)))\r\n  // @ts-ignore\r\n  accessof(ref) <- accessof(buf)\r\n  atomics.add(addressof(buf.buffer.refcount), 1)\r\n  return ref\r\n}\r\n\r\nexport function bufferReplace(dst: pointer<pointer<AVBufferRef>>, src: pointer<pointer<AVBufferRef>>) {\r\n  const buf = accessof(dst).buffer\r\n  if (src) {\r\n    // @ts-ignore\r\n    accessof(accessof(dst)) <- accessof(accessof(src))\r\n    avFreep(src)\r\n  }\r\n  else {\r\n    avFreep(dst)\r\n  }\r\n  if (atomics.sub(addressof(buf.refcount), 1) === 1) {\r\n    const freeAvbuffer = !(buf.flagsInternal & BufferFlags.BUFFER_FLAG_NO_FREE)\r\n    if (buf.opaque) {\r\n      poolReleaseBuffer(buf.opaque, buf.data)\r\n    }\r\n    else {\r\n      avFree(buf.data)\r\n    }\r\n    if (freeAvbuffer) {\r\n      avFree(buf)\r\n    }\r\n  }\r\n}\r\n\r\nexport function avbufferUnref(buf: pointer<pointer<AVBufferRef>>) {\r\n  if (!buf || !accessof(buf)) {\r\n    return\r\n  }\r\n  bufferReplace(buf, nullptr)\r\n}\r\n\r\nexport function avbufferIsWritable(buf: pointer<AVBufferRef>) {\r\n  if (buf.buffer.flags & AVBufferFlags.READONLY) {\r\n    return 0\r\n  }\r\n  return atomics.load(addressof(buf.buffer.refcount)) === 1 ? 1 : 0\r\n}\r\n\r\nexport function avbufferGetOpaque(buf: pointer<AVBufferRef>) {\r\n  return buf.buffer.opaque\r\n}\r\n\r\nexport function avbufferGetRefCount(buf: pointer<AVBufferRef>) {\r\n  return atomics.load(addressof(buf.buffer.refcount))\r\n}\r\n\r\nexport function avbufferMakeWritable(pbuf: pointer<pointer<AVBufferRef>>) {\r\n\r\n  const buf = accessof(pbuf)\r\n\r\n  if (!buf) {\r\n    return -1\r\n  }\r\n\r\n  if (avbufferIsWritable(buf)) {\r\n    return 0\r\n  }\r\n\r\n  const newbuf = avbufferAlloc(buf.size)\r\n\r\n  memcpy(newbuf.data, buf.data, buf.size)\r\n\r\n  let newbufp = reinterpret_cast<pointer<pointer<AVBufferRef>>>(stack.malloc(sizeof(pointer)))\r\n  accessof(newbufp) <- newbuf\r\n\r\n  bufferReplace(pbuf, newbufp)\r\n\r\n  stack.free(sizeof(pointer))\r\n\r\n  return 0\r\n}\r\n\r\nexport function avbufferReplace(pdst: pointer<pointer<AVBufferRef>>, src: pointer<AVBufferRef>) {\r\n  const dst = accessof(pdst)\r\n\r\n  if (!src) {\r\n    avbufferUnref(pdst)\r\n    return 0\r\n  }\r\n\r\n  if (dst && dst.data === src.data) {\r\n    dst.data = src.data\r\n    dst.size = src.size\r\n    return 0\r\n  }\r\n\r\n  const tmp = avbufferRef(src)\r\n\r\n  avbufferUnref(pdst)\r\n\r\n  accessof(pdst) <- tmp\r\n\r\n  return 0\r\n}\r\n\r\nexport function avbufferRealloc(pdst: pointer<pointer<AVBufferRef>>, size: size) {\r\n  if (!accessof(pdst)) {\r\n    const data = reinterpret_cast<pointer<uint8>>(avRealloc(nullptr, size))\r\n\r\n    const buf = avbufferCreate(data, size)\r\n\r\n    accessof(pdst) <- buf\r\n\r\n    buf.buffer.flagsInternal |= BUFFER_FLAG_REALLOCATABLE\r\n\r\n    return 0\r\n  }\r\n\r\n  const ref = accessof(pdst)\r\n  const buf = ref.buffer\r\n\r\n  if (ref.size === size) {\r\n    return 0\r\n  }\r\n\r\n  if (!(buf.flagsInternal & BUFFER_FLAG_REALLOCATABLE)\r\n    || !avbufferIsWritable(ref)\r\n    || ref.data !== buf.data\r\n  ) {\r\n    let newRef = reinterpret_cast<pointer<pointer<AVBufferRef>>>(stack.malloc(sizeof(pointer)))\r\n    accessof(newRef) <- nullptr\r\n\r\n    const ret = avbufferRealloc(newRef, size)\r\n    if (ret < 0) {\r\n      stack.free(sizeof(pointer))\r\n      return ret\r\n    }\r\n    memcpy(accessof(newRef).data, buf.data, Math.min(size, buf.size))\r\n\r\n    bufferReplace(pdst, newRef)\r\n\r\n    stack.free(sizeof(pointer))\r\n    return 0\r\n  }\r\n\r\n  const tmp = reinterpret_cast<pointer<uint8>>(avRealloc(buf.data, size))\r\n\r\n  ref.data = buf.data = tmp\r\n  ref.size = buf.size = size\r\n\r\n  return 0\r\n}\r\n\r\nexport function bufferPoolFlush(pool: pointer<AVBufferPool>) {\r\n  while (pool.pool) {\r\n    const buf = reinterpret_cast<pointer<BufferPoolEntry>>(pool.pool)\r\n    pool.pool = buf.next\r\n\r\n    if (buf.opaque) {\r\n      poolReleaseBuffer(buf.opaque, buf.data)\r\n    }\r\n    else {\r\n      avFree(buf.data)\r\n    }\r\n    avFree(buf)\r\n  }\r\n}\r\n\r\nexport function bufferPoolFree(pool: pointer<AVBufferPool>) {\r\n  bufferPoolFlush(pool)\r\n\r\n  mutex.destroy(addressof(pool.mutex))\r\n\r\n  avFree(pool)\r\n}\r\n\r\nexport function poolReleaseBuffer(opaque: pointer<void>, data: pointer<void>) {\r\n  const buf = reinterpret_cast<pointer<BufferPoolEntry>>(opaque)\r\n  const pool = buf.pool\r\n\r\n  mutex.lock(addressof(pool.mutex))\r\n\r\n  buf.next = pool.pool\r\n  pool.pool = buf\r\n\r\n  mutex.unlock(addressof(pool.mutex))\r\n\r\n  if (atomics.sub(addressof(pool.refcount), 1) === 1) {\r\n    bufferPoolFree(pool)\r\n  }\r\n}\r\n","/*\r\n * libmedia avdict util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { readCString, writeCString } from 'cheap/std/memory'\r\nimport { AVDictFlags, AVDictionary, AVDictionaryEntry } from '../struct/avdict'\r\nimport { avFreep } from './mem'\r\n\r\nexport function freeAVDict(pm: pointer<pointer<AVDictionary>>) {\r\n  freeAVDict2(accessof(pm))\r\n  avFreep(pm)\r\n}\r\n\r\nexport function freeAVDict2(m: pointer<AVDictionary>) {\r\n  if (m) {\r\n    while (m.count--) {\r\n      avFreep(addressof(m.elems[m.count].key))\r\n      avFreep(addressof(m.elems[m.count].value))\r\n    }\r\n    avFreep(addressof(m.elems))\r\n  }\r\n}\r\n\r\nexport function avDictCount(m: pointer<AVDictionary>) {\r\n  return m ? m.count : 0\r\n}\r\n\r\nexport function avDictIterate(m: pointer<AVDictionary>, prev: pointer<AVDictionaryEntry>): pointer<AVDictionaryEntry> {\r\n\r\n  let i = 0\r\n  if (!m) {\r\n    return nullptr\r\n  }\r\n  if (prev) {\r\n    i = prev - m.elems + 1\r\n  }\r\n\r\n  assert(i >= 0)\r\n\r\n  if (i >= m.count) {\r\n    return nullptr\r\n  }\r\n  return addressof(m.elems[i])\r\n}\r\n\r\nexport function avDictGet(m: pointer<AVDictionary>, key: string, prev: pointer<AVDictionaryEntry> = nullptr, flags: int32 = 0): pointer<AVDictionaryEntry> {\r\n\r\n  if (!m) {\r\n    return nullptr\r\n  }\r\n\r\n  let entry: pointer<AVDictionaryEntry> = prev\r\n\r\n  if (!key) {\r\n    return nullptr\r\n  }\r\n\r\n  while ((entry = avDictIterate(m, entry))) {\r\n    let s = readCString(entry.key)\r\n    if (flags & AVDictFlags.MATCH_CASE) {\r\n      s.toLocaleLowerCase()\r\n      key.toLocaleLowerCase()\r\n    }\r\n    if (s === key\r\n      || (\r\n        (flags & AVDictFlags.IGNORE_SUFFIX)\r\n        && s.indexOf(key) === 0\r\n      )\r\n    ) {\r\n      return entry\r\n    }\r\n  }\r\n}\r\n\r\nexport function avDictSet(m: pointer<AVDictionary>, key: string, value: string, flags: int32 = 0) {\r\n  if (!m) {\r\n    throw new Error('m is nullptr')\r\n  }\r\n\r\n  let tag: pointer<AVDictionaryEntry> = nullptr\r\n\r\n  if (flags & AVDictFlags.MULTIKEY) {\r\n    tag = avDictGet(m, key, nullptr, flags)\r\n  }\r\n\r\n  if (tag) {\r\n    if (flags & AVDictFlags.DONT_OVERWRITE) {\r\n      return 0\r\n    }\r\n    if (flags & AVDictFlags.APPEND) {\r\n      value = `${readCString(tag.value)},${value}`\r\n    }\r\n    free(tag.value)\r\n    tag.value = malloc(value.length + 1)\r\n    writeCString(tag.value, value, value.length)\r\n  }\r\n  else {\r\n    let tmp: pointer<AVDictionaryEntry> = realloc(m.elems, (m.count + 1) * sizeof(AVDictionaryEntry))\r\n    m.elems = tmp\r\n\r\n    m.elems[m.count].key = malloc(key.length + 1)\r\n    m.elems[m.count].value = malloc(value.length + 1)\r\n\r\n    writeCString(m.elems[m.count].key, key, key.length)\r\n    writeCString(m.elems[m.count].value, value, value.length)\r\n\r\n    m.count++\r\n  }\r\n\r\n  return 0\r\n}\r\n\r\nexport function avDictCopy(dst: pointer<AVDictionary>, src: pointer<AVDictionary>, flags: int32) {\r\n  if (!dst || !src) {\r\n    return -1\r\n  }\r\n\r\n  let t: pointer<AVDictionaryEntry> = nullptr\r\n\r\n  while ((t = avDictIterate(src, t))) {\r\n    let ret = avDictSet(dst, readCString(t.key), readCString(t.value), flags)\r\n    if (ret < 0) {\r\n      return ret\r\n    }\r\n  }\r\n\r\n  return 0\r\n}\r\n","/*\r\n * libmedia avframe util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVFrame, { AVFrameSideData, AVFrameSideDataType, AV_NUM_DATA_POINTERS } from '../struct/avframe'\r\nimport { avFree, avFreep, avMalloc, avMallocz } from './mem'\r\nimport { memcpy, memset } from 'cheap/std/memory'\r\nimport { INT32_MAX, NOPTS_VALUE_BIGINT } from '../constant'\r\nimport { AVChromaLocation, AVColorPrimaries, AVColorRange, AVColorSpace, AVColorTransferCharacteristic } from '../pixfmt'\r\nimport { avbufferAlloc, avbufferRef, avbufferReplace, avbufferUnref } from './avbuffer'\r\nimport { freeAVDict } from './avdict'\r\nimport { INVALID_ARGUMENT, NO_MEMORY } from '../error'\r\nimport { getChannelLayoutNBChannels } from './channel'\r\nimport { sampleFormatGetLinesize, sampleFormatIsPlanar } from './sample'\r\nimport { AVBufferRef } from '../struct/avbuffer'\r\nimport * as errorType from '../error'\r\nimport { PixelFormatDescriptorsMap } from '../pixelFormatDescriptor'\r\nimport * as stack from 'cheap/stack'\r\nimport { pixelFillLinesizes, pixelFillPlaneSizes, pixelFillPointer } from './pixel'\r\nimport alignFunc from 'common/math/align'\r\n\r\nexport function createAVFrame(): pointer<AVFrame> {\r\n  const frame: pointer<AVFrame> = avMallocz(sizeof(AVFrame))\r\n  getAVFrameDefault(frame)\r\n  return frame\r\n}\r\n\r\nexport function destroyAVFrame(frame: pointer<AVFrame>) {\r\n  unrefAVFrame(frame)\r\n  avFree(frame)\r\n}\r\n\r\nexport function freeSideData(ptr: pointer<pointer<AVFrameSideData>>) {\r\n  const sideData = accessof(ptr)\r\n  avbufferUnref(addressof(sideData.buf))\r\n  freeAVDict(addressof(sideData.metadata))\r\n  avFreep(ptr)\r\n}\r\n\r\nexport function wipeSideData(frame: pointer<AVFrame>) {\r\n  for (let i = 0; i < frame.nbSideData; i++) {\r\n    freeSideData(addressof(frame.sideData[i]))\r\n  }\r\n  frame.nbSideData = 0\r\n  avFreep(reinterpret_cast<pointer<pointer<void>>>(addressof(frame.sideData)))\r\n}\r\n\r\nexport function getAVFrameSideData(frame: pointer<AVFrame>, type: AVFrameSideDataType): pointer<AVFrameSideData> {\r\n  for (let i = 0; i < frame.nbSideData; i++) {\r\n    if (frame.sideData[i].type === type) {\r\n      return frame.sideData[i]\r\n    }\r\n  }\r\n  return nullptr\r\n}\r\n\r\nexport function getAVFrameDefault(frame: pointer<AVFrame>) {\r\n  if (frame.extendedData !== addressof(frame.data)) {\r\n    avFreep(reinterpret_cast<pointer<pointer<void>>>(addressof(frame.extendedData)))\r\n  }\r\n\r\n  memset(frame, 0, sizeof(AVFrame))\r\n\r\n  frame.pts = NOPTS_VALUE_BIGINT\r\n  frame.pktDts = NOPTS_VALUE_BIGINT\r\n  frame.bestEffortTimestamp = NOPTS_VALUE_BIGINT\r\n\r\n  if (defined(API_FRAME_PKT)) {\r\n    frame.pktPos = NOPTS_VALUE_BIGINT\r\n    frame.pktSize = -1\r\n  }\r\n  if (defined(API_FRAME_KEY)) {\r\n    frame.keyFrame = 1\r\n  }\r\n\r\n  frame.sampleAspectRatio.num = 0\r\n  frame.sampleAspectRatio.den = 1\r\n  frame.format = -1\r\n  frame.extendedData = addressof(frame.data)\r\n  frame.colorPrimaries = AVColorPrimaries.AVCOL_PRI_UNSPECIFIED\r\n  frame.colorTrc = AVColorTransferCharacteristic.AVCOL_TRC_UNSPECIFIED\r\n  frame.colorSpace = AVColorSpace.AVCOL_SPC_UNSPECIFIED\r\n  frame.colorRange = AVColorRange.AVCOL_RANGE_UNSPECIFIED\r\n  frame.chromaLocation = AVChromaLocation.AVCHROMA_LOC_UNSPECIFIED\r\n  frame.flags = 0\r\n}\r\n\r\nexport function getVideoBuffer(frame: pointer<AVFrame>, algin: int32 = 0) {\r\n  const desc = PixelFormatDescriptorsMap[frame.format]\r\n\r\n  if (!desc) {\r\n    return errorType.INVALID_ARGUMENT\r\n  }\r\n\r\n  const linesizes = reinterpret_cast<pointer<int32>>(stack.malloc(sizeof(int32) * 4))\r\n  const sizes = reinterpret_cast<pointer<size>>(stack.malloc(sizeof(size) * 4))\r\n\r\n  const planePadding = Math.max(16 + 16, algin)\r\n  let ret = 0\r\n\r\n  if (!frame.linesize[0]) {\r\n    if (algin <= 0) {\r\n      algin = 32\r\n    }\r\n\r\n    for (let i = 1; i < algin; i += i) {\r\n      ret = pixelFillLinesizes(addressof(frame.linesize), frame.format, alignFunc(frame.width, i))\r\n\r\n      if (ret < 0) {\r\n        defer()\r\n        return ret\r\n      }\r\n\r\n      if (!(frame.linesize[0] & (algin - 1))) {\r\n        break\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < 4 && frame.linesize[i]; i++) {\r\n      frame.linesize[i] = alignFunc(frame.linesize[i], algin)\r\n    }\r\n  }\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    linesizes[i] = frame.linesize[i]\r\n  }\r\n\r\n  const paddingHeight = alignFunc(frame.height, 32)\r\n\r\n  if ((ret = pixelFillPlaneSizes(sizes, frame.format, paddingHeight, linesizes)) < 0) {\r\n    defer()\r\n    return ret\r\n  }\r\n\r\n  let totalSize = 4 * planePadding\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    if (sizes[i] > INT32_MAX - totalSize) {\r\n      errorType.INVALID_ARGUMENT\r\n    }\r\n    totalSize += sizes[i]\r\n  }\r\n\r\n  frame.buf[0] = avbufferAlloc(totalSize)\r\n\r\n  if (!frame.buf[0]) {\r\n    unrefAVFrame(frame)\r\n    defer()\r\n    return errorType.NO_MEMORY\r\n  }\r\n\r\n  if ((ret = pixelFillPointer(addressof(frame.data), frame.format, paddingHeight, frame.buf[0].data, linesizes)) < 0) {\r\n    unrefAVFrame(frame)\r\n    defer()\r\n    return ret\r\n  }\r\n\r\n  for (let i = 1; i < 4; i++) {\r\n    if (frame.data[i]) {\r\n      frame.data[i] = reinterpret_cast<pointer<uint8>>(frame.data[i] + i * planePadding)\r\n    }\r\n  }\r\n\r\n  frame.extendedData = addressof(frame.data)\r\n\r\n  defer()\r\n  return 0\r\n\r\n  function defer() {\r\n    stack.free(sizeof(int32) * 4)\r\n    stack.free(sizeof(size) * 4)\r\n  }\r\n}\r\n\r\nexport function getAudioBuffer(frame: pointer<AVFrame>, algin?: int32) {\r\n  const planar = sampleFormatIsPlanar(frame.format)\r\n  const channels = frame.chLayout.nbChannels\r\n  const planes = planar ? channels : 1\r\n\r\n  let ret = 0\r\n\r\n  if (!frame.linesize[0]) {\r\n    ret = sampleFormatGetLinesize(frame.format, channels, frame.nbSamples, algin)\r\n\r\n    if (ret < 0) {\r\n      return ret\r\n    }\r\n    frame.linesize[0] = ret\r\n  }\r\n\r\n  if (planes > AV_NUM_DATA_POINTERS) {\r\n    frame.extendedData = reinterpret_cast<pointer<pointer<uint8>>>(avMalloc(planes * sizeof(accessof(frame.extendedData))))\r\n    frame.extendedBuf = reinterpret_cast<pointer<pointer<AVBufferRef>>>(avMalloc(planes * sizeof(accessof(frame.extendedBuf))))\r\n\r\n    if (!frame.extendedBuf || !frame.extendedData) {\r\n      avFreep(reinterpret_cast<pointer<pointer<uint8>>>(addressof(frame.extendedData)))\r\n      avFreep(reinterpret_cast<pointer<pointer<uint8>>>(addressof(frame.extendedBuf)))\r\n      return errorType.NO_MEMORY\r\n    }\r\n    frame.nbExtendedBuf = planes - AV_NUM_DATA_POINTERS\r\n  }\r\n  else {\r\n    frame.extendedData = addressof(frame.data)\r\n  }\r\n\r\n  for (let i = 0; i < Math.min(planes, AV_NUM_DATA_POINTERS); i++) {\r\n    frame.buf[i] = avbufferAlloc(frame.linesize[0])\r\n    if (!frame.buf[i]) {\r\n      unrefAVFrame(frame)\r\n      return errorType.NO_MEMORY\r\n    }\r\n    frame.extendedData[i] = frame.data[i] = frame.buf[i].data\r\n  }\r\n\r\n  for (let i = 0; i < planes - AV_NUM_DATA_POINTERS; i++) {\r\n    frame.extendedBuf[i] = avbufferAlloc(frame.linesize[0])\r\n    if (!frame.extendedBuf[i]) {\r\n      unrefAVFrame(frame)\r\n      return errorType.NO_MEMORY\r\n    }\r\n    frame.extendedData[i + AV_NUM_DATA_POINTERS] = frame.extendedBuf[i].data\r\n  }\r\n}\r\n\r\nexport function getBuffer(frame: pointer<AVFrame>, algin?: int32) {\r\n  if (frame.format < 0) {\r\n    return INVALID_ARGUMENT\r\n  }\r\n\r\n  if (frame.width > 0 && frame.height > 0) {\r\n    return getVideoBuffer(frame, algin)\r\n  }\r\n  else if (frame.nbSamples > 0 && (frame.chLayout.u.mask || frame.chLayout.nbChannels > 0)) {\r\n    return getAudioBuffer(frame, algin)\r\n  }\r\n\r\n  return INVALID_ARGUMENT\r\n}\r\n\r\nexport function refAVFrame(dst: pointer<AVFrame>, src: pointer<AVFrame>) {\r\n  dst.format = src.format\r\n  dst.width = src.width\r\n  dst.height = src.height\r\n\r\n  dst.chLayout = src.chLayout\r\n\r\n  dst.nbSamples = src.nbSamples\r\n\r\n  let ret = copyAVFrameProps(dst, src)\r\n  if (ret < 0) {\r\n    return ret\r\n  }\r\n\r\n  if (!src.buf[0]) {\r\n    for (let i = 0; i < sizeof(src.data) / sizeof(src.data[0]); i++) {\r\n      if (!src.data[i] || !src.linesize[i]) {\r\n        continue\r\n      }\r\n      let size = src.linesize[i] * sizeof(accessof(src.data[0]))\r\n\r\n      dst.data[i] = avMalloc(size)\r\n      if (!dst.data[i]) {\r\n        unrefAVFrame(dst)\r\n        return NO_MEMORY\r\n      }\r\n      memcpy(dst.data[i], src.data[i], size)\r\n    }\r\n    return 0\r\n  }\r\n\r\n  for (let i = 0; i < sizeof(src.buf) / sizeof(src.buf[0]); i++) {\r\n    if (!src.buf[i]) {\r\n      continue\r\n    }\r\n    dst.buf[i] = avbufferRef(src.buf[i])\r\n    if (!dst.buf[i]) {\r\n      unrefAVFrame(dst)\r\n      return NO_MEMORY\r\n    }\r\n  }\r\n\r\n  if (src.extendedBuf) {\r\n    dst.extendedBuf = reinterpret_cast<pointer<pointer<void>>>(avMallocz(sizeof(accessof(dst.extendedBuf)) * src.nbExtendedBuf))\r\n    if (!dst.extendedBuf) {\r\n      unrefAVFrame(dst)\r\n      return NO_MEMORY\r\n    }\r\n    dst.nbExtendedBuf = src.nbExtendedBuf\r\n\r\n    for (let i = 0; i < src.nbExtendedBuf; i++) {\r\n      dst.extendedBuf[i] = avbufferRef(src.extendedBuf[i])\r\n      if (!dst.extendedBuf[i]) {\r\n        unrefAVFrame(dst)\r\n        return NO_MEMORY\r\n      }\r\n    }\r\n  }\r\n\r\n  if (src.extendedData !== addressof(src.data)) {\r\n    let ch = src.chLayout.nbChannels\r\n    if (!ch) {\r\n      unrefAVFrame(dst)\r\n      return INVALID_ARGUMENT\r\n    }\r\n\r\n    assert(!src.chLayout.u.mask || src.chLayout.nbChannels == getChannelLayoutNBChannels(src.chLayout.u.mask))\r\n\r\n    dst.extendedData = reinterpret_cast<pointer<pointer<void>>>(avMallocz(sizeof(accessof(dst.extendedData)) * ch))\r\n    if (!dst.extendedData) {\r\n      unrefAVFrame(dst)\r\n      return NO_MEMORY\r\n    }\r\n\r\n    memcpy(dst.extendedData, src.extendedData, sizeof(accessof(dst.extendedData)) * ch)\r\n  }\r\n  else {\r\n    dst.extendedData = addressof(dst.data)\r\n  }\r\n\r\n  memcpy(addressof(dst.data), addressof(src.data), sizeof(src.data))\r\n  memcpy(addressof(dst.linesize), addressof(src.linesize), sizeof(src.linesize))\r\n\r\n  return 0\r\n}\r\n\r\nexport function unrefAVFrame(frame: pointer<AVFrame>) {\r\n  wipeSideData(frame)\r\n\r\n  for (let i = 0; i < (sizeof(frame.buf) / sizeof(frame.buf[0])); i++) {\r\n    avbufferUnref(addressof(frame.buf[i]))\r\n  }\r\n  for (let i = 0; i < frame.nbExtendedBuf; i++) {\r\n    avbufferUnref(addressof(frame.extendedBuf[i]))\r\n  }\r\n\r\n  avFreep(reinterpret_cast<pointer<pointer<void>>>(addressof(frame.extendedBuf)))\r\n  freeAVDict(addressof(frame.metadata))\r\n  avbufferUnref(addressof(frame.hwFramesCtx))\r\n  avbufferUnref(addressof(frame.opaqueRef))\r\n  avbufferUnref(addressof(frame.privateRef))\r\n\r\n  getAVFrameDefault(frame)\r\n\r\n}\r\n\r\nexport function copyAVFrameProps(dst: pointer<AVFrame>, src: pointer<AVFrame>) {\r\n  if (defined(API_FRAME_KEY)) {\r\n    dst.keyFrame = src.keyFrame\r\n  }\r\n  dst.pictType = src.pictType\r\n  dst.sampleAspectRatio = src.sampleAspectRatio\r\n  dst.cropTop = src.cropTop\r\n  dst.cropBottom = src.cropBottom\r\n  dst.cropLeft = src.cropLeft\r\n  dst.cropRight = src.cropRight\r\n  dst.pts = src.pts\r\n  dst.repeatPict = src.repeatPict\r\n  if (defined(API_INTERLACED_FRAME)) {\r\n    dst.interlacedFrame = src.interlacedFrame\r\n    dst.topFieldFirst = src.topFieldFirst\r\n  }\r\n  if (defined(API_PALETTE_HAS_CHANGED)) {\r\n    dst.paletteHasChanged = src.paletteHasChanged\r\n  }\r\n  dst.sampleRate = src.sampleRate\r\n  dst.opaque = src.opaque\r\n  dst.pktDts = src.pktDts\r\n  if (defined(API_FRAME_PKT)) {\r\n    dst.pktPos = src.pktPos\r\n    dst.pktSize = src.pktSize\r\n  }\r\n  dst.quality = src.quality\r\n  dst.bestEffortTimestamp = src.bestEffortTimestamp\r\n\r\n  dst.flags = src.flags\r\n  dst.decodeErrorFlags = src.decodeErrorFlags\r\n  dst.colorPrimaries = src.colorPrimaries\r\n  dst.colorTrc = src.colorTrc\r\n  dst.colorSpace = src.colorSpace\r\n  dst.colorRange = src.colorRange\r\n  dst.chromaLocation = src.chromaLocation\r\n\r\n  let ret = avbufferReplace(addressof(dst.opaqueRef), src.opaqueRef)\r\n  ret |= avbufferReplace(addressof(dst.privateRef), src.privateRef)\r\n\r\n  return ret\r\n}\r\n\r\nexport function cloneAVFrame(frame: pointer<AVFrame>) {\r\n  const ret = createAVFrame()\r\n\r\n  refAVFrame(ret, frame)\r\n\r\n  return ret\r\n}\r\n","/*\r\n * libmedia avpacket util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVPacket, { AVPacketSideData } from '../struct/avpacket'\r\nimport { memcpy, memset, mapUint8Array, mapSafeUint8Array } from 'cheap/std/memory'\r\nimport { AVPacketSideDataType } from '../codec'\r\nimport { avFree, avFreep, avMalloc, avMallocz } from './mem'\r\nimport { AV_TIME_BASE, NOPTS_VALUE, NOPTS_VALUE_BIGINT } from '../constant'\r\nimport { avbufferCreate, avbufferRealloc, avbufferRef, avbufferReplace, avbufferUnref } from './avbuffer'\r\nimport { AVBufferRef } from '../struct/avbuffer'\r\nimport SafeUint8Array from 'cheap/std/buffer/SafeUint8Array'\r\n\r\nconst AV_INPUT_BUFFER_PADDING_SIZE = 64\r\n\r\nexport function getAVPacketData(avpacket: pointer<AVPacket>): Uint8Array\r\nexport function getAVPacketData(avpacket: pointer<AVPacket>, safe: boolean): SafeUint8Array\r\nexport function getAVPacketData(avpacket: pointer<AVPacket>, safe?: boolean) {\r\n  return safe ? mapSafeUint8Array(avpacket.data, avpacket.size) : mapUint8Array(avpacket.data, avpacket.size)\r\n}\r\n\r\nexport function initAVPacketData(avpacket: pointer<AVPacket>, length: size) {\r\n  avpacket.data = avMalloc(length)\r\n  avpacket.size = length\r\n  return mapUint8Array(avpacket.data, avpacket.size)\r\n}\r\n\r\nexport function getAVPacketSideData(avpacket: pointer<AVPacket>, type: AVPacketSideDataType): pointer<AVPacketSideData> {\r\n  for (let i = 0; i < avpacket.sideDataElems; i++) {\r\n    if (avpacket.sideData[i].type === type) {\r\n      return addressof(avpacket.sideData[i])\r\n    }\r\n  }\r\n  return nullptr\r\n}\r\n\r\nexport function hasAVPacketSideData(avpacket: pointer<AVPacket>, type: AVPacketSideDataType) {\r\n  for (let i = 0; i < avpacket.sideDataElems; i++) {\r\n    if (avpacket.sideData[i].type === type) {\r\n      return true\r\n    }\r\n  }\r\n  return false\r\n}\r\n\r\nexport function addSideData(psd: pointer<pointer<AVPacketSideData>>, pnbSd: pointer<int32>, type: AVPacketSideDataType, data: pointer<void>, length: size) {\r\n  const sideDataElems = accessof(pnbSd)\r\n  const sideData = accessof(psd)\r\n  for (let i = 0; i < sideDataElems; i++) {\r\n    if (sideData[i].type === type) {\r\n      avFree(sideData[i].data)\r\n      sideData[i].data = data\r\n      sideData[i].size = length\r\n      return\r\n    }\r\n  }\r\n  const len = (sideDataElems + 1) * sizeof(AVPacketSideData)\r\n  const newSideData = avMallocz(len) as pointer<AVPacketSideData>\r\n\r\n  if (sideDataElems) {\r\n    for (let i = 0; i < sideDataElems; i++) {\r\n      newSideData[i] = sideData[i]\r\n    }\r\n  }\r\n\r\n  const ele = addressof(newSideData[sideDataElems])\r\n  ele.data = data\r\n  ele.type = type\r\n  ele.size = length\r\n\r\n  if (sideData) {\r\n    avFree(sideData)\r\n  }\r\n\r\n  accessof(psd) <- newSideData\r\n  accessof(pnbSd) <- reinterpret_cast<int32>(sideDataElems + 1)\r\n\r\n  return ele\r\n}\r\n\r\nexport function newSideData(psd: pointer<pointer<AVPacketSideData>>, pnbSd: pointer<int32>, type: AVPacketSideDataType, size: size) {\r\n  const data = avMalloc(size + AV_INPUT_BUFFER_PADDING_SIZE)\r\n  memset(reinterpret_cast<pointer<uint8>>(data + size), 0, AV_INPUT_BUFFER_PADDING_SIZE)\r\n  return addSideData(psd, pnbSd, type, data, size)\r\n}\r\n\r\nexport function addAVPacketSideData(avpacket: pointer<AVPacket>, type: AVPacketSideDataType, data: pointer<void>, length: size) {\r\n  addSideData(addressof(avpacket.sideData), addressof(avpacket.sideDataElems), type, data, length)\r\n}\r\n\r\nexport function deleteAVPacketSideData(avpacket: pointer<AVPacket>, type: AVPacketSideDataType) {\r\n  let index = -1\r\n  for (let i = 0; i < avpacket.sideDataElems; i++) {\r\n    if (avpacket.sideData[i].type === type) {\r\n      index = i\r\n      break\r\n    }\r\n  }\r\n  if (index > -1) {\r\n    if (avpacket.sideDataElems === 1) {\r\n      avFree(avpacket.sideData[0].data)\r\n      avFree(avpacket.sideData)\r\n      avpacket.sideData = nullptr\r\n      avpacket.sideDataElems = 0\r\n    }\r\n    else {\r\n      const len = (avpacket.sideDataElems - 1) * sizeof(AVPacketSideData)\r\n      const sideData = avMallocz(len) as pointer<AVPacketSideData>\r\n      for (let i = 0; i < avpacket.sideDataElems; i++) {\r\n        if (i !== index) {\r\n          sideData[i] = avpacket.sideData[i]\r\n        }\r\n        else {\r\n          avFree(avpacket.sideData[i].data)\r\n        }\r\n      }\r\n      avFree(avpacket.sideData)\r\n      avpacket.sideData = sideData\r\n      avpacket.sideDataElems--\r\n    }\r\n  }\r\n}\r\n\r\nexport function createAVPacket(): pointer<AVPacket> {\r\n  const avpacket: pointer<AVPacket> = avMallocz(sizeof(AVPacket))\r\n  getAVPacketDefault(avpacket)\r\n  return avpacket\r\n}\r\n\r\nexport function destroyAVPacket(avpacket: pointer<AVPacket>) {\r\n  unrefAVPacket(avpacket)\r\n  avFree(avpacket)\r\n}\r\n\r\nexport function freeAVPacketSideData(pSideData: pointer<pointer<AVPacketSideData>>, pnbSideData: pointer<int32>) {\r\n\r\n  const sideData = accessof(pSideData)\r\n  const nbSideData = accessof(pnbSideData)\r\n\r\n  if (sideData) {\r\n    for (let i = 0; i < nbSideData; i++) {\r\n      avFree(sideData[i].data)\r\n    }\r\n    avFreep(pSideData)\r\n    accessof(pnbSideData) <- static_cast<int32>(0)\r\n  }\r\n}\r\n\r\nexport function getAVPacketDefault(avpacket: pointer<AVPacket>) {\r\n  avpacket.data = nullptr\r\n  avpacket.size = 0\r\n  avpacket.sideData = nullptr\r\n  avpacket.sideDataElems = 0\r\n  avpacket.streamIndex = NOPTS_VALUE\r\n  avpacket.pos = NOPTS_VALUE_BIGINT\r\n  avpacket.duration = NOPTS_VALUE_BIGINT\r\n  avpacket.flags = 0\r\n  avpacket.dts = NOPTS_VALUE_BIGINT\r\n  avpacket.pts = NOPTS_VALUE_BIGINT\r\n  avpacket.timeBase.den = AV_TIME_BASE\r\n  avpacket.timeBase.num = 1\r\n  avpacket.bitFormat = 0\r\n\r\n  avpacket.buf = nullptr\r\n}\r\n\r\nexport function copyAVPacketSideData(dst: pointer<AVPacket>, src: pointer<AVPacket>) {\r\n  freeAVPacketSideData(addressof(dst.sideData), addressof(dst.sideDataElems))\r\n  if (src.sideDataElems) {\r\n    let size = sizeof(AVPacketSideData)\r\n    dst.sideData = avMallocz(size * src.sideDataElems)\r\n    for (let i = 0; i < src.sideDataElems; i++) {\r\n      dst.sideData[i].size = src.sideData[i].size\r\n      dst.sideData[i].type = src.sideData[i].type\r\n      dst.sideData[i].data = avMalloc(src.sideData[i].size)\r\n      memcpy(dst.sideData[i].data, src.sideData[i].data, src.sideData[i].size)\r\n    }\r\n    dst.sideDataElems = src.sideDataElems\r\n  }\r\n}\r\n\r\nexport function copyAVPacketProps(dst: pointer<AVPacket>, src: pointer<AVPacket>) {\r\n  dst.streamIndex = src.streamIndex\r\n  dst.pos = src.pos\r\n  dst.duration = src.duration\r\n  dst.flags = src.flags\r\n  dst.dts = src.dts\r\n  dst.pts = src.pts\r\n  dst.opaque = src.opaque\r\n  dst.timeBase.den = src.timeBase.den\r\n  dst.timeBase.num = src.timeBase.num\r\n  dst.bitFormat = src.bitFormat\r\n\r\n  dst.opaqueRef = nullptr\r\n\r\n  avbufferReplace(addressof(dst.opaqueRef), src.opaqueRef)\r\n\r\n  copyAVPacketSideData(dst, src)\r\n\r\n  return 0\r\n}\r\n\r\nfunction allocAVPacket(buf: pointer<pointer<AVBufferRef>>, size: size) {\r\n  avbufferRealloc(buf, size + AV_INPUT_BUFFER_PADDING_SIZE)\r\n  memset(accessof(buf).data + size, 0, AV_INPUT_BUFFER_PADDING_SIZE)\r\n  return 0\r\n}\r\n\r\nexport function refAVPacket(dst: pointer<AVPacket>, src: pointer<AVPacket>) {\r\n  if (dst.buf) {\r\n    avbufferUnref(addressof(dst.buf))\r\n  }\r\n  dst.buf = nullptr\r\n  copyAVPacketProps(dst, src)\r\n\r\n  if (!src.buf && src.size) {\r\n    allocAVPacket(addressof(dst.buf), src.size)\r\n    if (src.size) {\r\n      memcpy(dst.buf.data, src.data, src.size)\r\n    }\r\n    dst.data = dst.buf.data\r\n  }\r\n  else if (src.buf) {\r\n    dst.buf = avbufferRef(src.buf)\r\n    dst.data = src.data\r\n  }\r\n  dst.size = src.size\r\n\r\n  return 0\r\n}\r\n\r\nexport function unrefAVPacket(avpacket: pointer<AVPacket>) {\r\n  freeAVPacketSideData(addressof(avpacket.sideData), addressof(avpacket.sideDataElems))\r\n  avbufferUnref(addressof(avpacket.opaqueRef))\r\n\r\n  if (avpacket.buf) {\r\n    avbufferUnref(addressof(avpacket.buf))\r\n  }\r\n  else if (avpacket.data) {\r\n    avFree(avpacket.data)\r\n  }\r\n  getAVPacketDefault(avpacket)\r\n}\r\n\r\nexport function copyAVPacketData(dst: pointer<AVPacket>, src: pointer<AVPacket>) {\r\n  if (dst.buf) {\r\n    avbufferUnref(addressof(dst.buf))\r\n  }\r\n  dst.buf = nullptr\r\n  if (!src.buf && src.size) {\r\n    allocAVPacket(addressof(dst.buf), src.size)\r\n    if (src.size) {\r\n      memcpy(dst.buf.data, src.data, src.size)\r\n    }\r\n    dst.data = dst.buf.data\r\n  }\r\n  else if (src.buf) {\r\n    dst.buf = avbufferRef(src.buf)\r\n    dst.data = src.data\r\n  }\r\n  dst.size = src.size\r\n}\r\n\r\nexport function addAVPacketData(avpacket: pointer<AVPacket>, data: pointer<uint8>, size: size) {\r\n\r\n  if (avpacket.buf) {\r\n    avbufferUnref(addressof(avpacket.buf))\r\n  }\r\n  else if (avpacket.data) {\r\n    avFree(avpacket.data)\r\n  }\r\n\r\n  avpacket.buf = avbufferCreate(data, size + AV_INPUT_BUFFER_PADDING_SIZE)\r\n  avpacket.data = data\r\n  avpacket.size = size\r\n}\r\n","/*\r\n * libmedia channel util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVChannelLayout } from '../struct/audiosample'\r\nimport { popCount64 } from './common'\r\nimport { AVChannelOrder } from '../audiosamplefmt'\r\nimport { avFreep } from './mem'\r\nimport { memset } from 'cheap/std/memory'\r\nimport * as error from '../error'\r\n\r\nexport function getChannelLayoutNBChannels(layout: uint64) {\r\n  return popCount64(layout)\r\n}\r\n\r\nexport function unInitChannelLayout(channelLayout: pointer<AVChannelLayout>) {\r\n  if (channelLayout.order == AVChannelOrder.AV_CHANNEL_ORDER_CUSTOM) {\r\n    avFreep(addressof(channelLayout.u.map))\r\n  }\r\n  memset(channelLayout, 0, sizeof(accessof(channelLayout)))\r\n}\r\n\r\nexport function setChannelLayoutFromMask(channelLayout: pointer<AVChannelLayout>, mask: int32) {\r\n  if (!mask) {\r\n    return error.INVALID_ARGUMENT\r\n  }\r\n  channelLayout.order = AVChannelOrder.AV_CHANNEL_ORDER_NATIVE\r\n  channelLayout.nbChannels = popCount64(static_cast<uint64>(mask))\r\n  channelLayout.u.mask = static_cast<uint64>(mask)\r\n  return 0\r\n}\r\n","/*\r\n * libmedia codecparameters util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport AVCodecParameters from '../struct/avcodecparameters'\r\nimport { memcpy, memset } from 'cheap/std/memory'\r\nimport { avFree, avFreep, avMalloc, avMallocz } from './mem'\r\nimport { unInitChannelLayout } from './channel'\r\nimport { freeAVPacketSideData } from './avpacket'\r\nimport { AVCodecID, AVMediaType } from '../codec'\r\nimport { AVChannelOrder } from '../audiosamplefmt'\r\nimport { AVChromaLocation, AVColorPrimaries, AVColorRange,\r\n  AVColorSpace, AVColorTransferCharacteristic, AVFieldOrder\r\n} from '../pixfmt'\r\nimport { NOPTS_VALUE } from '../constant'\r\nimport { AVPacketSideData } from '../struct/avpacket'\r\n\r\nfunction copyCodecParametersSideData(\r\n  pDst: pointer<pointer<AVPacketSideData>>,\r\n  pnbDst: pointer<int32>,\r\n  src: pointer<AVPacketSideData>,\r\n  nbSrc: int32\r\n) {\r\n\r\n  if (!src) {\r\n    return\r\n  }\r\n\r\n  const dst: pointer<AVPacketSideData> = avMallocz(nbSrc * sizeof(AVPacketSideData))\r\n\r\n  for (let i = 0; i < nbSrc; i++) {\r\n    dst[i].type = src[i].type\r\n    dst[i].size = src[i].size\r\n    dst[i].data = avMalloc(src[i].size)\r\n    memcpy(addressof(dst[i].data), addressof(src[i].data), src[i].size)\r\n  }\r\n\r\n  accessof(pnbDst) <- nbSrc\r\n  accessof(pDst) <- dst\r\n\r\n  return 0\r\n}\r\n\r\nexport function copyCodecParameters(dst: pointer<AVCodecParameters>, src: pointer<AVCodecParameters>) {\r\n  dst.codecType = src.codecType\r\n  dst.codecId = src.codecId\r\n  dst.codecTag = src.codecTag\r\n  dst.format = src.format\r\n  dst.bitrate = src.bitrate\r\n  dst.bitsPerCodedSample = src.bitsPerCodedSample\r\n  dst.bitsPerRawSample = src.bitsPerRawSample\r\n  dst.profile = src.profile\r\n  dst.level = src.level\r\n  dst.width = src.width\r\n  dst.height = src.height\r\n  dst.sampleAspectRatio.den = src.sampleAspectRatio.den\r\n  dst.sampleAspectRatio.num = src.sampleAspectRatio.num\r\n  dst.fieldOrder = src.fieldOrder\r\n  dst.colorRange = src.colorRange\r\n  dst.colorPrimaries = src.colorPrimaries\r\n  dst.colorTrc = src.colorTrc\r\n  dst.colorSpace = src.colorSpace\r\n  dst.chromaLocation = src.chromaLocation\r\n  dst.videoDelay = src.videoDelay\r\n  dst.chLayout = src.chLayout\r\n  dst.sampleRate = src.sampleRate\r\n  dst.blockAlign = src.blockAlign\r\n  dst.frameSize = src.frameSize\r\n  dst.initialPadding = src.initialPadding\r\n  dst.trailingPadding = src.trailingPadding\r\n  dst.seekPreroll = src.seekPreroll\r\n\r\n  dst.framerate = src.framerate\r\n\r\n  if (src.extradata) {\r\n    if (dst.extradata) {\r\n      avFree(dst.extradata)\r\n    }\r\n    dst.extradata = avMalloc(src.extradataSize)\r\n    dst.extradataSize = src.extradataSize\r\n    memcpy(dst.extradata, src.extradata, src.extradataSize)\r\n  }\r\n\r\n  if (src.codedSideData) {\r\n    copyCodecParametersSideData(addressof(dst.codedSideData), addressof(dst.nbCodedSideData), src.codedSideData, src.nbCodedSideData)\r\n  }\r\n}\r\n\r\nexport function resetCodecParameters(par: pointer<AVCodecParameters>) {\r\n  if (par.extradata) {\r\n    avFreep(addressof(par.extradata))\r\n  }\r\n  unInitChannelLayout(addressof(par.chLayout))\r\n  freeAVPacketSideData(addressof(par.codedSideData), addressof(par.nbCodedSideData))\r\n  memset(par, 0, sizeof(accessof(par)))\r\n\r\n  par.codecType = AVMediaType.AVMEDIA_TYPE_UNKNOWN\r\n  par.codecId = AVCodecID.AV_CODEC_ID_NONE\r\n  par.format = -1\r\n  par.chLayout.order = AVChannelOrder.AV_CHANNEL_ORDER_UNSPEC\r\n  par.fieldOrder = AVFieldOrder.AV_FIELD_UNKNOWN\r\n  par.colorRange = AVColorRange.AVCOL_RANGE_UNSPECIFIED\r\n  par.colorPrimaries = AVColorPrimaries.AVCOL_PRI_UNSPECIFIED\r\n  par.colorTrc = AVColorTransferCharacteristic.AVCOL_TRC_UNSPECIFIED\r\n  par.colorSpace = AVColorSpace.AVCOL_SPC_UNSPECIFIED\r\n  par.chromaLocation = AVChromaLocation.AVCHROMA_LOC_UNSPECIFIED\r\n  par.sampleAspectRatio.num = 0\r\n  par.sampleAspectRatio.den = 1\r\n  par.framerate.num = 0\r\n  par.framerate.num = 1\r\n  par.profile = NOPTS_VALUE\r\n  par.level = NOPTS_VALUE\r\n}\r\n\r\nexport function freeCodecParameters(par: pointer<AVCodecParameters>) {\r\n  if (!par) {\r\n    return\r\n  }\r\n  resetCodecParameters(par)\r\n  avFree(par)\r\n}\r\n","/*\r\n * libmedia common util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nexport function popCount(x: uint32) {\r\n  x -= (x >> 1) & 0x55555555\r\n  x = (x & 0x33333333) + ((x >> 2) & 0x33333333)\r\n  x = (x + (x >> 4)) & 0x0F0F0F0F\r\n  x += x >> 8\r\n  return (x + (x >> 16)) & 0x3F\r\n}\r\n\r\nexport function popCount64(x: uint64) {\r\n  return popCount(static_cast<uint32>(x)) + popCount(static_cast<uint32>(x >> 32n))\r\n}\r\n\r\nexport function milliSecond2Second(time: int64) {\r\n  const integer = time / 1000n\r\n  const decimal = time - integer * 1000n\r\n  return Number(integer) + Number(decimal) / 1000\r\n}\r\n","/*\r\n * libmedia expgolomb util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport BitReader from 'common/io/BitReader'\r\nimport BitWriter from 'common/io/BitWriter'\r\n\r\nconst UESizeTable = [\r\n  // 0 的二进制所需的比特个数\r\n  1,\r\n  // 1 的二进制所需的比特个数    \r\n  1,\r\n  // 2~3 的二进制所需的比特个数   \r\n  2, 2,\r\n  // 4~7 的二进制所需的比特个数\r\n  3, 3, 3, 3,\r\n  // 8~15 的二进制所需的比特个数\r\n  4, 4, 4, 4, 4, 4, 4, 4,\r\n  // 16~31 的二进制所需的比特个数\r\n  5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,\r\n  // 32~63 的二进制所需的比特个数\r\n  6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,\r\n  6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,\r\n  // 64~127 的二进制所需的比特个数\r\n  7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,\r\n  7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,\r\n  7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,\r\n  7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,\r\n  // 128~255 的二进制所需的比特个数\r\n  8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,\r\n  8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,\r\n  8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,\r\n  8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,\r\n  8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,\r\n  8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,\r\n  8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,\r\n  8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8\r\n]\r\n\r\n/**\r\n * ue(v) 指数哥伦布解码\r\n */\r\nexport function readUE(bitReader: BitReader) {\r\n  let result = 0\r\n  // leadingZeroBits\r\n  let i = 0\r\n\r\n  while (i < 32 && bitReader.readU1() === 0) {\r\n    i++\r\n  }\r\n  // 计算 read_bits ( leadingZeroBits )\r\n  result = bitReader.readU(i)\r\n  // 计算 codeNum，1 << i 即为 2 的 i 次幂\r\n  result += (1 << i) - 1\r\n\r\n  return result\r\n}\r\n\r\n/**\r\n * se(v) 有符号指数哥伦布解码\r\n */\r\nexport function readSE(bitReader: BitReader) {\r\n  let result = readUE(bitReader)\r\n\r\n  // 判断 result 的奇偶性\r\n  if (result & 0x01) {\r\n    // 如果为奇数，说明编码前 > 0\r\n    result = (result + 1) / 2\r\n  }\r\n  else {\r\n    // 如果为偶数，说明编码前 <= 0\r\n    result = -result / 2\r\n  }\r\n  return result\r\n}\r\n\r\n/**\r\n * te(v) 截断指数哥伦布解码\r\n */\r\nexport function readTE(bitReader: BitReader, x: number) {\r\n  let result = 0\r\n  // 判断取值上限\r\n  if (x === 1) {\r\n    // 如果为 1 则将读取到的比特值取反\r\n    result = 1 - bitReader.readU1()\r\n  }\r\n  else if (x > 1) {\r\n    // 否则按照 ue(v) 进行解码\r\n    result = readUE(bitReader)\r\n  }\r\n  return result\r\n}\r\n\r\n/**\r\n * ue(v) 指数哥伦布编码\r\n */\r\nexport function writeUE(bitWriter: BitWriter, value: number) {\r\n  let size = 0\r\n\r\n  if (value === 0) {\r\n    // 0 直接编码为 1\r\n    bitWriter.writeU1(1)\r\n  }\r\n  else {\r\n    let tmp = ++value\r\n    // 判断所需比特个数是否大于 16 位\r\n    if ( tmp >= 0x00010000 ) {\r\n      size += 16\r\n      tmp >>= 16\r\n    }\r\n\r\n    // 判断此时所需比特个数是否大于 8 位\r\n    if ( tmp >= 0x100 ) {\r\n      size += 8\r\n      tmp >>= 8\r\n    }\r\n    // 最终 tmp 移位至 8 位以内，去查表\r\n    size += UESizeTable[tmp]\r\n\r\n    // 最终得出编码 value 所需的总比特数：2 * size - 1\r\n    bitWriter.writeU(2 * size - 1, value)\r\n  }\r\n}\r\n\r\n/**\r\n * se(v) 有符号指数哥伦布编码\r\n */\r\nexport function writeSE(bitWriter: BitWriter, value: number) {\r\n  if (value <= 0) {\r\n    writeUE(bitWriter, -value * 2)\r\n  }\r\n  else {\r\n    writeUE(bitWriter, value * 2 - 1)\r\n  }\r\n}\r\n\r\n/**\r\n * te(v) 截断指数哥伦布编码\r\n */\r\nexport function writeTE(bitWriter: BitWriter, x: number, value: number) {\r\n  if (x === 1) {\r\n    bitWriter.writeU1(1 & ~value)\r\n  }\r\n  else if (x > 1) {\r\n    writeUE(bitWriter, value)\r\n  }\r\n}\r\n","/*\r\n * libmedia int read util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nexport function r8(p: pointer<void>): uint8 {\r\n  return accessof(reinterpret_cast<pointer<uint8>>(p))\r\n}\r\n\r\nexport function rl16(p: pointer<void>): uint16 {\r\n  return (r8(reinterpret_cast<pointer<uint8>>(p + 1)) << 8) | r8(p)\r\n}\r\n\r\nexport function rb16(p: pointer<void>): uint16 {\r\n  return (r8(p) << 8) | r8(reinterpret_cast<pointer<uint8>>(p + 1))\r\n}\r\n\r\nexport function rl24(p: pointer<void>): int32 {\r\n  return (r8(reinterpret_cast<pointer<uint8>>(p + 2)) << 16) | (r8(reinterpret_cast<pointer<uint8>>(p + 1)) << 8) + r8(p)\r\n}\r\n\r\nexport function rb24(p: pointer<void>): int32 {\r\n  return (r8(p) << 16) | (r8(reinterpret_cast<pointer<uint8>>(p + 1)) << 8) | r8(reinterpret_cast<pointer<uint8>>(p + 2))\r\n}\r\n\r\nexport function rl32(p: pointer<void>): int32 {\r\n  return (rl16(reinterpret_cast<pointer<uint8>>(p + 2)) << 16) | rl16(p)\r\n}\r\n\r\nexport function rb32(p: pointer<void>): int32 {\r\n  return (rb16(p) << 16) | rb16(reinterpret_cast<pointer<uint8>>(p + 2))\r\n}\r\n\r\nexport function rl64(p: pointer<void>): int64 {\r\n  return (BigInt(rl32(reinterpret_cast<pointer<uint8>>(p + 4))) << 32n) | BigInt(rl32(p))\r\n}\r\n\r\nexport function rb64(p: pointer<void>): int64 {\r\n  return (BigInt(rb32(p)) << 32n) | BigInt(rb32(reinterpret_cast<pointer<uint8>>(p + 4)))\r\n}\r\n","/*\r\n * libmedia mem util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { memset } from 'cheap/std/memory'\r\nimport * as logger from 'common/util/logger'\r\n\r\nexport function avMalloc(len: size): pointer<void> {\r\n  const p = malloc(len)\r\n  if (!p) {\r\n    logger.fatal('can not alloc buffer')\r\n  }\r\n  return p\r\n}\r\n\r\nexport function avMallocz(len: size): pointer<void> {\r\n  const p = malloc(len)\r\n  if (!p) {\r\n    logger.fatal('can not alloc buffer')\r\n  }\r\n\r\n  memset(p, 0, len)\r\n  return p\r\n}\r\n\r\nexport function avFree(p: pointer<void>) {\r\n  assert(p, 'can not free empty pointer')\r\n  free(p)\r\n}\r\n\r\nexport function avFreep(p: pointer<pointer<void>>) {\r\n  assert(p, 'can not free empty pointer')\r\n  free(accessof(p))\r\n  accessof(p) <- nullptr\r\n}\r\n\r\nexport function avRealloc(p: pointer<void>, size: size): pointer<void> {\r\n  return realloc(p, size)\r\n}\r\n","/*\r\n * libmedia nalu util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport BufferReader from 'common/io/BufferReader'\r\nimport BufferWriter from 'common/io/BufferWriter'\r\nimport { Uint8ArrayInterface } from 'common/io/interface'\r\nimport * as array from 'common/util/array'\r\n\r\nexport function isAnnexb(data: Uint8ArrayInterface) {\r\n  return data.length > 4\r\n  && data[0] === 0\r\n  && data[1] === 0\r\n  && (\r\n    data[2] === 1\r\n    || data[2] === 0 && data[3] === 1\r\n  )\r\n}\r\n\r\nexport function getNextNaluStart(data: Uint8ArrayInterface, offset: number) {\r\n  let t = 0\r\n  for (let i = offset; i < data.length; i++) {\r\n    switch (data[i]) {\r\n      case 0:\r\n        t++\r\n        break\r\n      case 1:\r\n        if (t >= 2) {\r\n          return {\r\n            offset: i - Math.min(t, 3),\r\n            startCode: Math.min(t + 1, 4)\r\n          }\r\n        }\r\n        t = 0\r\n        break\r\n      default:\r\n        t = 0\r\n    }\r\n  }\r\n  return {\r\n    offset: -1,\r\n    startCode: 0\r\n  }\r\n}\r\n\r\nexport function splitNaluByStartCode<T extends Uint8ArrayInterface>(buffer: T): T[] {\r\n  const list = []\r\n  let offset = 0\r\n  let current = getNextNaluStart(buffer, offset)\r\n  let next = {\r\n    offset: -1,\r\n    startCode: 0\r\n  }\r\n  while (next = getNextNaluStart(buffer, current.offset + current.startCode), next.offset > -1) {\r\n    list.push(buffer.subarray(current.offset + current.startCode, next.offset, true))\r\n    current = next\r\n  }\r\n  list.push(buffer.subarray(current.offset + current.startCode, undefined, true))\r\n\r\n  return list\r\n}\r\n\r\nexport function splitNaluByLength<T extends Uint8ArrayInterface>(buffer: T, naluLengthSizeMinusOne: int32): T[] {\r\n  const list = []\r\n  const bufferReader = new BufferReader(buffer)\r\n  while (bufferReader.remainingSize() > 0) {\r\n    let length = 0\r\n    if (naluLengthSizeMinusOne === 3) {\r\n      length = bufferReader.readUint32()\r\n    }\r\n    else if (naluLengthSizeMinusOne === 2) {\r\n      length = bufferReader.readUint24()\r\n    }\r\n    else if (naluLengthSizeMinusOne === 1) {\r\n      length = bufferReader.readUint16()\r\n    }\r\n    else {\r\n      length = bufferReader.readUint8()\r\n    }\r\n    const nalu = buffer.subarray(static_cast<int32>(bufferReader.getPos()), static_cast<int32>(bufferReader.getPos()) + length, true)\r\n    bufferReader.skip(length)\r\n    list.push(nalu)\r\n  }\r\n  return list\r\n}\r\n\r\nexport function joinNaluByStartCode(nalus: Uint8ArrayInterface[], output?: Uint8Array, slice: boolean = false): Uint8Array {\r\n  if (!output) {\r\n    let length = nalus.reduce((prev, nalu, index) => {\r\n      return prev + ((index || slice) ? 3 : 4) + nalu.length\r\n    }, 0)\r\n    output = new Uint8Array(length)\r\n  }\r\n\r\n  const bufferWriter = new BufferWriter(output)\r\n\r\n  array.each(nalus, (nalu, index) => {\r\n    bufferWriter.writeUint8(0x00)\r\n    bufferWriter.writeUint8(0x00)\r\n    if (!index && !slice) {\r\n      bufferWriter.writeUint8(0x00)\r\n    }\r\n    bufferWriter.writeUint8(0x01)\r\n    bufferWriter.writeBuffer(nalu)\r\n  })\r\n\r\n  return output\r\n}\r\n\r\nexport function joinNaluByLength(nalus: Uint8Array[], naluLengthSizeMinusOne: int32, output?: Uint8Array): Uint8Array {\r\n  if (!output) {\r\n    const length = nalus.reduce((prev, nalu) => {\r\n      return prev + naluLengthSizeMinusOne + 1 + nalu.length\r\n    }, 0)\r\n    output = new Uint8Array(length)\r\n  }\r\n  const bufferWriter = new BufferWriter(output)\r\n\r\n  array.each(nalus, (nalu) => {\r\n    if (naluLengthSizeMinusOne === 3) {\r\n      bufferWriter.writeUint32(nalu.length)\r\n    }\r\n    else if (naluLengthSizeMinusOne === 2) {\r\n      bufferWriter.writeUint24(nalu.length)\r\n    }\r\n    else if (naluLengthSizeMinusOne === 1) {\r\n      bufferWriter.writeUint16(nalu.length)\r\n    }\r\n    else {\r\n      bufferWriter.writeUint8(nalu.length)\r\n    }\r\n    bufferWriter.writeBuffer(nalu)\r\n  })\r\n  return output\r\n}\r\n\r\nexport function naluUnescape(data: Uint8Array, start = 0, end?: number) {\r\n\r\n  if (!end) {\r\n    end = data.length\r\n  }\r\n\r\n  const buffer = new Uint8Array(data.length)\r\n\r\n  let zeroCount = 0\r\n  let pos = 0\r\n  for (let i = 0; i < data.length; i++) {\r\n    if (i >= start && i < end) {\r\n      if (data[i] === 0) {\r\n        zeroCount++\r\n      }\r\n      else {\r\n        if (data[i] === 3 && zeroCount === 2 && i + 1 < data.length && data[i + 1] <= 3) {\r\n          i++\r\n          if (i === data.length) {\r\n            break\r\n          }\r\n          else {\r\n            if (data[i] === 0) {\r\n              zeroCount = 1\r\n            }\r\n            else {\r\n              zeroCount = 0\r\n            }\r\n          }\r\n        }\r\n        else {\r\n          zeroCount = 0\r\n        }\r\n      }\r\n    }\r\n    buffer[pos++] = data[i]\r\n  }\r\n\r\n  return buffer.slice(0, pos)\r\n}\r\n\r\nexport function naluEscape(data: Uint8Array, start: number = 0, end?: number) {\r\n  if (!end) {\r\n    end = data.length\r\n  }\r\n\r\n  const indexes = []\r\n  let zeroCount = 0\r\n  for (let i = start; i < end; i++) {\r\n\r\n    if (i >= end) {\r\n      break\r\n    }\r\n\r\n    if (data[i] === 0) {\r\n      zeroCount++\r\n    }\r\n    else {\r\n      if (data[i] <= 3 && zeroCount === 2) {\r\n        indexes.push(i)\r\n      }\r\n      zeroCount = 0\r\n    }\r\n  }\r\n\r\n  if (indexes.length) {\r\n    const buffer = new Uint8Array(data.length + indexes.length)\r\n    let pos = 0\r\n    let subData = data.subarray(0, indexes[0])\r\n    buffer.set(subData, pos)\r\n    pos += subData.length\r\n\r\n    buffer[pos++] = 3\r\n\r\n    for (let i = 1; i < indexes.length; i++) {\r\n      subData = data.subarray(indexes[i - 1], indexes[i])\r\n      buffer.set(subData, pos)\r\n      pos += subData.length\r\n      buffer[pos++] = 3\r\n    }\r\n\r\n    subData = data.subarray(indexes[indexes.length - 1], data.length)\r\n    buffer.set(subData, pos)\r\n    pos += subData.length\r\n\r\n    return buffer\r\n  }\r\n  else {\r\n    return data\r\n  }\r\n}\r\n","/*\r\n * libmedia video pixel util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { PixelFormatDescriptor, PixelFormatDescriptorsMap, PixelFormatFlags } from '../pixelFormatDescriptor'\r\nimport { AVChromaLocation, AVPixelFormat } from '../pixfmt'\r\nimport * as errorType from '../error'\r\nimport { INT32_MAX } from '../constant'\r\nimport { memset } from 'cheap/std/memory'\r\nimport * as stack from 'cheap/stack'\r\nimport { avFree, avMalloc } from './mem'\r\nimport alignFunc from 'common/math/align'\r\n\r\nexport function chromaLocation2Pos(pos: AVChromaLocation) {\r\n  if (pos <= AVChromaLocation.AVCHROMA_LOC_UNSPECIFIED || pos >= AVChromaLocation.AVCHROMA_LOC_NB) {\r\n    return\r\n  }\r\n  return {\r\n    x: (pos & 1) * 128,\r\n    y: ((pos >>> 1) ^ (pos < 4 ? 1 : 0)) * 128\r\n  }\r\n}\r\n\r\nfunction getMaxPixSteps(desc: PixelFormatDescriptor) {\r\n  const maxPixSteps: int32[] = [0, 0, 0, 0]\r\n  const maxPixStepsComps: int32[] = [0, 0, 0, 0]\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    if (desc.comp[i] && desc.comp[i].step > maxPixSteps[desc.comp[i].plane]) {\r\n      maxPixSteps[desc.comp[i].plane] = desc.comp[i].step\r\n      maxPixStepsComps[desc.comp[i].plane] = i\r\n    }\r\n  }\r\n\r\n  return {\r\n    maxPixSteps,\r\n    maxPixStepsComps\r\n  }\r\n}\r\n\r\nfunction setSystematicPal(pal: pointer<uint32>, pixfmt: AVPixelFormat) {\r\n  for (let i = 0; i < 256; i++) {\r\n    let r, g, b\r\n\r\n    switch (pixfmt) {\r\n      case AVPixelFormat.AV_PIX_FMT_RGB8:\r\n        r = (i >> 5) * 36\r\n        g = ((i >> 2) & 7) * 36\r\n        b = (i & 3) * 85\r\n        break\r\n      case AVPixelFormat.AV_PIX_FMT_BGR8:\r\n        b = (i >> 6) * 85\r\n        g = ((i >> 3) & 7) * 36\r\n        r = (i & 7) * 36\r\n        break\r\n      case AVPixelFormat.AV_PIX_FMT_RGB4_BYTE:\r\n        r = (i >> 3) * 255\r\n        g = ((i >> 1) & 3) * 85\r\n        b = (i & 1) * 255\r\n        break\r\n      case AVPixelFormat.AV_PIX_FMT_BGR4_BYTE:\r\n        b = (i >> 3) * 255\r\n        g = ((i >> 1) & 3) * 85\r\n        r = (i & 1) * 255\r\n        break\r\n      case AVPixelFormat.AV_PIX_FMT_GRAY8:\r\n        r = b = g = i\r\n        break\r\n      default:\r\n        return errorType.INVALID_ARGUMENT\r\n    }\r\n    pal[i] = b + (g << 8) + (r << 16) + (0xFF << 24)\r\n  }\r\n\r\n  return 0\r\n}\r\n\r\nfunction pixelGetLinesize_(width: int32, plane: int32, maxStep: int32, maxStepComp: int32, desc: PixelFormatDescriptor) {\r\n  if (!desc) {\r\n    return errorType.INVALID_ARGUMENT\r\n  }\r\n\r\n  if (width < 0) {\r\n    return errorType.INVALID_ARGUMENT\r\n  }\r\n\r\n  const s = ( maxStepComp === 1 || maxStepComp === 2) ? desc.log2ChromaW : 0\r\n\r\n  const shiftedW = ((width + (1 << s) - 1)) >>> s\r\n\r\n  if (shiftedW && maxStep > INT32_MAX / shiftedW) {\r\n    return errorType.INVALID_ARGUMENT\r\n  }\r\n\r\n  let linesize = maxStep * shiftedW\r\n\r\n  if (desc.flags & PixelFormatFlags.BIT_STREAM) {\r\n    linesize = (linesize + 7) >>> 3\r\n  }\r\n\r\n  return linesize\r\n}\r\n\r\nexport function pixelGetLinesize(pixfmt: AVPixelFormat, width: int32, plane: int32) {\r\n  const desc = PixelFormatDescriptorsMap[pixfmt]\r\n\r\n  if (!desc) {\r\n    return errorType.INVALID_ARGUMENT\r\n  }\r\n\r\n  const { maxPixSteps, maxPixStepsComps } = getMaxPixSteps(desc)\r\n\r\n  return pixelGetLinesize_(width, plane, maxPixSteps[plane], maxPixStepsComps[plane], desc)\r\n}\r\n\r\nexport function pixelFillLinesizes(linesizes: pointer<int32>, pixfmt: AVPixelFormat, width: int32) {\r\n  const desc = PixelFormatDescriptorsMap[pixfmt]\r\n\r\n  if (!desc) {\r\n    return errorType.INVALID_ARGUMENT\r\n  }\r\n\r\n  const { maxPixSteps, maxPixStepsComps } = getMaxPixSteps(desc)\r\n\r\n  memset(linesizes, 0, 4 * sizeof(linesizes[0]))\r\n\r\n  let ret = 0\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    if ((ret = pixelGetLinesize_(width, i, maxPixSteps[i], maxPixStepsComps[i], desc)) < 0) {\r\n      return ret\r\n    }\r\n    linesizes[i] = ret\r\n  }\r\n}\r\n\r\nexport function pixelFillPlaneSizes(sizes: pointer<int32>, pixfmt: AVPixelFormat, height: int32, linesizes: pointer<int32>) {\r\n  const hasPlane = [0, 0, 0, 0]\r\n\r\n  const desc = PixelFormatDescriptorsMap[pixfmt]\r\n\r\n  if (!desc) {\r\n    return errorType.INVALID_ARGUMENT\r\n  }\r\n\r\n  memset(sizes, 0, 4 * sizeof(sizes[0]))\r\n\r\n  if (linesizes[0] > INT32_MAX / height) {\r\n    return errorType.INVALID_ARGUMENT\r\n  }\r\n\r\n  sizes[0] = linesizes[0] * height\r\n\r\n  if (desc.flags & PixelFormatFlags.PALETTE) {\r\n    sizes[1] = 256 * 4\r\n    return 0\r\n  }\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    if (desc.comp[i]) {\r\n      hasPlane[desc.comp[i].plane] = 1\r\n    }\r\n  }\r\n\r\n  for (let i = 0; i < 4 && hasPlane[i]; i++) {\r\n    let s = (i === 1 || i === 2) ? desc.log2ChromaH : 0\r\n    let h = (height + (1 << s) - 1) >> s\r\n\r\n    if (linesizes[i] > INT32_MAX / h) {\r\n      return errorType.INVALID_ARGUMENT\r\n    }\r\n\r\n    sizes[i] = h * linesizes[i]\r\n  }\r\n  return 0\r\n}\r\n\r\nexport function pixelFillPointer(\r\n  data: pointer<pointer<uint8>>,\r\n  pixfmt: AVPixelFormat,\r\n  height: int32,\r\n  ptr: pointer<uint8>,\r\n  linesizes: pointer<int32>\r\n) {\r\n  const linesizes1 = reinterpret_cast<pointer<int32>>(stack.malloc(sizeof(linesizes[0]) * 4))\r\n  const sizes = reinterpret_cast<pointer<size>>(stack.malloc(sizeof(size) * 4))\r\n\r\n  memset(data, 0, 4 * sizeof(data[0]))\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    linesizes1[i] = linesizes[i]\r\n  }\r\n\r\n  let ret = pixelFillPlaneSizes(sizes, pixfmt, height, linesizes1)\r\n\r\n  if (ret < 0) {\r\n    defer()\r\n    return ret\r\n  }\r\n\r\n  ret = 0\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    if (sizes[i] > INT32_MAX - ret) {\r\n      defer()\r\n      return errorType.INVALID_ARGUMENT\r\n    }\r\n    ret += sizes[i]\r\n  }\r\n\r\n  if (!ptr) {\r\n    defer()\r\n    return ret\r\n  }\r\n\r\n  data[0] = ptr\r\n  for (let i = 1; i < 4 && sizes[i]; i++) {\r\n    data[i] = reinterpret_cast<pointer<uint8>>(data[i - 1] + sizes[i - 1])\r\n  }\r\n\r\n  defer()\r\n  return ret\r\n\r\n  function defer() {\r\n    stack.free(sizeof(linesizes[0]) * 4)\r\n    stack.free(sizeof(size) * 4)\r\n  }\r\n}\r\n\r\nexport function pixelAlloc(\r\n  pointers: pointer<pointer<uint8>>,\r\n  linesizes: pointer<int32>,\r\n  w: int32,\r\n  h: int32,\r\n  pixfmt: AVPixelFormat,\r\n  align: int32 = 1\r\n) {\r\n\r\n  const desc = PixelFormatDescriptorsMap[pixfmt]\r\n\r\n  if (!desc) {\r\n    return errorType.INVALID_ARGUMENT\r\n  }\r\n\r\n  const linesizes1 = reinterpret_cast<pointer<int32>>(stack.malloc(sizeof(linesizes[0]) * 4))\r\n  const sizes = reinterpret_cast<pointer<size>>(stack.malloc(sizeof(size) * 4))\r\n\r\n  let ret = 0\r\n\r\n  if ((ret = pixelFillLinesizes(linesizes, pixfmt, align > 7 ? alignFunc(w, 8) : w)) < 0) {\r\n    defer()\r\n    return ret\r\n  }\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    linesizes[i] = alignFunc(linesizes[i], align)\r\n    linesizes1[i] = linesizes[i]\r\n  }\r\n\r\n  if ((ret = pixelFillPlaneSizes(sizes, pixfmt, h, linesizes1)) < 0) {\r\n    defer()\r\n    return ret\r\n  }\r\n\r\n  let totalSize = align\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    if (totalSize > INT32_MAX - sizes[i]) {\r\n      defer()\r\n      return errorType.INVALID_ARGUMENT\r\n    }\r\n    totalSize += sizes[i]\r\n  }\r\n\r\n  const buf = avMalloc(totalSize)\r\n\r\n  if (!buf) {\r\n    defer()\r\n    return errorType.NO_MEMORY\r\n  }\r\n\r\n  if ((ret = pixelFillPointer(pointers, pixfmt, h, buf, linesizes)) < 0) {\r\n    defer()\r\n    return ret\r\n  }\r\n\r\n  if (desc.flags & PixelFormatFlags.PALETTE) {\r\n    if (align < 4) {\r\n      avFree(buf)\r\n      defer()\r\n      return ret\r\n    }\r\n    setSystematicPal(reinterpret_cast<pointer<uint32>>(pointers[1]), pixfmt)\r\n  }\r\n\r\n  if ((desc.flags & PixelFormatFlags.PALETTE)\r\n    && pointers[1]\r\n    && pointers[1] - pointers[0] > linesizes[0] * h\r\n  ) {\r\n    /* zero-initialize the padding before the palette */\r\n    memset(pointers[0] + linesizes[0] * h, 0, pointers[1] - pointers[0] - linesizes[0] * h)\r\n  }\r\n\r\n  defer()\r\n  return ret\r\n\r\n  function defer() {\r\n    stack.free(sizeof(linesizes[0]) * 4)\r\n    stack.free(sizeof(size) * 4)\r\n  }\r\n}\r\n\r\nexport function pixelGetSize(pixfmt: AVPixelFormat, width: int32, height: int32, align: int32) {\r\n  const desc = PixelFormatDescriptorsMap[pixfmt]\r\n\r\n  if (!desc) {\r\n    return errorType.INVALID_ARGUMENT\r\n  }\r\n\r\n  const linesizes = reinterpret_cast<pointer<int32>>(stack.malloc(sizeof(int32) * 4))\r\n  const alignedLinesizes = reinterpret_cast<pointer<int32>>(stack.malloc(sizeof(int32) * 4))\r\n  const sizes = reinterpret_cast<pointer<size>>(stack.malloc(sizeof(size) * 4))\r\n\r\n  let ret = 0\r\n\r\n  if ((ret = pixelFillLinesizes(linesizes, pixfmt, width)) < 0) {\r\n    defer()\r\n    return ret\r\n  }\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    alignedLinesizes[i] = alignFunc(linesizes[i], align)\r\n  }\r\n\r\n  if ((ret = pixelFillPlaneSizes(sizes, pixfmt, height, alignedLinesizes)) < 0) {\r\n    defer()\r\n    return ret\r\n  }\r\n\r\n  let totalSize = 0\r\n\r\n  for (let i = 0; i < 4; i++) {\r\n    if (totalSize > INT32_MAX - sizes[i]) {\r\n      defer()\r\n      return errorType.INVALID_ARGUMENT\r\n    }\r\n    totalSize += sizes[i]\r\n  }\r\n\r\n  defer()\r\n\r\n  return totalSize\r\n\r\n  function defer() {\r\n    stack.free(sizeof(int32) * 4)\r\n    stack.free(sizeof(int32) * 4)\r\n    stack.free(sizeof(size) * 4)\r\n  }\r\n}\r\n","/*\r\n * libmedia rational util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { Rational } from '../struct/rational'\r\nimport gcd from 'common/math/gcd'\r\n\r\n/**\r\n * 将一个时间戳由一个时间基转换到另一个时间基\r\n * \r\n * @param a 待转换时间戳\r\n * @param bp 待转换时间戳的时间基\r\n * @param cq 目标时间基\r\n */\r\nexport function avRescaleQ(a: int64, bq: Rational, cq: Rational) {\r\n  const b = a * static_cast<int64>(bq.num) * static_cast<int64>(cq.den)\r\n  const c = static_cast<int64>(bq.den) * static_cast<int64>(cq.num)\r\n  return b / c\r\n}\r\n\r\n/**\r\n * 将一个时间戳由一个时间基转换到另一个时间基\r\n * \r\n * @param a 待转换时间戳\r\n * @param bp 待转换时间戳的时间基\r\n * @param cq 目标时间基\r\n */\r\nexport function avRescaleQ2(a: int64, bq: pointer<Rational>, cq: pointer<Rational>) {\r\n  const b = a * static_cast<int64>(bq.num) * static_cast<int64>(cq.den)\r\n  const c = static_cast<int64>(bq.den) * static_cast<int64>(cq.num)\r\n  return b / c\r\n}\r\n\r\n/**\r\n * 将一个时间基转换成 double\r\n * \r\n * @param a \r\n */\r\nexport function avQ2D(a: Rational) {\r\n  return a.num / a.den\r\n}\r\n\r\n/**\r\n * 将一个时间基转换成 double\r\n * \r\n * @param a \r\n */\r\nexport function avQ2D2(a: pointer<Rational>) {\r\n  return a.num / a.den\r\n}\r\n\r\n/**\r\n * 化简 Rational\r\n * \r\n * @param a \r\n */\r\nexport function avReduce(a: Rational) {\r\n  const gcdValue = gcd(a.num, a.den)\r\n  if (gcdValue <= 1) {\r\n    return\r\n  }\r\n  a.den /= gcdValue\r\n  a.num /= gcdValue\r\n}\r\n\r\n/**\r\n * 化简 Rational\r\n * \r\n * @param a \r\n */\r\nexport function avReduce2(a: pointer<Rational>) {\r\n  const gcdValue = gcd(a.num, a.den)\r\n  if (gcdValue <= 1) {\r\n    return\r\n  }\r\n  a.den /= gcdValue\r\n  a.num /= gcdValue\r\n}\r\n","/*\r\n * libmedia audio sample util\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { memset } from 'cheap/std/memory'\r\nimport { AVSampleFormat } from '../audiosamplefmt'\r\nimport { INT32_MAX } from '../constant'\r\nimport alignFunc from 'common/math/align'\r\nimport { avFree, avMalloc } from '../util/mem'\r\nimport { AVSampleFormatDescriptors } from '../sampleFormatDescriptor'\r\n\r\nexport function getBytesPerSample(format: AVSampleFormat) {\r\n  return (format < 0 || format >= AVSampleFormat.AV_SAMPLE_FMT_NB)\r\n    ? 0\r\n    : AVSampleFormatDescriptors[format].bits >> 3\r\n}\r\n\r\nexport function sampleFormatIsPlanar(format: AVSampleFormat) {\r\n  return (format < 0 || format >= AVSampleFormat.AV_SAMPLE_FMT_NB)\r\n    ? false\r\n    : AVSampleFormatDescriptors[format].planar\r\n}\r\n\r\nexport function sampleFormatGetLinesize(format: AVSampleFormat, channels: int32, nbSamples: int32, align?: int32) {\r\n  const sampleSize = getBytesPerSample(format)\r\n  const planar = sampleFormatIsPlanar(format)\r\n\r\n  if (!sampleSize || nbSamples <= 0 || channels <= 0) {\r\n    return -1\r\n  }\r\n\r\n  if (!align) {\r\n    align = 1\r\n    nbSamples = alignFunc(nbSamples, 32)\r\n  }\r\n\r\n  if (channels > INT32_MAX / align || channels * nbSamples > (INT32_MAX - align * channels) / sampleSize) {\r\n    return -1\r\n  }\r\n\r\n  return planar ? alignFunc(nbSamples * sampleSize, align) : alignFunc(nbSamples * sampleSize * channels, align)\r\n}\r\n\r\nexport function sampleFillArrays(\r\n  audioData: pointer<pointer<uint8>>,\r\n  buf: pointer<uint8>,\r\n  format: AVSampleFormat,\r\n  linesize: int32,\r\n  channels: int32\r\n) {\r\n  const planar = sampleFormatIsPlanar(format)\r\n\r\n  memset(audioData, 0, planar ? sizeof(accessof(audioData)) * channels : sizeof(accessof(audioData)))\r\n\r\n  if (!buf) {\r\n    return -1\r\n  }\r\n\r\n  audioData[0] = buf\r\n\r\n  if (planar) {\r\n    for (let i = 1; i < channels; i++) {\r\n      audioData[i] = reinterpret_cast<pointer<uint8>>(audioData[i - 1] + linesize)\r\n    }\r\n  }\r\n  return 0\r\n}\r\n\r\nexport function sampleAlloc(\r\n  audioData: pointer<pointer<uint8>>,\r\n  format: AVSampleFormat,\r\n  linesize: int32,\r\n  channels: int32\r\n) {\r\n  const planar = sampleFormatIsPlanar(format)\r\n  const bufSize = planar ? linesize * channels : linesize\r\n\r\n  if (bufSize < 0) {\r\n    return bufSize\r\n  }\r\n\r\n  const buf = avMalloc(bufSize)\r\n\r\n  const ret = sampleFillArrays(audioData, buf, format, linesize, channels)\r\n\r\n  if (ret < 0) {\r\n    avFree(buf)\r\n    return ret\r\n  }\r\n\r\n  return 0\r\n}\r\n\r\nexport function sampleSetSilence(\r\n  audioData: pointer<pointer<uint8>>,\r\n  offset: int32,\r\n  format: AVSampleFormat,\r\n  nbSamples: int32,\r\n  channels: int32\r\n) {\r\n  const planar = sampleFormatIsPlanar(format)\r\n  const planes = planar ? channels : 1\r\n  const blockAlign = getBytesPerSample(format) * (planar ? 1 : channels)\r\n  const dataSize = nbSamples * blockAlign\r\n  const fillChar = (format === AVSampleFormat.AV_SAMPLE_FMT_U8 || format === AVSampleFormat.AV_SAMPLE_FMT_U8P)\r\n    ? 0x80\r\n    : 0x00\r\n\r\n  offset *= blockAlign\r\n\r\n  for (let i = 0; i < planes; i++) {\r\n    memset(audioData[i] + offset, fillChar, dataSize)\r\n  }\r\n}\r\n","/*\r\n * libmedia serialize struct\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVCodecID, AVMediaType, AVPacketSideDataType } from '../codec'\r\nimport AVPacket from '../struct/avpacket'\r\nimport { Rational } from '../struct/rational'\r\nimport { mapUint8Array, memcpyFromUint8Array, memset } from 'cheap/std/memory'\r\nimport { addAVPacketData, addAVPacketSideData, addSideData, createAVPacket, freeAVPacketSideData, getAVPacketData } from './avpacket'\r\nimport { avFree, avMalloc } from './mem'\r\nimport { AVChromaLocation, AVColorPrimaries, AVColorRange, AVColorSpace, AVColorTransferCharacteristic, AVFieldOrder, AVPixelFormat } from '../pixfmt'\r\nimport { AVChannelOrder, AVSampleFormat } from '../audiosamplefmt'\r\nimport AVCodecParameters from '../struct/avcodecparameters'\r\n\r\nexport interface AVPacketSerialize {\r\n  pts: int64\r\n  dts: int64\r\n  data: Uint8Array\r\n  streamIndex: int32\r\n  flags: int32\r\n  sideData: {\r\n    type: AVPacketSideDataType\r\n    data: Uint8Array\r\n  }[]\r\n  duration: int64\r\n  pos: int64\r\n  timeBase: Rational\r\n  bitFormat: int32\r\n}\r\n\r\nexport interface AVCodecParametersSerialize {\r\n  codecType: AVMediaType\r\n  codecId: AVCodecID\r\n  codecTag: uint32\r\n  extradata: Uint8Array\r\n  codedSideData: {\r\n    type: AVPacketSideDataType\r\n    data: Uint8Array\r\n  }[]\r\n  format: AVPixelFormat | AVSampleFormat\r\n  bitrate: int64\r\n  bitsPerCodedSample: int32\r\n  bitsPerRawSample: int32\r\n  profile: int32\r\n  level: int32\r\n  width: int32\r\n  height: int32\r\n  sampleAspectRatio: Rational\r\n  framerate: Rational\r\n  fieldOrder: AVFieldOrder\r\n  colorRange: AVColorRange\r\n  colorPrimaries: AVColorPrimaries\r\n  colorTrc: AVColorTransferCharacteristic\r\n  colorSpace: AVColorSpace\r\n  chromaLocation: AVChromaLocation\r\n  videoDelay: int32\r\n  chLayout: {\r\n    order: AVChannelOrder\r\n    nbChannels: int32\r\n    u: uint64\r\n  }\r\n  sampleRate: int32\r\n  blockAlign: int32\r\n  frameSize: int32\r\n  initialPadding: int32\r\n  trailingPadding: int32\r\n  seekPreroll: int32\r\n  bitFormat: int32\r\n}\r\n\r\nexport function serializeAVPacket(avpacket: pointer<AVPacket>) {\r\n  const serialize: AVPacketSerialize = {\r\n    pts: avpacket.pts,\r\n    dts: avpacket.dts,\r\n    data: getAVPacketData(avpacket).slice(),\r\n    streamIndex: avpacket.streamIndex,\r\n    flags: avpacket.flags,\r\n    sideData: [],\r\n    duration: avpacket.duration,\r\n    pos: avpacket.pos,\r\n    timeBase: {\r\n      den: avpacket.timeBase.den,\r\n      num: avpacket.timeBase.num\r\n    },\r\n    bitFormat: avpacket.bitFormat\r\n  }\r\n\r\n  for (let i = 0; i < avpacket.sideDataElems; i++) {\r\n    const ele = {\r\n      type: avpacket.sideData[i].type,\r\n      data: mapUint8Array(avpacket.sideData[i].data, avpacket.sideData[i].size).slice()\r\n    }\r\n    serialize.sideData.push(ele)\r\n  }\r\n  return serialize\r\n}\r\n\r\nexport function unserializeAVPacket(serialize: AVPacketSerialize, avpacket: pointer<AVPacket> = nullptr) {\r\n  if (!avpacket) {\r\n    avpacket = createAVPacket()\r\n  }\r\n\r\n  avpacket.pts = serialize.pts\r\n  avpacket.dts = serialize.dts\r\n\r\n  const data = avMalloc(serialize.data.length)\r\n  memcpyFromUint8Array(data, serialize.data.length, serialize.data)\r\n  addAVPacketData(avpacket, data, serialize.data.length)\r\n\r\n  avpacket.streamIndex = serialize.streamIndex\r\n  avpacket.flags = serialize.flags\r\n  avpacket.duration = serialize.duration\r\n  avpacket.pos = serialize.pos\r\n  avpacket.timeBase.den = serialize.timeBase.den\r\n  avpacket.timeBase.num = serialize.timeBase.num\r\n  avpacket.bitFormat = serialize.bitFormat\r\n\r\n  if (serialize.sideData.length) {\r\n    for (let i = 0; i < serialize.sideData.length; i++) {\r\n      const data = avMalloc(serialize.sideData[i].data.length)\r\n      memcpyFromUint8Array(data, serialize.sideData[i].data.length, serialize.sideData[i].data)\r\n      addAVPacketSideData(avpacket, serialize.sideData[i].type, data, serialize.sideData[i].data.length)\r\n    }\r\n  }\r\n  else {\r\n    freeAVPacketSideData(addressof(avpacket.sideData), addressof(avpacket.sideDataElems))\r\n  }\r\n\r\n  return avpacket\r\n}\r\n\r\nexport function serializeAVCodecParameters(codecpar: pointer<AVCodecParameters>) {\r\n  const serialize: AVCodecParametersSerialize = {\r\n    codecType: codecpar.codecType,\r\n    codecId: codecpar.codecId,\r\n    codecTag: codecpar.codecTag,\r\n    extradata: null,\r\n    codedSideData: [],\r\n    format: codecpar.format,\r\n    bitrate: codecpar.bitrate,\r\n    bitsPerCodedSample: codecpar.bitsPerCodedSample,\r\n    bitsPerRawSample: codecpar.bitsPerRawSample,\r\n    profile: codecpar.profile,\r\n    level: codecpar.level,\r\n    width: codecpar.width,\r\n    height: codecpar.height,\r\n    sampleAspectRatio: {\r\n      den: codecpar.sampleAspectRatio.den,\r\n      num: codecpar.sampleAspectRatio.num\r\n    },\r\n    framerate: {\r\n      den: codecpar.framerate.den,\r\n      num: codecpar.framerate.num\r\n    },\r\n    fieldOrder: codecpar.fieldOrder,\r\n    colorRange: codecpar.colorRange,\r\n    colorPrimaries: codecpar.colorPrimaries,\r\n    colorTrc: codecpar.colorTrc,\r\n    colorSpace: codecpar.colorSpace,\r\n    chromaLocation: codecpar.chromaLocation,\r\n    videoDelay: codecpar.videoDelay,\r\n    chLayout: {\r\n      order: codecpar.chLayout.order,\r\n      nbChannels: codecpar.chLayout.nbChannels,\r\n      u: codecpar.chLayout.u.mask\r\n    },\r\n    sampleRate: codecpar.sampleRate,\r\n    blockAlign: codecpar.blockAlign,\r\n    frameSize: codecpar.frameSize,\r\n    initialPadding: codecpar.initialPadding,\r\n    trailingPadding: codecpar.trailingPadding,\r\n    seekPreroll: codecpar.seekPreroll,\r\n    bitFormat: codecpar.bitFormat\r\n  }\r\n\r\n  if (codecpar.extradataSize) {\r\n    serialize.extradata = mapUint8Array(codecpar.extradata, codecpar.extradataSize).slice()\r\n  }\r\n\r\n  for (let i = 0; i < codecpar.nbCodedSideData; i++) {\r\n    const ele = {\r\n      type: codecpar.codedSideData[i].type,\r\n      data: mapUint8Array(codecpar.codedSideData[i].data, codecpar.codedSideData[i].size).slice()\r\n    }\r\n    serialize.codedSideData.push(ele)\r\n  }\r\n\r\n  return serialize\r\n}\r\n\r\nexport function unserializeAVCodecParameters(serialize: AVCodecParametersSerialize, codecpar: pointer<AVCodecParameters> = nullptr) {\r\n  if (!codecpar) {\r\n    codecpar = avMalloc(sizeof(AVCodecParameters))\r\n    memset(codecpar, 0, sizeof(AVCodecParameters))\r\n  }\r\n\r\n  codecpar.codecType = serialize.codecType\r\n  codecpar.codecId = serialize.codecId\r\n  codecpar.codecTag = serialize.codecTag\r\n\r\n  if (serialize.extradata) {\r\n    if (codecpar.extradata) {\r\n      avFree(codecpar.extradata)\r\n    }\r\n    codecpar.extradata = avMalloc(serialize.extradata.length)\r\n    memcpyFromUint8Array(codecpar.extradata, serialize.extradata.length, serialize.extradata)\r\n    codecpar.extradataSize = serialize.extradata.length\r\n  }\r\n  if (serialize.codedSideData.length) {\r\n    for (let i = 0; i < serialize.codedSideData.length; i++) {\r\n      const data = avMalloc(serialize.codedSideData[i].data.length)\r\n      memcpyFromUint8Array(data, serialize.codedSideData[i].data.length, serialize.codedSideData[i].data)\r\n      addSideData(addressof(codecpar.codedSideData), addressof(codecpar.nbCodedSideData), serialize.codedSideData[i].type, data, serialize.codedSideData[i].data.length)\r\n    }\r\n  }\r\n  else {\r\n    freeAVPacketSideData(addressof(codecpar.codedSideData), addressof(codecpar.nbCodedSideData))\r\n  }\r\n  codecpar.format = serialize.format\r\n  codecpar.bitrate = serialize.bitrate\r\n  codecpar.bitsPerCodedSample = serialize.bitsPerCodedSample\r\n  codecpar.bitsPerRawSample = serialize.bitsPerRawSample\r\n  codecpar.profile = serialize.profile\r\n  codecpar.level = serialize.level\r\n  codecpar.width = serialize.width\r\n  codecpar.height = serialize.height\r\n  codecpar.sampleAspectRatio.den = serialize.sampleAspectRatio.den\r\n  codecpar.sampleAspectRatio.num = serialize.sampleAspectRatio.num\r\n  codecpar.framerate.den = serialize.framerate.den\r\n  codecpar.framerate.num = serialize.framerate.num\r\n  codecpar.fieldOrder = serialize.fieldOrder\r\n  codecpar.colorRange = serialize.colorRange\r\n  codecpar.colorPrimaries = serialize.colorPrimaries\r\n  codecpar.colorTrc = serialize.colorTrc\r\n  codecpar.colorSpace = serialize.colorSpace\r\n  codecpar.chromaLocation = serialize.chromaLocation\r\n  codecpar.videoDelay = serialize.videoDelay\r\n  codecpar.chLayout.order = serialize.chLayout.order\r\n  codecpar.chLayout.nbChannels = serialize.chLayout.nbChannels\r\n  codecpar.chLayout.u.mask = serialize.chLayout.u\r\n  codecpar.sampleRate = serialize.sampleRate\r\n  codecpar.blockAlign = serialize.blockAlign\r\n  codecpar.frameSize = serialize.frameSize\r\n  codecpar.initialPadding = serialize.initialPadding\r\n  codecpar.trailingPadding = serialize.trailingPadding\r\n  codecpar.seekPreroll = serialize.seekPreroll\r\n  codecpar.bitFormat = serialize.bitFormat\r\n\r\n  return codecpar\r\n}\r\n","/**\r\n * 基于 https://github.com/codemix/malloc 修改\r\n * 一个基于跳表的 malloc 算法\r\n * 添加支持自动扩堆，支持多线程和 alignedAlloc\r\n */\r\n\r\nimport Allocator from './Allocator'\r\nimport * as object from 'common/util/object'\r\nimport * as array from 'common/util/array'\r\nimport { lock, unlock } from '../thread/mutex'\r\nimport { heapMutex } from '../staticData'\r\nimport * as logger from 'common/util/logger'\r\n\r\nconst ALIGNMENT_IN_BYTES = 8\r\nconst ALIGNMENT_MASK = ALIGNMENT_IN_BYTES - 1\r\n\r\nconst POINTER_SIZE_IN_BYTES = 4\r\nconst BYTES_TO_QUADS_SHIFT = 2\r\nconst MIN_FREEABLE_SIZE_IN_BYTES = 16\r\nconst MIN_FREEABLE_SIZE_IN_QUADS = bytesToQuads(MIN_FREEABLE_SIZE_IN_BYTES)\r\n\r\nconst MAX_HEIGHT = 32\r\n\r\nconst HEADER_SIZE_IN_QUADS = 1 + (MAX_HEIGHT * 2)\r\nconst HEADER_OFFSET_IN_QUADS = 1\r\n\r\nconst HEIGHT_OFFSET_IN_QUADS = 0\r\nconst NEXT_OFFSET_IN_QUADS = 2\r\n\r\nconst POINTER_SIZE_IN_QUADS = 1\r\nconst POINTER_OVERHEAD_IN_QUADS = 2\r\n\r\nconst FIRST_BLOCK_OFFSET_IN_QUADS = HEADER_OFFSET_IN_QUADS + HEADER_SIZE_IN_QUADS + POINTER_OVERHEAD_IN_QUADS\r\nconst FIRST_BLOCK_OFFSET_IN_BYTES = FIRST_BLOCK_OFFSET_IN_QUADS * POINTER_SIZE_IN_BYTES\r\nconst OVERHEAD_IN_BYTES = (FIRST_BLOCK_OFFSET_IN_QUADS + 1) * POINTER_SIZE_IN_BYTES\r\n\r\ntype ListNode = {\r\n  type: string\r\n  offset: int32\r\n  size: int32\r\n  height: int32\r\n  pointers: int32[]\r\n  block: number\r\n}\r\n\r\ntype InspectionResult = {\r\n  header: ListNode\r\n  blocks: Array<{\r\n    type: string;\r\n    size: int32\r\n    node?: ListNode\r\n  }>\r\n  total: number\r\n  used: number\r\n}\r\n\r\nexport type AllocatorJSOptions = {\r\n  memory?: WebAssembly.Memory\r\n  buffer: ArrayBuffer | SharedArrayBuffer\r\n  byteOffset?: int32\r\n  byteLength?: int32\r\n  growAllowed?: boolean\r\n  growSize?: number\r\n  maxHeapSize?: number\r\n  onResize?: (old: Int32Array, need: number) => { buffer: ArrayBuffer, byteOffset?: number, byteLength?: number }\r\n}\r\n\r\nexport default class AllocatorJS implements Allocator {\r\n\r\n  private buffer: ArrayBuffer | SharedArrayBuffer\r\n\r\n  private byteOffset: int32\r\n\r\n  private heapOffset: int32\r\n\r\n  private heapLength: int32\r\n\r\n  private int32Array: Int32Array\r\n\r\n  private updates: Int32Array\r\n\r\n  private options: AllocatorJSOptions\r\n\r\n  private shared: boolean\r\n\r\n  private handles: ((buffer: ArrayBuffer) => void)[]\r\n\r\n  constructor(options: AllocatorJSOptions, init: boolean = true) {\r\n    this.options = object.extend({\r\n      growSize: 1 * 1024 * 1024,\r\n      maxHeapSize: 2000 * 1024 * 1024\r\n    }, options)\r\n    this.handles = []\r\n    this.buffer = options.buffer\r\n    this.shared = false\r\n    if (this.options.memory || this.buffer instanceof ArrayBuffer || this.buffer instanceof SharedArrayBuffer) {\r\n      this.byteOffset = options.byteOffset ?? 0\r\n      this.heapOffset = alignHeapOffset(this.byteOffset + quadsToBytes(MAX_HEIGHT), options.byteLength ?? this.buffer.byteLength)\r\n      this.heapLength = alignHeapLength((options.byteLength ?? this.buffer.byteLength) - this.heapOffset)\r\n\r\n      this.int32Array = new Int32Array(this.buffer, this.heapOffset, bytesToQuads(static_cast<int32>(this.heapLength)))\r\n      this.updates = new Int32Array(this.buffer, this.byteOffset, MAX_HEIGHT)\r\n\r\n      if (typeof SharedArrayBuffer === 'function' && this.buffer instanceof SharedArrayBuffer) {\r\n        this.shared = true\r\n      }\r\n    }\r\n    else {\r\n      logger.fatal('Expected buffer to be an instance of Buffer or ArrayBuffer')\r\n    }\r\n\r\n    if (init) {\r\n      this.updates.fill(HEADER_OFFSET_IN_QUADS)\r\n      prepare(this.int32Array)\r\n      checkListIntegrity(this.int32Array)\r\n    }\r\n  }\r\n\r\n  public addUpdateHandle(handle: (buffer: ArrayBuffer) => void): void {\r\n    if (!array.has(this.handles, handle)) {\r\n      this.handles.push(handle)\r\n    }\r\n  }\r\n\r\n  public removeUpdateHandle(handle: (buffer: ArrayBuffer) => void): void {\r\n    array.remove(this.handles, handle)\r\n  }\r\n\r\n  private malloc_(size: size): pointer<void> {\r\n    size = align(size, ALIGNMENT_MASK)\r\n    if (size < MIN_FREEABLE_SIZE_IN_BYTES) {\r\n      size = MIN_FREEABLE_SIZE_IN_BYTES\r\n    }\r\n\r\n    assert(!(!this.options.growSize && size > this.heapLength - OVERHEAD_IN_BYTES), `malloc size must be between ${MIN_FREEABLE_SIZE_IN_BYTES} bytes and ${this.heapLength - OVERHEAD_IN_BYTES} bytes`)\r\n\r\n    const minimumSize: int32 = bytesToQuads(size)\r\n    const block: int32 = this.findFreeBlock(this.int32Array, minimumSize)\r\n    if (block <= HEADER_OFFSET_IN_QUADS) {\r\n      return nullptr\r\n    }\r\n    const blockSize: int32 = readSize(this.int32Array, block)\r\n\r\n    if (blockSize - (minimumSize + POINTER_OVERHEAD_IN_QUADS) >= MIN_FREEABLE_SIZE_IN_QUADS) {\r\n      split(this.int32Array, block, minimumSize, blockSize, this.updates)\r\n    }\r\n    else {\r\n      assert(!(blockSize % 2))\r\n      remove(this.int32Array, block, blockSize, this.updates)\r\n    }\r\n\r\n    assert(!((quadsToBytes(block) & ALIGNMENT_MASK) !== nullptr), `Address must be a multiple of (${ALIGNMENT_IN_BYTES}).`)\r\n\r\n    return quadsToBytes(block) + this.heapOffset\r\n  }\r\n\r\n  /**\r\n   * Allocate a given number of bytes and return the offset.\r\n   * If allocation fails, returns 0.\r\n   */\r\n  public malloc(size: size): pointer<void> {\r\n\r\n    if (this.shared) {\r\n      lock(heapMutex, !defined(DEBUG))\r\n      this.checkBuffer()\r\n    }\r\n\r\n    const address = this.malloc_(size)\r\n\r\n    if (this.shared) {\r\n      unlock(heapMutex)\r\n    }\r\n\r\n    return address\r\n  }\r\n  public calloc_(num: size, size: size): pointer<void> {\r\n    let numberOfBytes = num * size\r\n\r\n    if (numberOfBytes < MIN_FREEABLE_SIZE_IN_BYTES) {\r\n      numberOfBytes = MIN_FREEABLE_SIZE_IN_BYTES\r\n    }\r\n    else {\r\n      numberOfBytes = align(numberOfBytes, ALIGNMENT_MASK)\r\n    }\r\n\r\n    const address = this.malloc_(numberOfBytes)\r\n    if (address === nullptr) {\r\n      // Not enough space\r\n      return nullptr\r\n    }\r\n    const offset = bytesToQuads(address - this.heapOffset)\r\n    this.int32Array.subarray(offset, offset + bytesToQuads(numberOfBytes)).fill(0)\r\n\r\n    return address\r\n  }\r\n\r\n  public calloc(num: size, size: size): pointer<void> {\r\n    if (this.shared) {\r\n      lock(heapMutex, !defined(DEBUG))\r\n      this.checkBuffer()\r\n    }\r\n\r\n    const address = this.calloc_(num, size)\r\n\r\n    if (this.shared) {\r\n      unlock(heapMutex)\r\n    }\r\n\r\n    return address\r\n  }\r\n\r\n  public realloc_(address: pointer<void>, size: size): pointer<void> {\r\n\r\n    if (address === nullptr) {\r\n      return this.malloc_(size)\r\n    }\r\n\r\n    assert(!((address & ALIGNMENT_MASK) !== nullptr), `Address must be a multiple of (${ALIGNMENT_IN_BYTES}).`)\r\n\r\n    const originAddress = address\r\n\r\n    if (size === 0) {\r\n      this.free_(originAddress)\r\n      return nullptr\r\n    }\r\n\r\n    address -= this.heapOffset\r\n\r\n    assert(!(address < FIRST_BLOCK_OFFSET_IN_BYTES || address > this.heapLength), `Address must be between ${FIRST_BLOCK_OFFSET_IN_BYTES} and ${this.heapLength - OVERHEAD_IN_BYTES}`)\r\n\r\n    let originBlock = bytesToQuads(reinterpret_cast<int32>(address))\r\n    let block = originBlock\r\n    let padding = 0\r\n\r\n    if (isAlign(this.int32Array, originBlock)) {\r\n      block = this.int32Array[originBlock - 1]\r\n      padding = originBlock - block\r\n    }\r\n\r\n    const blockSize: int32 = readSize(this.int32Array, block) - padding\r\n    const minimumSize: int32 = bytesToQuads(align(size, ALIGNMENT_MASK))\r\n\r\n    assert(!(blockSize < MIN_FREEABLE_SIZE_IN_QUADS || blockSize > (this.heapLength - OVERHEAD_IN_BYTES) / 4), `Invalid block: ${block}, got block size: ${quadsToBytes(blockSize)}`)\r\n\r\n    if (blockSize >= minimumSize) {\r\n      return originAddress\r\n    }\r\n    else {\r\n      const newAddress = this.malloc_(size)\r\n      if (newAddress === nullptr) {\r\n        this.free_(originAddress)\r\n        return nullptr\r\n      }\r\n      this.int32Array.set(\r\n        this.int32Array.subarray(originBlock, originBlock + blockSize),\r\n        bytesToQuads(newAddress - this.heapOffset)\r\n      )\r\n      this.free_(originAddress)\r\n      return newAddress\r\n    }\r\n  }\r\n\r\n  public realloc(address: pointer<void>, size: size): pointer<void> {\r\n    if (this.shared) {\r\n      lock(heapMutex, !defined(DEBUG))\r\n      this.checkBuffer()\r\n    }\r\n\r\n    address = this.realloc_(address, size)\r\n\r\n    if (this.shared) {\r\n      unlock(heapMutex)\r\n    }\r\n\r\n    return address\r\n  }\r\n\r\n  public alignedAlloc_(alignment: size, size: size): pointer<void> {\r\n\r\n    assert(alignment >= 4, `alignment must not smaller then 4, but got ${alignment}`)\r\n\r\n    assert(!(alignment & (alignment - 1)), `alignment must be power of 2, but got ${alignment}`)\r\n\r\n    if (alignment <= ALIGNMENT_IN_BYTES) {\r\n      // malloc 以 ALIGNMENT_IN_BYTES 字节对齐\r\n      return this.malloc_(size)\r\n    }\r\n\r\n    const address = this.malloc_(size + alignment - 1 + POINTER_SIZE_IN_BYTES)\r\n\r\n    if (address === nullptr) {\r\n      return nullptr\r\n    }\r\n\r\n    const alignmentAddress = (address + alignment - 1 + POINTER_SIZE_IN_BYTES) & ~(alignment - 1)\r\n\r\n    this.int32Array[bytesToQuads(alignmentAddress - this.heapOffset) - POINTER_SIZE_IN_QUADS] = bytesToQuads(address - this.heapOffset)\r\n\r\n    assert(!(alignmentAddress % alignment))\r\n\r\n    return alignmentAddress\r\n  }\r\n\r\n  public alignedAlloc(alignment: size, size: size): pointer<void> {\r\n    if (this.shared) {\r\n      lock(heapMutex, !defined(DEBUG))\r\n      this.checkBuffer()\r\n    }\r\n\r\n    const address = this.alignedAlloc_(alignment, size)\r\n\r\n    if (this.shared) {\r\n      unlock(heapMutex)\r\n    }\r\n\r\n    return address\r\n  }\r\n\r\n  private free_(address: pointer<void>): void {\r\n    if (address === nullptr) {\r\n      return\r\n    }\r\n\r\n    address -= this.heapOffset\r\n\r\n    assert(!((address & ALIGNMENT_MASK) !== nullptr), `Address must be a multiple of (${ALIGNMENT_IN_BYTES}).`)\r\n\r\n    assert(!(address < FIRST_BLOCK_OFFSET_IN_BYTES || address > this.heapLength), `Address must be between ${FIRST_BLOCK_OFFSET_IN_BYTES} and ${this.heapLength - OVERHEAD_IN_BYTES}`)\r\n\r\n    let block = bytesToQuads(reinterpret_cast<int32>(address))\r\n\r\n    if (isAlign(this.int32Array, block)) {\r\n      block = this.int32Array[block - POINTER_SIZE_IN_QUADS]\r\n    }\r\n\r\n    if (isFree(this.int32Array, block)) {\r\n      return\r\n    }\r\n\r\n    const blockSize: int32 = readSize(this.int32Array, block)\r\n\r\n    // 对地址是否合法进行断言\r\n    assert(blockSize === readSize(this.int32Array, block + blockSize + 1))\r\n\r\n    /* istanbul ignore if  */\r\n    assert(!(blockSize < MIN_FREEABLE_SIZE_IN_QUADS || blockSize > (this.heapLength - OVERHEAD_IN_BYTES) / 4), `Invalid block: ${block}, got block size: ${quadsToBytes(blockSize)}`)\r\n\r\n    const preceding: int32 = getFreeBlockBefore(this.int32Array, block)\r\n    const trailing: int32 = getFreeBlockAfter(this.int32Array, block)\r\n\r\n    if (preceding !== nullptr) {\r\n      if (trailing !== nullptr) {\r\n        insertMiddle(this.int32Array, preceding, block, blockSize, trailing, this.updates)\r\n      }\r\n      else {\r\n        insertAfter(this.int32Array, preceding, block, blockSize, this.updates)\r\n      }\r\n    }\r\n    else if (trailing !== nullptr) {\r\n      insertBefore(this.int32Array, trailing, block, blockSize, this.updates)\r\n    }\r\n    else {\r\n      insert(this.int32Array, block, blockSize, this.updates)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Free a number of bytes from the given address.\r\n   */\r\n  public free(address: pointer<void>): void {\r\n    if (this.shared) {\r\n      lock(heapMutex, !defined(DEBUG))\r\n      this.checkBuffer()\r\n    }\r\n\r\n    this.free_(address)\r\n\r\n    if (this.shared) {\r\n      unlock(heapMutex)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Return the size of the block at the given address.\r\n   */\r\n  public sizeof(address: int32): size {\r\n\r\n    if (address === nullptr) {\r\n      return 0\r\n    }\r\n\r\n    address -= this.heapOffset\r\n\r\n    assert(!(address < FIRST_BLOCK_OFFSET_IN_BYTES || address > this.heapLength || typeof address !== 'number' || isNaN(address)), `Address must be between ${FIRST_BLOCK_OFFSET_IN_BYTES} and ${this.heapLength - OVERHEAD_IN_BYTES}`)\r\n\r\n    assert(!((address & ALIGNMENT_MASK) !== nullptr), `Address must be a multiple of the pointer size (${POINTER_SIZE_IN_BYTES}).`)\r\n\r\n    let block = bytesToQuads(address)\r\n\r\n    if (isAlign(this.int32Array, block)) {\r\n      block = this.int32Array[block - POINTER_SIZE_IN_QUADS]\r\n    }\r\n\r\n    return quadsToBytes(readSize(this.int32Array, block))\r\n  }\r\n\r\n  /**\r\n   * 获取堆分配信息\r\n   * \r\n   * @returns \r\n   */\r\n  public inspect(): InspectionResult {\r\n    this.checkBuffer()\r\n    return inspect(this.int32Array, this.heapOffset)\r\n  }\r\n\r\n  private findFreeBlock(int32Array: Int32Array, minimumSize: int32): int32 {\r\n    let block: int32 = findFreeBlock(int32Array, minimumSize)\r\n    if (block === HEADER_OFFSET_IN_QUADS) {\r\n      if (this.options.growAllowed && this.heapLength < this.options.maxHeapSize) {\r\n\r\n        const block = this.int32Array.length + 1\r\n\r\n        let int32Array: Int32Array\r\n        let updates: Int32Array\r\n        let byteOffset = 0\r\n        let heapLength = 0\r\n        let heapOffset = 0\r\n\r\n        if (this.options.onResize) {\r\n          const result = this.options.onResize(\r\n            this.int32Array,\r\n            this.int32Array.byteLength + align(Math.max(this.options.growSize, quadsToBytes(minimumSize)), ALIGNMENT_MASK)\r\n          )\r\n          byteOffset = result.byteOffset ?? 0\r\n          heapOffset = alignHeapOffset(byteOffset + quadsToBytes(MAX_HEIGHT), result.byteLength ?? result.buffer.byteLength)\r\n          heapLength = alignHeapLength((result.byteLength ?? result.buffer.byteLength) - heapOffset)\r\n          int32Array = new Int32Array(result.buffer, heapOffset, bytesToQuads(heapLength))\r\n          updates = new Int32Array(result.buffer, byteOffset, MAX_HEIGHT)\r\n        }\r\n        else {\r\n          const buffer = new ArrayBuffer(this.int32Array.length + bytesToQuads(this.options.growSize))\r\n          heapOffset = alignHeapOffset(byteOffset + quadsToBytes(MAX_HEIGHT), buffer.byteLength)\r\n          heapLength = alignHeapLength(buffer.byteLength - heapOffset)\r\n          int32Array = new Int32Array(buffer, heapOffset, bytesToQuads(heapLength))\r\n          int32Array.set(this.int32Array, 0)\r\n          updates = new Int32Array(buffer, byteOffset, MAX_HEIGHT)\r\n        }\r\n\r\n        this.byteOffset = byteOffset\r\n        this.heapOffset = heapOffset\r\n        this.buffer = int32Array.buffer\r\n        this.heapLength = heapLength\r\n        this.int32Array = int32Array\r\n        this.updates = updates\r\n\r\n        const blockSize = int32Array.length - (block - 1) - POINTER_OVERHEAD_IN_QUADS\r\n\r\n        writeFreeBlockSize(int32Array, blockSize, block)\r\n\r\n        const preceding: int32 = getFreeBlockBefore(int32Array, block)\r\n        if (preceding !== nullptr) {\r\n          insertAfter(int32Array, preceding, block, blockSize, this.updates)\r\n        }\r\n        else {\r\n          insert(int32Array, block, blockSize, this.updates)\r\n        }\r\n\r\n        if (this.handles.length) {\r\n          array.each(this.handles, (func) => {\r\n            func(this.buffer)\r\n          })\r\n        }\r\n\r\n        return this.findFreeBlock(this.int32Array, minimumSize)\r\n      }\r\n      return block\r\n    }\r\n    else {\r\n      return block\r\n    }\r\n  }\r\n\r\n  public getBuffer(): ArrayBuffer {\r\n    return this.buffer\r\n  }\r\n\r\n  public isAlloc(pointer: pointer<void>) {\r\n    if (this.shared) {\r\n      lock(heapMutex, !defined(DEBUG))\r\n      this.checkBuffer()\r\n    }\r\n    const block = bytesToQuads(pointer - this.heapOffset)\r\n    let next: int32 = this.int32Array[HEADER_OFFSET_IN_QUADS + NEXT_OFFSET_IN_QUADS]\r\n    // sometime get undefined from the last free node in v8\r\n    // but it's is all right |=_=\r\n    while (next && next !== HEADER_OFFSET_IN_QUADS) {\r\n      if (block >= next && block < next + this.int32Array[next - POINTER_SIZE_IN_QUADS]) {\r\n        if (this.shared) {\r\n          unlock(heapMutex)\r\n        }\r\n        return false\r\n      }\r\n      next = this.int32Array[next + NEXT_OFFSET_IN_QUADS]\r\n    }\r\n    if (this.shared) {\r\n      unlock(heapMutex)\r\n    }\r\n    return true\r\n  }\r\n\r\n  private checkBuffer() {\r\n    if (this.options.memory && this.options.memory.buffer !== this.buffer) {\r\n      this.buffer = this.options.memory.buffer\r\n      this.heapLength = alignHeapLength(this.buffer.byteLength - this.heapOffset)\r\n      this.int32Array = new Int32Array(this.buffer, this.heapOffset, bytesToQuads(static_cast<int32>(this.heapLength)))\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Prepare the given int32Array and ensure it contains a valid header.\r\n */\r\nfunction prepare(int32Array: Int32Array) {\r\n  if (!verifyHeader(int32Array)) {\r\n    writeInitialHeader(int32Array)\r\n  }\r\n}\r\n\r\n/**\r\n * Verify that the int32Array contains a valid header.\r\n */\r\nfunction verifyHeader(int32Array: Int32Array): boolean {\r\n  return int32Array[HEADER_OFFSET_IN_QUADS - 1] === HEADER_SIZE_IN_QUADS\r\n    && int32Array[HEADER_OFFSET_IN_QUADS + HEADER_SIZE_IN_QUADS] === HEADER_SIZE_IN_QUADS\r\n}\r\n\r\n/**\r\n * Write the initial header for an empty int32Array.\r\n */\r\nfunction writeInitialHeader(int32Array: Int32Array) {\r\n  const header = HEADER_OFFSET_IN_QUADS\r\n  const headerSize = HEADER_SIZE_IN_QUADS\r\n  const block = FIRST_BLOCK_OFFSET_IN_QUADS\r\n  const blockSize = int32Array.length - (header + headerSize + POINTER_OVERHEAD_IN_QUADS + POINTER_SIZE_IN_QUADS)\r\n\r\n  writeFreeBlockSize(int32Array, headerSize, header)\r\n  int32Array[header + HEIGHT_OFFSET_IN_QUADS] = 1\r\n  int32Array[header + NEXT_OFFSET_IN_QUADS] = block\r\n  for (let height = 1; height < MAX_HEIGHT; height++) {\r\n    int32Array[header + NEXT_OFFSET_IN_QUADS + height] = HEADER_OFFSET_IN_QUADS\r\n  }\r\n\r\n  writeFreeBlockSize(int32Array, blockSize, block)\r\n  int32Array[block + HEIGHT_OFFSET_IN_QUADS] = 1\r\n  int32Array[block + NEXT_OFFSET_IN_QUADS] = header\r\n}\r\n\r\n/**\r\n * Check the integrity of the freelist in the given array.\r\n */\r\nfunction checkListIntegrity(int32Array: Int32Array): boolean {\r\n  let block: int32 = FIRST_BLOCK_OFFSET_IN_QUADS\r\n  while (block < int32Array.length - POINTER_SIZE_IN_QUADS) {\r\n    const size: int32 = readSize(int32Array, block)\r\n    /* istanbul ignore if  */\r\n    if (size < POINTER_OVERHEAD_IN_QUADS || size >= int32Array.length - FIRST_BLOCK_OFFSET_IN_QUADS) {\r\n      logger.fatal(`Got invalid sized chunk at ${quadsToBytes(block)} (${quadsToBytes(size)} bytes).`)\r\n    }\r\n    else if (isFree(int32Array, block)) {\r\n      checkFreeBlockIntegrity(int32Array, block, size)\r\n    }\r\n    else {\r\n      checkUsedBlockIntegrity(int32Array, block, size)\r\n    }\r\n    block += size + POINTER_OVERHEAD_IN_QUADS\r\n  }\r\n  return true\r\n}\r\n\r\nfunction checkFreeBlockIntegrity(int32Array: Int32Array, block: int32, blockSize: int32): boolean {\r\n  /* istanbul ignore if  */\r\n  if (int32Array[block - 1] !== int32Array[block + blockSize]) {\r\n    logger.fatal(`Block length header does not match footer (${quadsToBytes(int32Array[block - 1])} vs ${quadsToBytes(int32Array[block + blockSize])}).`)\r\n  }\r\n  const height: int32 = int32Array[block + HEIGHT_OFFSET_IN_QUADS]\r\n  /* istanbul ignore if  */\r\n  if (height < 1 || height > MAX_HEIGHT) {\r\n    logger.fatal(`Block ${quadsToBytes(block)} height must be between 1 and ${MAX_HEIGHT}, got ${height}.`)\r\n  }\r\n  for (let i = 0; i < height; i++) {\r\n    const pointer = int32Array[block + NEXT_OFFSET_IN_QUADS + i]\r\n    /* istanbul ignore if  */\r\n    if (pointer >= FIRST_BLOCK_OFFSET_IN_QUADS && !isFree(int32Array, pointer)) {\r\n      logger.fatal(`Block ${quadsToBytes(block)} has a pointer to a non-free block (${quadsToBytes(pointer)}).`)\r\n    }\r\n  }\r\n  return true\r\n}\r\n\r\nfunction checkUsedBlockIntegrity(int32Array: Int32Array, block: int32, blockSize: int32): boolean {\r\n  /* istanbul ignore if  */\r\n  if (int32Array[block - 1] !== int32Array[block + blockSize]) {\r\n    logger.fatal(`Block length header does not match footer (${quadsToBytes(int32Array[block - 1])} vs ${quadsToBytes(int32Array[block + blockSize])}).`)\r\n  }\r\n  else {\r\n    return true\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * Inspect the freelist in the given array.\r\n */\r\nfunction inspect(int32Array: Int32Array, byteOffset: number): InspectionResult {\r\n  const blocks: { type: string; size: int32; node?: ListNode; offset: number, block: number }[] = []\r\n  const header: ListNode = readListNode(int32Array, HEADER_OFFSET_IN_QUADS, byteOffset)\r\n  let block: int32 = FIRST_BLOCK_OFFSET_IN_QUADS\r\n  let used = 0\r\n  while (block < int32Array.length - POINTER_SIZE_IN_QUADS) {\r\n    const size: int32 = readSize(int32Array, block)\r\n    /* istanbul ignore if  */\r\n    if (size < POINTER_OVERHEAD_IN_QUADS || size >= int32Array.length) {\r\n      logger.fatal(`Got invalid sized chunk at ${quadsToBytes(block)} (${quadsToBytes(size)})`)\r\n    }\r\n    if (isFree(int32Array, block)) {\r\n      // @flowIssue todo\r\n      blocks.push(readListNode(int32Array, block, byteOffset))\r\n    }\r\n    else {\r\n      used += quadsToBytes(size)\r\n      blocks.push({\r\n        type: 'used',\r\n        block: block,\r\n        offset: quadsToBytes(block) + byteOffset,\r\n        size: quadsToBytes(size)\r\n      })\r\n    }\r\n    block += size + POINTER_OVERHEAD_IN_QUADS\r\n  }\r\n  return { header, blocks, total: quadsToBytes(int32Array.length), used}\r\n}\r\n\r\n/**\r\n * Convert quads to bytes.\r\n */\r\nfunction quadsToBytes(num: int32): int32 {\r\n  return (num << BYTES_TO_QUADS_SHIFT) >>> 0\r\n}\r\n\r\n/**\r\n * Convert bytes to quads.\r\n */\r\nfunction bytesToQuads(num: int32): int32 {\r\n  return num >>> BYTES_TO_QUADS_SHIFT\r\n}\r\n\r\n/**\r\n * Align the given value to 8 bytes.\r\n */\r\nfunction align(value: int32, alignment: size): int32 {\r\n  return ((value + alignment) & ~alignment) >>> 0\r\n}\r\n\r\n/**\r\n * align heap\r\n * \r\n * @param offset heap start offset\r\n * @param byteLength  buffer length\r\n * @returns \r\n */\r\nfunction alignHeapOffset(offset: int32, byteLength: int32) {\r\n  const length = byteLength - offset\r\n  // 保证 heapLength 为 ALIGNMENT_IN_BYTES 对齐\r\n  let heapOffset = offset + (align(length, ALIGNMENT_MASK) === length\r\n    ? 0\r\n    : (length - align(length, ALIGNMENT_MASK) + ALIGNMENT_IN_BYTES))\r\n\r\n  return heapOffset\r\n}\r\n\r\nfunction alignHeapLength(length: int32) {\r\n  // header 所占 int length 为奇数，则总长度也需要为奇数保证 body 为偶数\r\n  if (!((HEADER_OFFSET_IN_QUADS + HEADER_SIZE_IN_QUADS) % 2)) {\r\n    length -= POINTER_SIZE_IN_BYTES\r\n  }\r\n  return length\r\n}\r\n\r\n/**\r\n * Read the list pointers for a given block.\r\n */\r\nfunction readListNode(int32Array: Int32Array, block: int32, byteOffset: size): ListNode {\r\n  const height: int32 = int32Array[block + HEIGHT_OFFSET_IN_QUADS]\r\n  const pointers: int32[] = []\r\n  for (let i = 0; i < height; i++) {\r\n    pointers.push(int32Array[block + NEXT_OFFSET_IN_QUADS + i])\r\n  }\r\n\r\n  return {\r\n    type: 'free',\r\n    block,\r\n    offset: quadsToBytes(block) + byteOffset,\r\n    height,\r\n    pointers,\r\n    size: quadsToBytes(int32Array[block - 1])\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * Read the size (in quads) of the block at the given address.\r\n */\r\nfunction readSize(int32Array: Int32Array, block: int32): int32 {\r\n  const n = int32Array[block - 1]\r\n  const mask = n >> 31\r\n  return (n + mask) ^ mask\r\n}\r\n\r\n/**\r\n * Write the size of the block at the given address.\r\n * Note: This ONLY works for free blocks, not blocks in use.\r\n */\r\nfunction writeFreeBlockSize(int32Array: Int32Array, size: int32, block: int32): void {\r\n  int32Array[block - 1] = size\r\n  int32Array[block + size] = size\r\n}\r\n\r\n/**\r\n * Populate the `UPDATES` array with the offset of the last item in each\r\n * list level, *before* a node of at least the given size.\r\n */\r\nfunction findPredecessors(int32Array: Int32Array, minimumSize: int32, UPDATES: Int32Array): void {\r\n  const listHeight: int32 = int32Array[HEADER_OFFSET_IN_QUADS + HEIGHT_OFFSET_IN_QUADS]\r\n\r\n  let node: int32 = HEADER_OFFSET_IN_QUADS\r\n\r\n  for (let height = listHeight; height > 0; height--) {\r\n    let next: int32 = node + NEXT_OFFSET_IN_QUADS + (height - 1)\r\n    while (int32Array[next] >= FIRST_BLOCK_OFFSET_IN_QUADS && int32Array[int32Array[next] - 1] < minimumSize) {\r\n      node = int32Array[next]\r\n      next = node + NEXT_OFFSET_IN_QUADS + (height - 1)\r\n    }\r\n    UPDATES[height - 1] = node\r\n  }\r\n}\r\n\r\n/**\r\n * Find a free block with at least the given size and return its offset in quads.\r\n */\r\nfunction findFreeBlock(int32Array: Int32Array, minimumSize: int32): int32 {\r\n  let block: int32 = HEADER_OFFSET_IN_QUADS\r\n\r\n  for (let height = int32Array[HEADER_OFFSET_IN_QUADS + HEIGHT_OFFSET_IN_QUADS]; height > 0; height--) {\r\n    let next: int32 = int32Array[block + NEXT_OFFSET_IN_QUADS + (height - 1)]\r\n    while (next !== HEADER_OFFSET_IN_QUADS && int32Array[next - POINTER_SIZE_IN_QUADS] < minimumSize) {\r\n      block = next\r\n      next = int32Array[block + NEXT_OFFSET_IN_QUADS + (height - 1)]\r\n    }\r\n  }\r\n\r\n  block = int32Array[block + NEXT_OFFSET_IN_QUADS]\r\n  if (block === HEADER_OFFSET_IN_QUADS) {\r\n    return block\r\n  }\r\n  else {\r\n    return block\r\n  }\r\n}\r\n\r\n/**\r\n * Split the given block after a certain number of bytes and add the second half to the freelist.\r\n */\r\nfunction split(int32Array: Int32Array, block: int32, firstSize: int32, blockSize: int32, UPDATES: Int32Array): void {\r\n  const second: int32 = (block + firstSize + POINTER_OVERHEAD_IN_QUADS)\r\n  const secondSize: int32 = (blockSize - (second - block))\r\n\r\n  remove(int32Array, block, blockSize, UPDATES)\r\n\r\n  int32Array[block - 1] = -firstSize\r\n  int32Array[block + firstSize] = -firstSize\r\n\r\n  int32Array[second - 1] = -secondSize\r\n  int32Array[second + secondSize] = -secondSize\r\n\r\n  insert(int32Array, second, secondSize, UPDATES)\r\n}\r\n\r\n/**\r\n * Remove the given block from the freelist and mark it as allocated.\r\n */\r\nfunction remove(int32Array: Int32Array, block: int32, blockSize: int32, UPDATES: Int32Array): void {\r\n  findPredecessors(int32Array, blockSize, UPDATES)\r\n\r\n  let node: int32 = int32Array[UPDATES[0] + NEXT_OFFSET_IN_QUADS]\r\n\r\n  while (node !== block && node !== HEADER_OFFSET_IN_QUADS && int32Array[node - 1] <= blockSize) {\r\n    for (let height: number = int32Array[node + HEIGHT_OFFSET_IN_QUADS] - 1; height >= 0; height--) {\r\n      if (int32Array[node + NEXT_OFFSET_IN_QUADS + height] === block) {\r\n        UPDATES[height] = node\r\n      }\r\n    }\r\n    node = int32Array[node + NEXT_OFFSET_IN_QUADS]\r\n  }\r\n\r\n  assert(node === block, 'Could not find block to remove.')\r\n\r\n  let listHeight: int32 = int32Array[HEADER_OFFSET_IN_QUADS + HEIGHT_OFFSET_IN_QUADS]\r\n  for (let height = 0; height < listHeight; height++) {\r\n    const next: int32 = int32Array[UPDATES[height] + NEXT_OFFSET_IN_QUADS + height]\r\n    if (next !== block) {\r\n      break\r\n    }\r\n    int32Array[UPDATES[height] + NEXT_OFFSET_IN_QUADS + height] = int32Array[block + NEXT_OFFSET_IN_QUADS + height]\r\n  }\r\n\r\n  while (listHeight > 0 && int32Array[HEADER_OFFSET_IN_QUADS + NEXT_OFFSET_IN_QUADS + (listHeight - 1)] === HEADER_OFFSET_IN_QUADS) {\r\n    listHeight--\r\n    int32Array[HEADER_OFFSET_IN_QUADS + HEIGHT_OFFSET_IN_QUADS] = listHeight\r\n  }\r\n  // invert the size sign to signify an allocated block\r\n\r\n  int32Array[block - 1] = -blockSize\r\n  int32Array[block + blockSize] = -blockSize\r\n}\r\n\r\n/**\r\n * Determine whether the block at the given address is free or not.\r\n */\r\nfunction isFree(int32Array: Int32Array, block: int32): boolean {\r\n  /* istanbul ignore if  */\r\n  if (block < HEADER_SIZE_IN_QUADS) {\r\n    return false\r\n  }\r\n\r\n  const size: int32 = int32Array[block - POINTER_SIZE_IN_QUADS]\r\n\r\n  if (size < 0) {\r\n    return false\r\n  }\r\n  else {\r\n    return true\r\n  }\r\n}\r\n\r\n/**\r\n * Determine whether the block at the given address is free or not.\r\n */\r\nfunction isAlign(int32Array: Int32Array, block: int32): boolean {\r\n  /* istanbul ignore if  */\r\n  if (block < HEADER_SIZE_IN_QUADS) {\r\n    return false\r\n  }\r\n\r\n  const origin: int32 = int32Array[block - POINTER_SIZE_IN_QUADS]\r\n\r\n  if (origin < 0) {\r\n    return false\r\n  }\r\n  else {\r\n    return true\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * Get the address of the block before the given one and return the address *if it is free*,\r\n * otherwise 0.\r\n */\r\nfunction getFreeBlockBefore(int32Array: Int32Array, block: int32): int32 {\r\n  if (block <= FIRST_BLOCK_OFFSET_IN_QUADS) {\r\n    return nullptr\r\n  }\r\n  const beforeSize: int32 = int32Array[block - POINTER_OVERHEAD_IN_QUADS]\r\n\r\n  if (beforeSize < POINTER_OVERHEAD_IN_QUADS) {\r\n    return nullptr\r\n  }\r\n  return block - (POINTER_OVERHEAD_IN_QUADS + beforeSize)\r\n}\r\n\r\n/**\r\n * Get the address of the block after the given one and return its address *if it is free*,\r\n * otherwise 0.\r\n */\r\nfunction getFreeBlockAfter(int32Array: Int32Array, block: int32): int32 {\r\n  const blockSize: int32 = readSize(int32Array, block)\r\n  if (block + blockSize + POINTER_OVERHEAD_IN_QUADS >= int32Array.length - 2) {\r\n    // Block is the last in the list.\r\n    return nullptr\r\n  }\r\n  const next: int32 = (block + blockSize + POINTER_OVERHEAD_IN_QUADS)\r\n  const nextSize: int32 = int32Array[next - POINTER_SIZE_IN_QUADS]\r\n\r\n  if (nextSize < POINTER_OVERHEAD_IN_QUADS) {\r\n    return nullptr\r\n  }\r\n  return next\r\n}\r\n\r\n\r\n/**\r\n * Insert the given block into the freelist and return the number of bytes that were freed.\r\n */\r\nfunction insert(int32Array: Int32Array, block: int32, blockSize: int32, UPDATES: Int32Array): int32 {\r\n  findPredecessors(int32Array, blockSize, UPDATES)\r\n  const blockHeight: int32 = generateHeight(int32Array, block, blockSize, UPDATES)\r\n\r\n  for (let height = 1; height <= blockHeight; height++) {\r\n    const update: int32 = UPDATES[height - 1] + NEXT_OFFSET_IN_QUADS + (height - 1)\r\n    int32Array[block + NEXT_OFFSET_IN_QUADS + (height - 1)] = int32Array[update]\r\n    int32Array[update] = block\r\n    UPDATES[height - 1] = HEADER_OFFSET_IN_QUADS\r\n  }\r\n\r\n  int32Array[block - 1] = blockSize\r\n  int32Array[block + blockSize] = blockSize\r\n  return blockSize\r\n}\r\n\r\n\r\n/**\r\n * Insert the given block into the freelist before the given free block,\r\n * joining them together, returning the number of bytes which were freed.\r\n */\r\nfunction insertBefore(int32Array: Int32Array, trailing: int32, block: int32, blockSize: int32, UPDATES: Int32Array): int32 {\r\n  const trailingSize: int32 = readSize(int32Array, trailing)\r\n  remove(int32Array, trailing, trailingSize, UPDATES)\r\n  const size: int32 = (blockSize + trailingSize + POINTER_OVERHEAD_IN_QUADS)\r\n  int32Array[block - POINTER_SIZE_IN_QUADS] = -size\r\n  int32Array[trailing + trailingSize] = -size\r\n  insert(int32Array, block, size, UPDATES)\r\n  return blockSize\r\n}\r\n\r\n/**\r\n * Insert the given block into the freelist in between the given free blocks,\r\n * joining them together, returning the number of bytes which were freed.\r\n */\r\nfunction insertMiddle(int32Array: Int32Array, preceding: int32, block: int32, blockSize: int32, trailing: int32, UPDATES: Int32Array): int32 {\r\n  const precedingSize: int32 = readSize(int32Array, preceding)\r\n  const trailingSize: int32 = readSize(int32Array, trailing)\r\n  const size: int32 = ((trailing - preceding) + trailingSize)\r\n\r\n  remove(int32Array, preceding, precedingSize, UPDATES)\r\n  remove(int32Array, trailing, trailingSize, UPDATES)\r\n  int32Array[preceding - POINTER_SIZE_IN_QUADS] = -size\r\n  int32Array[trailing + trailingSize] = -size\r\n  insert(int32Array, preceding, size, UPDATES)\r\n  return blockSize\r\n}\r\n\r\n/**\r\n * Insert the given block into the freelist after the given free block,\r\n * joining them together, returning the number of bytes which were freed.\r\n */\r\nfunction insertAfter(int32Array: Int32Array, preceding: int32, block: int32, blockSize: int32, UPDATES: Int32Array): int32 {\r\n  const precedingSize: int32 = (block - preceding) - POINTER_OVERHEAD_IN_QUADS\r\n  const size: int32 = ((block - preceding) + blockSize)\r\n  remove(int32Array, preceding, precedingSize, UPDATES)\r\n  int32Array[preceding - POINTER_SIZE_IN_QUADS] = -size\r\n  int32Array[block + blockSize] = -size\r\n  insert(int32Array, preceding, size, UPDATES)\r\n  return blockSize\r\n}\r\n\r\n\r\n\r\n/**\r\n * Generate a random height for a block, growing the list height by 1 if required.\r\n */\r\nfunction generateHeight(int32Array: Int32Array, block: int32, blockSize: int32, UPDATES: Int32Array): int32 {\r\n  const listHeight: int32 = int32Array[HEADER_OFFSET_IN_QUADS + HEIGHT_OFFSET_IN_QUADS]\r\n  let height: int32 = randomHeight()\r\n\r\n  if (blockSize - 1 < height + 1) {\r\n    height = blockSize - 2\r\n  }\r\n\r\n  if (height > listHeight) {\r\n    const newHeight: int32 = listHeight + 1\r\n    int32Array[HEADER_OFFSET_IN_QUADS + HEIGHT_OFFSET_IN_QUADS] = newHeight\r\n    int32Array[HEADER_OFFSET_IN_QUADS + NEXT_OFFSET_IN_QUADS + (newHeight - 1)] = HEADER_OFFSET_IN_QUADS\r\n    UPDATES[newHeight] = HEADER_OFFSET_IN_QUADS\r\n    int32Array[block + HEIGHT_OFFSET_IN_QUADS] = newHeight\r\n    return newHeight\r\n  }\r\n  else {\r\n    int32Array[block + HEIGHT_OFFSET_IN_QUADS] = height\r\n    return height\r\n  }\r\n}\r\n\r\n/**\r\n * Generate a random height for a new block.\r\n */\r\nfunction randomHeight(): number {\r\n  let height: number = 1\r\n  while (Math.random() < 0.5 && height < MAX_HEIGHT) {\r\n    height += 1\r\n  }\r\n  return height\r\n}\r\n","\r\ninterface Node {\r\n  pointer: number\r\n  length: number\r\n  free: boolean\r\n}\r\n\r\nexport const enum BuiltinTableSlot {\r\n  FREE = 1,\r\n  MALLOC,\r\n  CALLOC,\r\n  REALLOC,\r\n  ALIGNED_ALLOC,\r\n  SLOT_NB\r\n}\r\n\r\nconst INIT_SIZE = 10\r\n\r\nexport class WebassemblyTable {\r\n\r\n  table: WebAssembly.Table\r\n\r\n  pointer: number\r\n\r\n  private nodes: Node[]\r\n\r\n  constructor() {\r\n    this.table = new WebAssembly.Table({\r\n      initial: BuiltinTableSlot.SLOT_NB + INIT_SIZE,\r\n      element: 'anyfunc'\r\n    })\r\n\r\n    this.pointer = BuiltinTableSlot.SLOT_NB\r\n    this.nodes = [{\r\n      pointer: this.pointer,\r\n      length: INIT_SIZE,\r\n      free: true\r\n    }]\r\n  }\r\n\r\n  public getPointer() {\r\n    return this.pointer\r\n  }\r\n\r\n  public alloc(count: number) {\r\n\r\n    let p = this.findFree(count)\r\n\r\n    if (p < 0) {\r\n      const last = this.nodes[this.nodes.length - 1]\r\n\r\n      const length = count - (last.free ? last.length : 0)\r\n\r\n      this.table.grow(length)\r\n\r\n      if (last.free) {\r\n        last.length = last.length + length\r\n      }\r\n      else {\r\n        this.nodes.push({\r\n          pointer: last.pointer + last.length,\r\n          length,\r\n          free: true\r\n        })\r\n      }\r\n\r\n      p = this.findFree(count)\r\n    }\r\n\r\n    const node = this.nodes[p]\r\n\r\n    if (node.length > count) {\r\n      this.nodes.splice(p + 1, 0, {\r\n        pointer: node.pointer + count,\r\n        length: node.length - count,\r\n        free: true\r\n      })\r\n      node.length = count\r\n    }\r\n\r\n    node.free = false\r\n\r\n    return node.pointer\r\n  }\r\n\r\n  public free(pointer: number) {\r\n    let p = this.findNode(pointer)\r\n    const node = this.nodes[p]\r\n\r\n    if (node && !node.free) {\r\n      const before = this.nodes[p - 1]\r\n      const after = this.nodes[p + 1]\r\n\r\n      if (before && before.free) {\r\n        if (after && after.free) {\r\n          before.length += (node.length + after.length)\r\n          this.nodes.splice(p, 2)\r\n        }\r\n        else {\r\n          before.length += node.length\r\n          this.nodes.splice(p, 1)\r\n        }\r\n      }\r\n      else {\r\n        if (after && after.free) {\r\n          node.length += after.length\r\n          this.nodes.splice(p + 1, 1)\r\n          node.free = true\r\n        }\r\n        else {\r\n          node.free = true\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this.nodes.length === 1 && this.nodes[0].free) {\r\n      // 当全部 free 之后重新创建新的 Table，之前 WebAssembly 设置的函数引用在 chrome 上没有被回收，会内存泄漏\r\n      const table = new WebAssembly.Table({\r\n        initial: BuiltinTableSlot.SLOT_NB + INIT_SIZE,\r\n        element: 'anyfunc'\r\n      })\r\n      this.pointer = BuiltinTableSlot.SLOT_NB\r\n      this.nodes = [{\r\n        pointer: this.pointer,\r\n        length: INIT_SIZE,\r\n        free: true\r\n      }]\r\n      for (let i = 1; i < this.pointer; i++) {\r\n        table.set(i, this.table.get(i))\r\n      }\r\n      this.table = table\r\n    }\r\n  }\r\n\r\n  public get<T extends(...args: any[]) => any>(index: pointer<T>): T {\r\n    return this.table.get(index)\r\n  }\r\n\r\n  public set<T extends(...args: any[]) => any>(index: number, value: T) {\r\n    if (index < 0 || index >= this.pointer) {\r\n      throw new RangeError('index out of bound')\r\n    }\r\n    this.table.set(index, value)\r\n  }\r\n\r\n  public inspect() {\r\n    return this.nodes\r\n  }\r\n\r\n  private findFree(length: number) {\r\n    let index = -1\r\n    for (let i = 0; i < this.nodes.length; i++) {\r\n      if (this.nodes[i].length >= length && this.nodes[i].free) {\r\n        index = i\r\n        break\r\n      }\r\n    }\r\n    return index\r\n  }\r\n\r\n  private findNode(pointer: number) {\r\n    let index = -1\r\n    for (let i = 0; i < this.nodes.length; i++) {\r\n      if (this.nodes[i].pointer === pointer) {\r\n        index = i\r\n        break\r\n      }\r\n    }\r\n    return index\r\n  }\r\n}\r\n","import { base64ToUint8Array } from 'common/util/base64'\r\nimport * as logger from 'common/util/logger'\r\nimport { override as readoverride} from '../ctypeEnumRead'\r\nimport { override as writeoverride} from '../ctypeEnumWrite'\r\nimport * as wasmUtils from 'common/util/wasm'\r\n\r\nimport asm from './memory.asm'\r\nimport { CTypeEnum } from '../typedef'\r\n\r\n/**\r\n * WebAssembly runtime 实例\r\n */\r\nexport let instance: WebAssembly.Instance\r\n\r\nexport function support() {\r\n  return !!instance\r\n}\r\n\r\nexport default async function init(memory: WebAssembly.Memory) {\r\n  try {\r\n    let wasm = base64ToUint8Array(asm)\r\n    wasmUtils.setMemoryShared(wasm, typeof SharedArrayBuffer === 'function' && memory.buffer instanceof SharedArrayBuffer)\r\n\r\n    instance = (await WebAssembly.instantiate(wasm, {\r\n      env: {\r\n        memory\r\n      }\r\n    })).instance\r\n\r\n    readoverride({\r\n      [CTypeEnum.char]: instance.exports.readU8 as any,\r\n      [CTypeEnum.atomic_char]: instance.exports.readU8 as any,\r\n      [CTypeEnum.uint8]: instance.exports.readU8 as any,\r\n      [CTypeEnum.atomic_uint8]: instance.exports.readU8 as any,\r\n      [CTypeEnum.uint16]: instance.exports.readU16 as any,\r\n      [CTypeEnum.atomic_uint16]: instance.exports.readU16 as any,\r\n      [CTypeEnum.uint32]: (pointer: pointer<void>) => {\r\n        return (instance.exports.read32 as Function)(pointer) >>> 0\r\n      },\r\n      [CTypeEnum.atomic_uint32]: (pointer: pointer<void>) => {\r\n        return (instance.exports.read32 as Function)(pointer) >>> 0\r\n      },\r\n      [CTypeEnum.uint64]: (pointer: pointer<void>) => {\r\n        return BigInt.asUintN(64, (instance.exports.read64 as Function)(pointer))\r\n      },\r\n      [CTypeEnum.atomic_uint64]: (pointer: pointer<void>) => {\r\n        return BigInt.asUintN(64, (instance.exports.read64 as Function)(pointer))\r\n      },\r\n\r\n      [CTypeEnum.int8]: instance.exports.read8 as any,\r\n      [CTypeEnum.atomic_int8]: instance.exports.read8 as any,\r\n      [CTypeEnum.int16]: instance.exports.read16 as any,\r\n      [CTypeEnum.atomic_int16]: instance.exports.read16 as any,\r\n      [CTypeEnum.int32]: instance.exports.read32 as any,\r\n      [CTypeEnum.atomic_int32]: instance.exports.read32 as any,\r\n      [CTypeEnum.int64]: instance.exports.read64 as any,\r\n      [CTypeEnum.atomic_int64]: instance.exports.read64 as any,\r\n\r\n      [CTypeEnum.float]: instance.exports.readf32 as any,\r\n      [CTypeEnum.double]: instance.exports.readf64 as any,\r\n\r\n      [CTypeEnum.pointer]: (pointer: pointer<void>) => {\r\n        return (instance.exports.read32 as Function)(pointer) >>> 0\r\n      }\r\n    })\r\n\r\n    writeoverride({\r\n      [CTypeEnum.char]: instance.exports.write8 as any,\r\n      [CTypeEnum.atomic_char]: instance.exports.write8 as any,\r\n\r\n      [CTypeEnum.uint8]: instance.exports.write8 as any,\r\n      [CTypeEnum.atomic_uint8]: instance.exports.write8 as any,\r\n      [CTypeEnum.uint16]: instance.exports.write16 as any,\r\n      [CTypeEnum.atomic_uint16]: instance.exports.write16 as any,\r\n      [CTypeEnum.uint32]: instance.exports.write32 as any,\r\n      [CTypeEnum.atomic_uint32]: instance.exports.write32 as any,\r\n      [CTypeEnum.uint64]: instance.exports.write64 as any,\r\n      [CTypeEnum.atomic_uint64]: instance.exports.write64 as any,\r\n\r\n      [CTypeEnum.int8]: instance.exports.write8 as any,\r\n      [CTypeEnum.atomic_int8]: instance.exports.write8 as any,\r\n      [CTypeEnum.int16]: instance.exports.write16 as any,\r\n      [CTypeEnum.atomic_int16]: instance.exports.write16 as any,\r\n      [CTypeEnum.int32]: instance.exports.write32 as any,\r\n      [CTypeEnum.atomic_int32]: instance.exports.write32 as any,\r\n      [CTypeEnum.int64]: instance.exports.write64 as any,\r\n      [CTypeEnum.atomic_int64]: instance.exports.write64 as any,\r\n\r\n      [CTypeEnum.float]: instance.exports.writef32 as any,\r\n      [CTypeEnum.double]: instance.exports.writef64 as any,\r\n\r\n      [CTypeEnum.pointer]: instance.exports.write32 as any\r\n    })\r\n  }\r\n  catch (error) {\r\n    logger.warn('memory asm not support, cannot use asm memory function')\r\n  }\r\n}\r\n","import support from 'common/util/support'\r\nimport { SELF } from 'common/util/constant'\r\nimport browser from 'common/util/browser'\r\nimport os from 'common/util/os'\r\n\r\n/**\r\n * 是否使用多线程\r\n */\r\nexport const USE_THREADS = defined(ENABLE_THREADS) && (support.thread || defined(ENV_NODE)) && (SELF as any).CHEAP_DISABLE_THREAD !== true\r\n\r\n/**\r\n * 栈地址对齐\r\n * 栈地址至少是 16 字节对齐，因为 wasm 的基本类型中最大是 v128 16 字节\r\n */\r\nexport let STACK_ALIGNMENT = 16\r\n\r\n/**\r\n * 栈大小，应为 STACK_ALIGNMENT 的整数倍\r\n */\r\nexport let STACK_SIZE = 1024 * 1024\r\n\r\n/**\r\n * 堆保留段，可用于静态数据区分配\r\n */\r\nexport const HEAP_OFFSET = 1024\r\n\r\n/**\r\n * 堆初始大小\r\n */\r\nexport const HEAP_INITIAL = ((SELF as any).CHEAP_HEAP_INITIAL ?? defined(CHEAP_HEAP_INITIAL))\r\n\r\n/**\r\n * 堆最大大小\r\n * ios safari 16 以下 对最大值有限制，太大分配不出来\r\n */\r\nexport const HEAP_MAXIMUM = (SELF as any).CHEAP_HEAP_MAXIMUM ?? (USE_THREADS && (os.ios && browser.safari && !browser.checkVersion(browser.majorVersion, '17', true)) ? 8192 : 65536)\r\n","import isLittleEndian from 'common/function/isLittleEndian'\r\nimport { CTypeEnum } from './typedef'\r\nimport { override as readoverride} from './ctypeEnumRead'\r\nimport { override as writeoverride} from './ctypeEnumWrite'\r\nimport AllocatorInterface from './allocator/Allocator'\r\n\r\nlet getAllocator: () => AllocatorInterface\r\nlet getView: () => DataView\r\n\r\nconst littleEndian = isLittleEndian()\r\n\r\nfunction writeU8(pointer: pointer<void>, value: uint8) {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  getView().setUint8(pointer, value)\r\n}\r\n\r\nfunction readU8(pointer: pointer<void>): uint8 {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  return getView().getUint8(pointer)\r\n}\r\n\r\nfunction writeU16(pointer: pointer<void>, value: uint16) {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  getView().setUint16(pointer, value, littleEndian)\r\n}\r\n\r\nfunction readU16(pointer: pointer<void>): uint16 {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  return getView().getUint16(pointer, littleEndian)\r\n}\r\n\r\nfunction writeU32(pointer: pointer<void>, value: uint32) {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  getView().setUint32(pointer, value, littleEndian)\r\n}\r\n\r\nfunction readU32(pointer: pointer<void>): uint32 {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  return getView().getUint32(pointer, littleEndian)\r\n}\r\n\r\nfunction writeU64(pointer: pointer<void>, value: uint64) {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  getView().setBigUint64(pointer, value, littleEndian)\r\n}\r\n\r\nfunction readU64(pointer: pointer<void>): uint64 {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  return getView().getBigUint64(pointer, littleEndian)\r\n}\r\n\r\nfunction write8(pointer: pointer<void>, value: int8) {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  getView().setInt8(pointer, value)\r\n}\r\n\r\nfunction read8(pointer: pointer<void>): int8 {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  return getView().getInt8(pointer)\r\n}\r\n\r\nfunction write16(pointer: pointer<void>, value: int16) {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  getView().setInt16(pointer, value, littleEndian)\r\n}\r\n\r\nfunction read16(pointer: pointer<void>): int16 {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  return getView().getInt16(pointer, littleEndian)\r\n}\r\n\r\nfunction write32(pointer: pointer<void>, value: int32) {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  getView().setInt32(pointer, value, littleEndian)\r\n}\r\n\r\nfunction read32(pointer: pointer<void>): int32 {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  return getView().getInt32(pointer, littleEndian)\r\n}\r\n\r\nfunction write64(pointer: pointer<void>, value: int64) {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  getView().setBigInt64(pointer, value, littleEndian)\r\n}\r\n\r\nfunction read64(pointer: pointer<void>): int64 {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  return getView().getBigInt64(pointer, littleEndian)\r\n}\r\n\r\nfunction writef32(pointer: pointer<void>, value: float) {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  getView().setFloat32(pointer, value, littleEndian)\r\n}\r\n\r\nfunction readf32(pointer: pointer<void>): float {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  return getView().getFloat32(pointer, littleEndian)\r\n}\r\n\r\nfunction writef64(pointer: pointer<void>, value: float64) {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  getView().setFloat64(pointer, value, littleEndian)\r\n}\r\n\r\nfunction readf64(pointer: pointer<void>): float64 | double {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  return getView().getFloat64(pointer, littleEndian)\r\n}\r\n\r\nfunction readPointer<T>(pointer: pointer<void>): pointer<T> {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  return getView().getUint32(pointer, littleEndian) as pointer<T>\r\n}\r\n\r\nfunction writePointer<T>(pointer: pointer<void>, value: pointer<T>) {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(getAllocator().isAlloc(pointer), `address ${pointer} is not alloc`)\r\n  return getView().setUint32(pointer, value, littleEndian)\r\n}\r\n\r\nexport default function init(getAllocator_: () => AllocatorInterface, getView_: () => DataView) {\r\n\r\n  getAllocator = getAllocator_\r\n  getView = getView_\r\n\r\n  readoverride({\r\n    [CTypeEnum.char]: readU8 as any,\r\n    [CTypeEnum.atomic_char]: readU8 as any,\r\n\r\n    [CTypeEnum.uint8]: readU8,\r\n    [CTypeEnum.atomic_uint8]: readU8 as any,\r\n    [CTypeEnum.uint16]: readU16,\r\n    [CTypeEnum.atomic_uint16]: readU16 as any,\r\n    [CTypeEnum.uint32]: readU32,\r\n    [CTypeEnum.atomic_uint32]: readU32 as any,\r\n    [CTypeEnum.uint64]: readU64,\r\n\r\n    [CTypeEnum.int8]: read8,\r\n    [CTypeEnum.atomic_int8]: read8 as any,\r\n    [CTypeEnum.int16]: read16,\r\n    [CTypeEnum.atomic_int16]: read16 as any,\r\n    [CTypeEnum.int32]: read32,\r\n    [CTypeEnum.atomic_int32]: read32 as any,\r\n    [CTypeEnum.int64]: read64,\r\n\r\n    [CTypeEnum.float]: readf32,\r\n    [CTypeEnum.double]: readf64,\r\n    [CTypeEnum.pointer]: readPointer,\r\n\r\n    [CTypeEnum.bool]: (pointer: pointer<void>) => {\r\n      return !!read8(pointer)\r\n    },\r\n    [CTypeEnum.atomic_bool]: (pointer: pointer<void>) => {\r\n      return !!read8(pointer)\r\n    }\r\n  })\r\n\r\n  writeoverride({\r\n    [CTypeEnum.char]: writeU8 as any,\r\n    [CTypeEnum.atomic_char]: writeU8,\r\n\r\n    [CTypeEnum.uint8]: writeU8,\r\n    [CTypeEnum.atomic_uint8]: writeU8,\r\n    [CTypeEnum.uint16]: writeU16,\r\n    [CTypeEnum.atomic_uint16]: writeU16 as any,\r\n    [CTypeEnum.uint32]: writeU32,\r\n    [CTypeEnum.atomic_uint32]: writeU32 as any,\r\n    [CTypeEnum.uint64]: writeU64,\r\n\r\n    [CTypeEnum.int8]: write8,\r\n    [CTypeEnum.atomic_int8]: write8 as any,\r\n    [CTypeEnum.int16]: write16,\r\n    [CTypeEnum.atomic_int16]: write16 as any,\r\n    [CTypeEnum.int32]: write32,\r\n    [CTypeEnum.atomic_int32]: write32 as any,\r\n    [CTypeEnum.int64]: write64,\r\n\r\n    [CTypeEnum.float]: writef32,\r\n    [CTypeEnum.double]: writef64,\r\n    [CTypeEnum.pointer]: writePointer,\r\n\r\n    [CTypeEnum.bool]: (pointer: pointer<void>, value: bool) => {\r\n      write8(pointer, value ? 1 : 0)\r\n    },\r\n    [CTypeEnum.atomic_bool]: ((pointer: pointer<void>, value: bool) => {\r\n      write8(pointer, value ? 1 : 0)\r\n    }) as any\r\n  })\r\n}\r\n","import { CTypeEnum, CTypeEnum2Type } from './typedef'\r\nimport * as object from 'common/util/object'\r\n\r\ntype CTypeEnumRead = {\r\n  [key in CTypeEnum]: (pointer: pointer<void>) => CTypeEnum2Type<key>\r\n}\r\n\r\nexport const CTypeEnumRead: CTypeEnumRead = {\r\n  [CTypeEnum.char]: function (pointer: pointer<void>) {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.atomic_char]: function (pointer: pointer<void>) {\r\n    throw new Error('unimplemented')\r\n  },\r\n\r\n  [CTypeEnum.uint8]: function (pointer: pointer<void>) {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.atomic_uint8]: function (pointer: pointer<void>) {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.uint16]: function (pointer: pointer<void>) {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.atomic_uint16]: function (pointer: pointer<void>) {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.uint32]: function (pointer: pointer<void>) {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.atomic_uint32]: function (pointer: pointer<void>) {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.uint64]: function (pointer: pointer<void>) {\r\n    throw new Error('unimplemented')\r\n  },\r\n\r\n  [CTypeEnum.int8]: function (pointer: pointer<void>) {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.atomic_int8]: function (pointer: pointer<void>) {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.int16]: function (pointer: pointer<void>) {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.atomic_int16]: function (pointer: pointer<void>) {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.int32]: function (pointer: pointer<void>) {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.atomic_int32]: function (pointer: pointer<void>) {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.int64]: function (pointer: pointer<void>) {\r\n    throw new Error('unimplemented')\r\n  },\r\n\r\n  [CTypeEnum.float]: function (pointer: pointer<void>) {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.double]: function (pointer: pointer<void>) {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.pointer]: function (pointer: pointer<void>) {\r\n    throw new Error('unimplemented')\r\n  },\r\n\r\n  [CTypeEnum.null]: function (pointer: pointer<void>) {\r\n    throw new Error('invalid operate')\r\n  },\r\n  [CTypeEnum.void]: function (pointer: pointer<void>) {\r\n    throw new Error('invalid operate')\r\n  },\r\n\r\n  [CTypeEnum.atomic_uint64]: function (pointer: pointer<void>) {\r\n    throw new Error('invalid operate')\r\n  },\r\n  [CTypeEnum.atomic_int64]: function (pointer: pointer<void>) {\r\n    throw new Error('invalid operate')\r\n  },\r\n\r\n  [CTypeEnum.bool]: function (pointer: pointer<void>) {\r\n    throw new Error('invalid operate')\r\n  },\r\n  [CTypeEnum.atomic_bool]: function (pointer: pointer<void>) {\r\n    throw new Error('invalid operate')\r\n  }\r\n}\r\n\r\nexport function override(funcs: Partial<CTypeEnumRead>) {\r\n  object.extend(CTypeEnumRead, funcs)\r\n}\r\n","import { CTypeEnum, CTypeEnum2Type } from './typedef'\r\nimport * as object from 'common/util/object'\r\n\r\ntype CTypeEnumWrite = {\r\n  [key in CTypeEnum]: (pointer: pointer<void>, value: CTypeEnum2Type<key>) => void\r\n}\r\nexport const CTypeEnumWrite: CTypeEnumWrite = {\r\n  [CTypeEnum.char]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.atomic_char]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('unimplemented')\r\n  },\r\n\r\n  [CTypeEnum.uint8]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.atomic_uint8]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.uint16]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.atomic_uint16]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.uint32]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.atomic_uint32]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.uint64]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('unimplemented')\r\n  },\r\n\r\n  [CTypeEnum.int8]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.atomic_int8]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.int16]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.atomic_int16]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.int32]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.atomic_int32]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.int64]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('unimplemented')\r\n  },\r\n\r\n  [CTypeEnum.float]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.double]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('unimplemented')\r\n  },\r\n  [CTypeEnum.pointer]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('unimplemented')\r\n  },\r\n\r\n  [CTypeEnum.null]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('invalid operate')\r\n  },\r\n  [CTypeEnum.void]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('invalid operate')\r\n  },\r\n\r\n  [CTypeEnum.atomic_uint64]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('invalid operate')\r\n  },\r\n  [CTypeEnum.atomic_int64]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('invalid operate')\r\n  },\r\n\r\n  [CTypeEnum.bool]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('invalid operate')\r\n  },\r\n  [CTypeEnum.atomic_bool]: function (pointer: pointer<void>, value: any): void {\r\n    throw new Error('invalid operate')\r\n  }\r\n}\r\n\r\nexport function override(funcs: Partial<CTypeEnumWrite>) {\r\n  object.extend(CTypeEnumWrite, funcs)\r\n}\r\n","import { CTypeEnumRead } from './ctypeEnumRead'\r\nimport { CTypeEnumWrite } from './ctypeEnumWrite'\r\nimport { symbolStructAddress, symbolStructKeysMeta } from './symbol'\r\nimport { CTypeEnum, CTypeEnum2Bytes, KeyMeta, KeyMetaKey, Struct } from './typedef'\r\nimport * as is from 'common/util/is'\r\nimport * as object from 'common/util/object'\r\nimport toString from 'common/function/toString'\r\nimport * as array from 'common/util/array'\r\n\r\nfunction definedProperty(target: any, key: string, get: () => any, set: (v: any) => void) {\r\n  Object.defineProperty(target, key, {\r\n    get,\r\n    set,\r\n    configurable: true,\r\n    enumerable: true\r\n  })\r\n}\r\n\r\n/**\r\n * 指针的值\r\n * \r\n * @param address \r\n * @returns \r\n */\r\nfunction getPointerValue(address: () => pointer<void>) {\r\n  return function () {\r\n    return CTypeEnumRead[CTypeEnum.pointer](address())\r\n  }\r\n}\r\n\r\nfunction getStruct(target: any, key: string, address: () => pointer<void>, struct: Struct | {}) {\r\n  return function () {\r\n    return target[`__$__${key}`] || (target[`__$__${key}`] = definedStruct(address(), struct))\r\n  }\r\n}\r\n\r\nfunction getCTypeEnumValue(address: () => pointer<void>, type: CTypeEnum) {\r\n  return function () {\r\n    return  CTypeEnumRead[type](address())\r\n  }\r\n}\r\n\r\nfunction getBitFieldValue(address: () => pointer<void>, type: CTypeEnum, bitLen: number, offset: number) {\r\n  const shift = CTypeEnum2Bytes[type] * 8 - offset - bitLen\r\n  const valueMask = Math.pow(2, bitLen) - 1\r\n  return function () {\r\n    let value = CTypeEnumRead[type as uint8](address())\r\n    return (value >>> shift) & valueMask\r\n  }\r\n}\r\n\r\nfunction setPointerValue(address: () => pointer<void>) {\r\n  return function (newValue: pointer<void>) {\r\n    CTypeEnumWrite[CTypeEnum.pointer](address(), newValue)\r\n  }\r\n}\r\n\r\nfunction setStruct(obj: Object, key: string, address: () => pointer<void>, struct: Struct | {}) {\r\n  const localKey = `__$__${key}`\r\n  return function (newValue: Object) {\r\n    const proxy = obj[localKey] || (obj[localKey] = definedStruct(address(), struct))\r\n    object.each(newValue, (value, key) => {\r\n      proxy[key] = value\r\n    })\r\n    obj[localKey] = proxy\r\n  }\r\n}\r\n\r\nfunction setCTypeEnumValue(address: () => pointer<void>, type: CTypeEnum) {\r\n  return function (newValue: any) {\r\n    CTypeEnumWrite[type as uint8](address(), newValue)\r\n  }\r\n}\r\n\r\nfunction setBitFieldValue(address: () => pointer<void>, type: CTypeEnum, bitLen: number, offset: number) {\r\n  let zeroMask = 0\r\n  let len = CTypeEnum2Bytes[type] * 8\r\n  for (let i = 0; i < bitLen; i++) {\r\n    zeroMask |= (1 << (len - 1 - (i + offset)))\r\n  }\r\n  const valueMask = Math.pow(2, bitLen) - 1\r\n  const shift = len - offset - bitLen\r\n\r\n  return function (newValue: any) {\r\n    const addr = address()\r\n    const value = CTypeEnumRead[type as uint8](addr)\r\n    CTypeEnumWrite[type as uint8](\r\n      addr,\r\n      (value & ~zeroMask) | ((newValue & valueMask) << shift)\r\n    )\r\n  }\r\n}\r\n\r\nfunction definedArrayStruct(address: () => pointer<void>, length: number, type: Struct | {}) {\r\n  const obj = {}\r\n  let size = sizeof(type)\r\n  for (let i = 0; i < length; i++) {\r\n    const key = toString(i)\r\n    definedProperty(\r\n      obj,\r\n      key,\r\n      getStruct(\r\n        obj,\r\n        key,\r\n        () => {\r\n          return address() + size * i\r\n        },\r\n        type\r\n      ),\r\n      setStruct(\r\n        obj,\r\n        key,\r\n        () => {\r\n          return address() + size * i\r\n        },\r\n        type\r\n      )\r\n    )\r\n  }\r\n\r\n  return obj\r\n}\r\n\r\nfunction definedArrayCTypeEnum(address: () => pointer<void>, length: number, type: CTypeEnum) {\r\n  const obj = {}\r\n  let size = sizeof(type)\r\n  for (let i = 0; i < length; i++) {\r\n    const key = toString(i)\r\n    definedProperty(\r\n      obj,\r\n      key,\r\n      getCTypeEnumValue(\r\n        () => {\r\n          return address() + size * i\r\n        },\r\n        type\r\n      ),\r\n      setCTypeEnumValue(\r\n        () => {\r\n          return address() + size * i\r\n        },\r\n        type\r\n      )\r\n    )\r\n  }\r\n\r\n  return obj\r\n}\r\n\r\nfunction getArray(address: () => pointer<void>, target: Object, key: string) {\r\n  return function () {\r\n    const t = target[`__$__${key}`]\r\n    t[symbolStructAddress] = address()\r\n    return t\r\n  }\r\n}\r\n\r\nfunction setArrayStruct(obj: Object, key: string, address: () => pointer<void>, length: number, type: Struct | {}) {\r\n  const localKey = `__$__${key}`\r\n  return function (newValue: any[]) {\r\n    let proxy = obj[localKey] || definedArrayStruct(address, length, type)\r\n    proxy[symbolStructAddress] = address()\r\n    array.each(newValue, (value, key) => {\r\n      proxy[key] = value\r\n    })\r\n    obj[localKey] = proxy\r\n  }\r\n}\r\n\r\nfunction setArrayCTypeEnum(obj: Object, key: string, address: () => pointer<void>, length: number, type: CTypeEnum) {\r\n  const localKey = `__$__${key}`\r\n  return function (newValue: any[]) {\r\n    let proxy = obj[localKey] || definedArrayCTypeEnum(address, length, type)\r\n    proxy[symbolStructAddress] = address()\r\n    array.each(newValue, (value, key) => {\r\n      proxy[key] = value\r\n    })\r\n    obj[localKey] = proxy\r\n  }\r\n}\r\n\r\nexport function definedStruct<T>(address: pointer<void>, struct: (new () => T) | {}) {\r\n  let prototype = is.func(struct) ? struct.prototype : struct\r\n\r\n  const obj = {}\r\n  obj[symbolStructAddress] = address\r\n  Object.setPrototypeOf(obj, prototype)\r\n\r\n  while (true) {\r\n    let keysMeta = prototype[symbolStructKeysMeta] as Map<string, KeyMeta>\r\n\r\n    if (keysMeta) {\r\n      keysMeta.forEach((meta, key) => {\r\n        if (meta[KeyMetaKey.Array]) {\r\n          if (meta[KeyMetaKey.Pointer]) {\r\n            definedProperty(\r\n              obj,\r\n              key,\r\n              getArray(\r\n                () => {\r\n                  return obj[symbolStructAddress] + meta[KeyMetaKey.BaseAddressOffset]\r\n                },\r\n                obj,\r\n                key\r\n              ),\r\n              setArrayCTypeEnum(\r\n                obj,\r\n                key,\r\n                () => {\r\n                  return obj[symbolStructAddress] + meta[KeyMetaKey.BaseAddressOffset]\r\n                },\r\n                meta[KeyMetaKey.ArrayLength],\r\n                CTypeEnum.pointer\r\n              )\r\n            )\r\n          }\r\n          else {\r\n            if (is.func(meta[KeyMetaKey.Type]) || is.object(meta[KeyMetaKey.Type])) {\r\n              definedProperty(\r\n                obj,\r\n                key,\r\n                getArray(\r\n                  () => {\r\n                    return obj[symbolStructAddress] + meta[KeyMetaKey.BaseAddressOffset]\r\n                  },\r\n                  obj,\r\n                  key\r\n                ),\r\n                setArrayStruct(\r\n                  obj,\r\n                  key,\r\n                  () => {\r\n                    return obj[symbolStructAddress] + meta[KeyMetaKey.BaseAddressOffset]\r\n                  },\r\n                  meta[KeyMetaKey.ArrayLength],\r\n                  meta[KeyMetaKey.Type]\r\n                )\r\n              )\r\n            }\r\n            else {\r\n              definedProperty(\r\n                obj,\r\n                key,\r\n                getArray(\r\n                  () => {\r\n                    return obj[symbolStructAddress] + meta[KeyMetaKey.BaseAddressOffset]\r\n                  },\r\n                  obj,\r\n                  key\r\n                ),\r\n                setArrayCTypeEnum(\r\n                  obj,\r\n                  key,\r\n                  () => {\r\n                    return obj[symbolStructAddress] + meta[KeyMetaKey.BaseAddressOffset]\r\n                  },\r\n                  meta[KeyMetaKey.ArrayLength],\r\n                  meta[KeyMetaKey.Type]\r\n                )\r\n              )\r\n            }\r\n          }\r\n        }\r\n        else {\r\n          if (meta[KeyMetaKey.Pointer]) {\r\n            definedProperty(\r\n              obj,\r\n              key,\r\n              getPointerValue(() => {\r\n                return obj[symbolStructAddress] + meta[KeyMetaKey.BaseAddressOffset]\r\n              }),\r\n              setPointerValue(() => {\r\n                return obj[symbolStructAddress] + meta[KeyMetaKey.BaseAddressOffset]\r\n              })\r\n            )\r\n          }\r\n          else if (is.func(meta[KeyMetaKey.Type]) || is.object(meta[KeyMetaKey.Type])) {\r\n            definedProperty(\r\n              obj,\r\n              key,\r\n              getStruct(\r\n                obj,\r\n                key,\r\n                () => {\r\n                  return obj[symbolStructAddress] + meta[KeyMetaKey.BaseAddressOffset]\r\n                },\r\n                meta[KeyMetaKey.Type]\r\n              ),\r\n              setStruct(\r\n                obj,\r\n                key,\r\n                () => {\r\n                  return obj[symbolStructAddress] + meta[KeyMetaKey.BaseAddressOffset]\r\n                },\r\n                meta[KeyMetaKey.Type]\r\n              )\r\n            )\r\n          }\r\n          else {\r\n            if (meta[KeyMetaKey.BitField]) {\r\n              definedProperty(\r\n                obj,\r\n                key,\r\n                getBitFieldValue(\r\n                  () => {\r\n                    return obj[symbolStructAddress] + meta[KeyMetaKey.BaseAddressOffset]\r\n                  },\r\n                  meta[KeyMetaKey.Type],\r\n                  meta[KeyMetaKey.BitFieldLength],\r\n                  meta[KeyMetaKey.BaseBitOffset]\r\n                ),\r\n                setBitFieldValue(\r\n                  () => {\r\n                    return obj[symbolStructAddress] + meta[KeyMetaKey.BaseAddressOffset]\r\n                  },\r\n                  meta[KeyMetaKey.Type],\r\n                  meta[KeyMetaKey.BitFieldLength],\r\n                  meta[KeyMetaKey.BaseBitOffset]\r\n                )\r\n              )\r\n            }\r\n            else {\r\n              definedProperty(\r\n                obj,\r\n                key,\r\n                getCTypeEnumValue(\r\n                  () => {\r\n                    return obj[symbolStructAddress] + meta[KeyMetaKey.BaseAddressOffset]\r\n                  },\r\n                  meta[KeyMetaKey.Type]\r\n                ),\r\n                setCTypeEnumValue(\r\n                  () => {\r\n                    return obj[symbolStructAddress] + meta[KeyMetaKey.BaseAddressOffset]\r\n                  },\r\n                  meta[KeyMetaKey.Type]\r\n                )\r\n              )\r\n            }\r\n          }\r\n        }\r\n      })\r\n    }\r\n    prototype = Object.getPrototypeOf(prototype)\r\n    if (!prototype) {\r\n      break\r\n    }\r\n  }\r\n  return obj as T\r\n}\r\n\r\nexport function revokeDefinedStruct<T>(target: T) {\r\n  let prototype = Object.getPrototypeOf(target)\r\n  while (true) {\r\n    let keysMeta = prototype[symbolStructKeysMeta] as Map<string, KeyMeta>\r\n    if (keysMeta) {\r\n      keysMeta.forEach((meta, key) => {\r\n        delete target[key]\r\n      })\r\n    }\r\n    prototype = Object.getPrototypeOf(prototype)\r\n    if (!prototype) {\r\n      break\r\n    }\r\n  }\r\n}\r\n","export default function definedMetaProperty(target: any, key: symbol, value: any) {\r\n  Object.defineProperty(target, key, {\r\n    value,\r\n    writable: false,\r\n    enumerable: false,\r\n    configurable: false\r\n  })\r\n}\r\n","import isWorker from 'common/function/isWorker'\r\nimport AllocatorInterface from './allocator/Allocator'\r\nimport AllocatorJS from './allocator/AllocatorJS'\r\nimport { WebassemblyTable } from './allocator/Table'\r\nimport { SELF } from 'common/util/constant'\r\nimport { AtomicsBuffer, CTypeEnum } from './typedef'\r\nimport * as config from './config'\r\nimport * as staticData from './staticData'\r\nimport initAtomics from './thread/atomicsImpl'\r\nimport initMemoryAsm from './asm/memory'\r\nimport initAtomicsAsm from './thread/asm/atomics'\r\nimport initCtypeEnumImpl from './ctypeEnumImpl'\r\nimport isAudioWorklet from 'common/function/isAudioWorklet'\r\nimport browser from 'common/util/browser'\r\n\r\n/**\r\n * 线程 id\r\n */\r\nexport let ThreadId: number = -1\r\n\r\nexport let isMainThread: boolean = true\r\n\r\n/**\r\n * 线程名\r\n */\r\nexport let ThreadName: string = ''\r\n\r\n/**\r\n * 当前线程的栈顶指针\r\n */\r\nexport let StackPointer: WebAssembly.Global = null\r\n\r\n/**\r\n * 栈结束位置\r\n */\r\nexport let StackTop: int32 = null\r\n\r\n/**\r\n * 当前线程栈大小\r\n */\r\nexport let StackSize: int32 = 0\r\n\r\n/**\r\n * 当前线程的 Table\r\n */\r\nexport let Table: WebassemblyTable = null\r\n\r\n/**\r\n * 堆分配器\r\n */\r\nexport let Allocator: AllocatorInterface = null\r\n\r\n/**\r\n * 堆\r\n */\r\nexport let Memory: WebAssembly.Memory = null\r\n\r\n/**\r\n * 1 字节整型读取\r\n * - int8\r\n * - -128 to 127\r\n */\r\nlet Heap8: Int8Array = null\r\n\r\n/**\r\n * 2 字节整型读取 \r\n * - int16\r\n * - -32768 to 32767\r\n */\r\nlet Heap16: Int16Array = null\r\n\r\n/**\r\n * 4 字节整型读取\r\n * - int32\r\n * - -2147483648 to 2147483647\r\n */\r\nlet Heap32: Int32Array = null\r\n\r\n/**\r\n * 8 字节整型读取\r\n * - int64\r\n * - 0 to 4294967295\r\n */\r\nlet Heap64: BigInt64Array = null\r\n\r\n/**\r\n * 1 字节无符号整型读取\r\n * - uint8\r\n * - 0 to 255\r\n */\r\nlet HeapU8: Uint8Array = null\r\n\r\n/**\r\n * 2 字节无符号整型读取\r\n * - uint16\r\n * - 0 to 65535\r\n */\r\nlet HeapU16: Uint16Array = null\r\n\r\n/**\r\n * 4 字节无符号整型读取\r\n * - uint32\r\n * - 0 to 4294967295\r\n */\r\nlet HeapU32: Uint32Array = null\r\n\r\n/**\r\n * 8 字节无符号整型读取\r\n * - uint64\r\n * - 0 to 4294967295\r\n */\r\nlet HeapU64: BigUint64Array = null\r\n\r\n/**\r\n * 32 位浮点数\r\n * float\r\n */\r\nlet HeapFloat32: Float32Array = null\r\n\r\n/**\r\n * 64 位浮点数\r\n * double\r\n */\r\nlet HeapFloat64: Float64Array = null\r\n\r\n/**\r\n * 堆访问器\r\n */\r\nlet view: DataView = null\r\n\r\nlet AtomicBufferMap: Record<number, AtomicsBuffer> = {\r\n  [CTypeEnum.atomic_char]: HeapU8,\r\n  [CTypeEnum.atomic_uint8]: HeapU8,\r\n  [CTypeEnum.atomic_uint16]: HeapU16,\r\n  [CTypeEnum.atomic_uint32]: HeapU32,\r\n  [CTypeEnum.atomic_uint64]: HeapU64,\r\n  [CTypeEnum.atomic_int8]: Heap8,\r\n  [CTypeEnum.atomic_int16]: Heap16,\r\n  [CTypeEnum.atomic_int32]: Heap32,\r\n  [CTypeEnum.atomic_int64]: Heap64\r\n}\r\n\r\nfunction checkHeap() {\r\n  if (Memory && Memory.buffer !== HeapU8.buffer) {\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nexport function getHeapU8() {\r\n  if (defined(ENABLE_THREADS) && checkHeap()) {\r\n    updateHeap(Memory.buffer)\r\n  }\r\n  return HeapU8\r\n}\r\n\r\nexport function getHeap8() {\r\n  if (defined(ENABLE_THREADS) && checkHeap()) {\r\n    updateHeap(Memory.buffer)\r\n  }\r\n  return Heap8\r\n}\r\n\r\nexport function getHeapU16() {\r\n  if (defined(ENABLE_THREADS) && checkHeap()) {\r\n    updateHeap(Memory.buffer)\r\n  }\r\n  return HeapU16\r\n}\r\n\r\nexport function getHeap16() {\r\n  if (defined(ENABLE_THREADS) && checkHeap()) {\r\n    updateHeap(Memory.buffer)\r\n  }\r\n  return Heap16\r\n}\r\n\r\nexport function getHeapU32() {\r\n  if (defined(ENABLE_THREADS) && checkHeap()) {\r\n    updateHeap(Memory.buffer)\r\n  }\r\n  return HeapU32\r\n}\r\n\r\nexport function getHeap32() {\r\n  if (defined(ENABLE_THREADS) && checkHeap()) {\r\n    updateHeap(Memory.buffer)\r\n  }\r\n  return Heap32\r\n}\r\n\r\nexport function getHeap64() {\r\n  if (defined(ENABLE_THREADS) && checkHeap()) {\r\n    updateHeap(Memory.buffer)\r\n  }\r\n  return Heap64\r\n}\r\n\r\nexport function getHeapU64() {\r\n  if (defined(ENABLE_THREADS) && checkHeap()) {\r\n    updateHeap(Memory.buffer)\r\n  }\r\n  return HeapU64\r\n}\r\n\r\nexport function getHeapF32() {\r\n  if (defined(ENABLE_THREADS) && checkHeap()) {\r\n    updateHeap(Memory.buffer)\r\n  }\r\n  return HeapFloat32\r\n}\r\n\r\nexport function getHeapF64() {\r\n  if (defined(ENABLE_THREADS) && checkHeap()) {\r\n    updateHeap(Memory.buffer)\r\n  }\r\n  return HeapFloat64\r\n}\r\n\r\nexport function getView() {\r\n  if (defined(ENABLE_THREADS) && checkHeap()) {\r\n    updateHeap(Memory.buffer)\r\n  }\r\n  return view\r\n}\r\n\r\nexport function getAtomicsBuffer(type: atomictype) {\r\n  if (defined(ENABLE_THREADS) && checkHeap()) {\r\n    updateHeap(Memory.buffer)\r\n  }\r\n  return AtomicBufferMap[type as number]\r\n}\r\n\r\nfunction setAllocator(a: AllocatorInterface) {\r\n  if (Allocator) {\r\n    Allocator.removeUpdateHandle(updateHeap)\r\n  }\r\n  Allocator = a\r\n  if (SELF.CHeap) {\r\n    SELF.CHeap.Allocator = Allocator\r\n  }\r\n\r\n  Allocator.addUpdateHandle(updateHeap)\r\n  updateHeap(Allocator.getBuffer())\r\n}\r\n\r\nfunction updateHeap(heap: ArrayBuffer | SharedArrayBuffer) {\r\n  Heap8 = new Int8Array(heap)\r\n  Heap16 = new Int16Array(heap)\r\n  Heap32 = new Int32Array(heap)\r\n  Heap64 = new BigInt64Array(heap)\r\n\r\n  HeapU8 = new Uint8Array(heap)\r\n  HeapU16 = new Uint16Array(heap)\r\n  HeapU32 = new Uint32Array(heap)\r\n  HeapU64 = new BigUint64Array(heap)\r\n\r\n  HeapFloat32 = new Float32Array(heap)\r\n  HeapFloat64 = new Float64Array(heap)\r\n\r\n  view = new DataView(heap)\r\n\r\n  AtomicBufferMap = {\r\n    [CTypeEnum.atomic_char]: HeapU8,\r\n    [CTypeEnum.atomic_uint8]: HeapU8,\r\n    [CTypeEnum.atomic_uint16]: HeapU16,\r\n    [CTypeEnum.atomic_uint32]: HeapU32,\r\n    [CTypeEnum.atomic_uint64]: HeapU64,\r\n    [CTypeEnum.atomic_int8]: Heap8,\r\n    [CTypeEnum.atomic_int16]: Heap16,\r\n    [CTypeEnum.atomic_int32]: Heap32,\r\n    [CTypeEnum.atomic_int64]: Heap64\r\n  }\r\n}\r\n\r\nexport function allocThreadId() {\r\n  return Atomics.add(HeapU32, staticData.threadCounter >>> 2, 1)\r\n}\r\n\r\n/**\r\n * 子线程初始化\r\n * \r\n * @param options \r\n */\r\nexport async function initThread(options: {\r\n  memory: WebAssembly.Memory\r\n  stackPointer?: number\r\n  stackSize?: number\r\n  name?: string\r\n  disableAsm?: boolean\r\n  id?: int32\r\n}) {\r\n\r\n  initCtypeEnumImpl(\r\n    () => {\r\n      return Allocator\r\n    },\r\n    getView\r\n  )\r\n  initAtomics(getAtomicsBuffer)\r\n\r\n  Memory = options.memory\r\n\r\n  const allocator = new AllocatorJS({\r\n    buffer: Memory.buffer,\r\n    memory: Memory,\r\n    byteOffset: config.HEAP_OFFSET,\r\n    maxHeapSize: config.HEAP_MAXIMUM * 64 * 1024,\r\n    growAllowed: true,\r\n    onResize(old, need) {\r\n      Memory.grow((need - old.byteLength) >>> 16)\r\n      return {\r\n        buffer: Memory.buffer,\r\n        byteOffset: config.HEAP_OFFSET\r\n      }\r\n    }\r\n  }, false)\r\n\r\n  setAllocator(allocator)\r\n\r\n  if (options.stackPointer) {\r\n    StackSize = options.stackSize\r\n    StackTop = options.stackPointer\r\n    StackPointer = new WebAssembly.Global({\r\n      value: 'i32',\r\n      mutable: true\r\n    }, StackTop + StackSize)\r\n    Table = new WebassemblyTable()\r\n  }\r\n  if (typeof options.id === 'number') {\r\n    ThreadId = options.id\r\n  }\r\n  else {\r\n    ThreadId = Atomics.add(HeapU32, staticData.threadCounter >>> 2, 1)\r\n  }\r\n  ThreadName = options.name ?? 'anonymous'\r\n\r\n  SELF.CHeap = {\r\n    initThread,\r\n    Allocator,\r\n    Table,\r\n    ThreadId,\r\n    ThreadName,\r\n    Memory,\r\n    Config: config,\r\n\r\n    StackSize,\r\n    StackTop,\r\n    StackPointer,\r\n    isMainThread: false\r\n  }\r\n\r\n  isMainThread = false\r\n\r\n  if (!defined(DEBUG)) {\r\n    if (!options.disableAsm) {\r\n      // @ts-ignore\r\n      if (typeof BigInt === 'function' && BigInt !== Number\r\n        && (\r\n          browser.chrome && browser.checkVersion(browser.majorVersion, '85', true)\r\n          || browser.firefox && browser.checkVersion(browser.majorVersion, '78', true)\r\n          || browser.safari && browser.checkVersion(browser.majorVersion, '15', true)\r\n          || browser.newEdge\r\n        )\r\n      ) {\r\n        await initMemoryAsm(Memory)\r\n      }\r\n      if (defined(ENABLE_THREADS)\r\n        && config.USE_THREADS\r\n        && (\r\n          browser.chrome && browser.checkVersion(browser.majorVersion, '85', true)\r\n          || browser.firefox && browser.checkVersion(browser.majorVersion, '78', true)\r\n          || browser.safari && browser.checkVersion(browser.majorVersion, '15', true)\r\n          || browser.newEdge\r\n        )\r\n      ) {\r\n        await initAtomicsAsm(Memory)\r\n      }\r\n    }\r\n\r\n  }\r\n}\r\n\r\n/**\r\n * 主线程初始化\r\n */\r\nexport function initMain() {\r\n  initCtypeEnumImpl(\r\n    () => {\r\n      return Allocator\r\n    },\r\n    getView\r\n  )\r\n  initAtomics(getAtomicsBuffer)\r\n\r\n  Memory = SELF.CHeap?.Memory ? SELF.CHeap.Memory : new WebAssembly.Memory({\r\n    initial: config.HEAP_INITIAL,\r\n    maximum: config.HEAP_MAXIMUM,\r\n    shared: config.USE_THREADS\r\n  })\r\n\r\n  Allocator = SELF.CHeap?.Allocator ? (SELF.CHeap.Allocator as AllocatorInterface) : new AllocatorJS({\r\n    buffer: Memory.buffer,\r\n    memory: Memory,\r\n    byteOffset: config.HEAP_OFFSET,\r\n    maxHeapSize: config.HEAP_MAXIMUM * 64 * 1024,\r\n    growAllowed: true,\r\n    onResize(old, need) {\r\n      Memory.grow((need - old.byteLength) >>> 16)\r\n      return {\r\n        buffer: Memory.buffer,\r\n        byteOffset: config.HEAP_OFFSET\r\n      }\r\n    }\r\n  })\r\n\r\n  Allocator.addUpdateHandle(updateHeap)\r\n\r\n  updateHeap(Allocator.getBuffer())\r\n\r\n  StackSize = SELF.CHeap?.StackSize ? SELF.CHeap.StackSize : config.STACK_SIZE\r\n  StackTop = SELF.CHeap?.StackTop ? SELF.CHeap.StackTop : Allocator.malloc(StackSize)\r\n  StackPointer = SELF.CHeap?.StackPointer ? SELF.CHeap.StackPointer : new WebAssembly.Global({\r\n    value: 'i32',\r\n    mutable: true\r\n  }, StackTop + StackSize)\r\n\r\n  Table = SELF.CHeap?.Table ? (SELF.CHeap.Table as WebassemblyTable) : new WebassemblyTable()\r\n\r\n  ThreadId = SELF.CHeap?.ThreadId ? SELF.CHeap.ThreadId : 0\r\n  ThreadName = SELF.CHeap?.ThreadName ? SELF.CHeap.ThreadName : 'main'\r\n\r\n  if (!SELF.CHeap) {\r\n    if (config.USE_THREADS && defined(ENABLE_THREADS)) {\r\n      Atomics.store(HeapU32, staticData.threadCounter >>> 2, ThreadId + 1)\r\n      Atomics.store(Heap32, addressof(staticData.heapMutex.atomic) >>> 2, 0)\r\n    }\r\n    else {\r\n      HeapU32[staticData.threadCounter >>> 2] = ThreadId + 1\r\n      let index = addressof(staticData.heapMutex.atomic) >>> 2\r\n      Heap32[index] = 0\r\n    }\r\n  }\r\n\r\n  if (!defined(DEBUG) && defined(ENABLE_THREADS)) {\r\n    // @ts-ignore\r\n    if (typeof BigInt === 'function' && BigInt !== Number\r\n      && (\r\n        browser.chrome && browser.checkVersion(browser.majorVersion, '85', true)\r\n        || browser.firefox && browser.checkVersion(browser.majorVersion, '78', true)\r\n        || browser.safari && browser.checkVersion(browser.majorVersion, '15', true)\r\n        || browser.newEdge\r\n      )\r\n    ) {\r\n      initMemoryAsm(Memory)\r\n    }\r\n    if (config.USE_THREADS\r\n      && defined(ENABLE_THREADS)\r\n      && (\r\n        browser.chrome && browser.checkVersion(browser.majorVersion, '85', true)\r\n        || browser.firefox && browser.checkVersion(browser.majorVersion, '78', true)\r\n        || browser.safari && browser.checkVersion(browser.majorVersion, '15', true)\r\n        || browser.newEdge\r\n      )\r\n    ) {\r\n      initAtomicsAsm(Memory)\r\n    }\r\n  }\r\n\r\n  if (!SELF.CHeap) {\r\n    SELF.CHeap = {\r\n      Allocator,\r\n      Table,\r\n      ThreadId,\r\n      ThreadName,\r\n      Memory,\r\n      Config: config,\r\n\r\n      StackSize,\r\n      StackTop,\r\n      StackPointer,\r\n      isMainThread: true,\r\n\r\n      threadCounter: staticData.threadCounter,\r\n      heapMutex: staticData.heapMutex\r\n    }\r\n  }\r\n  isMainThread = true\r\n}\r\n\r\nif (defined(ENV_NODE)) {\r\n  const { isMainThread: isMainThread_ } = require('worker_threads')\r\n  if (isMainThread_) {\r\n    initMain()\r\n  }\r\n  else {\r\n    SELF.CHeap = {\r\n      initThread,\r\n      isMainThread: false,\r\n      Config: config\r\n    }\r\n    isMainThread = false\r\n  }\r\n}\r\nelse {\r\n  if (!isWorker() && !isAudioWorklet() || (isWorker() && !config.USE_THREADS)) {\r\n    initMain()\r\n  }\r\n  else {\r\n    SELF.CHeap = {\r\n      initThread,\r\n      isMainThread: false,\r\n      Config: config\r\n    }\r\n    isMainThread = false\r\n  }\r\n}\r\n","import { CTypeEnumRead } from './ctypeEnumRead'\r\nimport { CTypeEnumWrite } from './ctypeEnumWrite'\r\nimport { symbolStructAddress, symbolStructKeysMeta, symbolStructProxyRevoke } from './symbol'\r\nimport { CTypeEnum, CTypeEnum2Bytes, KeyMeta, KeyMetaKey, Struct } from './typedef'\r\nimport * as is from 'common/util/is'\r\nimport * as object from 'common/util/object'\r\nimport * as array from 'common/util/array'\r\nimport toNumber from 'common/function/toNumber'\r\n\r\nconst ObjectPro = Object.getPrototypeOf({})\r\n\r\nexport function findKeyMeta<T>(prototype: new () => T, key: string) {\r\n  while (true) {\r\n    let keysMeta = prototype[symbolStructKeysMeta] as Map<string, KeyMeta>\r\n    if (keysMeta) {\r\n      const meta = keysMeta.get(key)\r\n      if (meta) {\r\n        return meta\r\n      }\r\n    }\r\n    prototype = Object.getPrototypeOf(prototype)\r\n    if (!prototype || prototype === ObjectPro) {\r\n      return null\r\n    }\r\n  }\r\n}\r\n\r\n\r\nfunction proxyArray(address: pointer<CTypeEnum | Struct>, length: number, type: CTypeEnum | Struct, pointer: 0 | 1) {\r\n  const obj = {}\r\n  obj[symbolStructAddress] = address\r\n\r\n  let size = sizeof(pointer ? CTypeEnum.pointer : type)\r\n\r\n  const proxy = new Proxy(obj, {\r\n    get(target, propertyKey, receiver) {\r\n\r\n      if (propertyKey === symbolStructAddress) {\r\n        return target[symbolStructAddress]\r\n      }\r\n\r\n      const index = toNumber(propertyKey)\r\n\r\n      assert(index < length && index >= 0, `Out Of Bounds, address: ${(target[symbolStructAddress] + index * size).toString(16)}`)\r\n\r\n      if (pointer) {\r\n        return CTypeEnumRead[CTypeEnum.pointer](target[symbolStructAddress] + index * size)\r\n      }\r\n      else {\r\n        if (is.func(type)) {\r\n          return target[propertyKey]\r\n        }\r\n        else {\r\n          return CTypeEnumRead[type](target[symbolStructAddress] + index * size)\r\n        }\r\n      }\r\n    },\r\n    set(target, propertyKey, newValue, receiver) {\r\n\r\n      if (propertyKey === symbolStructAddress) {\r\n        target[symbolStructAddress] = newValue\r\n        return true\r\n      }\r\n\r\n      const index = toNumber(propertyKey)\r\n\r\n      assert(index < length && index >= 0, `Out Of Bounds, address: ${(target[symbolStructAddress] + index * size).toString(16)}`)\r\n\r\n      if (pointer) {\r\n\r\n        assert(is.number(newValue), 'value is not pointer')\r\n\r\n        CTypeEnumWrite[CTypeEnum.pointer](target[symbolStructAddress] + index * size, newValue)\r\n        target[propertyKey] = newValue\r\n      }\r\n      else {\r\n        if (is.func(type)) {\r\n\r\n          assert(is.object(newValue) && Object.getPrototypeOf(newValue) == type.prototype, `value is not ${type.prototype.constructor.name}'s instance`)\r\n\r\n          const proxy = target[propertyKey] || (target[propertyKey] = proxyStruct(target[symbolStructAddress] + index * size, type))\r\n          object.each(newValue, (value, key) => {\r\n            proxy[key] = value\r\n          })\r\n          target[propertyKey] = proxy\r\n        }\r\n        else {\r\n\r\n          assert(is.number(newValue) || is.bigint(newValue), 'value is not number')\r\n\r\n          CTypeEnumWrite[type as uint8](target[symbolStructAddress] + index * size, newValue)\r\n          target[propertyKey] = newValue\r\n        }\r\n      }\r\n      return true\r\n    }\r\n  })\r\n\r\n  return proxy\r\n}\r\n\r\nexport function proxyStruct<T>(address: pointer<void>, struct: (new () => T) | {}): T {\r\n  const prototype = is.func(struct) ? struct.prototype : struct\r\n\r\n  const obj = {}\r\n  obj[symbolStructAddress] = address\r\n  Object.setPrototypeOf(obj, prototype)\r\n\r\n  const { proxy, revoke } = Proxy.revocable(obj, {\r\n    get(target, propertyKey, receiver) {\r\n      if (is.string(propertyKey)) {\r\n\r\n        assert(target[symbolStructAddress] !== nullptr, 'target address is null, maybe is free')\r\n\r\n        const meta = findKeyMeta(prototype, (propertyKey as string).replace(/^\\$+/, ''))\r\n\r\n        if (meta) {\r\n          const address = target[symbolStructAddress] + meta[KeyMetaKey.BaseAddressOffset]\r\n          if (meta[KeyMetaKey.Array]) {\r\n            const t = target[propertyKey]\r\n            t[symbolStructAddress] = address\r\n            return t\r\n          }\r\n          else if (meta[KeyMetaKey.Pointer]) {\r\n            let p = CTypeEnumRead[CTypeEnum.pointer](address)\r\n            return p\r\n          }\r\n          else if (is.func(meta[KeyMetaKey.Type]) || is.object(meta[KeyMetaKey.Type])) {\r\n            return target[propertyKey] || (target[propertyKey] = proxyStruct(address, meta[KeyMetaKey.Type]))\r\n          }\r\n          else {\r\n            let value = CTypeEnumRead[meta[KeyMetaKey.Type] as uint8](address)\r\n            if (meta[KeyMetaKey.BitField]) {\r\n              value = ((value >>> (CTypeEnum2Bytes[meta[KeyMetaKey.Type]] * 8 - meta[KeyMetaKey.BaseBitOffset] - meta[KeyMetaKey.BitFieldLength]))\r\n                & (Math.pow(2, meta[KeyMetaKey.BitFieldLength]) - 1))\r\n            }\r\n            return value\r\n          }\r\n        }\r\n        else {\r\n          return target[propertyKey]\r\n        }\r\n      }\r\n      else {\r\n        return target[propertyKey]\r\n      }\r\n    },\r\n    set(target, propertyKey, newValue, receiver) {\r\n      if (is.string(propertyKey)) {\r\n        assert(target[symbolStructAddress] !== nullptr, 'target address is null, maybe has freed')\r\n        const meta = findKeyMeta(prototype, (propertyKey as string).replace(/^\\$+/, ''))\r\n        if (meta) {\r\n          const address = target[symbolStructAddress] + meta[KeyMetaKey.BaseAddressOffset]\r\n          if (meta[KeyMetaKey.Array]) {\r\n            const proxy = target[propertyKey] || proxyArray(address, meta[KeyMetaKey.ArrayLength], meta[KeyMetaKey.Type], meta[KeyMetaKey.Pointer])\r\n            array.each(newValue, (value, key) => {\r\n              proxy[key] = value\r\n            })\r\n            target[propertyKey] = proxy\r\n          }\r\n          else {\r\n            if (meta[KeyMetaKey.Pointer]) {\r\n\r\n              assert(is.number(newValue), `value is not pointer, struct: ${prototype.constructor.name}, name: ${propertyKey as string}`)\r\n\r\n              CTypeEnumWrite[CTypeEnum.pointer](address, newValue)\r\n              target[propertyKey] = newValue\r\n            }\r\n            else if (is.func(meta[KeyMetaKey.Type]) || is.object(meta[KeyMetaKey.Type])) {\r\n\r\n              assert(\r\n                is.object(newValue)\r\n                && Object.getPrototypeOf(newValue) === (\r\n                  is.func(meta[KeyMetaKey.Type])\r\n                    ? meta[KeyMetaKey.Type].prototype\r\n                    : meta[KeyMetaKey.Type]\r\n                ),\r\n                `value is not ${is.func(meta[KeyMetaKey.Type]) ? meta[KeyMetaKey.Type].prototype.constructor.name : 'inline struct'}'s instance, name: ${propertyKey as string}`\r\n              )\r\n\r\n              const proxy = target[propertyKey] || (target[propertyKey] = proxyStruct(address, meta[KeyMetaKey.Type]))\r\n              object.each(newValue, (value, key) => {\r\n                proxy[key] = value\r\n              })\r\n              target[propertyKey] = proxy\r\n            }\r\n            else {\r\n\r\n              assert(is.number(newValue) || is.bigint(newValue), 'value is not number')\r\n\r\n              if (meta[KeyMetaKey.BitField]) {\r\n\r\n                assert(!is.bigint(newValue), `bigint is not support in bit field, struct: ${prototype.constructor.name}, name: ${propertyKey as string}`)\r\n\r\n                let mask = 0\r\n                let len = CTypeEnum2Bytes[meta[KeyMetaKey.Type]] * 8\r\n                for (let i = 0; i < meta[KeyMetaKey.BitFieldLength]; i++) {\r\n                  mask |= (1 << (len - 1 - (i + meta[KeyMetaKey.BaseBitOffset])))\r\n                }\r\n                const value = CTypeEnumRead[meta[KeyMetaKey.Type] as uint8](address)\r\n\r\n                CTypeEnumWrite[meta[KeyMetaKey.Type] as uint8](\r\n                  address,\r\n                  (value & ~mask) | ((newValue & (Math.pow(2, meta[KeyMetaKey.BitFieldLength]) - 1))\r\n                    << (len - meta[KeyMetaKey.BaseBitOffset] - meta[KeyMetaKey.BitFieldLength]))\r\n                )\r\n              }\r\n              else {\r\n                CTypeEnumWrite[meta[KeyMetaKey.Type] as uint8](address, newValue)\r\n              }\r\n              target[propertyKey] = newValue\r\n            }\r\n          }\r\n        }\r\n        else {\r\n          target[propertyKey] = newValue\r\n        }\r\n      }\r\n      else {\r\n        target[propertyKey] = newValue\r\n      }\r\n      return true\r\n    }\r\n  })\r\n\r\n  obj[symbolStructProxyRevoke] = revoke\r\n\r\n  return proxy as T\r\n}\r\n\r\nexport function revokeProxyStruct<T>(target: T) {\r\n  const revoke = target[symbolStructProxyRevoke]\r\n  if (revoke) {\r\n    revoke()\r\n  }\r\n}\r\n","import { StackPointer, StackTop, StackSize } from './heap'\r\n\r\nexport function malloc(size: size): pointer<void> {\r\n  assert(StackPointer.value - size >= StackTop, 'stack up overflow')\r\n  StackPointer.value -= size\r\n  return StackPointer.value\r\n}\r\n\r\nexport function free(size: size): void {\r\n  assert(StackPointer.value + size <= StackTop + StackSize, 'stack down overflow')\r\n  StackPointer.value += size\r\n}\r\n","/**\r\n * 静态分配区只能在此文件分配\r\n * 导出在其他地方使用\r\n */\r\n\r\nimport { SELF } from 'common/util/constant'\r\nimport * as config from './config'\r\nimport { Mutex } from './thread/mutex'\r\n\r\n/**\r\n * 静态分配区栈顶指针\r\n */\r\nlet pointer: pointer<uint8> = reinterpret_cast<pointer<uint8>>(static_cast<uint32>(nullptr) + 1)\r\n\r\nexport function malloc(length: size, algin: number = 1): pointer<void> {\r\n\r\n  let address = pointer\r\n\r\n  while (address % algin) {\r\n    address++\r\n  }\r\n\r\n  assert(address < config.HEAP_OFFSET, 'static data overflow')\r\n\r\n  pointer = reinterpret_cast<pointer<uint8>>(address + length)\r\n\r\n  return address\r\n}\r\n\r\n/**\r\n * 线程计数器地址\r\n */\r\nexport const threadCounter: pointer<uint32> = SELF.CHeap?.threadCounter\r\n  ? SELF.CHeap.threadCounter\r\n  : reinterpret_cast<pointer<uint32>>(malloc(sizeof(uint32), sizeof(uint32)))\r\n\r\n/**\r\n * 堆分配锁地址\r\n */\r\nexport const heapMutex: pointer<Mutex> = SELF.CHeap?.heapMutex\r\n  ? SELF.CHeap.heapMutex\r\n  : reinterpret_cast<pointer<Mutex>>(malloc(sizeof(Mutex), sizeof(atomic_int32)))\r\n","/*\r\n * libmedia SafeUint8Array\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { Uint8ArrayInterface } from 'common/io/interface'\r\nimport { getHeapU8, getView } from '../../heap'\r\nimport ArrayLikeInterface from 'common/interface/ArrayLike'\r\n\r\nexport class SafeBufferView {\r\n  private pointer: pointer<uint8>\r\n\r\n  private len: size\r\n\r\n  constructor(pointer: pointer<uint8>, len: size) {\r\n    this.pointer = pointer\r\n    this.len = len\r\n  }\r\n\r\n  get byteLength() {\r\n    return this.len\r\n  }\r\n\r\n  get buffer() {\r\n    return getHeapU8().buffer\r\n  }\r\n\r\n  get byteOffset() {\r\n    return this.pointer\r\n  }\r\n\r\n  public getFloat32(byteOffset: number, littleEndian?: boolean): number {\r\n    return getView().getFloat32(this.pointer + byteOffset, littleEndian)\r\n  }\r\n\r\n  public getFloat64(byteOffset: number, littleEndian?: boolean): number {\r\n    return getView().getFloat64(this.pointer + byteOffset, littleEndian)\r\n  }\r\n\r\n  public getInt8(byteOffset: number): number {\r\n    return getView().getInt8(this.pointer + byteOffset)\r\n  }\r\n\r\n  public getInt16(byteOffset: number, littleEndian?: boolean): number {\r\n    return getView().getInt16(this.pointer + byteOffset, littleEndian)\r\n  }\r\n\r\n  public getInt32(byteOffset: number, littleEndian?: boolean): number {\r\n    return getView().getInt32(this.pointer + byteOffset, littleEndian)\r\n  }\r\n\r\n  public getUint8(byteOffset: number): number {\r\n    return getView().getUint8(this.pointer + byteOffset)\r\n  }\r\n\r\n  public getUint16(byteOffset: number, littleEndian?: boolean): number {\r\n    return getView().getUint16(this.pointer + byteOffset, littleEndian)\r\n  }\r\n\r\n  public getUint32(byteOffset: number, littleEndian?: boolean): number {\r\n    return getView().getUint32(this.pointer + byteOffset, littleEndian)\r\n  }\r\n\r\n  public setFloat32(byteOffset: number, value: number, littleEndian?: boolean): void {\r\n    getView().setFloat32(this.pointer + byteOffset, value, littleEndian)\r\n  }\r\n\r\n  public setFloat64(byteOffset: number, value: number, littleEndian?: boolean): void {\r\n    getView().setFloat64(this.pointer + byteOffset, value, littleEndian)\r\n  }\r\n\r\n  public setInt8(byteOffset: number, value: number): void {\r\n    getView().setInt8(this.pointer + byteOffset, value)\r\n  }\r\n\r\n  public setInt16(byteOffset: number, value: number, littleEndian?: boolean): void {\r\n    getView().setInt16(this.pointer + byteOffset, value, littleEndian)\r\n  }\r\n\r\n  public setInt32(byteOffset: number, value: number, littleEndian?: boolean): void {\r\n    getView().setInt32(this.pointer + byteOffset, value, littleEndian)\r\n  }\r\n\r\n  public setUint8(byteOffset: number, value: number): void {\r\n    getView().setUint8(this.pointer + byteOffset, value)\r\n  }\r\n\r\n  public setUint16(byteOffset: number, value: number, littleEndian?: boolean): void {\r\n    getView().setUint16(this.pointer + byteOffset, value, littleEndian)\r\n  }\r\n\r\n  public setUint32(byteOffset: number, value: number, littleEndian?: boolean): void {\r\n    getView().setUint32(this.pointer + byteOffset, value, littleEndian)\r\n  }\r\n\r\n  public getBigInt64(byteOffset: number, littleEndian?: boolean): bigint {\r\n    return getView().getBigInt64(this.pointer + byteOffset, littleEndian)\r\n  }\r\n  public getBigUint64(byteOffset: number, littleEndian?: boolean): bigint {\r\n    return getView().getBigUint64(this.pointer + byteOffset, littleEndian)\r\n  }\r\n  public setBigInt64(byteOffset: number, value: bigint, littleEndian?: boolean) {\r\n    getView().setBigInt64(this.pointer + byteOffset, value, littleEndian)\r\n  }\r\n  public setBigUint64(byteOffset: number, value: bigint, littleEndian?: boolean) {\r\n    getView().setBigUint64(this.pointer + byteOffset, value, littleEndian)\r\n  }\r\n}\r\n\r\nexport default class SafeUint8Array extends ArrayLikeInterface implements Uint8ArrayInterface {\r\n\r\n  private pointer: pointer<uint8>\r\n\r\n  private len: size\r\n\r\n  constructor(pointer: pointer<uint8>, len: size) {\r\n    super()\r\n    this.pointer = pointer\r\n    this.len = len\r\n\r\n    return this.proxy as SafeUint8Array\r\n  }\r\n\r\n  protected getIndexValue(index: uint32): uint8 {\r\n    return accessof(reinterpret_cast<pointer<uint8>>(this.pointer + index))\r\n  }\r\n  protected setIndexValue(index: uint32, value: uint8): void {\r\n    accessof(reinterpret_cast<pointer<uint8>>(this.pointer + index)) <- value\r\n  }\r\n\r\n  public set(array: ArrayLike<number>, offset: number = 0) {\r\n    assert(offset + array.length <= this.len)\r\n    getHeapU8().set(array, this.pointer + offset)\r\n  }\r\n\r\n  public subarray(begin: number = 0, end?: number, safe?: boolean) {\r\n    if (safe) {\r\n      return new SafeUint8Array(reinterpret_cast<pointer<uint8>>(this.pointer + begin), (end ? end : this.len) - begin) as any as Uint8Array\r\n    }\r\n    return getHeapU8().subarray(this.pointer + begin, this.pointer + (end ?? this.len))\r\n  }\r\n\r\n  public slice(start: number = 0, end?: number) {\r\n    return getHeapU8().slice(this.pointer + start, this.pointer + (end ?? this.len))\r\n  }\r\n\r\n  get length() {\r\n    return this.len\r\n  }\r\n\r\n  get byteLength() {\r\n    return this.len\r\n  }\r\n\r\n  get buffer() {\r\n    return getHeapU8().buffer\r\n  }\r\n\r\n  get byteOffset() {\r\n    return this.pointer\r\n  }\r\n\r\n  get view() {\r\n    return new SafeBufferView(this.pointer, this.len) as any as DataView\r\n  }\r\n\r\n  [n: int32]: uint8\r\n}\r\n","import { memcpy } from '../../std/memory'\r\nimport { CTypeEnumWrite } from '../../ctypeEnumWrite'\r\nimport { CTypeEnum } from '../../typedef'\r\nimport * as is from 'common/util/is'\r\nimport { CTypeEnumRead } from '../../ctypeEnumRead'\r\nimport structAccess from '../structAccess'\r\nimport { symbolStructAddress } from '../../symbol'\r\n\r\ntype ListNodeDepth = [never, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\r\n\r\n@struct\r\nclass ListNode<T = void, D extends ListNodeDepth[number] = 9> {\r\n  // @ts-ignore\r\n  @type(ListNode<T>)\r\n  @pointer()\r\n  prev: [D] extends [never] ? never : pointer<ListNode<T, ListNodeDepth[D]>>\r\n\r\n  // @ts-ignore\r\n  @type(ListNode<T>)\r\n  @pointer()\r\n  next: [D] extends [never] ? never : pointer<ListNode<T, ListNodeDepth[D]>>\r\n\r\n  data: pointer<T>\r\n}\r\n\r\n@struct\r\nexport default class List<T> {\r\n\r\n  public length: uint32 = 0\r\n\r\n  private head: pointer<ListNode<T>> = nullptr\r\n  private tail: pointer<ListNode<T>> = nullptr\r\n\r\n  private createNode(item: any, type?: CTypeEnum | struct<{}>, move: boolean = false) {\r\n    const pNode = malloc(sizeof(ListNode)) as pointer<ListNode<T>>\r\n\r\n    pNode.next = nullptr\r\n    pNode.prev = nullptr\r\n\r\n    if (is.number(type)) {\r\n      assert(is.number(item) || is.bigint(item))\r\n      if (type === typeptr) {\r\n        pNode.data = reinterpret_cast<pointer<T>>(item)\r\n      }\r\n      else {\r\n        const p = malloc(sizeof(type))\r\n        CTypeEnumWrite[type as uint8](p, item)\r\n        pNode.data = reinterpret_cast<pointer<T>>(p)\r\n      }\r\n    }\r\n    else {\r\n      if (move) {\r\n        assert(is.number(item) && item)\r\n        pNode.data = reinterpret_cast<pointer<T>>(item)\r\n      }\r\n      else {\r\n        const p = malloc(sizeof(type))\r\n        memcpy(p, item[symbolStructAddress], sizeof(type))\r\n        pNode.data = reinterpret_cast<pointer<T>>(p)\r\n      }\r\n    }\r\n    return pNode\r\n  }\r\n\r\n  private getItem(data: pointer<T>, type: CTypeEnum | struct<any>) {\r\n    let result: T\r\n\r\n    if (is.number(type)) {\r\n      if (type === typeptr) {\r\n        result = data as T\r\n      }\r\n      else {\r\n        result = CTypeEnumRead[type](data as pointer<T>)\r\n      }\r\n    }\r\n    else {\r\n      result = structAccess(data as pointer<struct<any>>, type as any)\r\n    }\r\n\r\n    return result\r\n  }\r\n\r\n  public push<args=[T]>(item: T): void\r\n  public push<args=[T, true]>(item: pointer<T>): void\r\n  public push(item: any, type?: T, move: boolean = false) {\r\n\r\n    const pNode = this.createNode(item, type, move)\r\n\r\n    if (!this.tail) {\r\n\r\n      assert(!this.head)\r\n\r\n      this.head = pNode\r\n      this.tail = pNode\r\n    }\r\n    else {\r\n      this.tail.next = reinterpret_cast<pointer<ListNode<T>>>(pNode)\r\n      pNode.prev = reinterpret_cast<pointer<ListNode<T>>>(this.tail)\r\n      this.tail = pNode\r\n    }\r\n\r\n    this.length++\r\n  }\r\n\r\n  public pop<args=[T]>(): T\r\n  public pop(type?: T): T {\r\n    assert(this.length)\r\n\r\n    const pNode = this.tail\r\n\r\n    let result = this.getItem(pNode.data, type)\r\n\r\n    if (this.length > 1) {\r\n      pNode.prev.next = nullptr\r\n      this.tail = reinterpret_cast<pointer<ListNode<T>>>(pNode.prev)\r\n    }\r\n    else {\r\n      this.head = this.tail = nullptr\r\n    }\r\n\r\n    this.length--\r\n\r\n    free(reinterpret_cast<pointer<void>>(pNode.data))\r\n    free(pNode)\r\n\r\n    return result\r\n  }\r\n\r\n  public shift<args=[T]>(): T\r\n  public shift(type?: T): T {\r\n    assert(this.length)\r\n\r\n    const pNode = this.head\r\n\r\n    let result = this.getItem(pNode.data, type)\r\n\r\n    if (this.length > 1) {\r\n      pNode.next.prev = nullptr\r\n      this.head = reinterpret_cast<pointer<ListNode<T>>>(pNode.next)\r\n    }\r\n    else {\r\n      this.head = this.tail = nullptr\r\n    }\r\n\r\n    this.length--\r\n\r\n    free(reinterpret_cast<pointer<void>>(pNode.data))\r\n    free(pNode)\r\n\r\n    return result\r\n  }\r\n\r\n  public unshift<args=[T]>(item: T): void\r\n  public unshift<args=[T, true]>(item: pointer<T>): void\r\n  public unshift(item: any, type?: T, move: boolean = false) {\r\n\r\n    const pNode = this.createNode(item, type, move)\r\n\r\n    if (!this.head) {\r\n\r\n      assert(!this.tail)\r\n\r\n      this.head = pNode\r\n      this.tail = pNode\r\n    }\r\n    else {\r\n      this.head.prev = reinterpret_cast<pointer<ListNode<T>>>(pNode)\r\n      pNode.next = reinterpret_cast<pointer<ListNode<T>>>(this.head)\r\n      this.head = pNode\r\n    }\r\n\r\n    this.length++\r\n  }\r\n\r\n  public forEach<args=[T]>(callback: (item: T, index?: uint32) => boolean | void): void\r\n  public forEach(callback: (item: T, index: uint32) => boolean, type?: T) {\r\n    if (!this.length) {\r\n      return\r\n    }\r\n    let current = this.head\r\n    let index = 0\r\n    while (current !== nullptr) {\r\n      if (callback(this.getItem(current.data, type), index) === false) {\r\n        break\r\n      }\r\n      current = reinterpret_cast<pointer<ListNode<T>>>(current.next)\r\n      index++\r\n    }\r\n  }\r\n\r\n  public find<args=[T]>(callback: (item: T, index?: uint32) => boolean): T\r\n  public find(callback: (item: T, index: uint32) => boolean, type?: T): T {\r\n    if (!this.length) {\r\n      return nullptr as T\r\n    }\r\n    let current = this.head\r\n    let index = 0\r\n    while (current !== nullptr) {\r\n      const item = this.getItem(current.data, type)\r\n      if (callback(item, index) === true) {\r\n        return item\r\n      }\r\n      current = reinterpret_cast<pointer<ListNode<T>>>(current.next)\r\n      index++\r\n    }\r\n    return nullptr as T\r\n  }\r\n\r\n  public indexOf<args=[T]>(index: uint32): T\r\n  public indexOf(index: uint32, type?: T): T {\r\n    if (!this.length) {\r\n      return nullptr as T\r\n    }\r\n\r\n    assert(index >= 0 && index < this.length)\r\n\r\n    let current = this.head\r\n    let i = 0\r\n    while (current !== nullptr) {\r\n      if (i === index) {\r\n        return this.getItem(current.data, type)\r\n      }\r\n      current = reinterpret_cast<pointer<ListNode<T>>>(current.next)\r\n      i++\r\n    }\r\n    return nullptr as T\r\n  }\r\n\r\n  public clear<args=[T]>(callback?: (item: T) => void): void\r\n  public clear(callback?: (item: T) => void, type?: T) {\r\n    if (this.length) {\r\n      let current = this.head\r\n      while (current !== nullptr) {\r\n        if (callback) {\r\n          callback(this.getItem(current.data, type))\r\n        }\r\n        free(reinterpret_cast<pointer<void>>(current.data))\r\n        const next = reinterpret_cast<pointer<ListNode<T>>>(current.next)\r\n        free(current)\r\n        current = next\r\n      }\r\n    }\r\n    this.head = this.tail = nullptr\r\n    this.length = 0\r\n  }\r\n}\r\n","import * as is from 'common/util/is'\r\n\r\nexport default function isPointer(p: any): p is pointer<void> {\r\n  return is.number(p) && p >= nullptr\r\n}\r\n","import { memset } from './memory'\r\nimport { symbolStruct } from '../symbol'\r\nimport * as object from 'common/util/object'\r\nimport { Data } from 'common/types/type'\r\nimport isDef from 'common/function/isDef'\r\nimport structAccess from './structAccess'\r\n\r\n/**\r\n * 创建一个 struct 实例\r\n * \r\n * @param target \r\n * @returns \r\n */\r\nexport default function make<T>(init?: Data, struct?: new (...args: any[]) => T): T {\r\n\r\n  assert(struct.prototype[symbolStruct], 'cannot make struct because of not defined')\r\n\r\n  if (!isDef(struct)) {\r\n    struct = init as unknown as new (...args: any[]) => any\r\n    init = null\r\n  }\r\n\r\n  const size = sizeof(struct)\r\n  const address = malloc(size)\r\n  if (!address) {\r\n    throw new TypeError('cannot alloc memory for struct')\r\n  }\r\n\r\n  memset(address, 0, size)\r\n\r\n  const target = structAccess(address, struct)\r\n\r\n  const data = new struct()\r\n\r\n  if (init) {\r\n    object.extend(data, init)\r\n  }\r\n\r\n  object.each(data, (value, key) => {\r\n    if (isDef(value)) {\r\n      target[key] = value\r\n    }\r\n  })\r\n\r\n  return target\r\n}\r\n","import { getHeapU8, Allocator, getHeapU16, getHeap8, getHeapU32,\r\n  getHeap16, getHeap32, getHeapU64, getHeap64, getHeapF32, getHeapF64\r\n} from '../heap'\r\nimport { strlen } from './string'\r\nimport * as text from 'common/util/text'\r\nimport { CTypeEnum } from '../typedef'\r\nimport { CTypeEnumWrite } from '../ctypeEnumWrite'\r\nimport SafeUint8Array from './buffer/SafeUint8Array'\r\nimport * as config from '../config'\r\n\r\nexport function memcpy(dst: anyptr, src: anyptr, size: size) {\r\n  assert(dst && src, 'Out Of Bounds, address: 0')\r\n  assert(Allocator.isAlloc(dst), `dst address ${dst} is not alloc`)\r\n  getHeapU8().set(getHeapU8().subarray(src, src + size), dst)\r\n}\r\n\r\nexport function memcpyFromUint8Array(dst: pointer<void>, max: size, data: Uint8Array) {\r\n  assert(dst, 'Out Of Bounds, address: 0')\r\n  assert(Allocator.isAlloc(dst), `src address ${dst} is not alloc`)\r\n  getHeapU8().set(data.subarray(0, max), dst)\r\n}\r\n\r\nexport function memmove(dst: anyptr, src: anyptr, size: size) {\r\n  assert(dst && src, 'Out Of Bounds, address: 0')\r\n  assert(Allocator.isAlloc(dst), `dst address ${dst} is not alloc`)\r\n  getHeapU8().copyWithin(dst, src, src + size)\r\n}\r\n\r\nexport function memset(src: anyptr, c: uint8, n: size) {\r\n  assert(src, 'Out Of Bounds, address: 0')\r\n  assert(Allocator.isAlloc(src), `src address ${src} is not alloc`)\r\n  getHeapU8().subarray(src, src + n).fill(c)\r\n}\r\n\r\nexport function mapSafeUint8Array(src: pointer<void>, n: size): SafeUint8Array {\r\n  assert(src, 'Out Of Bounds, address: 0')\r\n  assert(Allocator.isAlloc(src), `src address ${src} is not alloc`)\r\n  return config.USE_THREADS ? mapUint8Array(src, n) as any as SafeUint8Array : new SafeUint8Array(reinterpret_cast<pointer<uint8>>(src), n)\r\n}\r\n\r\nexport function mapUint8Array(src: pointer<void>, n: size) {\r\n  assert(src, 'Out Of Bounds, address: 0')\r\n  assert(Allocator.isAlloc(src), `src address ${src} is not alloc`)\r\n  return getHeapU8().subarray(src, src + n)\r\n}\r\n\r\nexport function mapInt8Array(src: pointer<int8>, n: size) {\r\n  assert(src, 'Out Of Bounds, address: 0')\r\n  assert(Allocator.isAlloc(src), `src address ${src} is not alloc`)\r\n  return getHeap8().subarray(src, src + n)\r\n}\r\n\r\nexport function mapUint16Array(src: pointer<uint16>, n: size) {\r\n  assert(src, 'Out Of Bounds, address: 0')\r\n  assert(Allocator.isAlloc(src), `src address ${src} is not alloc`)\r\n  return getHeapU16().subarray(src >>> 1, (src >>> 1) + n)\r\n}\r\n\r\nexport function mapInt16Array(src: pointer<int16>, n: size) {\r\n  assert(src, 'Out Of Bounds, address: 0')\r\n  assert(Allocator.isAlloc(src), `src address ${src} is not alloc`)\r\n  return getHeap16().subarray(src >>> 1, (src >>> 1) + n)\r\n}\r\n\r\nexport function mapUint32Array(src: pointer<uint32>, n: size) {\r\n  assert(src, 'Out Of Bounds, address: 0')\r\n  assert(Allocator.isAlloc(src), `src address ${src} is not alloc`)\r\n  return getHeapU32().subarray(src >>> 2, (src >>> 2) + n)\r\n}\r\n\r\nexport function mapInt32Array(src: pointer<int32>, n: size) {\r\n  assert(src, 'Out Of Bounds, address: 0')\r\n  assert(Allocator.isAlloc(src), `src address ${src} is not alloc`)\r\n  return getHeap32().subarray(src >>> 2, (src >>> 2) + n)\r\n}\r\n\r\nexport function mapUint64Array(src: pointer<uint64>, n: size) {\r\n  assert(src, 'Out Of Bounds, address: 0')\r\n  assert(Allocator.isAlloc(src), `src address ${src} is not alloc`)\r\n  return getHeapU64().subarray(src >>> 3, (src >>> 3) + n)\r\n}\r\n\r\nexport function mapInt64Array(src: pointer<int64>, n: size) {\r\n  assert(src, 'Out Of Bounds, address: 0')\r\n  assert(Allocator.isAlloc(src), `src address ${src} is not alloc`)\r\n  return getHeap64().subarray(src >>> 3, (src >>> 3) + n)\r\n}\r\n\r\nexport function mapFloat32Array(src: pointer<float>, n: size) {\r\n  assert(src, 'Out Of Bounds, address: 0')\r\n  assert(Allocator.isAlloc(src), `src address ${src} is not alloc`)\r\n  return getHeapF32().subarray(src >>> 2, (src >>> 2) + n)\r\n}\r\n\r\nexport function mapFloat64Array(src: pointer<double>, n: size) {\r\n  assert(src, 'Out Of Bounds, address: 0')\r\n  assert(Allocator.isAlloc(src), `src address ${src} is not alloc`)\r\n  return getHeapF64().subarray(src >>> 3, (src >>> 3) + n)\r\n}\r\n\r\nexport function readCString(pointer: pointer<char>, max?: uint32) {\r\n  assert(pointer, 'Out Of Bounds, address: 0')\r\n  assert(Allocator.isAlloc(pointer), `address ${pointer} is not alloc`)\r\n\r\n  const stringLen = strlen(reinterpret_cast<pointer<char>>(pointer))\r\n  const len = Math.min(stringLen, max ?? stringLen)\r\n  return text.decode(mapUint8Array(pointer, len))\r\n}\r\n\r\nexport function writeCString(dst: pointer<void>, str: string, max?: uint32, addNull: boolean = true) {\r\n\r\n  assert(dst, 'Out Of Bounds, address: 0')\r\n  assert(Allocator.isAlloc(dst), `dst address ${dst} is not alloc`)\r\n\r\n  const data = text.encode(str)\r\n\r\n  let len = data.length\r\n  let remain = addNull ? 1 : 0\r\n\r\n  if (max && len - remain > max) {\r\n    len = max - remain\r\n  }\r\n\r\n  memcpyFromUint8Array(dst, len, data)\r\n\r\n  if (addNull) {\r\n    CTypeEnumWrite[CTypeEnum.int8](dst + len, 0)\r\n  }\r\n}\r\n","import { symbolStruct, symbolStructLength } from '../symbol'\r\nimport * as is from 'common/util/is'\r\nimport { CTypeEnum, CTypeEnum2Bytes, Struct } from '../typedef'\r\n\r\nexport default function sizeof(type: CTypeEnum | Struct): size {\r\n  if (is.number(type)) {\r\n    return CTypeEnum2Bytes[type] || 0\r\n  }\r\n  else if (is.func(type) && type.prototype[symbolStruct]) {\r\n    return type.prototype[symbolStructLength]\r\n  }\r\n  return 0\r\n}\r\n","import { mapUint8Array, memcpyFromUint8Array } from './memory'\r\nimport { CTypeEnum } from '../typedef'\r\nimport { CTypeEnumRead } from '../ctypeEnumRead'\r\n\r\n/**\r\n * 获取字符串长度，不包括字符串末尾的空字符（\\0）\r\n * \r\n * @param pointer \r\n */\r\nexport function strlen(pointer: pointer<char>) {\r\n  let len = 0\r\n  while (CTypeEnumRead[CTypeEnum.char](pointer++)) {\r\n    len++\r\n  }\r\n  return len\r\n}\r\n\r\n/**\r\n * 将一个字符串复制到另一个字符串\r\n * \r\n * @param destination \r\n * @param source \r\n */\r\nexport function strcpy(destination: pointer<char>, source: pointer<char>) {\r\n  const len = strlen(source) + 1\r\n  memcpyFromUint8Array(destination, len, mapUint8Array(source, len))\r\n}\r\n\r\n/**\r\n * 将一个字符串追加到另一个字符串的末尾\r\n * \r\n * @param destination \r\n * @param source \r\n */\r\nexport function strcat(destination: pointer<char>, source: pointer<char>) {\r\n  const len = strlen(source) + 1\r\n  const len1 = strlen(destination)\r\n  memcpyFromUint8Array(destination + len1, len, mapUint8Array(source, len))\r\n}\r\n\r\n/**\r\n * 比较两个字符串的大小\r\n */\r\nexport function strcmp(str1: pointer<char>, str2: pointer<char>) {\r\n  const len1 = strlen(str1)\r\n  const len2 = strlen(str2)\r\n\r\n  const len = Math.min(len1, len2)\r\n\r\n  for (let i = 0; i < len; i++) {\r\n    const char1 = CTypeEnumRead[CTypeEnum.char](str1 + i)\r\n    const char2 = CTypeEnumRead[CTypeEnum.char](str2 + i)\r\n\r\n    if (char1 > char2) {\r\n      return 1\r\n    }\r\n    else if (char1 < char2) {\r\n      return -1\r\n    }\r\n  }\r\n\r\n  if (len1 > len2) {\r\n    return 1\r\n  }\r\n  else if (len1 < len2) {\r\n    return -1\r\n  }\r\n  else {\r\n    return 0\r\n  }\r\n}\r\n","import { symbolStruct, symbolStructKeysMeta } from '../symbol'\r\nimport { proxyStruct } from '../proxyStruct'\r\nimport { definedStruct } from '../definedStruct'\r\nimport support from 'common/util/support'\r\nimport * as is from 'common/util/is'\r\nimport * as keypath from 'common/util/keypath'\r\nimport { KeyMeta, KeyMetaKey } from '../typedef'\r\n\r\n/**\r\n * 访问 struct 指针\r\n * \r\n * @param target \r\n * @param address\r\n * @returns\r\n */\r\nexport default function structAccess<T>(address: pointer<void>, struct: new (...args: any[]) => T): T {\r\n\r\n  assert(struct.prototype[symbolStruct], 'cannot reinterpret cast struct because of not defined')\r\n\r\n  if (arguments[2] && is.string(arguments[2])) {\r\n    struct = struct.prototype\r\n    keypath.each(arguments[2], (key) => {\r\n      const meta = struct[symbolStructKeysMeta] as Map<string, KeyMeta>\r\n      struct = meta.get(key)[KeyMetaKey.Type] as (new (...args: any[]) => T)\r\n    })\r\n  }\r\n\r\n  return support.proxy ? proxyStruct(address, struct) : definedStruct(address, struct)\r\n}\r\n","import { symbolStruct, symbolStructAddress } from '../symbol'\r\nimport { revokeProxyStruct } from '../proxyStruct'\r\nimport { revokeDefinedStruct } from '../definedStruct'\r\nimport support from 'common/util/support'\r\n\r\n/**\r\n * 销毁一个 struct 实例，调用 make 创建的对象必须调用 unmake，否则内存泄漏\r\n * \r\n * @param target \r\n */\r\nexport default function unmake<T extends Object>(target: T) {\r\n\r\n  assert(Object.getPrototypeOf(target)[symbolStruct], 'cannot unmake struct because of not defined')\r\n\r\n  const p = target[symbolStructAddress]\r\n  if (p) {\r\n    free(p)\r\n    target[symbolStructAddress] = nullptr\r\n    support.proxy ? revokeProxyStruct(target) : revokeDefinedStruct(target)\r\n  }\r\n}\r\n","export const symbolStruct = Symbol('Struct')\r\nexport const symbolStructLength = Symbol('StructLength')\r\nexport const symbolStructMaxBaseTypeByteLength = Symbol('StructMaxBaseTypeByteLength')\r\nexport const symbolStructAddress = Symbol('StructAddress')\r\nexport const symbolStructKeysQueue = Symbol('StructKeysQueue')\r\nexport const symbolStructKeysMeta = Symbol('StructKeysMeta')\r\nexport const symbolStructKeysInstance = Symbol('StructKeysInstance')\r\nexport const symbolStructProxyRevoke = Symbol('StructProxyRevoke')\r\n","import { base64ToUint8Array } from 'common/util/base64'\r\nimport * as logger from 'common/util/logger'\r\nimport * as wasmUtils from 'common/util/wasm'\r\n\r\nimport asm from './atomics.asm'\r\n\r\nimport { override } from '../atomics'\r\n\r\n/**\r\n * WebAssembly runtime 实例\r\n */\r\nexport let instance: WebAssembly.Instance\r\n\r\nexport function isSupport() {\r\n  return !!instance\r\n}\r\n\r\nexport default async function init(memory: WebAssembly.Memory) {\r\n  try {\r\n    if (typeof SharedArrayBuffer === 'function' && memory.buffer instanceof SharedArrayBuffer) {\r\n\r\n      const wasm = base64ToUint8Array(asm)\r\n\r\n      wasmUtils.setMemoryShared(wasm, true)\r\n\r\n      instance = (await WebAssembly.instantiate(wasm, {\r\n        env: {\r\n          memory\r\n        }\r\n      })).instance\r\n    }\r\n    else {\r\n      return\r\n    }\r\n\r\n    override({\r\n      add: function<T> (address: pointer<T>, value: AtomicType2Type<T>, type?: atomictype): AtomicType2Type<T> {\r\n\r\n        assert(address, 'Out Of Bounds, address: 0')\r\n\r\n        switch (type) {\r\n          case atomic_char:\r\n          case atomic_uint8:\r\n            return ((instance.exports.add8 as Function)(address, value) & 0xff) as AtomicType2Type<T>\r\n          case atomic_int8:\r\n            return (instance.exports.add8 as Function)(address, value)\r\n          case atomic_int16:\r\n            return (instance.exports.add16 as Function)(address, value)\r\n          case atomic_uint16:\r\n            return ((instance.exports.add16 as Function)(address, value) & 0xffff) as AtomicType2Type<T>\r\n          case atomic_int32:\r\n            assert(!(address % 4))\r\n            return (instance.exports.add32 as Function)(address, value)\r\n          case atomic_uint32:\r\n            return ((instance.exports.add32 as Function)(address, value) & 0xffffffff) as AtomicType2Type<T>\r\n          case atomic_int64:\r\n            return (instance.exports.add64 as Function)(address, value)\r\n          case atomic_uint64:\r\n            return BigInt.asUintN(64, (instance.exports.add64 as Function)(address, value)) as AtomicType2Type<T>\r\n        }\r\n      },\r\n      sub: function<T> (address: pointer<T>, value: AtomicType2Type<T>, type?: atomictype): AtomicType2Type<T> {\r\n\r\n        assert(address, 'Out Of Bounds, address: 0')\r\n\r\n        switch (type) {\r\n          case atomic_char:\r\n          case atomic_uint8:\r\n            return ((instance.exports.sub8 as Function)(address, value) & 0xff) as AtomicType2Type<T>\r\n          case atomic_int8:\r\n            return (instance.exports.sub8 as Function)(address, value)\r\n          case atomic_int16:\r\n            return (instance.exports.sub16 as Function)(address, value)\r\n          case atomic_uint16:\r\n            return ((instance.exports.sub16 as Function)(address, value) & 0xffff) as AtomicType2Type<T>\r\n          case atomic_int32:\r\n            assert(!(address % 4))\r\n            return (instance.exports.sub32 as Function)(address, value)\r\n          case atomic_uint32:\r\n            return ((instance.exports.sub32 as Function)(address, value) & 0xffffffff) as AtomicType2Type<T>\r\n          case atomic_int64:\r\n            return (instance.exports.sub64 as Function)(address, value)\r\n          case atomic_uint64:\r\n            return BigInt.asUintN(64, (instance.exports.sub64 as Function)(address, value)) as AtomicType2Type<T>\r\n        }\r\n      },\r\n      and: function<T> (address: pointer<T>, value: AtomicType2Type<T>, type?: atomictype): AtomicType2Type<T> {\r\n\r\n        assert(address, 'Out Of Bounds, address: 0')\r\n\r\n        switch (type) {\r\n          case atomic_char:\r\n          case atomic_uint8:\r\n            return ((instance.exports.and8 as Function)(address, value) & 0xff) as AtomicType2Type<T>\r\n          case atomic_int8:\r\n            return (instance.exports.and8 as Function)(address, value)\r\n          case atomic_int16:\r\n            return (instance.exports.and16 as Function)(address, value)\r\n          case atomic_uint16:\r\n            return ((instance.exports.and16 as Function)(address, value) & 0xffff) as AtomicType2Type<T>\r\n          case atomic_int32:\r\n            return (instance.exports.and32 as Function)(address, value)\r\n          case atomic_uint32:\r\n            return ((instance.exports.and32 as Function)(address, value) & 0xffffffff) as AtomicType2Type<T>\r\n          case atomic_int64:\r\n            return (instance.exports.and64 as Function)(address, value)\r\n          case atomic_uint64:\r\n            return BigInt.asUintN(64, (instance.exports.and64 as Function)(address, value)) as AtomicType2Type<T>\r\n        }\r\n      },\r\n      or: function<T> (address: pointer<T>, value: AtomicType2Type<T>, type?: atomictype): AtomicType2Type<T> {\r\n\r\n        assert(address, 'Out Of Bounds, address: 0')\r\n\r\n        switch (type) {\r\n          case atomic_char:\r\n          case atomic_uint8:\r\n            return ((instance.exports.or8 as Function)(address, value) & 0xff) as AtomicType2Type<T>\r\n          case atomic_int8:\r\n            return (instance.exports.or8 as Function)(address, value)\r\n          case atomic_int16:\r\n            return (instance.exports.or16 as Function)(address, value)\r\n          case atomic_uint16:\r\n            return ((instance.exports.or16 as Function)(address, value) & 0xffff) as AtomicType2Type<T>\r\n          case atomic_int32:\r\n            return (instance.exports.or32 as Function)(address, value)\r\n          case atomic_uint32:\r\n            return ((instance.exports.or32 as Function)(address, value) as 0xffffffff) as AtomicType2Type<T>\r\n          case atomic_int64:\r\n            return (instance.exports.or64 as Function)(address, value)\r\n          case atomic_uint64:\r\n            return BigInt.asUintN(64, (instance.exports.or64 as Function)(address, value)) as AtomicType2Type<T>\r\n        }\r\n      },\r\n      xor: function<T> (address: pointer<T>, value: AtomicType2Type<T>, type?: atomictype): AtomicType2Type<T> {\r\n\r\n        assert(address, 'Out Of Bounds, address: 0')\r\n\r\n        switch (type) {\r\n          case atomic_char:\r\n          case atomic_uint8:\r\n            return ((instance.exports.xor8 as Function)(address, value) & 0xff) as AtomicType2Type<T>\r\n          case atomic_int8:\r\n            return (instance.exports.xor8 as Function)(address, value)\r\n          case atomic_int16:\r\n            return (instance.exports.xor16 as Function)(address, value)\r\n          case atomic_uint16:\r\n            return ((instance.exports.xor16 as Function)(address, value) & 0xffff) as AtomicType2Type<T>\r\n          case atomic_int32:\r\n            return (instance.exports.xor32 as Function)(address, value)\r\n          case atomic_uint32:\r\n            return ((instance.exports.xor32 as Function)(address, value) as 0xffffffff) as AtomicType2Type<T>\r\n          case atomic_int64:\r\n            return (instance.exports.xor64 as Function)(address, value)\r\n          case atomic_uint64:\r\n            return BigInt.asUintN(64, (instance.exports.xor64 as Function)(address, value)) as AtomicType2Type<T>\r\n        }\r\n      },\r\n      store: function<T> (address: pointer<T>, value: AtomicType2Type<T>, type?: atomictype): AtomicType2Type<T> {\r\n\r\n        assert(address, 'Out Of Bounds, address: 0')\r\n\r\n        switch (type) {\r\n          case atomic_char:\r\n          case atomic_int8:\r\n          case atomic_uint8:\r\n            return (instance.exports.store8 as Function)(address, value)\r\n          case atomic_int16:\r\n          case atomic_uint16:\r\n            return (instance.exports.store16 as Function)(address, value)\r\n          case atomic_int32:\r\n          case atomic_uint32:\r\n            assert(!(address % 4))\r\n            return (instance.exports.store32 as Function)(address, value)\r\n          case atomic_int64:\r\n          case atomic_uint64:\r\n            return (instance.exports.store64 as Function)(address, value)\r\n        }\r\n      },\r\n      load: function<T> (address: pointer<T>, type?: atomictype): AtomicType2Type<T> {\r\n\r\n        assert(address, 'Out Of Bounds, address: 0')\r\n\r\n        switch (type) {\r\n          case atomic_char:\r\n          case atomic_uint8:\r\n            return ((instance.exports.load8 as Function)(address) & 0xff) as AtomicType2Type<T>\r\n          case atomic_int8:\r\n            return (instance.exports.load8 as Function)(address)\r\n          case atomic_int16:\r\n            return (instance.exports.load16 as Function)(address)\r\n          case atomic_uint16:\r\n            return ((instance.exports.load16 as Function)(address) as 0xffff) as AtomicType2Type<T>\r\n          case atomic_int32:\r\n            assert(!(address % 4))\r\n            return (instance.exports.load32 as Function)(address)\r\n          case atomic_uint32:\r\n            return ((instance.exports.load32 as Function)(address) & 0xffffffff) as AtomicType2Type<T>\r\n          case atomic_int64:\r\n            return (instance.exports.load64 as Function)(address)\r\n          case atomic_uint64:\r\n            return BigInt.asUintN(64, (instance.exports.load64 as Function)(address)) as AtomicType2Type<T>\r\n        }\r\n      },\r\n      compareExchange: function<T> (\r\n        address: pointer<T>,\r\n        expectedValue: AtomicType2Type<T>,\r\n        replacementValue: AtomicType2Type<T>,\r\n        type?: atomictype\r\n      ): AtomicType2Type<T> {\r\n\r\n        assert(address, 'Out Of Bounds, address: 0')\r\n\r\n        switch (type) {\r\n          case atomic_char:\r\n          case atomic_uint8:\r\n            return ((instance.exports.compare_exchange8 as Function)(address, expectedValue, replacementValue) & 0xff) as AtomicType2Type<T>\r\n          case atomic_int8:\r\n            return (instance.exports.compare_exchange8 as Function)(address, expectedValue, replacementValue)\r\n          case atomic_int16:\r\n            return (instance.exports.compare_exchange16 as Function)(address, expectedValue, replacementValue)\r\n          case atomic_uint16:\r\n            return ((instance.exports.compare_exchange16 as Function)(address, expectedValue, replacementValue) & 0xffff) as AtomicType2Type<T>\r\n          case atomic_int32:\r\n            return (instance.exports.compare_exchange32 as Function)(address, expectedValue, replacementValue)\r\n          case atomic_uint32:\r\n            return ((instance.exports.compare_exchange32 as Function)(address, expectedValue, replacementValue) & 0xffffffff) as AtomicType2Type<T>\r\n          case atomic_int64:\r\n            return (instance.exports.compare_exchange64 as Function)(address, expectedValue, replacementValue)\r\n          case atomic_uint64:\r\n            return BigInt.asUintN(64, (instance.exports.compare_exchange64 as Function)(\r\n              address,\r\n              expectedValue,\r\n              replacementValue\r\n            )) as AtomicType2Type<T>\r\n        }\r\n      },\r\n      exchange: function<T> (address: pointer<T>, value: AtomicType2Type<T>, type?: atomictype): AtomicType2Type<T> {\r\n\r\n        assert(address, 'Out Of Bounds, address: 0')\r\n\r\n        switch (type) {\r\n          case atomic_char:\r\n          case atomic_uint8:\r\n            return ((instance.exports.exchange8 as Function)(address, value) & 0xff) as AtomicType2Type<T>\r\n          case atomic_int8:\r\n            return (instance.exports.exchange8 as Function)(address, value)\r\n          case atomic_int16:\r\n            return (instance.exports.exchange16 as Function)(address, value)\r\n          case atomic_uint16:\r\n            return ((instance.exports.exchange16 as Function)(address, value) & 0xffff) as AtomicType2Type<T>\r\n          case atomic_int32:\r\n            return (instance.exports.exchange32 as Function)(address, value)\r\n          case atomic_uint32:\r\n            return ((instance.exports.exchange32 as Function)(address, value) & 0xffffffff) as AtomicType2Type<T>\r\n          case atomic_int64:\r\n            return (instance.exports.exchange64 as Function)(address, value)\r\n          case atomic_uint64:\r\n            return BigInt.asUintN(64, (instance.exports.exchange64 as Function)(address, value)) as AtomicType2Type<T>\r\n        }\r\n      },\r\n      notify: function (address: pointer<atomic_int32>, count: uint32) {\r\n\r\n        assert(address, 'Out Of Bounds, address: 0')\r\n\r\n        return (instance.exports.notify as Function)(address, count)\r\n      },\r\n      wait: function (address: pointer<atomic_int32>, value: int32) {\r\n\r\n        assert(address, 'Out Of Bounds, address: 0')\r\n\r\n        return (instance.exports.wait as Function)(address, value)\r\n      },\r\n\r\n      waitTimeout: function (address: pointer<atomic_int32>, value: int32, timeout?: int32) {\r\n\r\n        assert(address, 'Out Of Bounds, address: 0')\r\n\r\n        return (instance.exports.waitTimeout as Function)(address, value, static_cast<int64>(timeout))\r\n      }\r\n    })\r\n  }\r\n  catch (error) {\r\n    logger.warn('atomics asm not support, cannot use asm atomics function')\r\n  }\r\n}\r\n","/* eslint-disable */\r\nexport type AtomicType2Shift<T> =\r\n  T extends atomic_char\r\n  ? 0\r\n  : T extends atomic_int16\r\n  ? 1\r\n  : T extends atomic_int32\r\n  ? 2\r\n  : T extends atomic_int8\r\n  ? 0\r\n  : T extends atomic_uint8\r\n  ? 0\r\n  : T extends atomic_uint16\r\n  ? 1\r\n  : T extends atomic_uint32\r\n  ? 2\r\n  : T extends atomic_uint64\r\n  ? 4\r\n  : T extends atomic_int64\r\n  ? 4\r\n  : T extends atomic_bool\r\n  ? 0\r\n  : never\r\n/* eslint-enable */\r\n\r\ntype AtomicType2CTypeEnum<T> =\r\n  T extends atomic_bool\r\n    ? atomic_int8\r\n    : T\r\n\r\n/**\r\n * 给定的值加到指定位置上\r\n * \r\n * 返回该位置的旧值\r\n *\r\n */\r\nexport let add: <T extends atomictype, args = [AtomicType2CTypeEnum<T>, AtomicType2Shift<T>]>(address: pointer<T>, value: AtomicType2Type<T>) => AtomicType2Type<T>\r\n\r\n/**\r\n * 给定的值与指定位置上的值相减\r\n * \r\n * 返回该位置的旧值\r\n *\r\n */\r\nexport let sub: <T extends atomictype, args = [AtomicType2CTypeEnum<T>, AtomicType2Shift<T>]>(address: pointer<T>, value: AtomicType2Type<T>) => AtomicType2Type<T>\r\n\r\n/**\r\n * 给定的值与指定位置上的值进行与运算\r\n * \r\n * 返回该位置的旧值\r\n *\r\n */\r\nexport let and: <T extends atomictype, args = [AtomicType2CTypeEnum<T>, AtomicType2Shift<T>]>(address: pointer<T>, value: AtomicType2Type<T>) => AtomicType2Type<T>\r\n\r\n/**\r\n * 给定的值与指定位置上的值进行或运算\r\n * \r\n * 返回该位置的旧值\r\n *\r\n */\r\nexport let or: <T extends atomictype, args = [AtomicType2CTypeEnum<T>, AtomicType2Shift<T>]>(address: pointer<T>, value: AtomicType2Type<T>) => AtomicType2Type<T>\r\n\r\n/**\r\n * 给定的值与指定位置上的值进行异或运算\r\n * \r\n * 返回该位置的旧值\r\n *\r\n */\r\nexport let xor: <T extends atomictype, args = [AtomicType2CTypeEnum<T>, AtomicType2Shift<T>]>(address: pointer<T>, value: AtomicType2Type<T>) => AtomicType2Type<T>\r\n\r\n/**\r\n * 给定的值存在给定位置上\r\n * \r\n * 返回该位置的旧值\r\n *\r\n */\r\nexport let store: <T extends atomictype, args = [AtomicType2CTypeEnum<T>, AtomicType2Shift<T>]>(address: pointer<T>, value: AtomicType2Type<T>) => AtomicType2Type<T>\r\n\r\n/**\r\n * 读取给定位置上的值\r\n * \r\n * 返回该位置的旧值\r\n *\r\n */\r\nexport let load: <T extends atomictype, args = [AtomicType2CTypeEnum<T>, AtomicType2Shift<T>]>(address: pointer<T>) => AtomicType2Type<T>\r\n\r\n/**\r\n * 如果指定位置的值与给定的值相等，则将其更新为新的值，并返回该元素原先的值\r\n * \r\n * 返回该位置的旧值\r\n *\r\n */\r\nexport let compareExchange: <T extends atomictype, args = [AtomicType2CTypeEnum<T>, AtomicType2Shift<T>]>(\r\n  address: pointer<T>,\r\n  expectedValue: AtomicType2Type<T>,\r\n  replacementValue: AtomicType2Type<T>\r\n) => AtomicType2Type<T>\r\n/**\r\n * 将指定位置的值更新为给定的值，并返回该元素更新前的值。\r\n * \r\n * 返回该位置的旧值\r\n *\r\n */\r\nexport let exchange: <T extends atomictype, args = [AtomicType2CTypeEnum<T>, AtomicType2Shift<T>]>(address: pointer<T>, value: AtomicType2Type<T>) => AtomicType2Type<T>\r\n\r\n\r\n/**\r\n * 唤醒等待队列中正在指定位置上等待的线程。返回值为成功唤醒的线程数量。\r\n * \r\n * 返回被唤醒的代理的数量 0 将不会唤醒任何线程\r\n *\r\n */\r\nexport let notify: (address: pointer<atomic_int32>, count: uint32) => uint32\r\n\r\n/**\r\n * 检测指定位置上的值是否仍然是给定值，是则保持挂起直到被唤醒\r\n * \r\n * 0 \"ok\"、1 \"not-equal\"\r\n *\r\n */\r\nexport let wait: (address: pointer<atomic_int32>, value: int32) => 0 | 1 | 2\r\n\r\n/**\r\n * 检测指定位置上的值是否仍然是给定值，是则保持挂起直到被唤醒或超时（毫秒）\r\n * \r\n * 0 \"ok\"、1 \"not-equal\" 或 2 \"time-out\"\r\n *\r\n */\r\nexport let waitTimeout: (address: pointer<atomic_int32>, value: int32, timeout: int32) => 0 | 1 | 2\r\n\r\n/**\r\n * 检测指定位置上的值是否仍然是给定值，是则保持挂起直到被唤醒\r\n * \r\n * 异步非阻塞，适合在主线程上使用\r\n * \r\n * 0 \"ok\"、1 \"not-equal\"\r\n *\r\n */\r\nexport let waitAsync: (address: pointer<atomic_int32>, value: int32) => Promise<0 | 1 | 2>\r\n/**\r\n * 检测指定位置上的值是否仍然是给定值，是则保持挂起直到被唤醒或超时\r\n * \r\n * 异步非阻塞，适合在主线程上使用\r\n * \r\n * 0 \"ok\"、1 \"not-equal\" 或 2 \"time-out\"\r\n *\r\n */\r\nexport let waitTimeoutAsync: (address: pointer<atomic_int32>, value: int32, timeout: int32) => Promise<0 | 1 | 2>\r\n\r\nexport function override(funcs: Partial<{\r\n  add: typeof add\r\n  sub: typeof sub\r\n  and: typeof and\r\n  or: typeof or\r\n  xor: typeof xor\r\n  store: typeof store\r\n  load: typeof load\r\n  compareExchange: typeof compareExchange\r\n  exchange: typeof exchange\r\n  notify: typeof notify\r\n  wait: typeof wait\r\n  waitTimeout: typeof waitTimeout\r\n  waitAsync: typeof waitAsync\r\n  waitTimeoutAsync: typeof waitTimeoutAsync\r\n}>) {\r\n  if (funcs.add) {\r\n    add = funcs.add\r\n  }\r\n  if (funcs.sub) {\r\n    sub = funcs.sub\r\n  }\r\n  if (funcs.and) {\r\n    and = funcs.and\r\n  }\r\n  if (funcs.or) {\r\n    or = funcs.or\r\n  }\r\n  if (funcs.xor) {\r\n    xor = funcs.xor\r\n  }\r\n  if (funcs.store) {\r\n    store = funcs.store\r\n  }\r\n  if (funcs.load) {\r\n    load = funcs.load\r\n  }\r\n  if (funcs.compareExchange) {\r\n    compareExchange = funcs.compareExchange\r\n  }\r\n  if (funcs.exchange) {\r\n    exchange = funcs.exchange\r\n  }\r\n  if (funcs.notify) {\r\n    notify = funcs.notify\r\n  }\r\n  if (funcs.wait) {\r\n    wait = funcs.wait\r\n  }\r\n  if (funcs.waitTimeout) {\r\n    waitTimeout = funcs.waitTimeout\r\n  }\r\n  if (funcs.waitAsync) {\r\n    waitAsync = funcs.waitAsync\r\n  }\r\n  if (funcs.waitTimeoutAsync) {\r\n    waitTimeoutAsync = funcs.waitTimeoutAsync\r\n  }\r\n}\r\n","import getTimestamp from 'common/function/getTimestamp'\r\nimport nextTick from 'common/function/nextTick'\r\nimport { override } from './atomics'\r\nimport { AtomicsBuffer } from '../typedef'\r\nimport * as config from '../config'\r\nimport browser from 'common/util/browser'\r\nimport support from 'common/util/support'\r\n\r\nlet getAtomicsBuffer: (type: atomictype) => AtomicsBuffer\r\n\r\nconst useAtomics = config.USE_THREADS || (!browser.chrome && support.atomics || browser.checkVersion(browser.majorVersion, '94', true))\r\n\r\n/**\r\n * 给定的值加到指定位置上\r\n * \r\n * 返回该位置的旧值\r\n *\r\n */\r\nfunction add<T extends atomictype>(address: pointer<T>, value: AtomicType2Type<T>, type?: T, shift?: uint32): AtomicType2Type<T> {\r\n  assert(address, 'Out Of Bounds, address: 0')\r\n  if (defined(ENABLE_THREADS) && useAtomics) {\r\n    return Atomics.add(getAtomicsBuffer(type) as Uint8Array, address >>> shift, value as uint8) as AtomicType2Type<T>\r\n  }\r\n  else {\r\n    const buffer = getAtomicsBuffer(type) as Uint8Array\r\n    const index = address >>> shift\r\n    const old = buffer[index]\r\n    buffer[index] += value as uint8\r\n    return old as AtomicType2Type<T>\r\n  }\r\n}\r\n\r\n/**\r\n * 给定的值与指定位置上的值相减\r\n * \r\n * 返回该位置的旧值\r\n *\r\n */\r\nfunction sub<T extends atomictype>(address: pointer<T>, value: AtomicType2Type<T>, type?: T, shift?: uint32): AtomicType2Type<T> {\r\n  assert(address, 'Out Of Bounds, address: 0')\r\n  if (defined(ENABLE_THREADS) && useAtomics) {\r\n    return Atomics.sub(getAtomicsBuffer(type) as Uint8Array, address >>> shift, value as uint8) as AtomicType2Type<T>\r\n  }\r\n  else {\r\n    const buffer = getAtomicsBuffer(type) as Uint8Array\r\n    const index = address >>> shift\r\n    const old = buffer[index]\r\n    buffer[index] -= value as uint8\r\n    return old as AtomicType2Type<T>\r\n  }\r\n}\r\n\r\n/**\r\n * 给定的值与指定位置上的值进行与运算\r\n * \r\n * 返回该位置的旧值\r\n *\r\n */\r\nfunction and<T extends atomictype>(address: pointer<T>, value: AtomicType2Type<T>, type?: T, shift?: uint32): AtomicType2Type<T> {\r\n  assert(address, 'Out Of Bounds, address: 0')\r\n  if (defined(ENABLE_THREADS) && useAtomics) {\r\n    return Atomics.and(getAtomicsBuffer(type) as Uint8Array, address >>> shift, value as uint8) as AtomicType2Type<T>\r\n  }\r\n  else {\r\n    const buffer = getAtomicsBuffer(type) as Uint8Array\r\n    const index = address >>> shift\r\n    const old = buffer[index]\r\n    buffer[index] &= value as uint8\r\n    return old as AtomicType2Type<T>\r\n  }\r\n}\r\n\r\n/**\r\n * 给定的值与指定位置上的值进行或运算\r\n * \r\n * 返回该位置的旧值\r\n *\r\n */\r\nfunction or<T extends atomictype>(address: pointer<T>, value: AtomicType2Type<T>, type?: T, shift?: uint32): AtomicType2Type<T> {\r\n  assert(address, 'Out Of Bounds, address: 0')\r\n  if (defined(ENABLE_THREADS) && useAtomics) {\r\n    return Atomics.or(getAtomicsBuffer(type) as Uint8Array, address >>> shift, value as uint8) as AtomicType2Type<T>\r\n  }\r\n  else {\r\n    const buffer = getAtomicsBuffer(type) as Uint8Array\r\n    const index = address >>> shift\r\n    const old = buffer[index]\r\n    buffer[index] |= value as uint8\r\n    return old as AtomicType2Type<T>\r\n  }\r\n}\r\n\r\n/**\r\n * 给定的值与指定位置上的值进行异或运算\r\n * \r\n * 返回该位置的旧值\r\n *\r\n */\r\nfunction xor<T extends atomictype>(address: pointer<T>, value: AtomicType2Type<T>, type?: T, shift?: uint32): AtomicType2Type<T> {\r\n  assert(address, 'Out Of Bounds, address: 0')\r\n  if (defined(ENABLE_THREADS) && useAtomics) {\r\n    return Atomics.xor(getAtomicsBuffer(type) as Uint8Array, address >>> shift, value as uint8) as AtomicType2Type<T>\r\n  }\r\n  else {\r\n    const buffer = getAtomicsBuffer(type) as Uint8Array\r\n    const index = address >>> shift\r\n    const old = buffer[index]\r\n    buffer[index] ^= value as uint8\r\n    return old as AtomicType2Type<T>\r\n  }\r\n}\r\n\r\n/**\r\n * 给定的值存在给定位置上\r\n * \r\n * 返回该位置的旧值\r\n *\r\n */\r\nfunction store<T extends atomictype>(address: pointer<T>, value: AtomicType2Type<T>, type?: T, shift?: uint32): AtomicType2Type<T> {\r\n  assert(address, 'Out Of Bounds, address: 0')\r\n  if (defined(ENABLE_THREADS) && useAtomics) {\r\n    return Atomics.store(getAtomicsBuffer(type) as Uint8Array, address >>> shift, value as uint8) as AtomicType2Type<T>\r\n  }\r\n  else {\r\n    const buffer = getAtomicsBuffer(type) as Uint8Array\r\n    const index = address >>> shift\r\n    const old = buffer[index]\r\n    buffer[index] = value as uint8\r\n    return old as AtomicType2Type<T>\r\n  }\r\n}\r\n\r\n/**\r\n * 读取给定位置上的值\r\n * \r\n * 返回该位置的旧值\r\n *\r\n */\r\nfunction load<T extends atomictype>(address: pointer<T>, type?: T, shift?: uint32): AtomicType2Type<T> {\r\n  assert(address, 'Out Of Bounds, address: 0')\r\n  if (defined(ENABLE_THREADS) && useAtomics) {\r\n    return Atomics.load(getAtomicsBuffer(type) as Uint8Array, address >>> shift as uint8) as AtomicType2Type<T>\r\n  }\r\n  else {\r\n    const buffer = getAtomicsBuffer(type) as Uint8Array\r\n    const index = address >>> shift\r\n    const old = buffer[index]\r\n    return old as AtomicType2Type<T>\r\n  }\r\n}\r\n\r\n/**\r\n * 如果指定位置的值与给定的值相等，则将其更新为新的值，并返回该位置原先的值\r\n * \r\n * 返回该位置的旧值\r\n *\r\n */\r\nfunction compareExchange<T extends atomictype>(\r\n  address: pointer<T>,\r\n  expectedValue: AtomicType2Type<T>,\r\n  replacementValue: AtomicType2Type<T>,\r\n  type?: T,\r\n  shift?: uint32\r\n): AtomicType2Type<T> {\r\n  assert(address, 'Out Of Bounds, address: 0')\r\n  if (defined(ENABLE_THREADS) && useAtomics) {\r\n    return Atomics.compareExchange(\r\n      getAtomicsBuffer(type) as Uint8Array,\r\n      address >>> shift,\r\n      expectedValue as uint8,\r\n      replacementValue as uint8\r\n    ) as AtomicType2Type<T>\r\n  }\r\n  else {\r\n    const buffer = getAtomicsBuffer(type) as Uint8Array\r\n    const index = address >>> shift\r\n    const old = buffer[index] as uint8\r\n    if (old === expectedValue) {\r\n      buffer[index] = replacementValue as uint8\r\n    }\r\n    return old as AtomicType2Type<T>\r\n  }\r\n}\r\n\r\n/**\r\n * 将指定位置的值更新为给定的值，并返回该位置更新前的值。\r\n * \r\n * 返回该位置的旧值\r\n *\r\n */\r\nfunction exchange<T extends atomictype>(address: pointer<T>, value: AtomicType2Type<T>, type?: T, shift?: uint32): AtomicType2Type<T> {\r\n  assert(address, 'Out Of Bounds, address: 0')\r\n  if (defined(ENABLE_THREADS) && useAtomics) {\r\n    return Atomics.exchange(getAtomicsBuffer(type) as Uint8Array, address >>> shift, value as uint8) as AtomicType2Type<T>\r\n  }\r\n  else {\r\n    const buffer = getAtomicsBuffer(type) as Uint8Array\r\n    const index = address >>> shift\r\n    const old = buffer[index]\r\n    buffer[index] = value as uint8\r\n    return old as AtomicType2Type<T>\r\n  }\r\n}\r\n\r\n/**\r\n * 唤醒等待队列中正在指定位置上等待的线程。返回值为成功唤醒的线程数量。\r\n * \r\n * 返回被唤醒的代理的数量\r\n *\r\n */\r\nfunction notify(address: pointer<atomic_int32>, count: uint32): uint32 {\r\n  assert(address, 'Out Of Bounds, address: 0')\r\n  if (defined(ENABLE_THREADS) && useAtomics) {\r\n    return Atomics.notify(getAtomicsBuffer(atomic_int32) as Int32Array, address >>> 2, count)\r\n  }\r\n  else {\r\n    return\r\n  }\r\n}\r\n\r\n/**\r\n * 检测指定位置上的值是否仍然是给定值，是则保持挂起直到被唤醒\r\n * \r\n * 0 \"ok\"、1 \"not-equal\" 或 2 \"timed-out\"\r\n *\r\n */\r\nconst waitMap: Record<'ok' | 'not-equal' | 'timed-out', 0 | 1 | 2> = {\r\n  'ok': 0,\r\n  'not-equal': 1,\r\n  'timed-out': 2\r\n}\r\n\r\nfunction wait(address: pointer<atomic_int32>, value: int32): 0 | 1 | 2 {\r\n  assert(address, 'Out Of Bounds, address: 0')\r\n  return waitMap[Atomics.wait(getAtomicsBuffer(atomic_int32) as Int32Array, address >>> 2, value)]\r\n}\r\n\r\n/**\r\n * 检测指定位置上的值是否仍然是给定值，是则保持挂起直到被唤醒或超时\r\n * \r\n * 0 \"ok\"、1 \"not-equal\" 或 2 \"time-out\"\r\n *\r\n */\r\nfunction waitTimeout(address: pointer<atomic_int32>, value: int32, timeout: int32): 0 | 1 | 2 {\r\n  assert(address, 'Out Of Bounds, address: 0')\r\n  return waitMap[Atomics.wait(getAtomicsBuffer(atomic_int32) as Int32Array, address >>> 2, value, timeout)]\r\n}\r\n\r\n/**\r\n * 检测指定位置上的值是否仍然是给定值，是则保持挂起直到被唤醒\r\n * \r\n * 0 \"ok\"、1 \"not-equal\" 或 2 \"timed-out\"\r\n *\r\n */\r\nasync function waitAsync(address: pointer<atomic_int32>, value: int32): Promise<0 | 1 | 2> {\r\n\r\n  assert(address, 'Out Of Bounds, address: 0')\r\n\r\n  if (Atomics.waitAsync) {\r\n    const result = Atomics.waitAsync(getAtomicsBuffer(atomic_int32) as Int32Array, address >>> 2, value)\r\n    if (result.async) {\r\n      return waitMap[await result.value]\r\n    }\r\n    return waitMap[result.value as 'not-equal' | 'timed-out']\r\n  }\r\n  else {\r\n\r\n    if (static_cast<int32>(load(address)) !== value) {\r\n      return 1\r\n    }\r\n    else {\r\n      while (static_cast<int32>(load(address)) === value) {\r\n        // 跳过当前事件循环\r\n        await new Promise<void>((resolve) => {\r\n          nextTick(() => {\r\n            resolve()\r\n          })\r\n        })\r\n      }\r\n      return 0\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 检测指定位置上的值是否仍然是给定值，是则保持挂起直到被唤醒或超时\r\n * \r\n * 0 \"ok\"、1 \"not-equal\" 或 2 \"time-out\"\r\n *\r\n */\r\nasync function waitTimeoutAsync(address: pointer<atomic_int32>, value: int32, timeout: int32): Promise<0 | 1 | 2> {\r\n\r\n  assert(address, 'Out Of Bounds, address: 0')\r\n\r\n  if (Atomics.waitAsync) {\r\n    const result = Atomics.waitAsync(getAtomicsBuffer(atomic_int32) as Int32Array, address >>> 2, value, timeout)\r\n    if (result.async) {\r\n      return waitMap[await result.value]\r\n    }\r\n    return waitMap[result.value as 'not-equal' | 'timed-out']\r\n  }\r\n  else {\r\n\r\n    if (static_cast<int32>(load(address)) !== value) {\r\n      return 1\r\n    }\r\n    else {\r\n      const now = getTimestamp()\r\n\r\n      while (static_cast<int32>(load(address)) === value && (getTimestamp() - now < timeout)) {\r\n        // 跳过当前事件循环\r\n        await new Promise<void>((resolve) => {\r\n          nextTick(() => {\r\n            resolve()\r\n          })\r\n        })\r\n      }\r\n      return load(address) !== value ? 0 : 2\r\n    }\r\n  }\r\n}\r\n\r\nexport default function init(getAtomicsBuffer_: (type: atomictype) => AtomicsBuffer,) {\r\n\r\n  getAtomicsBuffer = getAtomicsBuffer_\r\n\r\n  override({\r\n    add,\r\n    sub,\r\n    and,\r\n    or,\r\n    xor,\r\n    store,\r\n    load,\r\n    compareExchange,\r\n    exchange,\r\n    notify,\r\n    wait,\r\n    waitTimeout,\r\n    waitAsync,\r\n    waitTimeoutAsync\r\n  })\r\n}\r\n","/**\r\n * 参考 https://github.com/mozilla-spidermonkey/js-lock-and-condition\r\n */\r\n\r\nimport * as mutexUtil from './mutex'\r\nimport * as atomics from './atomics'\r\nimport { Mutex } from './mutex'\r\n\r\n@struct\r\nexport class Cond {\r\n  atomic: atomic_int32\r\n}\r\n\r\n/**\r\n * 初始化条件变量\r\n */\r\nexport function init(cond: pointer<Cond>, attr?: pointer<void>): int32 {\r\n  atomics.store(addressof(cond.atomic), 0)\r\n  return 0\r\n}\r\n\r\n/**\r\n * 销毁条件变量\r\n */\r\nexport function destroy(cond: pointer<Cond>): int32 {\r\n  atomics.store(addressof(cond.atomic), 0)\r\n  return 0\r\n}\r\n\r\n/**\r\n * 唤醒条件变量上的一个等待线程\r\n * \r\n * @param cond \r\n */\r\nexport function signal(cond: pointer<Cond>): int32 {\r\n  atomics.add(addressof(cond.atomic), 1)\r\n  atomics.notify(addressof(cond.atomic), 1)\r\n  return 0\r\n}\r\n\r\n/**\r\n * 唤醒条件变量上的所有等待线程\r\n * \r\n * @param cond \r\n */\r\nexport function broadcast(cond: pointer<Cond>): int32 {\r\n  atomics.add(addressof(cond.atomic), 1)\r\n  atomics.notify(addressof(cond.atomic), 1 << 30)\r\n  return 0\r\n}\r\n\r\n/**\r\n * 线程在条件变量处等待\r\n * \r\n * @param cond \r\n * @param mutex \r\n * @returns \r\n */\r\nexport function wait(cond: pointer<Cond>, mutex: pointer<Mutex>): int32 {\r\n  let c = atomics.load(addressof(cond.atomic))\r\n  mutexUtil.unlock(mutex)\r\n  atomics.wait(addressof(cond.atomic), c)\r\n  mutexUtil.lock(mutex)\r\n  return 0\r\n}\r\n\r\n/**\r\n * 线程在条件变量处异步等待\r\n * \r\n * @param cond \r\n * @param mutex \r\n */\r\nexport async function waitAsync(cond: pointer<Cond>, mutex: pointer<Mutex>): Promise<int32> {\r\n  let c = atomics.load(addressof(cond.atomic))\r\n  mutexUtil.unlock(mutex)\r\n\r\n  await atomics.waitAsync(addressof(cond.atomic), c)\r\n\r\n  await mutexUtil.lockAsync(mutex)\r\n\r\n  return 0\r\n}\r\n\r\n/**\r\n * 线程在条件变量处超时等待\r\n * \r\n * @param cond \r\n * @param mutex \r\n * @param timeout 毫秒\r\n */\r\nexport function timedWait(cond: pointer<Cond>, mutex: pointer<Mutex>, timeout: int32): int32 {\r\n  let c = atomics.load(addressof(cond.atomic))\r\n  mutexUtil.unlock(mutex)\r\n  let ret = atomics.waitTimeout(addressof(cond.atomic), c, timeout)\r\n  mutexUtil.lock(mutex)\r\n  return ret === 2 ? 110 : 0\r\n}\r\n\r\n/**\r\n * 线程在条件变量处超时异步等待\r\n * \r\n * @param cond \r\n * @param mutex \r\n * @param timeout 毫秒\r\n */\r\nexport async function timedwaitAsync(cond: pointer<Cond>, mutex: pointer<Mutex>, timeout: int32): Promise<int32> {\r\n  let c = atomics.load(addressof(cond.atomic))\r\n  mutexUtil.unlock(mutex)\r\n  let ret = await atomics.waitTimeoutAsync(addressof(cond.atomic), c, timeout)\r\n  await mutexUtil.lockAsync(mutex)\r\n  return ret === 2 ? 110 : 0\r\n}\r\n\r\n","import IPCPort, { REQUEST } from 'common/network/IPCPort'\r\nimport NodeIPCPort from 'common/network/NodeIPCPort'\r\nimport { SELF } from 'common/util/constant'\r\nimport * as is from 'common/util/is'\r\nimport { CHeapError } from '../error'\r\n\r\nlet parentPort = SELF\r\nif (defined(ENV_NODE)) {\r\n  const { parentPort: parentPort_ } = require('worker_threads')\r\n  parentPort = parentPort_\r\n}\r\n\r\nexport default function init(run: (...args: any[]) => any) {\r\n\r\n  let ipc: IPCPort\r\n  let target: any\r\n\r\n  function initIPC(port: MessagePort) {\r\n    ipc = defined(ENV_NODE) ? new NodeIPCPort(port) : new IPCPort(port)\r\n    ipc.on(REQUEST, async (data: any) => {\r\n      const method = data.method\r\n      const params = data.params\r\n\r\n      if (is.func(target[method])) {\r\n        try {\r\n          if (!target[method].transfer) {\r\n            target[method].transfer = []\r\n          }\r\n          const result = await target[method](...params.params)\r\n          ipc.reply(data, result, null, target[method].transfer)\r\n          target[method].transfer.length = 0\r\n        }\r\n        catch (error) {\r\n          if (defined(DEBUG)) {\r\n            console.error(error)\r\n          }\r\n          ipc.reply(data, CHeapError.REQUEST_ERROR, {\r\n            message: error.message\r\n          })\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  const handler = (message: MessageEvent<any>) => {\r\n    const origin = defined(ENV_NODE) ? message : message.data\r\n    const type = origin.type\r\n    const data = origin.data\r\n\r\n    switch (type) {\r\n      case 'init':\r\n        if (SELF.CHeap && SELF.CHeap.initThread && SELF.CHeap.Config.USE_THREADS) {\r\n          SELF.CHeap.initThread(data).then(() => {\r\n            parentPort.postMessage({\r\n              type: 'ready'\r\n            })\r\n          })\r\n          return\r\n        }\r\n        parentPort.postMessage({\r\n          type: 'ready'\r\n        })\r\n        break\r\n      case 'run':\r\n\r\n        parentPort.postMessage({\r\n          type: 'running'\r\n        })\r\n\r\n        target = run(data.params)\r\n\r\n        initIPC(data.port)\r\n\r\n        break\r\n      case 'stop':\r\n        if (ipc) {\r\n          ipc.destroy()\r\n        }\r\n        // @ts-ignore\r\n        if (SELF.__freeSmartPtr__) {\r\n          // @ts-ignore\r\n          SELF.__freeSmartPtr__()\r\n        }\r\n        parentPort.postMessage({\r\n          type: 'stopped'\r\n        })\r\n        break\r\n      default:\r\n        break\r\n    }\r\n  }\r\n\r\n  if (defined(ENV_NODE)) {\r\n    // @ts-ignore\r\n    parentPort.on('message', handler)\r\n  }\r\n  else {\r\n    parentPort.onmessage = handler\r\n  }\r\n}\r\n","import { SELF } from 'common/util/constant'\r\n\r\nlet parentPort = SELF\r\nif (defined(ENV_NODE)) {\r\n  const { parentPort: parentPort_ } = require('worker_threads')\r\n  parentPort = parentPort_\r\n}\r\n\r\nexport default function init(run: (...args: any[]) => any) {\r\n  let retval: any\r\n\r\n  const handler = (message: MessageEvent<any>) => {\r\n    const origin = defined(ENV_NODE) ? message : message.data\r\n    const type = origin.type\r\n    const data = origin.data\r\n\r\n    switch (type) {\r\n      case 'init':\r\n        if (SELF.CHeap && SELF.CHeap.initThread && SELF.CHeap.Config.USE_THREADS) {\r\n          SELF.CHeap.initThread(data).then(() => {\r\n            parentPort.postMessage({\r\n              type: 'ready'\r\n            })\r\n          })\r\n          return\r\n        }\r\n\r\n        parentPort.postMessage({\r\n          type: 'ready'\r\n        })\r\n        break\r\n      case 'run':\r\n        retval = run(data.params)\r\n        break\r\n      case 'stop':\r\n        if (retval && retval.then) {\r\n          retval.then((res: any) => {\r\n            // @ts-ignore\r\n            if (SELF.__freeSmartPtr__) {\r\n              // @ts-ignore\r\n              SELF.__freeSmartPtr__()\r\n            }\r\n            parentPort.postMessage({\r\n              type: 'stopped',\r\n              data: res\r\n            })\r\n          })\r\n        }\r\n        else {\r\n          // @ts-ignore\r\n          if (SELF.__freeSmartPtr__) {\r\n            // @ts-ignore\r\n            SELF.__freeSmartPtr__()\r\n          }\r\n          parentPort.postMessage({\r\n            type: 'stopped',\r\n            data: retval\r\n          })\r\n        }\r\n        break\r\n      default:\r\n        break\r\n    }\r\n  }\r\n\r\n  if (defined(ENV_NODE)) {\r\n    // @ts-ignore\r\n    parentPort.on('message', handler)\r\n  }\r\n  else {\r\n    parentPort.onmessage = handler\r\n  }\r\n}\r\n","import IPCPort, { REQUEST } from 'common/network/IPCPort'\r\nimport NodeIPCPort from 'common/network/NodeIPCPort'\r\nimport { SELF } from 'common/util/constant'\r\nimport * as is from 'common/util/is'\r\nimport { CHeapError } from '../error'\r\n\r\nlet parentPort = SELF\r\nif (defined(ENV_NODE)) {\r\n  const { parentPort: parentPort_ } = require('worker_threads')\r\n  parentPort = parentPort_\r\n}\r\n\r\nexport default function init(module: Object) {\r\n\r\n  let ipc: IPCPort\r\n\r\n  function initIPC(port: MessagePort) {\r\n    ipc = defined(ENV_NODE) ? new NodeIPCPort(port) : new IPCPort(port)\r\n    ipc.on(REQUEST, async (data: any) => {\r\n      const method = data.method\r\n      const params = data.params\r\n\r\n      if (is.func(module[method])) {\r\n        try {\r\n          if (!module[method].transfer) {\r\n            module[method].transfer = []\r\n          }\r\n          const result = await module[method](...params.params)\r\n          ipc.reply(data, result, null, module[method].transfer)\r\n          module[method].transfer.length = 0\r\n        }\r\n        catch (error) {\r\n          if (defined(DEBUG)) {\r\n            console.error(error)\r\n          }\r\n          ipc.reply(data, CHeapError.REQUEST_ERROR, {\r\n            message: error.message\r\n          })\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  const handler = (message: MessageEvent<any>) => {\r\n    const origin = defined(ENV_NODE) ? message : message.data\r\n    const type = origin.type\r\n    const data = origin.data\r\n\r\n    switch (type) {\r\n      case 'init':\r\n        if (SELF.CHeap && SELF.CHeap.initThread && SELF.CHeap.Config.USE_THREADS) {\r\n          SELF.CHeap.initThread(data).then(() => {\r\n            parentPort.postMessage({\r\n              type: 'ready'\r\n            })\r\n          })\r\n          return\r\n        }\r\n        parentPort.postMessage({\r\n          type: 'ready'\r\n        })\r\n        break\r\n      case 'run':\r\n\r\n        parentPort.postMessage({\r\n          type: 'running'\r\n        })\r\n\r\n        initIPC(data.port)\r\n\r\n        break\r\n      case 'stop':\r\n        if (ipc) {\r\n          ipc.destroy()\r\n        }\r\n        // @ts-ignore\r\n        if (SELF.__freeSmartPtr__) {\r\n          // @ts-ignore\r\n          SELF.__freeSmartPtr__()\r\n        }\r\n        parentPort.postMessage({\r\n          type: 'stopped'\r\n        })\r\n        break\r\n      default:\r\n        break\r\n    }\r\n  }\r\n\r\n  if (defined(ENV_NODE)) {\r\n    // @ts-ignore\r\n    parentPort.on('message', handler)\r\n  }\r\n  else {\r\n    parentPort.onmessage = handler\r\n  }\r\n}\r\n","/**\r\n * 参考 https://github.com/mozilla-spidermonkey/js-lock-and-condition\r\n */\r\n\r\nimport { POSIXError } from '../error'\r\nimport * as atomics from './atomics'\r\nimport isWorker from 'common/function/isWorker'\r\n\r\n@struct\r\nexport class Mutex {\r\n  atomic: atomic_int32\r\n}\r\n\r\nconst enum STATUS {\r\n  UNLOCK,\r\n  LOCKED,\r\n  WAITED\r\n}\r\n\r\n/**\r\n * 初始化锁\r\n * \r\n * @param mutex \r\n * @returns \r\n */\r\nexport function init(mutex: pointer<Mutex>): int32 {\r\n  atomics.store(addressof(mutex.atomic), STATUS.UNLOCK)\r\n  return 0\r\n}\r\n\r\n/**\r\n * 加锁\r\n * \r\n * @param mutex \r\n * @param spin 是否自旋\r\n */\r\nexport function lock(mutex: pointer<Mutex>, spin: boolean = false): int32 {\r\n  let status: STATUS\r\n  // 不为 UNLOCK，说明其他线程持锁，将锁置为 LOCKED 状态\r\n  if ((status = atomics.compareExchange(addressof(mutex.atomic), STATUS.UNLOCK, STATUS.LOCKED)) !== STATUS.UNLOCK) {\r\n    do {\r\n      // 如果依旧得不到锁，将锁置为 WAITED 状态\r\n      if (status == STATUS.WAITED\r\n        || atomics.compareExchange(addressof(mutex.atomic), STATUS.LOCKED, STATUS.WAITED) !== STATUS.UNLOCK\r\n      ) {\r\n        // 主线程不能 wait，直接自旋（需要注意所有线程各自的持锁时间，避免出现忙等占用大量 cpu 时间）\r\n        if (!spin && isWorker()) {\r\n          atomics.wait(addressof(mutex.atomic), STATUS.WAITED)\r\n        }\r\n      }\r\n    }\r\n    // 再次尝试获取锁\r\n    while ((status = atomics.compareExchange(addressof(mutex.atomic), STATUS.UNLOCK, STATUS.WAITED)) !== STATUS.UNLOCK)\r\n  }\r\n\r\n  return 0\r\n}\r\n\r\n/**\r\n * 尝试加锁\r\n * \r\n * @param mutex \r\n */\r\nexport function tryLock(mutex: pointer<Mutex>): int32 {\r\n  if (atomics.compareExchange(addressof(mutex.atomic), STATUS.UNLOCK, STATUS.LOCKED) === STATUS.UNLOCK) {\r\n    return 0\r\n  }\r\n  // EBUSY\r\n  return POSIXError.EBUSY\r\n}\r\n\r\n\r\n/**\r\n * 异步加锁\r\n * \r\n * @param mutex\r\n */\r\nexport async function lockAsync(mutex: pointer<Mutex>): Promise<int32> {\r\n  let status: STATUS\r\n  // 不为 UNLOCK，说明其他线程持锁，将锁置为 LOCKED 状态\r\n  if ((status = atomics.compareExchange(addressof(mutex.atomic), STATUS.UNLOCK, STATUS.LOCKED)) !== STATUS.UNLOCK) {\r\n    do {\r\n      // 如果依旧得不到锁，将锁置为 WAITED 状态\r\n      if (status == STATUS.WAITED\r\n        || atomics.compareExchange(addressof(mutex.atomic), STATUS.LOCKED, STATUS.WAITED) !== STATUS.UNLOCK\r\n      ) {\r\n        await atomics.waitAsync(addressof(mutex.atomic), STATUS.WAITED)\r\n      }\r\n    }\r\n    // 再次尝试获取锁\r\n    while ((status = atomics.compareExchange(addressof(mutex.atomic), STATUS.UNLOCK, STATUS.WAITED)) !== STATUS.UNLOCK)\r\n  }\r\n\r\n  return 0\r\n}\r\n\r\n/**\r\n * 释放锁\r\n * \r\n * @param mutex \r\n */\r\nexport function unlock(mutex: pointer<Mutex>): int32 {\r\n\r\n  assert(atomics.load(addressof(mutex.atomic)) === STATUS.LOCKED || atomics.load(addressof(mutex.atomic)) === STATUS.WAITED)\r\n\r\n  let status: STATUS = atomics.sub(addressof(mutex.atomic), 1)\r\n  // 此时拥有锁，状态为 LOCKED 或 WAITED\r\n  if (status !== STATUS.LOCKED) {\r\n    // 释放锁\r\n    atomics.store(addressof(mutex.atomic), STATUS.UNLOCK)\r\n    // 唤醒一个 wait 的线程\r\n    atomics.notify(addressof(mutex.atomic), 1)\r\n  }\r\n\r\n  return 0\r\n}\r\n\r\n/**\r\n * 销毁锁\r\n * \r\n * @param mutex \r\n * @returns \r\n */\r\nexport function destroy(mutex: pointer<Mutex>): int32 {\r\n  atomics.store(addressof(mutex.atomic), STATUS.UNLOCK)\r\n  return 0\r\n}\r\n","import * as atomics from './atomics'\r\nimport * as mutex from './mutex'\r\nimport { Mutex } from './mutex'\r\n\r\n@struct\r\nexport class Sem {\r\n  atomic: atomic_int32\r\n  mutex: Mutex\r\n}\r\n\r\n\r\n/**\r\n * 初始化信号量\r\n * \r\n * @param sem \r\n * @param value 信号量初始值\r\n */\r\nexport function init(sem: pointer<Sem>, value: uint32): int32 {\r\n  atomics.store(addressof(sem.atomic), static_cast<int32>(value))\r\n  mutex.init(addressof(sem.mutex))\r\n  return 0\r\n}\r\n\r\nexport function destroy(sem: pointer<Sem>): int32 {\r\n  mutex.destroy(addressof(sem.mutex))\r\n  return 0\r\n}\r\n\r\n/**\r\n * 生产信号量\r\n * \r\n * @param sem \r\n */\r\nexport function post(sem: pointer<Sem>): int32 {\r\n  atomics.add(addressof(sem.atomic), 1)\r\n  atomics.notify(addressof(sem.atomic), 1)\r\n  return 0\r\n}\r\n\r\n/**\r\n * 消费信号量\r\n * \r\n * @param sem \r\n */\r\nexport function wait(sem: pointer<Sem>): int32 {\r\n  while (true) {\r\n    atomics.wait(addressof(sem.atomic), 0)\r\n    let old = atomics.sub(addressof(sem.atomic), 1)\r\n    if (old <= 0) {\r\n      // 此时已经没有了，将减掉的加回来继续等待\r\n      atomics.add(addressof(sem.atomic), 1)\r\n    }\r\n    else {\r\n      break\r\n    }\r\n  }\r\n  return 0\r\n}\r\n\r\n/**\r\n * 消费信号量\r\n * \r\n * @param sem \r\n */\r\nexport function tryWait(sem: pointer<Sem>): int32 {\r\n  mutex.lock(addressof(sem.mutex))\r\n  if (sem.atomic > 0) {\r\n    sem.atomic--\r\n    mutex.unlock(addressof(sem.mutex))\r\n    return 0\r\n  }\r\n  mutex.unlock(addressof(sem.mutex))\r\n  return 11\r\n}\r\n\r\n/**\r\n * 消费信号量，并设置一个超时\r\n * \r\n * @param sem \r\n * @param timeout 毫秒\r\n * @returns \r\n */\r\nexport function timedWait(sem: pointer<Sem>, timeout: int32): int32 {\r\n  let ret = atomics.waitTimeout(addressof(sem.atomic), 0, timeout)\r\n  if (ret !== 2) {\r\n    let old = atomics.sub(addressof(sem.atomic), 1)\r\n    if (old <= 0) {\r\n      // 此时已经没有了，将减掉的加回来\r\n      atomics.add(addressof(sem.atomic), 1)\r\n      // ETIMEDOUT\r\n      return 110\r\n    }\r\n  }\r\n  return 0\r\n}\r\n\r\n/**\r\n * 异步消费信号量\r\n * \r\n * @param sem \r\n */\r\nexport async function waitAsync(sem: pointer<Sem>): Promise<int32> {\r\n  while (true) {\r\n    await atomics.waitAsync(addressof(sem.atomic), 0)\r\n    let old = atomics.sub(addressof(sem.atomic), 1)\r\n    if (old <= 0) {\r\n      // 此时已经没有了，将减掉的加回来继续等待\r\n      atomics.add(addressof(sem.atomic), 1)\r\n    }\r\n    else {\r\n      break\r\n    }\r\n  }\r\n  return 0\r\n}\r\n\r\n/**\r\n * 异步消费信号量，并设置一个超时\r\n * \r\n * @param sem \r\n * @param timeout 毫秒\r\n */\r\nexport async function timedWaitAsync(sem: pointer<Sem>, timeout: int32): Promise<int32> {\r\n  let ret = await atomics.waitTimeoutAsync(addressof(sem.atomic), 0, timeout)\r\n  if (ret !== 2) {\r\n    let old = atomics.sub(addressof(sem.atomic), 1)\r\n    if (old <= 0) {\r\n      // 此时已经没有了，将减掉的加回来\r\n      atomics.add(addressof(sem.atomic), 1)\r\n      // ETIMEDOUT\r\n      return 110\r\n    }\r\n  }\r\n  return 0\r\n}\r\n\r\n\r\nexport function set(sem: pointer<Sem>, value: int32): int32 {\r\n  atomics.store(addressof(sem.atomic), value)\r\n  return 0\r\n}\r\n\r\nexport function get(sem: pointer<Sem>): int32 {\r\n  return atomics.load(addressof(sem.atomic))\r\n}\r\n\r\n","import { PromiseType, RemoveNeverProperties } from 'common/types/advanced'\r\nimport IPCPort from 'common/network/IPCPort'\r\nimport NodeIPCPort from 'common/network/NodeIPCPort'\r\nimport { Memory } from '../heap'\r\nimport sourceLoad from 'common/function/sourceLoad'\r\nimport * as config from '../config'\r\nimport * as is from 'common/util/is'\r\nimport { SELF } from 'common/util/constant'\r\nimport generateUUID from 'common/function/generateUUID'\r\nimport toString from 'common/function/toString'\r\n\r\n// @ts-ignore\r\nlet Worker: new (url: string) => Worker = SELF.Worker\r\n// @ts-ignore\r\nlet MessageChannel: new () => MessageChannel = SELF.MessageChannel\r\n\r\nif (defined(ENV_NODE)) {\r\n  const { Worker: Worker_, MessageChannel: MessageChannel_ } = require('worker_threads')\r\n  Worker = Worker_\r\n  MessageChannel = MessageChannel_\r\n}\r\n\r\nif (defined(ENABLE_THREADS)) {\r\n  // 保证打包工具可以包含下面的模块代码\r\n  require('./initClass')\r\n  require('./initFunction')\r\n  require('./initModule')\r\n}\r\n\r\nconst initClass = defined(ENABLE_THREADS) ? sourceLoad(require.resolve('./initClass'), {\r\n  varName: 'init'\r\n}) : null\r\nconst initFunction = defined(ENABLE_THREADS) ? sourceLoad(require.resolve('./initFunction'), {\r\n  varName: 'init'\r\n}) : null\r\nconst initModule = defined(ENABLE_THREADS) ? sourceLoad(require.resolve('./initModule'), {\r\n  varName: 'init'\r\n}) : null\r\n\r\nconst symbolRevoke = Symbol('revoke')\r\n\r\ntype AsyncReturnWithoutProperties<T> = RemoveNeverProperties<{\r\n  [K in keyof T]: T[K] extends (...args: any[]) => any\r\n    ? (T[K] extends (...args: any[]) => Promise<any>\r\n      ? T[K] & {\r\n        transfer: (...transfer: Transferable[]) => { invoke: T[K] }\r\n      }\r\n      : (...args: Parameters<T[K]>) => Promise<ReturnType<T[K]>> ) & {\r\n      transfer: (...transfer: Transferable[]) => { invoke: T[K] }\r\n    }\r\n    : never\r\n}>\r\n\r\ntype ThreadType = 'class' | 'function' | 'module'\r\n\r\nexport type Thread<T, U = never> = {\r\n  $worker: Worker\r\n  $ipc?: IPCPort\r\n  $channel?: MessageChannel\r\n  $moduleId: string | Worker\r\n  $stackPointer: pointer<void>\r\n  $retval?: Promise<U>\r\n  $instance?: any\r\n  $type: ThreadType\r\n} & AsyncReturnWithoutProperties<T>\r\n\r\nexport interface ThreadOptions {\r\n  name?: string\r\n  stackSize?: number\r\n  disableWorker?: boolean\r\n  dispatchToWorker?: boolean\r\n}\r\n\r\nconst caches: Map<string, {\r\n  url: string\r\n  refCount: number\r\n}> = new Map()\r\n\r\nfunction getCacheKey(moduleId: string, type: ThreadType) {\r\n  return `${moduleId}_${type}`\r\n}\r\n\r\nexport function createThreadFromClass<T, U extends any[], args=[moduleId<'0'>]>(entity: new (...args: U) => T, options?: ThreadOptions): {\r\n  run: (...args: U) => Promise<Thread<T>>\r\n  transfer: (...transfer: Transferable[]) => {\r\n    run: (...args: U) => Promise<Thread<T>>\r\n  }\r\n}\r\nexport function createThreadFromClass<T, U extends any[]>(\r\n  entity: new (...args: U) => T,\r\n  options: ThreadOptions,\r\n  moduleId: string\r\n): {\r\n  run: (...args: U) => Promise<Thread<T>>\r\n  transfer: (...transfer: Transferable[]) => {\r\n    run: (...args: U) => Promise<Thread<T>>\r\n  }\r\n}\r\nexport function createThreadFromClass<T, U extends any[]>(\r\n  entity: new (...args: U) => T,\r\n  options: ThreadOptions = {},\r\n  moduleId?: string | Worker\r\n): {\r\n    run: (...args: U) => Promise<Thread<T>>\r\n    transfer: (...transfer: Transferable[]) => {\r\n      run: (...args: U) => Promise<Thread<T>>\r\n    }\r\n  } {\r\n\r\n  let transferData: Transferable[] = []\r\n\r\n  let runInWorker: (...args: U) => Promise<Thread<T>>\r\n\r\n  if (defined(ENABLE_THREADS)) {\r\n    runInWorker = (...args: U) => {\r\n\r\n      let worker: Worker\r\n\r\n      if (moduleId instanceof Worker) {\r\n        worker = moduleId\r\n      }\r\n      else {\r\n        let workerUrl: string\r\n        const cacheKey = getCacheKey(moduleId, 'class')\r\n        if (caches.has(cacheKey)) {\r\n          workerUrl = caches.get(cacheKey).url\r\n          caches.get(cacheKey).refCount++\r\n        }\r\n        else {\r\n          const module = sourceLoad(moduleId, {\r\n            varName: `__module_${entity.name}__`,\r\n            exportName: `__${entity.name}__`,\r\n            pointName: entity.name,\r\n            exportIsClass: true\r\n          })\r\n          const source = `\r\n            self.CHEAP_DISABLE_THREAD = ${(SELF as any).CHEAP_DISABLE_THREAD}\r\n            self.CHEAP_HEAP_INITIAL = ${(SELF as any).CHEAP_HEAP_INITIAL}\r\n            self.CHEAP_HEAP_MAXIMUM = ${(SELF as any).CHEAP_HEAP_MAXIMUM}\r\n            ${module}\r\n            function run(params) {\r\n              params.unshift(null)\r\n              return new (Function.prototype.bind.apply(__module_${entity.name}__.__${entity.name}__, params))()\r\n            }\r\n            ${initClass}\r\n            init.default(run);\r\n          `\r\n          if (defined(ENV_NODE)) {\r\n            workerUrl = `./cheap_${generateUUID()}.js`\r\n            const fs = require('fs')\r\n            fs.writeFileSync(workerUrl, source)\r\n          }\r\n          else {\r\n            const blob = new Blob([source], { type: 'text/javascript' })\r\n            workerUrl = URL.createObjectURL(blob)\r\n          }\r\n\r\n          caches.set(cacheKey, {\r\n            url: workerUrl,\r\n            refCount: 1\r\n          })\r\n        }\r\n        worker = new Worker(workerUrl)\r\n      }\r\n\r\n      const channel = new MessageChannel()\r\n      return new Promise<Thread<T>>((resolve, reject) => {\r\n\r\n        const stackPointer = config.USE_THREADS ? aligned_alloc(\r\n          config.STACK_ALIGNMENT,\r\n          options.stackSize\r\n            ? ((options.stackSize + config.STACK_ALIGNMENT) & ~config.STACK_ALIGNMENT)\r\n            : config.STACK_SIZE\r\n        ) : nullptr\r\n\r\n        function running() {\r\n          const ipc = defined(ENV_NODE) ? new NodeIPCPort(channel.port1) : new IPCPort(channel.port1)\r\n\r\n          const obj: Thread<T> = {\r\n            $worker: worker,\r\n            $ipc: ipc,\r\n            $channel: channel,\r\n            $moduleId: toString(moduleId),\r\n            $stackPointer: stackPointer,\r\n            $type: 'class'\r\n          } as Thread<T>\r\n\r\n          const { proxy, revoke } = Proxy.revocable(obj, {\r\n            get(target, propertyKey, receiver) {\r\n              if (target[propertyKey]) {\r\n                return obj[propertyKey]\r\n              }\r\n              if (propertyKey in entity.prototype && typeof entity.prototype[propertyKey] === 'function') {\r\n                const call = async function (...args: any[]) {\r\n                  return ipc.request(propertyKey as string, {\r\n                    params: args\r\n                  })\r\n                }\r\n                call.transfer = function (...transfer: Transferable[]) {\r\n                  return {\r\n                    invoke: async function (...args: any[]) {\r\n                      return ipc.request(propertyKey as string, {\r\n                        params: args\r\n                      }, transfer)\r\n                    }\r\n                  }\r\n                }\r\n                target[propertyKey] = call\r\n              }\r\n              return target[propertyKey]\r\n            }\r\n          })\r\n\r\n          obj[symbolRevoke] = revoke\r\n\r\n          resolve(proxy as Thread<T>)\r\n        }\r\n\r\n        const handler = (message: MessageEvent<any>) => {\r\n          const origin = defined(ENV_NODE) ? message : message.data\r\n          const type = origin.type\r\n          const data = origin.data\r\n\r\n          switch (type) {\r\n            case 'ready':\r\n              worker.postMessage({\r\n                type: 'run',\r\n                data: {\r\n                  port: channel.port2,\r\n                  params: args\r\n                }\r\n              }, [channel.port2, ...transferData])\r\n              break\r\n            case 'running':\r\n              running()\r\n              break\r\n            default:\r\n              break\r\n          }\r\n        }\r\n\r\n        if (defined(ENV_NODE)) {\r\n          // @ts-ignore\r\n          worker.on('message', handler)\r\n        }\r\n        else {\r\n          worker.onmessage = handler\r\n        }\r\n\r\n        worker.onmessage = handler\r\n\r\n        worker.postMessage({\r\n          type: 'init',\r\n          data: {\r\n            memory: config.USE_THREADS ? Memory : null,\r\n            name: options.name || entity.name,\r\n            stackPointer,\r\n            stackSize: options.stackSize ?? config.STACK_SIZE\r\n          }\r\n        })\r\n      })\r\n    }\r\n  }\r\n\r\n  function runInMain(...args: U) {\r\n    const worker = new entity(...args)\r\n    return new Promise<Thread<T>>((resolve) => {\r\n      const obj: Thread<T> = {\r\n        $worker: null,\r\n        $ipc: null,\r\n        $channel: null,\r\n        $moduleId: toString(moduleId),\r\n        $stackPointer: nullptr,\r\n        $instance: worker,\r\n        $type: 'class'\r\n      } as Thread<T>\r\n\r\n      const { proxy, revoke } = Proxy.revocable(obj, {\r\n        get(target, propertyKey, receiver) {\r\n          if (target[propertyKey]) {\r\n            return obj[propertyKey]\r\n          }\r\n          if (propertyKey in entity.prototype && typeof entity.prototype[propertyKey] === 'function') {\r\n            const call = function (...args: any[]) {\r\n              return worker[propertyKey](...args)\r\n            }\r\n            call.transfer = function (...transfer: Transferable[]) {\r\n              return {\r\n                invoke: function (...args: any[]) {\r\n                  return worker[propertyKey](...args)\r\n                }\r\n              }\r\n            }\r\n            target[propertyKey] = call\r\n          }\r\n          return target[propertyKey]\r\n        }\r\n      })\r\n\r\n      obj[symbolRevoke] = revoke\r\n\r\n      resolve(proxy as Thread<T>)\r\n    })\r\n  }\r\n\r\n  function transfer(...transfer: Transferable[]) {\r\n    transferData = transfer\r\n    return {\r\n      run: defined(ENABLE_THREADS) && ((config.USE_THREADS || options.dispatchToWorker) && !options.disableWorker) ? runInWorker : runInMain\r\n    }\r\n  }\r\n\r\n  return {\r\n    run: defined(ENABLE_THREADS) && ((config.USE_THREADS || options.dispatchToWorker) && !options.disableWorker) ? runInWorker : runInMain,\r\n    transfer\r\n  }\r\n}\r\n\r\nexport function createThreadFromFunction<T extends any[], U extends any, args=[moduleId<'0'>]>(entity: (...args: T) => U, options?: ThreadOptions): {\r\n  run: (...args: T) => Promise<Thread<{}, U>>\r\n  transfer: (...transfer: Transferable[]) => {\r\n    run: (...args: T) => Promise<Thread<{}, U>>\r\n  }\r\n}\r\nexport function createThreadFromFunction<T extends any[], U extends any>(\r\n  entity: (...args: T) => U,\r\n  options: ThreadOptions,\r\n  moduleId: string\r\n): {\r\n  run: (...args: T) => Promise<Thread<{}, U>>\r\n  transfer: (...transfer: Transferable[]) => {\r\n    run: (...args: T) => Promise<Thread<{}, U>>\r\n  }\r\n}\r\nexport function createThreadFromFunction<T extends any[], U extends any>(\r\n  entity: (...args: T) => U,\r\n  options: ThreadOptions = {},\r\n  moduleId?: string | Worker\r\n): {\r\n    run: (...args: T) => Promise<Thread<{}, U>>\r\n    transfer: (...transfer: Transferable[]) => {\r\n      run: (...args: T) => Promise<Thread<{}, U>>\r\n    }\r\n  } {\r\n\r\n  let transferData: Transferable[] = []\r\n\r\n  let runInWorker: (...args: T) => Promise<Thread<{}, U>>\r\n\r\n  if (defined(ENABLE_THREADS)) {\r\n    runInWorker = (...args: T) => {\r\n\r\n      let worker: Worker\r\n\r\n      if (moduleId instanceof Worker) {\r\n        worker = moduleId\r\n      }\r\n      else {\r\n        let workerUrl: string\r\n        const cacheKey = getCacheKey(moduleId, 'function')\r\n        if (caches.has(cacheKey)) {\r\n          workerUrl = caches.get(cacheKey).url\r\n          caches.get(cacheKey).refCount++\r\n        }\r\n        else {\r\n          const module = sourceLoad(moduleId, {\r\n            varName: `__module_${entity.name}__`,\r\n            exportName: `__${entity.name}__`,\r\n            pointName: entity.name\r\n          })\r\n\r\n          const source = `\r\n            self.CHEAP_DISABLE_THREAD = ${(SELF as any).CHEAP_DISABLE_THREAD}\r\n            self.CHEAP_HEAP_INITIAL = ${(SELF as any).CHEAP_HEAP_INITIAL}\r\n            self.CHEAP_HEAP_MAXIMUM = ${(SELF as any).CHEAP_HEAP_MAXIMUM}\r\n            ${module}\r\n            function run(params) {\r\n              return __module_${entity.name}__.__${entity.name}__.apply(${defined(ENV_NODE) ? 'global' : 'self'}, params)\r\n            }\r\n            ${initFunction}\r\n            init.default(run);\r\n          `\r\n          if (defined(ENV_NODE)) {\r\n            workerUrl = `./cheap_${generateUUID()}.js`\r\n            const fs = require('fs')\r\n            fs.writeFileSync(workerUrl, source)\r\n          }\r\n          else {\r\n            const blob = new Blob([source], { type: 'text/javascript' })\r\n            workerUrl = URL.createObjectURL(blob)\r\n          }\r\n\r\n          caches.set(cacheKey, {\r\n            url: workerUrl,\r\n            refCount: 1\r\n          })\r\n        }\r\n        worker = new Worker(workerUrl)\r\n      }\r\n\r\n      return new Promise<Thread<{}, U>>((resolve, reject) => {\r\n\r\n        const stackPointer = config.USE_THREADS ? aligned_alloc(\r\n          config.STACK_ALIGNMENT,\r\n          options.stackSize\r\n            ? ((options.stackSize + config.STACK_ALIGNMENT) & ~config.STACK_ALIGNMENT)\r\n            : config.STACK_SIZE\r\n        ) : nullptr\r\n\r\n        function running() {\r\n          const obj: Thread<{}> = {\r\n            $worker: worker,\r\n            $moduleId: toString(moduleId),\r\n            $stackPointer: stackPointer,\r\n            $type: 'function'\r\n          }\r\n          resolve(obj)\r\n        }\r\n\r\n        const handler = (message: MessageEvent<any>) => {\r\n          const origin = defined(ENV_NODE) ? message : message.data\r\n          const type = origin.type\r\n          const data = origin.data\r\n\r\n          switch (type) {\r\n            case 'ready':\r\n              worker.postMessage({\r\n                type: 'run',\r\n                data: {\r\n                  params: args\r\n                }\r\n              }, transferData)\r\n              running()\r\n              break\r\n            default:\r\n              break\r\n          }\r\n        }\r\n\r\n        if (defined(ENV_NODE)) {\r\n          // @ts-ignore\r\n          worker.on('message', handler)\r\n        }\r\n        else {\r\n          worker.onmessage = handler\r\n        }\r\n\r\n        worker.onmessage = handler\r\n\r\n        worker.postMessage({\r\n          type: 'init',\r\n          data: {\r\n            memory: config.USE_THREADS ? Memory : null,\r\n            name: options.name || entity.name,\r\n            stackPointer,\r\n            stackSize: options.stackSize ?? config.STACK_SIZE\r\n          }\r\n        })\r\n      })\r\n    }\r\n  }\r\n\r\n  function runInMain(...args: T) {\r\n    return new Promise<Thread<{}, U>>((resolve, reject) => {\r\n      const obj: Thread<{}, U> = {\r\n        $worker: null,\r\n        $moduleId: toString(moduleId),\r\n        $stackPointer: null,\r\n        $type: 'function'\r\n      }\r\n      resolve(obj)\r\n      obj.$retval = new Promise<U>((resolve) => {\r\n        resolve(entity(...args))\r\n      })\r\n    })\r\n  }\r\n\r\n  function transfer(...transfer: Transferable[]) {\r\n    transferData = transfer\r\n    return {\r\n      run: defined(ENABLE_THREADS) && ((config.USE_THREADS || options.dispatchToWorker) && !options.disableWorker) ? runInWorker : runInMain\r\n    }\r\n  }\r\n\r\n  return {\r\n    run: defined(ENABLE_THREADS) && ((config.USE_THREADS || options.dispatchToWorker) && !options.disableWorker) ? runInWorker : runInMain,\r\n    transfer\r\n  }\r\n}\r\n\r\nexport function createThreadFromModule<T extends Object, args=[moduleId<'0'>]>(entity: T, options?: ThreadOptions): {\r\n  run: () => Promise<Thread<T>>\r\n}\r\nexport function createThreadFromModule<T extends Object>(\r\n  entity: T,\r\n  options: ThreadOptions,\r\n  moduleId: string\r\n): {\r\n  run: () => Promise<Thread<T>>\r\n}\r\n\r\nexport function createThreadFromModule<T extends Object>(\r\n  entity: T,\r\n  options: ThreadOptions = {},\r\n  moduleId?: string | Worker\r\n): {\r\n    run: () => Promise<Thread<T>>\r\n  } {\r\n  let runInWorker: () => Promise<Thread<T>>\r\n  if (defined(ENABLE_THREADS)) {\r\n    runInWorker = () => {\r\n      let worker: Worker\r\n      let moduleName = `__module_${moduleId}__`.replace(/\\.|\\//g, '_')\r\n\r\n      if (moduleId instanceof Worker) {\r\n        worker = moduleId\r\n      }\r\n      else {\r\n        let workerUrl: string\r\n        const cacheKey = getCacheKey(moduleId, 'module')\r\n        if (caches.has(cacheKey)) {\r\n          workerUrl = caches.get(cacheKey).url\r\n          caches.get(cacheKey).refCount++\r\n        }\r\n        else {\r\n          const module = sourceLoad(moduleId, {\r\n            varName: moduleName\r\n          })\r\n\r\n          const source = `\r\n            self.CHEAP_DISABLE_THREAD = ${(SELF as any).CHEAP_DISABLE_THREAD}\r\n            self.CHEAP_HEAP_INITIAL = ${(SELF as any).CHEAP_HEAP_INITIAL}\r\n            self.CHEAP_HEAP_MAXIMUM = ${(SELF as any).CHEAP_HEAP_MAXIMUM}\r\n            ${module}\r\n            ${initModule}\r\n            init.default(${moduleName});\r\n          `\r\n\r\n          if (defined(ENV_NODE)) {\r\n            workerUrl = `./cheap_${generateUUID()}.js`\r\n            const fs = require('fs')\r\n            fs.writeFileSync(workerUrl, source)\r\n          }\r\n          else {\r\n            const blob = new Blob([source], { type: 'text/javascript' })\r\n            workerUrl = URL.createObjectURL(blob)\r\n          }\r\n          caches.set(cacheKey, {\r\n            url: workerUrl,\r\n            refCount: 1\r\n          })\r\n        }\r\n        worker = new Worker(workerUrl)\r\n      }\r\n      const channel = new MessageChannel()\r\n      return new Promise<Thread<T>>((resolve, reject) => {\r\n\r\n        const stackPointer = config.USE_THREADS ? aligned_alloc(\r\n          config.STACK_ALIGNMENT,\r\n          options.stackSize\r\n            ? ((options.stackSize + config.STACK_ALIGNMENT) & ~config.STACK_ALIGNMENT)\r\n            : config.STACK_SIZE\r\n        ) : nullptr\r\n\r\n        function running() {\r\n          const ipc = defined(ENV_NODE) ? new NodeIPCPort(channel.port1) : new IPCPort(channel.port1)\r\n\r\n          const obj: Thread<T> = {\r\n            $worker: worker,\r\n            $ipc: ipc,\r\n            $channel: channel,\r\n            $moduleId: toString(moduleId),\r\n            $stackPointer: stackPointer,\r\n            $type: 'module'\r\n          } as Thread<T>\r\n\r\n          const { proxy, revoke } = Proxy.revocable(obj, {\r\n            get(target, propertyKey, receiver) {\r\n              if (target[propertyKey]) {\r\n                return obj[propertyKey]\r\n              }\r\n              if (propertyKey in entity && typeof entity[propertyKey] === 'function') {\r\n                const call = async function (...args: any[]) {\r\n                  return ipc.request(propertyKey as string, {\r\n                    params: args\r\n                  })\r\n                }\r\n                call.transfer = function (...transfer: Transferable[]) {\r\n                  return {\r\n                    invoke: async function (...args: any[]) {\r\n                      return ipc.request(propertyKey as string, {\r\n                        params: args\r\n                      }, transfer)\r\n                    }\r\n                  }\r\n                }\r\n                target[propertyKey] = call\r\n              }\r\n              return target[propertyKey]\r\n            }\r\n          })\r\n\r\n          obj[symbolRevoke] = revoke\r\n\r\n          resolve(proxy as Thread<T>)\r\n        }\r\n\r\n        const handler = (message: MessageEvent<any>) => {\r\n          const origin = defined(ENV_NODE) ? message : message.data\r\n          const type = origin.type\r\n          const data = origin.data\r\n\r\n          switch (type) {\r\n            case 'ready':\r\n              worker.postMessage({\r\n                type: 'run',\r\n                data: {\r\n                  port: channel.port2\r\n                }\r\n              }, [channel.port2])\r\n              break\r\n            case 'running':\r\n              running()\r\n              break\r\n            default:\r\n              break\r\n          }\r\n        }\r\n\r\n        if (defined(ENV_NODE)) {\r\n          // @ts-ignore\r\n          worker.on('message', handler)\r\n        }\r\n        else {\r\n          worker.onmessage = handler\r\n        }\r\n\r\n        worker.onmessage = handler\r\n\r\n        worker.postMessage({\r\n          type: 'init',\r\n          data: {\r\n            memory: config.USE_THREADS ? Memory : null,\r\n            name: options.name || moduleName,\r\n            stackPointer,\r\n            stackSize: options.stackSize ?? config.STACK_SIZE\r\n          }\r\n        })\r\n      })\r\n    }\r\n  }\r\n  function runInMain() {\r\n    return new Promise<Thread<T>>((resolve, reject) => {\r\n      const obj: Thread<T> = {\r\n        $worker: null,\r\n        $ipc: null,\r\n        $channel: null,\r\n        $moduleId: toString(moduleId),\r\n        $stackPointer: nullptr,\r\n        $instance: entity,\r\n        $type: 'module'\r\n      } as Thread<T>\r\n\r\n      const { proxy, revoke } = Proxy.revocable(obj, {\r\n        get(target, propertyKey, receiver) {\r\n          if (target[propertyKey]) {\r\n            return obj[propertyKey]\r\n          }\r\n          if (propertyKey in entity && typeof entity[propertyKey] === 'function') {\r\n            const call = function (...args: any[]) {\r\n              return entity[propertyKey](...args)\r\n            }\r\n            call.transfer = function (...transfer: Transferable[]) {\r\n              return {\r\n                invoke: function (...args: any[]) {\r\n                  return entity[propertyKey](...args)\r\n                }\r\n              }\r\n            }\r\n            target[propertyKey] = call\r\n          }\r\n          return target[propertyKey]\r\n        }\r\n      })\r\n\r\n      obj[symbolRevoke] = revoke\r\n\r\n      resolve(proxy as Thread<T>)\r\n    })\r\n  }\r\n  return {\r\n    run: defined(ENABLE_THREADS) && ((config.USE_THREADS || options.dispatchToWorker) && !options.disableWorker) ? runInWorker : runInMain,\r\n  }\r\n}\r\n\r\nexport function closeThread<T, U>(thread: Thread<T, U>) {\r\n  if (thread.$worker) {\r\n    thread.$worker.terminate()\r\n    thread.$worker = null\r\n  }\r\n  if (thread.$moduleId) {\r\n    if (is.string(thread.$moduleId)) {\r\n      const cacheKey = getCacheKey(thread.$moduleId, thread.$type)\r\n      if (caches.has(cacheKey)) {\r\n        caches.get(cacheKey).refCount--\r\n        if (caches.get(cacheKey).refCount === 0) {\r\n          if (defined(ENV_NODE)) {\r\n            const fs = require('fs')\r\n            fs.unlinkSync(caches.get(cacheKey).url)\r\n          }\r\n          else {\r\n            URL.revokeObjectURL(caches.get(cacheKey).url)\r\n          }\r\n          caches.delete(cacheKey)\r\n        }\r\n      }\r\n    }\r\n    thread.$moduleId = null\r\n  }\r\n\r\n  if (thread.$ipc) {\r\n    thread.$ipc.destroy()\r\n    thread.$ipc = null\r\n  }\r\n\r\n  if (thread.$stackPointer) {\r\n    free(thread.$stackPointer)\r\n    thread.$stackPointer = nullptr\r\n  }\r\n\r\n  thread.$channel = null\r\n  thread.$instance = null\r\n\r\n  if (thread[symbolRevoke]) {\r\n    const revoke = thread[symbolRevoke]\r\n    thread[symbolRevoke] = null\r\n    revoke()\r\n  }\r\n}\r\n\r\nexport async function joinThread<T, U>(thread: Thread<{}, U>) {\r\n  if (thread.$worker) {\r\n    return new Promise<PromiseType<U>>((resolve) => {\r\n\r\n      function handler(message: MessageEvent<any>) {\r\n        const origin = defined(ENV_NODE) ? message : message.data\r\n        const type = origin.type\r\n        const data = origin.data\r\n\r\n        switch (type) {\r\n          case 'stopped':\r\n            closeThread(thread)\r\n            resolve(data)\r\n            break\r\n          default:\r\n            break\r\n        }\r\n      }\r\n\r\n      if (defined(ENV_NODE)) {\r\n        // @ts-ignore\r\n        thread.$worker.removeAllListeners('message')\r\n        // @ts-ignore\r\n        thread.$worker.on('message', handler)\r\n      }\r\n      else {\r\n        thread.$worker.onmessage = handler\r\n      }\r\n      thread.$worker.postMessage({\r\n        type: 'stop'\r\n      })\r\n    })\r\n  }\r\n  else if (thread.$retval) {\r\n    return thread.$retval as PromiseType<U>\r\n  }\r\n}\r\n","import { Data, TypeArray } from 'common/types/type'\r\n\r\nexport const enum CTypeEnum {\r\n  null = 0,\r\n\r\n  void,\r\n\r\n  uint8,\r\n  atomic_uint8,\r\n  char,\r\n  atomic_char,\r\n  uint16,\r\n  atomic_uint16,\r\n  uint32,\r\n  atomic_uint32,\r\n  uint64,\r\n\r\n  int8,\r\n  atomic_int8,\r\n  int16,\r\n  atomic_int16,\r\n  int32,\r\n  atomic_int32,\r\n  int64,\r\n\r\n  float,\r\n  double,\r\n  pointer,\r\n\r\n  atomic_int64,\r\n  atomic_uint64,\r\n\r\n  bool,\r\n  atomic_bool\r\n}\r\n\r\nexport const CTypeEnum2Bytes: Record<CTypeEnum, number> = {\r\n  [CTypeEnum.uint8]: 1,\r\n  [CTypeEnum.atomic_uint8]: 1,\r\n  [CTypeEnum.char]: 1,\r\n  [CTypeEnum.atomic_char]: 1,\r\n  [CTypeEnum.uint16]: 2,\r\n  [CTypeEnum.atomic_uint16]: 2,\r\n  [CTypeEnum.uint32]: 4,\r\n  [CTypeEnum.atomic_uint32]: 4,\r\n  [CTypeEnum.uint64]: 8,\r\n  [CTypeEnum.int8]: 1,\r\n  [CTypeEnum.atomic_int8]: 1,\r\n  [CTypeEnum.int16]: 2,\r\n  [CTypeEnum.atomic_int16]: 2,\r\n  [CTypeEnum.int32]: 4,\r\n  [CTypeEnum.atomic_int32]: 4,\r\n  [CTypeEnum.int64]: 8,\r\n  [CTypeEnum.float]: 4,\r\n  [CTypeEnum.double]: 8,\r\n  [CTypeEnum.pointer]: 4,\r\n  [CTypeEnum.null]: 4,\r\n  [CTypeEnum.void]: 4,\r\n\r\n  [CTypeEnum.atomic_uint64]: 8,\r\n  [CTypeEnum.atomic_int64]: 8,\r\n\r\n  [CTypeEnum.bool]: 1,\r\n  [CTypeEnum.atomic_bool]: 1\r\n}\r\n\r\nexport const CTypeEnumPointerShiftMap: Record<CTypeEnum, number> = {\r\n  [CTypeEnum.uint8]: 0,\r\n  [CTypeEnum.atomic_uint8]: 0,\r\n  [CTypeEnum.char]: 0,\r\n  [CTypeEnum.atomic_char]: 0,\r\n  [CTypeEnum.uint16]: 1,\r\n  [CTypeEnum.atomic_uint16]: 1,\r\n  [CTypeEnum.uint32]: 2,\r\n  [CTypeEnum.atomic_uint32]: 2,\r\n  [CTypeEnum.uint64]: 4,\r\n  [CTypeEnum.int8]: 0,\r\n  [CTypeEnum.atomic_int8]: 0,\r\n  [CTypeEnum.int16]: 1,\r\n  [CTypeEnum.atomic_int16]: 1,\r\n  [CTypeEnum.int32]: 2,\r\n  [CTypeEnum.atomic_int32]: 2,\r\n  [CTypeEnum.int64]: 4,\r\n  [CTypeEnum.float]: 2,\r\n  [CTypeEnum.double]: 4,\r\n  [CTypeEnum.pointer]: 2,\r\n  [CTypeEnum.void]: 2,\r\n  [CTypeEnum.null]: 2,\r\n  [CTypeEnum.atomic_uint64]: 4,\r\n  [CTypeEnum.atomic_int64]: 4,\r\n\r\n  [CTypeEnum.bool]: 0,\r\n  [CTypeEnum.atomic_bool]: 0\r\n}\r\n\r\nexport const enum KeyMetaKey {\r\n  Type,\r\n  Pointer,\r\n  PointerLevel,\r\n  Array,\r\n  ArrayLength,\r\n  BitField,\r\n  BitFieldLength,\r\n  BaseAddressOffset,\r\n  BaseBitOffset,\r\n  InlineStruct\r\n}\r\n\r\nexport type KeyMeta = {\r\n  [KeyMetaKey.Type]: CTypeEnum | Struct\r\n  [KeyMetaKey.Pointer]: 0 | 1\r\n  [KeyMetaKey.PointerLevel]: number\r\n  [KeyMetaKey.Array]: 0 | 1\r\n  [KeyMetaKey.ArrayLength]: number\r\n  [KeyMetaKey.BitField]: 0 | 1\r\n  [KeyMetaKey.BitFieldLength]: number\r\n  [KeyMetaKey.BaseAddressOffset]: uint32\r\n  [KeyMetaKey.BaseBitOffset]: uint32\r\n  getTypeMeta?: () => { length: number, maxBaseTypeByteLength: number }\r\n}\r\n\r\nexport type Struct = new (init?: Data) => any\r\nexport type Union = new (init?: Data) => any\r\n\r\n/* eslint-disable */\r\nexport type CTypeEnum2Type<T> =\r\n  T extends CTypeEnum.null\r\n  ? void\r\n  : T extends CTypeEnum.void\r\n  ? void\r\n  : T extends CTypeEnum.uint8\r\n  ? uint8\r\n  : T extends CTypeEnum.atomic_int8\r\n  ? atomic_uint8\r\n  : T extends CTypeEnum.char\r\n  ? char\r\n  : T extends CTypeEnum.uint16\r\n  ? uint16\r\n  : T extends CTypeEnum.atomic_uint16\r\n  ? atomic_uint16\r\n  : T extends CTypeEnum.uint32\r\n  ? uint32\r\n  : T extends CTypeEnum.atomic_uint32\r\n  ? atomic_uint32\r\n  : T extends CTypeEnum.uint64\r\n  ? uint64\r\n  : T extends CTypeEnum.int8\r\n  ? int8\r\n  : T extends CTypeEnum.atomic_int8\r\n  ? atomic_int8\r\n  : T extends CTypeEnum.int16\r\n  ? int16\r\n  : T extends CTypeEnum.atomic_int16\r\n  ? atomic_int16\r\n  : T extends CTypeEnum.int32\r\n  ? int32\r\n  : T extends CTypeEnum.atomic_int32\r\n  ? atomic_int32\r\n  : T extends CTypeEnum.int64\r\n  ? int64\r\n  : T extends CTypeEnum.float\r\n  ? float\r\n  : T extends CTypeEnum.double\r\n  ? double\r\n  : T extends CTypeEnum.pointer\r\n  ? pointer<void>\r\n  : T extends CTypeEnum.atomic_int64\r\n  ? atomic_int64\r\n  : T extends CTypeEnum.atomic_uint64\r\n  ? atomic_uint64\r\n  : T extends CTypeEnum.bool\r\n  ? bool\r\n  : T extends CTypeEnum.atomic_bool\r\n  ? atomic_bool\r\n  : never\r\n/* eslint-enable */\r\n\r\nexport type AtomicsBuffer = Exclude<TypeArray, Float32Array | Float64Array> | BigInt64Array | BigUint64Array\r\n","import { ChildThread, Pthread, PthreadFlags, PthreadStatus, ThreadDescriptor, ThreadWait } from './thread'\r\nimport * as config from '../config'\r\nimport { memset } from '../std/memory'\r\nimport { Memory, allocThreadId } from '../heap'\r\nimport * as cond from '../thread/cond'\r\nimport * as mutex from '../thread/mutex'\r\nimport * as atomicsUtils from '../thread/atomics'\r\n\r\ninterface TheadPoolEntry {\r\n  id: uint32\r\n  thread: ChildThread\r\n  threadWait: pointer<ThreadWait>\r\n}\r\n\r\ninterface TheadPoolEntryOptions {\r\n  tableSize: number\r\n  module: WebAssembly.Module\r\n  initFuncs: string[]\r\n\r\n  memoryBase: number\r\n  tableBase: number\r\n  childImports: string\r\n}\r\n\r\nexport default class ThreadPool {\r\n\r\n  private count: number\r\n\r\n  private url: string\r\n\r\n  private childThreads: TheadPoolEntry[]\r\n\r\n  constructor(count: number, url: string) {\r\n    this.count = count\r\n    this.url = url\r\n    this.childThreads = []\r\n  }\r\n\r\n  private async createTheadPoolEntry(options: TheadPoolEntryOptions) {\r\n    return new Promise<TheadPoolEntry>((resolve, reject) => {\r\n      const worker = new Worker(this.url)\r\n      const stackPointer = aligned_alloc(config.STACK_ALIGNMENT, config.STACK_SIZE)\r\n      const threadDescriptor: pointer<ThreadDescriptor> = malloc(sizeof(ThreadDescriptor))\r\n      memset(threadDescriptor, 0, sizeof(ThreadDescriptor))\r\n\r\n      threadDescriptor.status = PthreadStatus.STOP\r\n      threadDescriptor.flags |= PthreadFlags.POOL\r\n\r\n      const id = allocThreadId()\r\n\r\n      worker.onmessage = (message) => {\r\n        const origin = message.data\r\n        const type = origin.type\r\n        switch (type) {\r\n          case 'ready':\r\n            const wait: pointer<ThreadWait> = stackPointer\r\n            memset(wait, 0, sizeof(ThreadWait))\r\n            mutex.init(addressof(wait.mutex))\r\n            cond.init(addressof(wait.cond))\r\n            worker.postMessage({\r\n              type: 'wait'\r\n            })\r\n            resolve({\r\n              id,\r\n              thread: {\r\n                thread: nullptr,\r\n                worker,\r\n                stackPointer,\r\n                threadDescriptor\r\n              },\r\n              threadWait: wait\r\n            })\r\n            break\r\n        }\r\n      }\r\n\r\n      worker.postMessage({\r\n        type: 'ready',\r\n        data: {\r\n          cheap: {\r\n            memory: Memory,\r\n            stackPointer,\r\n            stackSize: config.STACK_SIZE,\r\n            id\r\n          },\r\n          runner: {\r\n            resource: {\r\n              tableSize: options.tableSize,\r\n              module: options.module,\r\n              initFuncs: options.initFuncs\r\n            },\r\n            options: {\r\n              memoryBase: options.memoryBase,\r\n              tableBase: options.tableBase,\r\n              threadDescriptor,\r\n              childImports: options.childImports\r\n            },\r\n            imports: options.childImports\r\n          }\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  public async ready(options: TheadPoolEntryOptions) {\r\n    this.childThreads = await Promise.all(new Array(this.count).fill(0).map(() => {\r\n      return this.createTheadPoolEntry(options)\r\n    }))\r\n  }\r\n\r\n  public hasFree() {\r\n    for (let i = 0; i < this.childThreads.length; i++) {\r\n      if (this.childThreads[i].thread.threadDescriptor.status === PthreadStatus.STOP) {\r\n        return true\r\n      }\r\n    }\r\n    return false\r\n  }\r\n\r\n  public isPoolThread(thread: pointer<Pthread>) {\r\n    for (let i = 0; i < this.childThreads.length; i++) {\r\n      if (this.childThreads[i].thread.thread === thread) {\r\n        return true\r\n      }\r\n    }\r\n    return false\r\n  }\r\n\r\n  public createThread(thread: pointer<Pthread>, attr: pointer<void>, func: pointer<((args: pointer<void>) => void)>, args: pointer<void>) {\r\n    for (let i = 0; i < this.childThreads.length; i++) {\r\n      if (this.childThreads[i].thread.threadDescriptor.status === PthreadStatus.STOP) {\r\n        this.childThreads[i].thread.threadDescriptor.status = PthreadStatus.RUN\r\n        this.childThreads[i].thread.thread = thread\r\n\r\n        thread.flags |= PthreadFlags.POOL\r\n\r\n        mutex.lock(addressof(this.childThreads[i].threadWait.mutex))\r\n        this.childThreads[i].threadWait.thread = thread\r\n        this.childThreads[i].threadWait.func = func\r\n        this.childThreads[i].threadWait.args = args\r\n        mutex.unlock(addressof(this.childThreads[i].threadWait.mutex))\r\n        cond.signal(addressof(this.childThreads[i].threadWait.cond))\r\n        return\r\n      }\r\n    }\r\n  }\r\n\r\n  public joinThread(thread: pointer<Pthread>, retval: pointer<pointer<void>>) {\r\n\r\n    let entry: TheadPoolEntry\r\n\r\n    for (let i = 0; i < this.childThreads.length; i++) {\r\n      if (this.childThreads[i].thread.thread === thread) {\r\n        entry = this.childThreads[i]\r\n        break\r\n      }\r\n    }\r\n\r\n    if (!entry) {\r\n      return -1\r\n    }\r\n\r\n    if (thread.flags & PthreadFlags.DETACH) {\r\n      return 0\r\n    }\r\n    // 等待子线程退出\r\n    atomicsUtils.wait(addressof(thread.status), PthreadStatus.RUN)\r\n\r\n    if (retval !== nullptr) {\r\n      accessof(retval) <- thread.retval\r\n    }\r\n\r\n    entry.thread.threadDescriptor.status = PthreadStatus.STOP\r\n\r\n    return 0\r\n  }\r\n\r\n  public detachThread(thread: pointer<Pthread>) {\r\n    let entry: TheadPoolEntry\r\n\r\n    for (let i = 0; i < this.childThreads.length; i++) {\r\n      if (this.childThreads[i].thread.thread === thread) {\r\n        entry = this.childThreads[i]\r\n        break\r\n      }\r\n    }\r\n\r\n    if (!entry) {\r\n      return -1\r\n    }\r\n\r\n    entry.thread.threadDescriptor.flags |= PthreadFlags.DETACH\r\n    thread.flags |= PthreadFlags.DETACH\r\n\r\n    return 0\r\n  }\r\n\r\n  public destroy() {\r\n    for (let i = 0; i < this.childThreads.length; i++) {\r\n      // 回收栈\r\n      free(this.childThreads[i].thread.stackPointer)\r\n      free(this.childThreads[i].thread.threadDescriptor)\r\n      this.childThreads[i].thread.worker.terminate()\r\n    }\r\n    this.childThreads = []\r\n  }\r\n}\r\n","/* eslint-disable camelcase */\r\n\r\nimport * as object from 'common/util/object'\r\nimport * as array from 'common/util/array'\r\nimport * as logger from 'common/util/logger'\r\nimport * as is from 'common/util/is'\r\nimport { Memory, StackPointer, Table, allocThreadId, StackTop } from '../heap'\r\nimport { memcpy, memset } from '../std/memory'\r\nimport { fd_fdstat_get, fd_write, abort, random_get, clock_time_get, clock_res_get, environ_get, environ_sizes_get } from './runtime/clib'\r\nimport { WebAssemblyResource } from './compiler'\r\nimport * as atomics from './runtime/atomic'\r\nimport * as pthread from './runtime/pthread'\r\nimport * as semaphore from './runtime/semaphore'\r\nimport sourceLoad from 'common/function/sourceLoad'\r\nimport * as config from '../config'\r\nimport * as atomicsUtils from '../thread/atomics'\r\nimport * as atomicAsm from '../thread/asm/atomics'\r\nimport * as libcAsm from './runtime/asm/libc'\r\nimport { BuiltinTableSlot } from '../allocator/Table'\r\n\r\nimport * as threadAsm from './runtime/asm/thread'\r\nimport isWorker from 'common/function/isWorker'\r\nimport { ChildThread, Pthread, PthreadFlags, PthreadStatus } from './thread'\r\nimport { ThreadDescriptor } from './thread'\r\nimport ThreadPool from './ThreadPool'\r\nimport * as cond from '../thread/cond'\r\nimport * as mutex from '../thread/mutex'\r\nimport support from 'common/util/support'\r\n\r\nexport type WebAssemblyRunnerOptions = {\r\n  imports?: Record<string, Record<string, WebAssembly.ImportValue>>,\r\n  exportMap?: Record<string, string>\r\n  importMap?: Record<string, string>\r\n  envKey?: string\r\n  childImports?: string | Blob\r\n  memoryBase?: number\r\n  tableBase?: number\r\n  thread?: pointer<Pthread>\r\n  threadDescriptor?: pointer<ThreadDescriptor>\r\n}\r\n\r\nif (defined(ENABLE_THREADS)) {\r\n  // 保证打包工具包含下面的模块代码\r\n  require('./runThread')\r\n}\r\n\r\nconst runThread = defined(ENABLE_THREADS) ? sourceLoad(require.resolve('./runThread'), {\r\n  varName: 'init'\r\n}) : null\r\n\r\nfunction emptyFunction() {}\r\n\r\nlet atomicAsmOverride = false\r\n\r\nexport default class WebAssemblyRunner {\r\n\r\n  static getTable() {\r\n    return Table\r\n  }\r\n\r\n  static mutexLock(mux: pointer<mutex.Mutex>) {\r\n    mutex.lock(mux)\r\n  }\r\n\r\n  static mutexUnlock(mux: pointer<mutex.Mutex>) {\r\n    mutex.unlock(mux)\r\n  }\r\n\r\n  static condWait(cnd: pointer<cond.Cond>, mux: pointer<mutex.Mutex>) {\r\n    cond.wait(cnd, mux)\r\n  }\r\n\r\n  static readPointer(p: pointer<pointer<void>>) {\r\n    return accessof(p)\r\n  }\r\n\r\n  static writePointer(p: pointer<pointer<void>>, v: pointer<void>) {\r\n    accessof(p) <- v\r\n  }\r\n\r\n  private resource: WebAssemblyResource\r\n\r\n  /**\r\n   * WebAssembly runtime 实例\r\n   */\r\n  private instance: WebAssembly.Instance\r\n\r\n  /**\r\n   * 配置项\r\n   */\r\n  protected options: WebAssemblyRunnerOptions\r\n\r\n  private builtinMalloc: pointer<void>[]\r\n\r\n  private memoryBase: number\r\n\r\n  private tableBase: number\r\n\r\n  private childImports: string\r\n  private childUrl: string\r\n  private childBlob: Blob\r\n\r\n  private childThreads: Map<int32, ChildThread>\r\n\r\n  private imports: Record<string, any>\r\n\r\n  private childReadyPromises: Promise<void>[]\r\n\r\n  private threadPool: ThreadPool\r\n\r\n  private initCalling: boolean\r\n\r\n  private promisingMap: Map<string, Function>\r\n\r\n  constructor(resource: WebAssemblyResource, options: WebAssemblyRunnerOptions = {}) {\r\n\r\n    this.resource = resource\r\n    this.builtinMalloc = []\r\n    this.initCalling = false\r\n\r\n    this.childThreads = new Map()\r\n    this.childReadyPromises = []\r\n    this.promisingMap = new Map()\r\n\r\n    if (is.string(options.childImports)) {\r\n      this.childImports =  options.childImports\r\n    }\r\n    else if (is.object(options.childImports) && options.childImports instanceof Blob) {\r\n      this.childImports = URL.createObjectURL(options.childImports)\r\n    }\r\n\r\n    this.memoryBase = resource.dataSize ? malloc(resource.dataSize) : 0\r\n\r\n    // 子线程的 tableBase 需要和父线程一致\r\n    if (options.thread && options.tableBase) {\r\n      if (Table.getPointer() !== options.tableBase) {\r\n        Table.alloc(options.tableBase - Table.getPointer())\r\n      }\r\n    }\r\n    this.tableBase = resource.tableSize ? Table.alloc(resource.tableSize) : 0\r\n\r\n    this.options = options\r\n\r\n    this.imports = {\r\n      env: {\r\n        memory: Memory,\r\n        __stack_pointer: StackPointer,\r\n        __indirect_function_table: Table.table,\r\n\r\n        clock_time_get: clock_time_get,\r\n        clock_res_get: clock_res_get,\r\n        random_get: random_get,\r\n\r\n        abort: abort,\r\n        proc_exit: function (exitCode: number) {\r\n          logger.error(`wasm module exit, code: ${exitCode}`)\r\n        },\r\n        __syscall_renameat: emptyFunction,\r\n        __syscall_unlinkat: emptyFunction,\r\n\r\n        environ_get: environ_get,\r\n        environ_sizes_get: environ_sizes_get,\r\n\r\n        fd_close: emptyFunction,\r\n        fd_fdstat_get: fd_fdstat_get,\r\n        fd_read: emptyFunction,\r\n        fd_seek: emptyFunction,\r\n        fd_write: fd_write,\r\n\r\n        emscripten_builtin_malloc: (size: size) => {\r\n          const p = malloc(size)\r\n          this.builtinMalloc.push(p)\r\n          return p\r\n        },\r\n\r\n        emscripten_builtin_free: (pointer: pointer<void>) => {\r\n          free(pointer)\r\n        },\r\n\r\n        emscripten_builtin_memalign: (memptr: pointer<pointer<void>>, alignment: size, size: size) => {\r\n          const address = aligned_alloc(alignment, size)\r\n          if (address !== nullptr) {\r\n            accessof(memptr) <- address\r\n            this.builtinMalloc.push(address)\r\n            return 0\r\n          }\r\n          return -1\r\n        },\r\n\r\n        emscripten_memcpy_big: function (dest: pointer<void>, src: pointer<void>, num: size) {\r\n          memcpy(dest, src, num)\r\n        },\r\n\r\n        __libc_malloc: function (size: size) {\r\n          return malloc(size)\r\n        },\r\n        __libc_free: (pointer: pointer<void>) => {\r\n          free(pointer)\r\n        },\r\n        malloc: (size: size) => {\r\n          if (this.initCalling === true) {\r\n            const p = malloc(size)\r\n            this.builtinMalloc.push(p)\r\n            return p\r\n          }\r\n          return malloc(size)\r\n        },\r\n        calloc: function (num: size, size: size) {\r\n          return calloc(num, size)\r\n        },\r\n        realloc: function (pointer: pointer<void>, size: size) {\r\n          return realloc(pointer, size)\r\n        },\r\n        aligned_alloc(alignment: size, size: size): pointer<void> {\r\n          return aligned_alloc(alignment, size)\r\n        },\r\n        free: function (pointer: pointer<void>) {\r\n          free(pointer)\r\n        },\r\n        posix_memalign: function (memptr: pointer<pointer<void>>, alignment: size, size: size) {\r\n          const address = aligned_alloc(alignment, size)\r\n          if (address !== nullptr) {\r\n            accessof(memptr) <- address\r\n            return 0\r\n          }\r\n          return -1\r\n        },\r\n        memalign: function (alignment: size, size: size) {\r\n          return aligned_alloc(alignment, size)\r\n        }\r\n      },\r\n      'GOT.func': {\r\n        malloc: new WebAssembly.Global({mutable: true, value: 'i32'}, BuiltinTableSlot.MALLOC),\r\n        calloc: new WebAssembly.Global({mutable: true, value: 'i32'}, BuiltinTableSlot.CALLOC),\r\n        realloc: new WebAssembly.Global({mutable: true, value: 'i32'}, BuiltinTableSlot.REALLOC),\r\n        aligned_alloc: new WebAssembly.Global({mutable: true, value: 'i32'}, BuiltinTableSlot.ALIGNED_ALLOC),\r\n        free: new WebAssembly.Global({mutable: true, value: 'i32'}, BuiltinTableSlot.FREE)\r\n      }\r\n    }\r\n\r\n    if (defined(ENABLE_THREADS)) {\r\n      const createPthread = (thread: pointer<Pthread>, attr: pointer<void>, func: pointer<((args: pointer<void>) => void)>, args: pointer<void>) => {\r\n        if (this.threadPool && this.threadPool.hasFree()) {\r\n          this.threadPool.createThread(thread, attr, func, args)\r\n          return 0\r\n        }\r\n\r\n        if (!this.childUrl) {\r\n          this.createChildUrl()\r\n        }\r\n\r\n        const worker = new Worker(this.childUrl)\r\n\r\n        thread.id = allocThreadId()\r\n        thread.status = PthreadStatus.RUN\r\n        thread.flags = 0\r\n        thread.retval = 0\r\n\r\n        const stackPointer = aligned_alloc(config.STACK_ALIGNMENT, config.STACK_SIZE)\r\n\r\n        const threadDescriptor = malloc(sizeof(ThreadDescriptor))\r\n        memset(threadDescriptor, 0, sizeof(ThreadDescriptor))\r\n\r\n        this.childThreads.set(thread.id, {\r\n          thread,\r\n          worker,\r\n          stackPointer,\r\n          threadDescriptor\r\n        })\r\n\r\n        let resolve: (ret: int32) => void\r\n        const promise = new Promise<int32>((r) => {\r\n          resolve = r\r\n        })\r\n        if (!support.jspi) {\r\n          this.childReadyPromises.push(promise as unknown as Promise<void>)\r\n        }\r\n\r\n        worker.onmessage = (message) => {\r\n          const origin = message.data\r\n          const type = origin.type\r\n          const data = origin.data\r\n\r\n          switch (type) {\r\n            case 'run':\r\n              resolve(0)\r\n              break\r\n          }\r\n        }\r\n\r\n        /**\r\n         * postMessage 并不是同步的，而是在事件循环中处理的\r\n         * 因此父线程不能被阻塞在当前的事件循环中，否则子线程无法成功运行\r\n         * 只有 childReadyPromises 中的 Promise 都 resolve 了之后才能阻塞\r\n         */\r\n        worker.postMessage({\r\n          type: 'run',\r\n          data: {\r\n            cheap: {\r\n              memory: Memory,\r\n              stackPointer,\r\n              stackSize: config.STACK_SIZE,\r\n              id: thread.id\r\n            },\r\n            runner: {\r\n              resource: {\r\n                tableSize: this.resource.tableSize,\r\n                module: this.resource.threadModule.module,\r\n                initFuncs: this.resource.threadModule.initFuncs\r\n              },\r\n              options: {\r\n                memoryBase: this.options.memoryBase || this.memoryBase,\r\n                tableBase: this.tableBase,\r\n                thread,\r\n                threadDescriptor,\r\n                childImports: this.childImports\r\n              },\r\n              func,\r\n              args,\r\n              imports: this.childImports,\r\n              thread\r\n            }\r\n          }\r\n        })\r\n\r\n        return support.jspi ? promise : 0\r\n      }\r\n\r\n      object.extend(this.imports.env, {\r\n        // @ts-ignore\r\n        wasm_pthread_create: support.jspi ? new WebAssembly.Suspending(createPthread) : createPthread,\r\n\r\n        wasm_pthread_join2: (thread: pointer<Pthread>, retval: pointer<pointer<void>>) => {\r\n\r\n          if (this.threadPool && this.threadPool.isPoolThread(thread)) {\r\n            this.threadPool.joinThread(thread, retval)\r\n            return 0\r\n          }\r\n\r\n          if (thread.flags & PthreadFlags.DETACH) {\r\n            this.childThreads.delete(thread.id)\r\n            return 0\r\n          }\r\n          // 等待子线程退出\r\n          atomicsUtils.wait(addressof(thread.status), PthreadStatus.RUN)\r\n\r\n          if (retval !== nullptr) {\r\n            accessof(retval) <- thread.retval\r\n          }\r\n\r\n          const child = this.childThreads.get(thread.id)\r\n\r\n          // 回收栈\r\n          free(child.stackPointer)\r\n          free(child.threadDescriptor)\r\n\r\n          child.worker.terminate()\r\n\r\n          this.childThreads.delete(thread.id)\r\n\r\n          memset(thread, 0, sizeof(Pthread))\r\n          return 0\r\n        },\r\n\r\n        wasm_pthread_detach2: (thread: pointer<Pthread>) => {\r\n          if (this.threadPool && this.threadPool.isPoolThread(thread)) {\r\n            this.threadPool.detachThread(thread)\r\n            return 0\r\n          }\r\n          const child = this.childThreads.get(thread.id)\r\n          child.threadDescriptor.flags |= PthreadFlags.DETACH\r\n          thread.flags |= PthreadFlags.DETACH\r\n        }\r\n      })\r\n      object.extend(this.imports.env, atomics)\r\n      object.extend(this.imports.env, pthread)\r\n      object.extend(this.imports.env, semaphore)\r\n    }\r\n\r\n    if (this.memoryBase) {\r\n      object.extend(this.imports.env, {\r\n        __memory_base: this.memoryBase\r\n      })\r\n    }\r\n    // 使用父线程的 memoryBase\r\n    else if (options.memoryBase) {\r\n      object.extend(this.imports.env, {\r\n        __memory_base: options.memoryBase\r\n      })\r\n    }\r\n    if (this.tableBase) {\r\n      object.extend(this.imports.env, {\r\n        __table_base: this.tableBase\r\n      })\r\n    }\r\n\r\n    if (options.imports?.env) {\r\n      object.extend(this.imports.env, options.imports.env)\r\n      if (options.envKey && options.importMap) {\r\n        const env: Record<string, WebAssembly.ImportValue> = {}\r\n        object.each(this.imports.env, (value, key) => {\r\n          if (options.importMap[key]) {\r\n            env[options.importMap[key]] = value\r\n          }\r\n        })\r\n        this.imports[options.envKey] = env\r\n      }\r\n    }\r\n    this.imports['wasi_snapshot_preview1'] = this.imports.env\r\n  }\r\n\r\n  private createChildUrl() {\r\n    const module = sourceLoad(require.resolve('./WebAssemblyRunner.ts'), {\r\n      varName: '__WebAssemblyRunner__',\r\n      exportName: '__WebAssemblyRunner__',\r\n      pointName: WebAssemblyRunner.name,\r\n      exportIsClass: true\r\n    })\r\n    const source = `\r\n      ${module}\r\n      ${runThread}\r\n      var preRun;\r\n      ${this.childImports ? `\r\n      preRun = import('${this.childImports}')\r\n      ` : ''}\r\n      init.default(preRun);\r\n    `\r\n    this.childBlob = new Blob([source], { type: 'text/javascript' })\r\n    this.childUrl = URL.createObjectURL(this.childBlob)\r\n  }\r\n\r\n  private overrideAtomic() {\r\n    atomics.override({\r\n      atomic_add_i8: atomicAsm.instance.exports.add8 as any,\r\n      atomic_sub_i8: atomicAsm.instance.exports.sub8 as any,\r\n      atomic_and_i8: atomicAsm.instance.exports.and8 as any,\r\n      atomic_or_i8: atomicAsm.instance.exports.or8 as any,\r\n      atomic_xor_i8: atomicAsm.instance.exports.xor8 as any,\r\n      atomic_store_i8: atomicAsm.instance.exports.store8 as any,\r\n      atomic_load_i8: atomicAsm.instance.exports.load8 as any,\r\n      atomic_compare_exchange_i8: atomicAsm.instance.exports.compare_exchange8 as any,\r\n      atomic_exchange_i8: atomicAsm.instance.exports.exchange8 as any,\r\n      atomic_add_i16: atomicAsm.instance.exports.add16 as any,\r\n      atomic_sub_i16: atomicAsm.instance.exports.sub16 as any,\r\n      atomic_and_i16: atomicAsm.instance.exports.and16 as any,\r\n      atomic_or_i16: atomicAsm.instance.exports.or16 as any,\r\n      atomic_xor_i16: atomicAsm.instance.exports.xor16 as any,\r\n      atomic_store_i16: atomicAsm.instance.exports.store16 as any,\r\n      atomic_load_i16: atomicAsm.instance.exports.load16 as any,\r\n      atomic_compare_exchange_i16: atomicAsm.instance.exports.compare_exchange16 as any,\r\n      atomic_exchange_i16: atomicAsm.instance.exports.exchange16 as any,\r\n      atomic_add_i32: atomicAsm.instance.exports.add32 as any,\r\n      atomic_sub_i32: atomicAsm.instance.exports.sub32 as any,\r\n      atomic_and_i32: atomicAsm.instance.exports.and32 as any,\r\n      atomic_or_i32: atomicAsm.instance.exports.or32 as any,\r\n      atomic_xor_i32: atomicAsm.instance.exports.xor32 as any,\r\n      atomic_store_i32: atomicAsm.instance.exports.store32 as any,\r\n      atomic_load_i32: atomicAsm.instance.exports.load32 as any,\r\n      atomic_compare_exchange_i32: atomicAsm.instance.exports.compare_exchange32 as any,\r\n      atomic_exchange_i32: atomicAsm.instance.exports.exchange32 as any,\r\n      atomic_add_i64: atomicAsm.instance.exports.add64 as any,\r\n      atomic_sub_i64: atomicAsm.instance.exports.sub64 as any,\r\n      atomic_and_i64: atomicAsm.instance.exports.and64 as any,\r\n      atomic_or_i64: atomicAsm.instance.exports.or64 as any,\r\n      atomic_xor_i64: atomicAsm.instance.exports.xor64 as any,\r\n      atomic_store_i64: atomicAsm.instance.exports.store64 as any,\r\n      atomic_load_i64: atomicAsm.instance.exports.load64 as any,\r\n      atomic_compare_exchange_i64: atomicAsm.instance.exports.compare_exchange64 as any,\r\n      atomic_exchange_i64: atomicAsm.instance.exports.exchange64 as any,\r\n      atomics_notify: atomicAsm.instance.exports.notify as any,\r\n      atomics_wait: atomicAsm.instance.exports.wait as any\r\n    })\r\n    object.extend(this.imports.env, atomics)\r\n  }\r\n\r\n  /**\r\n   * 运行 wasm 实例\r\n   */\r\n  public async run(imports?: Record<string, any>, threadPoolCount?: number) {\r\n    if (is.object(imports)) {\r\n      object.extend(this.options.imports, imports)\r\n    }\r\n    if (!defined(DEBUG)\r\n      && isWorker()\r\n      && !threadAsm.wasmThreadProxy\r\n      && threadAsm.isSupport()\r\n      && this.resource.threadModule\r\n    ) {\r\n      await threadAsm.init(Memory, pthread.override)\r\n      object.extend(this.imports.env, pthread)\r\n    }\r\n    if (!libcAsm.wasmThreadProxy\r\n      && libcAsm.isSupport()\r\n    ) {\r\n      await libcAsm.init(Memory)\r\n    }\r\n    if (!atomicAsmOverride && atomicAsm.isSupport()) {\r\n      atomicAsmOverride = true\r\n      this.overrideAtomic()\r\n    }\r\n    this.instance = await WebAssembly.instantiate(this.resource.module, this.imports)\r\n\r\n    this.initRunTime()\r\n\r\n    if (defined(ENABLE_THREADS)\r\n      && this.resource.threadModule\r\n      && this.resource.enableThreadPool\r\n      && threadPoolCount > 0\r\n      && !support.jspi\r\n    ) {\r\n      if (!this.childUrl) {\r\n        this.createChildUrl()\r\n      }\r\n\r\n      let count = threadPoolCount\r\n      if (this.resource.enableThreadCountRate) {\r\n        count *= this.resource.enableThreadCountRate\r\n      }\r\n\r\n      this.threadPool = new ThreadPool(count, this.childUrl)\r\n      await this.threadPool.ready({\r\n        tableSize: this.resource.tableSize,\r\n        module: this.resource.threadModule.module,\r\n        initFuncs: this.resource.threadModule.initFuncs,\r\n        memoryBase: this.options.memoryBase || this.memoryBase,\r\n        tableBase: this.tableBase,\r\n        childImports: this.childImports\r\n      })\r\n    }\r\n  }\r\n\r\n  public async runAsChild(imports?: Record<string, any>) {\r\n    if (is.object(imports)) {\r\n      object.extend(this.options.imports, imports)\r\n    }\r\n    if (!defined(DEBUG) && !threadAsm.wasmThreadProxy && threadAsm.isSupport()) {\r\n      await threadAsm.init(Memory, pthread.override)\r\n      object.extend(this.imports.env, pthread)\r\n    }\r\n    if (!atomicAsmOverride && atomicAsm.isSupport()) {\r\n      atomicAsmOverride = true\r\n      this.overrideAtomic()\r\n    }\r\n    this.instance = new WebAssembly.Instance(this.resource.module, this.imports)\r\n\r\n    this.initRunTime()\r\n  }\r\n\r\n  public async childrenThreadReady() {\r\n    if (!this.childReadyPromises.length) {\r\n      return\r\n    }\r\n    const promise = this.childReadyPromises\r\n    this.childReadyPromises = []\r\n    await Promise.all(promise)\r\n  }\r\n\r\n  private initRunTime() {\r\n    this.builtinMalloc = []\r\n    this.initCalling = true\r\n    if (is.array(this.resource.initFuncs)) {\r\n      array.each(this.resource.initFuncs, (func) => {\r\n        let call: Function\r\n        if (this.asm[func]) {\r\n          call = this.asm[func]\r\n        }\r\n        if (call) {\r\n          return call()\r\n        }\r\n      })\r\n    }\r\n    this.initCalling = false\r\n  }\r\n\r\n  /**\r\n   * 调用 wasm 模块暴露的方法\r\n   * \r\n   * @param func 方法名\r\n   * @param args 参数，只能是 number 和 bigint( 有浏览器版本要求， 建议 64 位数据使用指针传递） 类型，如果是其他类型参数使用指针传递\r\n   */\r\n  public call<T extends number | bigint | void = void>(func: string, ...args: (number | bigint)[]): T  {\r\n    if (!this.asm) {\r\n      return -1 as T\r\n    }\r\n\r\n    let call: Function\r\n    if (this.asm[func]) {\r\n      call = this.asm[func]\r\n    }\r\n    else if (this.options.exportMap && this.options.exportMap[func] && this.asm[this.options.exportMap[func]]) {\r\n      call = this.asm[this.options.exportMap[func]] as Function\r\n    }\r\n    if (call) {\r\n      return call.apply(null, args)\r\n    }\r\n    else {\r\n      logger.error(`the wasm module has not function ${func} to call`)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 异步调用 wasm 模块暴露的方法\r\n   * \r\n   * 适用于 wasm 内部会调用异步 js 函数的情况\r\n   * \r\n   * 需要支持 JSPI\r\n   * \r\n   * @param func 方法名\r\n   * @param args 参数，只能是 number 和 bigint( 有浏览器版本要求， 建议 64 位数据使用指针传递） 类型，如果是其他类型参数使用指针传递\r\n   */\r\n  public async callAsync<T extends number | bigint | void = void>(func: string, ...args: (number | bigint)[]): Promise<T>  {\r\n    if (!this.asm) {\r\n      return -1 as T\r\n    }\r\n    if (!support.jspi) {\r\n      return this.call<T>(func, ...args)\r\n    }\r\n\r\n    let call: Function\r\n\r\n    if (this.promisingMap.has(func)) {\r\n      call = this.promisingMap.get(func)\r\n    }\r\n    else {\r\n      if (this.asm[func]) {\r\n        call = this.asm[func]\r\n      }\r\n      else if (this.options.exportMap && this.options.exportMap[func] && this.asm[this.options.exportMap[func]]) {\r\n        call = this.asm[this.options.exportMap[func]] as Function\r\n      }\r\n      // @ts-ignore\r\n      call = WebAssembly.promising(call)\r\n      this.promisingMap.set(func, call)\r\n    }\r\n    if (call) {\r\n      return call.apply(null, args)\r\n    }\r\n    else {\r\n      logger.error(`the wasm module has not function ${func} to call`)\r\n    }\r\n  }\r\n\r\n  get asm() {\r\n    return this.instance && this.instance.exports as Object\r\n  }\r\n\r\n  public getInstance() {\r\n    return this.instance\r\n  }\r\n\r\n  public destroy() {\r\n    if (this.builtinMalloc?.length) {\r\n      array.each(this.builtinMalloc, (pointer) => {\r\n        free(pointer)\r\n      })\r\n      this.builtinMalloc.length = 0\r\n    }\r\n\r\n    if (this.memoryBase) {\r\n      free(this.memoryBase)\r\n      this.memoryBase = null\r\n    }\r\n\r\n    if (this.tableBase) {\r\n      Table.free(this.tableBase)\r\n      this.tableBase = null\r\n    }\r\n\r\n    if (this.childImports) {\r\n      URL.revokeObjectURL(this.childImports)\r\n      this.childImports = null\r\n    }\r\n\r\n    if (this.childUrl) {\r\n      URL.revokeObjectURL(this.childUrl)\r\n      this.childUrl = null\r\n    }\r\n    this.childBlob = null\r\n    this.childReadyPromises.length = 0\r\n\r\n    if (this.childThreads.size) {\r\n      this.childThreads.forEach((thread, id) => {\r\n        if (!(thread.threadDescriptor.flags & PthreadFlags.DETACH)) {\r\n          logger.warn('has child thread running, maybe resource leakage')\r\n          thread.worker.terminate()\r\n          thread.thread.status = PthreadStatus.STOP\r\n          if (thread.stackPointer) {\r\n            free(thread.stackPointer)\r\n          }\r\n          free(thread.threadDescriptor)\r\n          this.childThreads.delete(id)\r\n        }\r\n      })\r\n    }\r\n\r\n    this.builtinMalloc = null\r\n    this.instance = null\r\n\r\n    if (this.options.thread) {\r\n      if (this.options.threadDescriptor) {\r\n        this.options.threadDescriptor.status = PthreadStatus.STOP\r\n      }\r\n      if (this.options.threadDescriptor\r\n        && ((this.options.threadDescriptor.flags & PthreadFlags.DETACH)\r\n            || (this.options.thread.flags & PthreadFlags.EXIT)\r\n        )\r\n      ) {\r\n        if (!(this.options.threadDescriptor.flags & PthreadFlags.POOL)) {\r\n          if (StackTop) {\r\n            free(StackTop)\r\n          }\r\n          free(this.options.threadDescriptor)\r\n          memset(this.options.thread, 0, sizeof(Pthread))\r\n          self.close()\r\n        }\r\n      }\r\n      else {\r\n        this.options.thread.status = PthreadStatus.STOP\r\n        // 唤醒父线程收回资源\r\n        atomicsUtils.notify(addressof(this.options.thread.status), 1)\r\n      }\r\n    }\r\n\r\n    if (defined(ENABLE_THREADS)) {\r\n      if (this.threadPool) {\r\n        this.threadPool.destroy()\r\n      }\r\n      this.threadPool = null\r\n    }\r\n\r\n    if (this.promisingMap) {\r\n      this.promisingMap.clear()\r\n      this.promisingMap = null\r\n    }\r\n  }\r\n}\r\n","import * as is from 'common/util/is'\r\nimport IOReader from 'common/io/IOReader'\r\nimport { IOError } from 'common/io/error'\r\nimport IOWriter from 'common/io/IOWriter'\r\nimport { ExternalKind, SectionId, readSLeb128Async,\r\n  readULeb128Async, writeSleb128Async, writeUleb128Async\r\n} from 'common/util/wasm'\r\nimport concatTypeArray from 'common/function/concatTypeArray'\r\nimport * as object from 'common/util/object'\r\nimport * as config from '../config'\r\nimport browser from 'common/util/browser'\r\nimport os from 'common/util/os'\r\n\r\nexport interface WebAssemblyResource {\r\n  tableSize?: number\r\n  dataSize?: number\r\n  initFuncs?: string[]\r\n  module: WebAssembly.Module\r\n  buffer?: ArrayBuffer\r\n  threadModule?: {\r\n    module: WebAssembly.Module\r\n    initFuncs?: string[]\r\n  }\r\n  /**\r\n   * 提前创建好的 worker pool\r\n   * 某些 wasm 创建线程之后需要马上挂起线程，这种情况需要提前将线程准备好\r\n   */\r\n  enableThreadPool?: boolean\r\n  enableThreadCountRate?: number\r\n}\r\n\r\nexport interface WebAssemblySource {\r\n  source: Uint8Array | ArrayBuffer | string\r\n  tableSize?: number\r\n  dataSize?: number\r\n}\r\n\r\ninterface Context {\r\n  ioReader: IOReader,\r\n  ioWriter: IOWriter\r\n  bufferEnded: boolean\r\n  compileStopped: boolean\r\n  error: string\r\n  abortController: AbortController\r\n\r\n  pullResolve: (buffer: Uint8Array) => void\r\n  bufferResolve: (controller: ReadableStreamDefaultController<any>) => void\r\n\r\n  data: {\r\n    tableSize?: number\r\n    dataSize?: number\r\n  }\r\n  buffers: Uint8Array[]\r\n  options: CompilerOptions\r\n}\r\n\r\ninterface CompilerOptions {\r\n  enableThread?: boolean\r\n  child?: boolean\r\n  initFuncs?: string[]\r\n}\r\n\r\nasync function process(context: Context) {\r\n  try {\r\n    // `\\0asm`\r\n    await context.ioWriter.writeUint32(await context.ioReader.readUint32())\r\n    // Version\r\n    await context.ioWriter.writeUint32(await context.ioReader.readUint32())\r\n    while (true) {\r\n      if (context.compileStopped) {\r\n        if (context.abortController) {\r\n          context.abortController.abort()\r\n        }\r\n        break\r\n      }\r\n\r\n      const sectionId = await context.ioReader.readUint8()\r\n      if (context.options.child) {\r\n        if (sectionId === SectionId.Data) {\r\n          await context.ioWriter.writeUint8(sectionId)\r\n          // size\r\n          await writeUleb128Async(context.ioWriter, 7)\r\n\r\n          // count\r\n          await writeUleb128Async(context.ioWriter, 1)\r\n\r\n          // index\r\n          await writeUleb128Async(context.ioWriter, 0)\r\n\r\n          // init_expr i32_const 0\r\n          await context.ioWriter.writeUint8(0x41)\r\n          await context.ioWriter.writeUint8(0x00)\r\n          await context.ioWriter.writeUint8(0x0b)\r\n\r\n          // size\r\n          await writeUleb128Async(context.ioWriter, 1)\r\n          await context.ioWriter.writeUint8(0x00)\r\n\r\n          const size = await readULeb128Async(context.ioReader)\r\n          await context.ioReader.skip(size)\r\n          continue\r\n        }\r\n      }\r\n\r\n      await context.ioWriter.writeUint8(sectionId)\r\n\r\n      const size = await readULeb128Async(context.ioReader)\r\n      await writeUleb128Async(context.ioWriter, size)\r\n\r\n      const now = context.ioReader.getPos()\r\n\r\n      if (sectionId === SectionId.Data) {\r\n        /**\r\n         * - count: varuint32\r\n         * - entries: data_segment*\r\n         *   - index varuint32 the linear memory index (0 in the MVP)\r\n         *   - offset init_expr \r\n         *   - size varuint32\r\n         *   - data bytes\r\n         */\r\n        const count = await readULeb128Async(context.ioReader)\r\n        await writeUleb128Async(context.ioWriter, count)\r\n        if (count) {\r\n          await writeUleb128Async(context.ioWriter, await readULeb128Async(context.ioReader))\r\n          while (true) {\r\n            const byte = await context.ioReader.readUint8()\r\n            await context.ioWriter.writeUint8(byte)\r\n            if (byte === 0x0b) {\r\n              break\r\n            }\r\n          }\r\n          context.data.dataSize = await readULeb128Async(context.ioReader)\r\n          await writeUleb128Async(context.ioWriter, context.data.dataSize)\r\n        }\r\n      }\r\n      else if (sectionId === SectionId.Import) {\r\n        /**\r\n         * - count: varuint32\r\n         * - entries: import_entry*\r\n         *   - module_len varuint32\r\n         *   - module_str bytes \r\n         *   - field_len varuint32\r\n         *   - field_str bytes\r\n         *   - external_kind\r\n         */\r\n\r\n        let count = await readULeb128Async(context.ioReader)\r\n        await writeUleb128Async(context.ioWriter, count)\r\n        let counter = 0\r\n\r\n        while (count--) {\r\n          const moduleLen = await readULeb128Async(context.ioReader)\r\n          await writeUleb128Async(context.ioWriter, moduleLen)\r\n          await context.ioWriter.writeBuffer(await context.ioReader.readBuffer(moduleLen))\r\n          const fieldLen = await readULeb128Async(context.ioReader)\r\n          await writeUleb128Async(context.ioWriter, fieldLen)\r\n          await context.ioWriter.writeBuffer(await context.ioReader.readBuffer(fieldLen))\r\n\r\n          const externalKind = await context.ioReader.readUint8()\r\n          await context.ioWriter.writeUint8(externalKind)\r\n\r\n          switch (externalKind) {\r\n            case ExternalKind.Function: {\r\n              // type index of the function signature\r\n              await writeUleb128Async(context.ioWriter, await readULeb128Async(context.ioReader))\r\n              break\r\n            }\r\n            case ExternalKind.Global: {\r\n              // content_type\r\n              await writeSleb128Async(context.ioWriter, await readSLeb128Async(context.ioReader))\r\n              // mutability\r\n              await writeUleb128Async(context.ioWriter, await readULeb128Async(context.ioReader))\r\n              break\r\n            }\r\n            case ExternalKind.Memory: {\r\n              let flags = await readULeb128Async(context.ioReader)\r\n\r\n              if (context.options.enableThread) {\r\n                flags |= 2\r\n              }\r\n              else {\r\n                flags &= ~2\r\n              }\r\n\r\n              await writeUleb128Async(context.ioWriter, flags)\r\n              // initial\r\n              const initial = await readULeb128Async(context.ioReader)\r\n              await writeUleb128Async(context.ioWriter, config.HEAP_INITIAL || initial)\r\n              if (flags & 0x01) {\r\n                let max = await readULeb128Async(context.ioReader)\r\n                if (!(browser.safari && os.ios && !browser.checkVersion(browser.majorVersion, '17', true)) || !context.options.enableThread) {\r\n                  // ios safari 16 以下改更了会编译错误，但它也不会去检查 max 和导入的内存是否限制一致\r\n                  // 所以这里不更改了\r\n                  max = config.HEAP_MAXIMUM\r\n                }\r\n                // maximum\r\n                await writeUleb128Async(context.ioWriter, max)\r\n              }\r\n              counter++\r\n              break\r\n            }\r\n            case ExternalKind.Table: {\r\n              // elem_type\r\n              await writeSleb128Async(context.ioWriter, await readSLeb128Async(context.ioReader))\r\n              const flags = await readULeb128Async(context.ioReader)\r\n              await writeUleb128Async(context.ioWriter, flags)\r\n              const initial = await readULeb128Async(context.ioReader)\r\n              await writeUleb128Async(context.ioWriter, initial)\r\n\r\n              context.data.tableSize = initial\r\n\r\n              if (flags & 0x01) {\r\n                // maximum\r\n                await writeUleb128Async(context.ioWriter, await readULeb128Async(context.ioReader))\r\n              }\r\n              counter++\r\n              break\r\n            }\r\n          }\r\n\r\n          if (counter === 2) {\r\n            break\r\n          }\r\n        }\r\n      }\r\n\r\n      const remainingLength = size - Number(context.ioReader.getPos() - now)\r\n      if (remainingLength) {\r\n        await context.ioReader.pipe(context.ioWriter, size - Number(context.ioReader.getPos() - now))\r\n      }\r\n    }\r\n  }\r\n  catch (e) {\r\n    if (context.ioReader.error === IOError.END) {\r\n      context.bufferEnded = true\r\n    }\r\n    else {\r\n      context.error = e\r\n    }\r\n    if (context.ioReader.remainingLength()) {\r\n      await context.ioWriter.writeBuffer(await context.ioReader.readBuffer(context.ioReader.remainingLength()))\r\n    }\r\n    await context.ioWriter.flush()\r\n  }\r\n}\r\n\r\nexport default async function compile(source: WebAssemblySource, options: CompilerOptions = {}): Promise<WebAssemblyResource> {\r\n  let module: WebAssembly.Module\r\n  let tableSize: number\r\n  let dataSize: number\r\n  let buffer: ArrayBuffer\r\n\r\n  options = object.extend({\r\n    enableThread: config.USE_THREADS,\r\n    initFuncs: options.child ? [] : ['__wasm_apply_data_relocs', '_initialize']\r\n  }, options)\r\n\r\n  if (is.number(source.dataSize) && is.number(source.tableSize)) {\r\n    tableSize = source.dataSize\r\n    dataSize = source.dataSize\r\n    if (is.string(source.source)) {\r\n      const params: Partial<any> = {\r\n        method: 'GET',\r\n        headers: {},\r\n        mode: 'cors',\r\n        cache: 'default',\r\n        referrerPolicy: 'no-referrer-when-downgrade'\r\n      }\r\n      if (is.func(WebAssembly.compileStreaming)) {\r\n        module = await WebAssembly.compileStreaming(fetch(source.source, params))\r\n      }\r\n      else {\r\n        const response = await fetch(source.source, params)\r\n        buffer = await response.arrayBuffer()\r\n        module = await WebAssembly.compile(buffer)\r\n      }\r\n    }\r\n    else {\r\n      module = await WebAssembly.compile(source.source)\r\n      buffer = is.arrayBuffer(source.source) ? source.source : (source.source as Uint8Array).buffer\r\n    }\r\n  }\r\n  else {\r\n    const context: Context = {\r\n      ioReader: new IOReader(1 * 1024 * 1024),\r\n      ioWriter: new IOWriter(1 * 1024 * 1024),\r\n      bufferEnded: false,\r\n      compileStopped: false,\r\n      error: '',\r\n      abortController: null,\r\n\r\n      pullResolve: null,\r\n      bufferResolve: null,\r\n      buffers: [],\r\n      data: {\r\n\r\n      },\r\n      options\r\n    }\r\n\r\n    const response = new Response(\r\n      new ReadableStream({\r\n        async start(controller) {\r\n          if (is.string(source.source)) {\r\n            if (AbortController) {\r\n              context.abortController = new AbortController()\r\n            }\r\n            const params: Partial<any> = {\r\n              method: 'GET',\r\n              headers: {},\r\n              mode: 'cors',\r\n              cache: 'default',\r\n              referrerPolicy: 'no-referrer-when-downgrade',\r\n              signal: context.abortController?.signal\r\n            }\r\n\r\n            const res = await fetch(source.source, params)\r\n            let reader: ReadableStreamDefaultReader<Uint8Array>\r\n            if (res.ok && (res.status >= 200 && res.status <= 299)) {\r\n              reader = res.body.getReader()\r\n            }\r\n            else {\r\n              controller.error(`Http code invalid, ${res.status} ${res.statusText}`)\r\n            }\r\n\r\n            const buffers: Uint8Array[] = []\r\n            context.ioReader.onFlush = async (buffer: Uint8Array) => {\r\n              let pos = 0\r\n              while (buffers.length && pos < buffer.length) {\r\n                const cache = buffers.shift()\r\n                if (cache.length > buffer.length - pos) {\r\n                  buffer.set(cache.subarray(0, buffer.length - pos), pos)\r\n                  buffers.unshift(cache.subarray(buffer.length - pos))\r\n                  pos = buffer.length\r\n                }\r\n                else {\r\n                  buffer.set(cache, pos)\r\n                  pos += cache.length\r\n                }\r\n              }\r\n\r\n              if (pos >= buffer.length) {\r\n                return buffer.length\r\n              }\r\n\r\n              const { value, done } = await reader.read()\r\n\r\n              if (done) {\r\n                return pos > 0 ? pos : IOError.END\r\n              }\r\n              else {\r\n                context.buffers.push(value)\r\n                if (value.length > buffer.length - pos) {\r\n                  buffer.set(value.subarray(0, buffer.length - pos), pos)\r\n                  buffers.push(value.subarray(buffer.length - pos))\r\n                  return buffer.length\r\n                }\r\n                else {\r\n                  buffer.set(value, pos)\r\n                  pos += value.length\r\n                  return pos\r\n                }\r\n              }\r\n            }\r\n          }\r\n          else {\r\n            let readPos = 0\r\n            let readFileLength = source.source.byteLength\r\n\r\n            const wasm = is.arrayBuffer(source.source) ? new Uint8Array(source.source) : source.source\r\n\r\n            context.ioReader.onFlush = async (buffer: Uint8Array) => {\r\n              if (readPos >= readFileLength) {\r\n                return IOError.END\r\n              }\r\n              const len = Math.min(buffer.length, readFileLength - readPos)\r\n\r\n              buffer.set(wasm.subarray(readPos, readPos + len), 0)\r\n\r\n              readPos += len\r\n\r\n              return len\r\n            }\r\n          }\r\n\r\n          context.ioWriter.onFlush = async (buffer: Uint8Array) => {\r\n            if (context.pullResolve) {\r\n              context.pullResolve(buffer.slice())\r\n              context.pullResolve = null\r\n              return 0\r\n            }\r\n            (await new Promise<ReadableStreamDefaultController<any>>((resolve, reject) => {\r\n              context.bufferResolve = resolve\r\n            })).enqueue(buffer.slice())\r\n\r\n            return 0\r\n          }\r\n\r\n          process(context)\r\n        },\r\n        async pull(controller) {\r\n          if (context.error) {\r\n            controller.close()\r\n            return\r\n          }\r\n          if (context.bufferResolve) {\r\n            context.bufferResolve(controller)\r\n            context.bufferResolve = null\r\n            return\r\n          }\r\n          controller.enqueue(await new Promise<Uint8Array>((resolve, reject) => {\r\n            context.pullResolve = resolve\r\n          }))\r\n\r\n          if (context.bufferEnded) {\r\n            controller.close()\r\n          }\r\n          else if (context.error) {\r\n            controller.error(context.error)\r\n          }\r\n        },\r\n        cancel(reason) {\r\n          context.compileStopped = true\r\n        }\r\n      }),\r\n      {\r\n        headers: {\r\n          'Content-Type': 'application/wasm'\r\n        }\r\n      }\r\n    )\r\n\r\n    if (is.func(WebAssembly.compileStreaming)) {\r\n      module = await WebAssembly.compileStreaming(response)\r\n    }\r\n    else {\r\n      module = await WebAssembly.compile(await response.arrayBuffer())\r\n    }\r\n\r\n    buffer = is.string(source.source)\r\n      ? concatTypeArray(Uint8Array, context.buffers).buffer\r\n      : (is.arrayBuffer(source.source) ? source.source : (source.source as Uint8Array).buffer)\r\n    tableSize = context.data.tableSize\r\n    dataSize = context.data.dataSize\r\n  }\r\n\r\n  if (options.child) {\r\n    return {\r\n      module,\r\n      initFuncs: options.initFuncs || []\r\n    }\r\n  }\r\n\r\n  return {\r\n    module,\r\n    tableSize,\r\n    dataSize,\r\n    initFuncs: options.initFuncs || [],\r\n    buffer: buffer\r\n  }\r\n}\r\n","\r\nimport { SELF } from 'common/util/constant'\r\nimport { ThreadWait } from './thread'\r\n\r\n// @ts-ignore\r\nSELF.imports = {\r\n  env: {\r\n\r\n  }\r\n}\r\n\r\nlet parentPort = SELF\r\nif (defined(ENV_NODE)) {\r\n  const { parentPort: parentPort_ } = require('worker_threads')\r\n  parentPort = parentPort_\r\n}\r\n\r\nlet runner: any\r\nlet runnerData: any\r\nlet waitData: pointer<ThreadWait> = nullptr\r\n\r\nexport default function init(preRun: Promise<void>) {\r\n  const handler = (message: MessageEvent<any>) => {\r\n\r\n    const origin = defined(ENV_NODE) ? message : message.data\r\n    const type = origin.type\r\n    const data = origin.data\r\n\r\n    switch (type) {\r\n      case 'run': {\r\n        parentPort.postMessage({\r\n          type: 'run'\r\n        })\r\n        if (SELF.CHeap && SELF.CHeap.initThread) {\r\n          SELF.CHeap.initThread(data.cheap).then(() => {\r\n            function run() {\r\n              SELF.__SELF_THREAD__ = data.runner.thread\r\n              // @ts-ignore\r\n              data.runner.options.imports = SELF.imports\r\n              // @ts-ignore\r\n              runner = new __WebAssemblyRunner__.__WebAssemblyRunner__(data.runner.resource, data.runner.options)\r\n              runner.runAsChild().then(() => {\r\n                // @ts-ignore\r\n                __WebAssemblyRunner__.__WebAssemblyRunner__.getTable().get(data.runner.func)(data.runner.args)\r\n                runner.destroy()\r\n              })\r\n            }\r\n\r\n            if (preRun) {\r\n              preRun.then(() => {\r\n                run()\r\n              })\r\n            }\r\n            else {\r\n              run()\r\n            }\r\n          })\r\n        }\r\n        break\r\n      }\r\n      case 'ready': {\r\n        runnerData = data.runner\r\n        waitData = data.cheap.stackPointer\r\n        if (SELF.CHeap && SELF.CHeap.initThread) {\r\n          SELF.CHeap.initThread(data.cheap).then(() => {\r\n            if (preRun) {\r\n              preRun.then(() => {\r\n                parentPort.postMessage({\r\n                  type: 'ready'\r\n                })\r\n              })\r\n            }\r\n            else {\r\n              parentPort.postMessage({\r\n                type: 'ready'\r\n              })\r\n            }\r\n          })\r\n        }\r\n        break\r\n      }\r\n\r\n      case 'wait': {\r\n        async function run() {\r\n          while (true) {\r\n            // @ts-ignore\r\n            __WebAssemblyRunner__.__WebAssemblyRunner__.mutexLock(addressof(waitData.mutex))\r\n            // @ts-ignore\r\n            while (__WebAssemblyRunner__.__WebAssemblyRunner__.readPointer(addressof(waitData.thread)) === nullptr) {\r\n              // @ts-ignore\r\n              __WebAssemblyRunner__.__WebAssemblyRunner__.condWait(addressof(waitData.cond), addressof(waitData.mutex))\r\n            }\r\n\r\n            // @ts-ignore\r\n            SELF.__SELF_THREAD__ = runnerData.options.thread = runnerData.thread = __WebAssemblyRunner__.__WebAssemblyRunner__.readPointer(addressof(waitData.thread))\r\n\r\n            // @ts-ignore\r\n            runnerData.func = __WebAssemblyRunner__.__WebAssemblyRunner__.readPointer(addressof(waitData.func))\r\n            // @ts-ignore\r\n            runnerData.args = __WebAssemblyRunner__.__WebAssemblyRunner__.readPointer(addressof(waitData.args))\r\n\r\n            // @ts-ignore\r\n            runner = new __WebAssemblyRunner__.__WebAssemblyRunner__(runnerData.resource, runnerData.options)\r\n            await runner.runAsChild()\r\n            // @ts-ignore\r\n            __WebAssemblyRunner__.__WebAssemblyRunner__.getTable().get(runnerData.func)(runnerData.args)\r\n            runner.destroy()\r\n            // @ts-ignore\r\n            __WebAssemblyRunner__.__WebAssemblyRunner__.writePointer(addressof(waitData.thread), nullptr)\r\n            // @ts-ignore\r\n            __WebAssemblyRunner__.__WebAssemblyRunner__.mutexUnlock(addressof(waitData.mutex))\r\n          }\r\n        }\r\n        // @ts-ignore\r\n        runnerData.options.imports = SELF.imports\r\n        run()\r\n        break\r\n      }\r\n    }\r\n  }\r\n\r\n  if (defined(ENV_NODE)) {\r\n    // @ts-ignore\r\n    parentPort.on('message', handler)\r\n  }\r\n  else {\r\n    parentPort.onmessage = handler\r\n  }\r\n}\r\n","/* eslint-disable camelcase */\r\n\r\nimport { base64ToUint8Array } from 'common/util/base64'\r\nimport * as logger from 'common/util/logger'\r\n\r\nimport asm from './libc.asm'\r\nimport * as wasmUtils from 'common/util/wasm'\r\nimport { BuiltinTableSlot } from '../../../allocator/Table'\r\nimport { Table } from '../../../heap'\r\n\r\n/**\r\n * WebAssembly runtime 实例\r\n */\r\nexport let wasmThreadProxy: WebAssembly.Instance\r\n\r\nlet support = true\r\n\r\nexport function isSupport() {\r\n  return support\r\n}\r\n\r\nexport async function init(memory: WebAssembly.Memory) {\r\n  try {\r\n    if (typeof SharedArrayBuffer === 'function' && memory.buffer instanceof SharedArrayBuffer) {\r\n\r\n      const wasm = base64ToUint8Array(asm)\r\n\r\n      wasmUtils.setMemoryShared(wasm, true)\r\n\r\n      wasmThreadProxy = (await WebAssembly.instantiate(wasm, {\r\n        env: {\r\n          memory,\r\n          malloc: function (size: size) {\r\n            return malloc(size)\r\n          },\r\n          calloc: function (num: size, size: size) {\r\n            return calloc(num, size)\r\n          },\r\n          realloc: function (pointer: pointer<void>, size: size) {\r\n            return realloc(pointer, size)\r\n          },\r\n          aligned_alloc(alignment: size, size: size): pointer<void> {\r\n            return aligned_alloc(alignment, size)\r\n          },\r\n          free: function (pointer: pointer<void>) {\r\n            free(pointer)\r\n          }\r\n        }\r\n      })).instance\r\n      Table.set(BuiltinTableSlot.MALLOC, wasmThreadProxy.exports.malloc as any)\r\n      Table.set(BuiltinTableSlot.FREE, wasmThreadProxy.exports.free as any)\r\n      Table.set(BuiltinTableSlot.CALLOC, wasmThreadProxy.exports.calloc as any)\r\n      Table.set(BuiltinTableSlot.REALLOC, wasmThreadProxy.exports.realloc as any)\r\n      Table.set(BuiltinTableSlot.ALIGNED_ALLOC, wasmThreadProxy.exports.alignedAlloc as any)\r\n    }\r\n    else {\r\n      support = false\r\n      return\r\n    }\r\n\r\n  }\r\n  catch (error) {\r\n    support = false\r\n    logger.warn('thread asm not support, cannot use asm thread function')\r\n  }\r\n}\r\n","/* eslint-disable camelcase */\r\n\r\nimport { base64ToUint8Array } from 'common/util/base64'\r\nimport * as logger from 'common/util/logger'\r\n\r\nimport asm from './thread.asm'\r\nimport { Mutex } from '../../../thread/mutex'\r\nimport { Cond } from '../../../thread/cond'\r\nimport { Timespec } from '../semaphore'\r\nimport * as wasmUtils from 'common/util/wasm'\r\n\r\n/**\r\n * WebAssembly runtime 实例\r\n */\r\nexport let wasmThreadProxy: WebAssembly.Instance\r\n\r\nlet support = true\r\n\r\nexport function isSupport() {\r\n  return support\r\n}\r\n\r\nexport async function init(memory: WebAssembly.Memory, override: (\r\n  data: {\r\n    wasm_pthread_mutex_lock: (mutex: pointer<Mutex>) => int32,\r\n    wasm_pthread_mutex_trylock: (mutex: pointer<Mutex>) => int32,\r\n    wasm_pthread_mutex_unlock: (mutex: pointer<Mutex>) => int32,\r\n    wasm_pthread_cond_wait: (cond: pointer<Cond>, mutex: pointer<Mutex>) => int32,\r\n    wasm_pthread_cond_timedwait: (cond: pointer<Cond>, mutex: pointer<Mutex>, abstime: pointer<Timespec>) => int32,\r\n    wasm_pthread_cond_signal: (cond: pointer<Cond>) => int32,\r\n    wasm_pthread_cond_broadcast: (cond: pointer<Cond>) => int32\r\n  }\r\n) => void) {\r\n  try {\r\n    if (typeof SharedArrayBuffer === 'function' && memory.buffer instanceof SharedArrayBuffer) {\r\n\r\n      const wasm = base64ToUint8Array(asm)\r\n\r\n      wasmUtils.setMemoryShared(wasm, true)\r\n\r\n      wasmThreadProxy = (await WebAssembly.instantiate(wasm, {\r\n        env: {\r\n          memory\r\n        }\r\n      })).instance\r\n    }\r\n    else {\r\n      support = false\r\n      return\r\n    }\r\n    override({\r\n      wasm_pthread_mutex_lock: wasmThreadProxy.exports.lock as (mutex: pointer<Mutex>) => int32,\r\n      wasm_pthread_mutex_trylock: wasmThreadProxy.exports.trylock as (mutex: pointer<Mutex>) => int32,\r\n      wasm_pthread_mutex_unlock: wasmThreadProxy.exports.unlock as (mutex: pointer<Mutex>) => int32,\r\n      wasm_pthread_cond_wait: wasmThreadProxy.exports.wait as (cond: pointer<Cond>, mutex: pointer<Mutex>) => int32,\r\n      wasm_pthread_cond_timedwait: wasmThreadProxy.exports.timedwait as (\r\n        cond: pointer<Cond>,\r\n        mutex: pointer<Mutex>,\r\n        abstime: pointer<Timespec>\r\n      ) => int32,\r\n      wasm_pthread_cond_signal: wasmThreadProxy.exports.signal as (cond: pointer<Cond>) => int32,\r\n      wasm_pthread_cond_broadcast: wasmThreadProxy.exports.broadcast as (cond: pointer<Cond>) => int32\r\n    })\r\n  }\r\n  catch (error) {\r\n    support = false\r\n    logger.warn('thread asm not support, cannot use asm thread function')\r\n  }\r\n}\r\n","/* eslint-disable camelcase */\r\n\r\nimport * as atomics from '../../thread/atomics'\r\nimport { CTypeEnumPointerShiftMap } from '../../typedef'\r\n\r\nexport let atomic_add_i8 = function (p: pointer<atomic_int8>, value: int32) {\r\n  // @ts-ignore\r\n  return atomics.add(p, value, atomic_int8, CTypeEnumPointerShiftMap[atomic_int8])\r\n}\r\n\r\nexport let atomic_sub_i8 = function (p: pointer<atomic_int8>, value: int32) {\r\n  // @ts-ignore\r\n  return atomics.sub(p, value, atomic_int8, CTypeEnumPointerShiftMap[atomic_int8])\r\n}\r\n\r\nexport let atomic_and_i8 = function (p: pointer<atomic_int8>, value: int32) {\r\n  // @ts-ignore\r\n  return atomics.and(p, value,  atomic_int8, CTypeEnumPointerShiftMap[atomic_int8])\r\n}\r\n\r\nexport let atomic_or_i8 = function (p: pointer<atomic_int8>, value: int32) {\r\n  // @ts-ignore\r\n  return atomics.or(p, value,  atomic_int8, CTypeEnumPointerShiftMap[atomic_int8])\r\n}\r\n\r\nexport let atomic_xor_i8 = function (p: pointer<atomic_int8>, value: int32) {\r\n  // @ts-ignore\r\n  return atomics.xor(p, value,  atomic_int8, CTypeEnumPointerShiftMap[atomic_int8])\r\n}\r\n\r\nexport let atomic_store_i8 = function (p: pointer<atomic_int8>, value: int32) {\r\n  // @ts-ignore\r\n  return atomics.store(p, value,  atomic_int8, CTypeEnumPointerShiftMap[atomic_int8])\r\n}\r\n\r\nexport let atomic_load_i8 = function (p: pointer<atomic_int8>) {\r\n  // @ts-ignore\r\n  return atomics.load(p,  atomic_int8, CTypeEnumPointerShiftMap[atomic_int8])\r\n}\r\n\r\nexport let atomic_compare_exchange_i8 = function (p: pointer<atomic_int8>, expectedValue: int32, replacementValue: int32) {\r\n  // @ts-ignore\r\n  return atomics.compareExchange(p, expectedValue, replacementValue,  atomic_int8, CTypeEnumPointerShiftMap[atomic_int8])\r\n}\r\n\r\nexport let atomic_exchange_i8 = function (p: pointer<atomic_int8>, value: int32) {\r\n  // @ts-ignore\r\n  return atomics.exchange(p, value,  atomic_int8, CTypeEnumPointerShiftMap[atomic_int8])\r\n}\r\n\r\n\r\nexport let atomic_add_i16 = function (p: pointer<atomic_int16>, value: int32) {\r\n  // @ts-ignore\r\n  return atomics.add(p, value, atomic_int16, CTypeEnumPointerShiftMap[atomic_int16])\r\n}\r\n\r\nexport let atomic_sub_i16 = function (p: pointer<atomic_int16>, value: int32) {\r\n  // @ts-ignore\r\n  return atomics.sub(p, value, atomic_int16, CTypeEnumPointerShiftMap[atomic_int16])\r\n}\r\n\r\nexport let atomic_and_i16 = function (p: pointer<atomic_int16>, value: int32) {\r\n  // @ts-ignore\r\n  return atomics.and(p, value,  atomic_int16, CTypeEnumPointerShiftMap[atomic_int16])\r\n}\r\n\r\nexport let atomic_or_i16 = function (p: pointer<atomic_int16>, value: int32) {\r\n  // @ts-ignore\r\n  return atomics.or(p, value,  atomic_int16, CTypeEnumPointerShiftMap[atomic_int16])\r\n}\r\n\r\nexport let atomic_xor_i16 = function (p: pointer<atomic_int16>, value: int32) {\r\n  // @ts-ignore\r\n  return atomics.xor(p, value,  atomic_int16, CTypeEnumPointerShiftMap[atomic_int16])\r\n}\r\n\r\nexport let atomic_store_i16 = function (p: pointer<atomic_int16>, value: int32) {\r\n  // @ts-ignore\r\n  return atomics.store(p, value,  atomic_int16, CTypeEnumPointerShiftMap[atomic_int16])\r\n}\r\n\r\nexport let atomic_load_i16 = function (p: pointer<atomic_int16>) {\r\n  // @ts-ignore\r\n  return atomics.load(p,  atomic_int16, CTypeEnumPointerShiftMap[atomic_int16])\r\n}\r\n\r\nexport let atomic_compare_exchange_i16 = function (p: pointer<atomic_int16>, expectedValue: int32, replacementValue: int32) {\r\n  // @ts-ignore\r\n  return atomics.compareExchange(p, expectedValue, replacementValue,  atomic_int16, CTypeEnumPointerShiftMap[atomic_int16])\r\n}\r\n\r\nexport let atomic_exchange_i16 = function (p: pointer<atomic_int16>, value: int32) {\r\n  // @ts-ignore\r\n  return atomics.exchange(p, value,  atomic_int16, CTypeEnumPointerShiftMap[atomic_int16])\r\n}\r\n\r\nexport let atomic_add_i32 = function (p: pointer<atomic_int32>, value: int32) {\r\n  // @ts-ignore\r\n  return atomics.add(p, value, atomic_int32, CTypeEnumPointerShiftMap[atomic_int32])\r\n}\r\n\r\nexport let atomic_sub_i32 = function (p: pointer<atomic_int32>, value: int32) {\r\n  // @ts-ignore\r\n  return atomics.sub(p, value, atomic_int32, CTypeEnumPointerShiftMap[atomic_int32])\r\n}\r\n\r\nexport let atomic_and_i32 = function (p: pointer<atomic_int32>, value: int32) {\r\n  // @ts-ignore\r\n  return atomics.and(p, value,  atomic_int32, CTypeEnumPointerShiftMap[atomic_int32])\r\n}\r\n\r\nexport let atomic_or_i32 = function (p: pointer<atomic_int32>, value: int32) {\r\n  // @ts-ignore\r\n  return atomics.or(p, value,  atomic_int32, CTypeEnumPointerShiftMap[atomic_int32])\r\n}\r\n\r\nexport let atomic_xor_i32 = function (p: pointer<atomic_int32>, value: int32) {\r\n  // @ts-ignore\r\n  return atomics.xor(p, value,  atomic_int32, CTypeEnumPointerShiftMap[atomic_int32])\r\n}\r\n\r\nexport let atomic_store_i32 = function (p: pointer<atomic_int32>, value: int32) {\r\n  // @ts-ignore\r\n  return atomics.store(p, value,  atomic_int32, CTypeEnumPointerShiftMap[atomic_int32])\r\n}\r\n\r\nexport let atomic_load_i32 = function (p: pointer<atomic_int32>) {\r\n  // @ts-ignore\r\n  return atomics.load(p,  atomic_int32, CTypeEnumPointerShiftMap[atomic_int32])\r\n}\r\n\r\nexport let atomic_compare_exchange_i32 = function (p: pointer<atomic_int32>, expectedValue: int32, replacementValue: int32) {\r\n  // @ts-ignore\r\n  return atomics.compareExchange(p, expectedValue, replacementValue,  atomic_int32, CTypeEnumPointerShiftMap[atomic_int32])\r\n}\r\n\r\nexport let atomic_exchange_i32 = function (p: pointer<atomic_int32>, value: int32) {\r\n  // @ts-ignore\r\n  return atomics.exchange(p, value,  atomic_int32, CTypeEnumPointerShiftMap[atomic_int32])\r\n}\r\n\r\n\r\n\r\nexport let atomic_add_i64 = function (p: pointer<atomic_int64>, value: int64) {\r\n  // @ts-ignore\r\n  return atomics.add(p, value, atomic_int64, CTypeEnumPointerShiftMap[atomic_int64])\r\n}\r\n\r\nexport let atomic_sub_i64 = function (p: pointer<atomic_int64>, value: int64) {\r\n  // @ts-ignore\r\n  return atomics.sub(p, value, atomic_int64, CTypeEnumPointerShiftMap[atomic_int64])\r\n}\r\n\r\nexport let atomic_and_i64 = function (p: pointer<atomic_int64>, value: int64) {\r\n  // @ts-ignore\r\n  return atomics.and(p, value, atomic_int64, CTypeEnumPointerShiftMap[atomic_int64])\r\n}\r\n\r\nexport let atomic_or_i64 = function (p: pointer<atomic_int64>, value: int64) {\r\n  // @ts-ignore\r\n  return atomics.or(p, value, atomic_int64, CTypeEnumPointerShiftMap[atomic_int64])\r\n}\r\n\r\nexport let atomic_xor_i64 = function (p: pointer<atomic_int64>, value: int64) {\r\n  // @ts-ignore\r\n  return atomics.xor(p, value, atomic_int64, CTypeEnumPointerShiftMap[atomic_int64])\r\n}\r\n\r\nexport let atomic_store_i64 = function (p: pointer<atomic_int64>, value: int64) {\r\n  // @ts-ignore\r\n  return atomics.store(p, value, atomic_int64, CTypeEnumPointerShiftMap[atomic_int64])\r\n}\r\n\r\nexport let atomic_load_i64 = function (p: pointer<atomic_int64>) {\r\n  // @ts-ignore\r\n  return atomics.load(p, atomic_int64, CTypeEnumPointerShiftMap[atomic_int64])\r\n}\r\n\r\nexport let atomic_compare_exchange_i64 = function (p: pointer<atomic_int64>, expectedValue: int64, replacementValue: int64) {\r\n  // @ts-ignore\r\n  return atomics.compareExchange(p, expectedValue, replacementValue, atomic_int64, CTypeEnumPointerShiftMap[atomic_int64])\r\n}\r\n\r\nexport let atomic_exchange_i64 = function (p: pointer<atomic_int64>, value: int64) {\r\n  // @ts-ignore\r\n  return atomics.exchange(p, value, atomic_int64, CTypeEnumPointerShiftMap[atomic_int64])\r\n}\r\n\r\nexport let atomics_notify = function (p: pointer<atomic_int32>, count: uint32) {\r\n  return atomics.notify(p, count)\r\n}\r\n\r\nexport let atomics_wait = function (p: pointer<atomic_int32>, value: int32) {\r\n  return atomics.wait(p, value)\r\n}\r\n\r\nexport let atomics_wait_timeout = function (p: pointer<atomic_int32>, value: int32, timeout: int64) {\r\n  return atomics.waitTimeout(p, value, static_cast<int32>(timeout))\r\n}\r\n\r\nexport function override(data: {\r\n  atomic_add_i8?: typeof atomic_add_i8\r\n  atomic_sub_i8?: typeof atomic_sub_i8\r\n  atomic_and_i8?: typeof atomic_and_i8\r\n  atomic_or_i8?: typeof atomic_or_i8\r\n  atomic_xor_i8?: typeof atomic_xor_i8\r\n  atomic_store_i8?: typeof atomic_store_i8\r\n  atomic_load_i8?: typeof atomic_load_i8\r\n  atomic_compare_exchange_i8?: typeof atomic_compare_exchange_i8\r\n  atomic_exchange_i8?: typeof atomic_exchange_i8\r\n  atomic_add_i16?: typeof atomic_add_i16\r\n  atomic_sub_i16?: typeof atomic_sub_i16\r\n  atomic_and_i16?: typeof atomic_and_i16\r\n  atomic_or_i16?: typeof atomic_or_i16\r\n  atomic_xor_i16?: typeof atomic_xor_i16\r\n  atomic_store_i16?: typeof atomic_store_i16\r\n  atomic_load_i16?: typeof atomic_load_i16\r\n  atomic_compare_exchange_i16?: typeof atomic_compare_exchange_i16\r\n  atomic_exchange_i16?: typeof atomic_exchange_i16\r\n  atomic_add_i32?: typeof atomic_add_i32\r\n  atomic_sub_i32?: typeof atomic_sub_i32\r\n  atomic_and_i32?: typeof atomic_and_i32\r\n  atomic_or_i32?: typeof atomic_or_i32\r\n  atomic_xor_i32?: typeof atomic_xor_i32\r\n  atomic_store_i32?: typeof atomic_store_i32\r\n  atomic_load_i32?: typeof atomic_load_i32\r\n  atomic_compare_exchange_i32?: typeof atomic_compare_exchange_i32\r\n  atomic_exchange_i32?: typeof atomic_exchange_i32\r\n  atomic_add_i64?: typeof atomic_add_i64\r\n  atomic_sub_i64?: typeof atomic_sub_i64\r\n  atomic_and_i64?: typeof atomic_and_i64\r\n  atomic_or_i64?: typeof atomic_or_i64\r\n  atomic_xor_i64?: typeof atomic_xor_i64\r\n  atomic_store_i64?: typeof atomic_store_i64\r\n  atomic_load_i64?: typeof atomic_load_i64\r\n  atomic_compare_exchange_i64?: typeof atomic_compare_exchange_i64\r\n  atomic_exchange_i64?: typeof atomic_exchange_i64\r\n  atomics_notify?: typeof atomics_notify\r\n  atomics_wait?: typeof atomics_wait\r\n  atomics_wait_timeout?: typeof atomics_wait_timeout\r\n}) {\r\n  if (data.atomic_add_i8) {\r\n    atomic_add_i8 = data.atomic_add_i8\r\n  }\r\n  if (data.atomic_sub_i8) {\r\n    atomic_sub_i8 = data.atomic_sub_i8\r\n  }\r\n  if (data.atomic_and_i8) {\r\n    atomic_and_i8 = data.atomic_and_i8\r\n  }\r\n  if (data.atomic_or_i8) {\r\n    atomic_or_i8 = data.atomic_or_i8\r\n  }\r\n  if (data.atomic_xor_i8) {\r\n    atomic_xor_i8 = data.atomic_xor_i8\r\n  }\r\n  if (data.atomic_store_i8) {\r\n    atomic_store_i8 = data.atomic_store_i8\r\n  }\r\n  if (data.atomic_load_i8) {\r\n    atomic_load_i8 = data.atomic_load_i8\r\n  }\r\n  if (data.atomic_compare_exchange_i8) {\r\n    atomic_compare_exchange_i8 = data.atomic_compare_exchange_i8\r\n  }\r\n  if (data.atomic_exchange_i8) {\r\n    atomic_exchange_i8 = data.atomic_exchange_i8\r\n  }\r\n\r\n  if (data.atomic_add_i16) {\r\n    atomic_add_i16 = data.atomic_add_i16\r\n  }\r\n  if (data.atomic_sub_i16) {\r\n    atomic_sub_i16 = data.atomic_sub_i16\r\n  }\r\n  if (data.atomic_and_i16) {\r\n    atomic_and_i16 = data.atomic_and_i16\r\n  }\r\n  if (data.atomic_or_i16) {\r\n    atomic_or_i16 = data.atomic_or_i16\r\n  }\r\n  if (data.atomic_xor_i16) {\r\n    atomic_xor_i16 = data.atomic_xor_i16\r\n  }\r\n  if (data.atomic_store_i16) {\r\n    atomic_store_i16 = data.atomic_store_i16\r\n  }\r\n  if (data.atomic_load_i16) {\r\n    atomic_load_i16 = data.atomic_load_i16\r\n  }\r\n  if (data.atomic_compare_exchange_i16) {\r\n    atomic_compare_exchange_i16 = data.atomic_compare_exchange_i16\r\n  }\r\n  if (data.atomic_exchange_i16) {\r\n    atomic_exchange_i16 = data.atomic_exchange_i16\r\n  }\r\n\r\n  if (data.atomic_add_i32) {\r\n    atomic_add_i32 = data.atomic_add_i32\r\n  }\r\n  if (data.atomic_sub_i32) {\r\n    atomic_sub_i32 = data.atomic_sub_i32\r\n  }\r\n  if (data.atomic_and_i32) {\r\n    atomic_and_i32 = data.atomic_and_i32\r\n  }\r\n  if (data.atomic_or_i32) {\r\n    atomic_or_i32 = data.atomic_or_i32\r\n  }\r\n  if (data.atomic_xor_i32) {\r\n    atomic_xor_i32 = data.atomic_xor_i32\r\n  }\r\n  if (data.atomic_store_i32) {\r\n    atomic_store_i32 = data.atomic_store_i32\r\n  }\r\n  if (data.atomic_load_i32) {\r\n    atomic_load_i32 = data.atomic_load_i32\r\n  }\r\n  if (data.atomic_compare_exchange_i32) {\r\n    atomic_compare_exchange_i32 = data.atomic_compare_exchange_i32\r\n  }\r\n  if (data.atomic_exchange_i32) {\r\n    atomic_exchange_i32 = data.atomic_exchange_i32\r\n  }\r\n\r\n  if (data.atomic_add_i64) {\r\n    atomic_add_i64 = data.atomic_add_i64\r\n  }\r\n  if (data.atomic_sub_i64) {\r\n    atomic_sub_i64 = data.atomic_sub_i64\r\n  }\r\n  if (data.atomic_and_i64) {\r\n    atomic_and_i64 = data.atomic_and_i64\r\n  }\r\n  if (data.atomic_or_i64) {\r\n    atomic_or_i64 = data.atomic_or_i64\r\n  }\r\n  if (data.atomic_xor_i64) {\r\n    atomic_xor_i64 = data.atomic_xor_i64\r\n  }\r\n  if (data.atomic_store_i64) {\r\n    atomic_store_i64 = data.atomic_store_i64\r\n  }\r\n  if (data.atomic_load_i64) {\r\n    atomic_load_i64 = data.atomic_load_i64\r\n  }\r\n  if (data.atomic_compare_exchange_i64) {\r\n    atomic_compare_exchange_i64 = data.atomic_compare_exchange_i64\r\n  }\r\n  if (data.atomic_exchange_i64) {\r\n    atomic_exchange_i64 = data.atomic_exchange_i64\r\n  }\r\n\r\n  if (data.atomics_notify) {\r\n    atomics_notify = data.atomics_notify\r\n  }\r\n  if (data.atomics_wait) {\r\n    atomics_wait = data.atomics_wait\r\n  }\r\n  if (data.atomics_wait_timeout) {\r\n    atomics_wait_timeout = data.atomics_wait_timeout\r\n  }\r\n}\r\n","/* eslint-disable camelcase */\r\n\r\nimport { mapUint8Array } from '../../std/memory'\r\nimport * as text from 'common/util/text'\r\n\r\nconst buffers = [null, [], []]\r\n\r\nconst WASI_ERRNO_SUCCESS = 0\r\nconst WASI_ERRNO_NOSYS = 52\r\nconst WASI_ERRNO_INVAL = 28\r\n\r\nexport function printChar(stream: uint32, curr: char) {\r\n  const buffer = buffers[stream]\r\n  if (curr === 0 || curr === 10) {\r\n    (stream === 1 ? console.log.bind(console) : console.log.bind(console))(text.decode(buffer))\r\n    buffer.length = 0\r\n  }\r\n  else {\r\n    buffer.push(curr)\r\n  }\r\n}\r\n\r\nexport function writeAsciiToMemory(str: string, buffer: pointer<char>, doNotAddNull?: boolean) {\r\n  for (let i = 0; i < str.length; ++i) {\r\n    accessof(buffer) <- static_cast<char>(str.charCodeAt(i))\r\n    buffer++\r\n  }\r\n  if (!doNotAddNull) {\r\n    accessof(buffer) <- static_cast<char>(0)\r\n  }\r\n}\r\n\r\nconst ENV = {}\r\nlet thisProgram: string = './this.program'\r\nlet getEnvStringsStrings: string[]\r\n\r\nfunction getExecutableName() {\r\n  return thisProgram || './this.program'\r\n}\r\n\r\nfunction getEnvStrings() {\r\n  if (!getEnvStringsStrings) {\r\n    const lang = (typeof navigator === 'object' && navigator.languages && navigator.languages[0] || 'C').replace('-', '_') + '.UTF-8'\r\n    const env = {\r\n      'USER': 'web_user',\r\n      'LOGNAME': 'web_user',\r\n      'PATH': '/',\r\n      'PWD': '/',\r\n      'HOME': '/home/web_user',\r\n      'LANG': lang,\r\n      '_': getExecutableName()\r\n    }\r\n    for (let x in ENV) {\r\n      env[x] = ENV[x]\r\n    }\r\n    const strings = []\r\n    for (let x in env) {\r\n      strings.push(x + '=' + env[x])\r\n    }\r\n    getEnvStringsStrings = strings\r\n  }\r\n  return getEnvStringsStrings\r\n}\r\n\r\nexport function environ_get(environ: pointer<uint32>, environBuf: pointer<uint8>) {\r\n  let bufSize = 0\r\n  getEnvStrings().forEach(function (string: string, i: number) {\r\n\r\n    const ptr: pointer<uint8> = reinterpret_cast<pointer<uint8>>(environBuf + bufSize)\r\n\r\n    accessof(reinterpret_cast<pointer<uint32>>(environ + i)) <- reinterpret_cast<uint32>(ptr)\r\n\r\n    writeAsciiToMemory(string, reinterpret_cast<pointer<char>>(ptr))\r\n\r\n    bufSize += string.length + 1\r\n  })\r\n  return 0\r\n}\r\n\r\nexport function environ_sizes_get(penvironCount: pointer<uint32>, penvironBufSize: pointer<uint32>) {\r\n  const strings = getEnvStrings()\r\n\r\n  accessof(penvironCount) <- static_cast<uint32>(strings.length)\r\n\r\n  let bufSize = 0\r\n  strings.forEach(function (string) {\r\n    bufSize += string.length + 1\r\n  })\r\n\r\n  accessof(penvironBufSize) <- static_cast<uint32>(bufSize)\r\n\r\n  return 0\r\n}\r\n\r\n\r\nexport function fd_fdstat_get(fd: uint32, pBuf: pointer<void>) {\r\n  let rightsBase = 0\r\n  if (fd == 0) {\r\n    rightsBase = 2\r\n  }\r\n  else if (fd == 1 || fd == 2) {\r\n    rightsBase = 64\r\n  }\r\n  accessof(reinterpret_cast<pointer<int8>>(pBuf)) <- static_cast<int8>(2)\r\n  accessof(reinterpret_cast<pointer<int16>>(pBuf + 2)) <- static_cast<int16>(1)\r\n  accessof(reinterpret_cast<pointer<int32>>(pBuf + 8)) <- static_cast<int32>(rightsBase)\r\n  accessof(reinterpret_cast<pointer<int32>>(pBuf + 12)) <- static_cast<int32>(0)\r\n  accessof(reinterpret_cast<pointer<int64>>(pBuf + 16)) <- static_cast<int64>(0n)\r\n\r\n  return WASI_ERRNO_SUCCESS\r\n}\r\n\r\nexport function fd_read(fd: uint32, iov: pointer<uint32>, iovCnt: uint32, pNum: pointer<uint32>) {\r\n  return WASI_ERRNO_NOSYS\r\n}\r\n\r\nexport function fd_seek(fd: uint32, offsetLow: uint32, offsetHigh: uint32, whence: pointer<uint32>, newOffset: uint32) {\r\n  return WASI_ERRNO_NOSYS\r\n}\r\n\r\nexport function fd_write(fd: uint32, iov: pointer<uint32>, iovCnt: uint32, pNum: pointer<uint32>) {\r\n  let num = 0\r\n  for (let i = 0; i < iovCnt; i++) {\r\n    let ptr = reinterpret_cast<pointer<char>>(accessof(iov))\r\n    let len = accessof(reinterpret_cast<pointer<uint32>>(iov + 1))\r\n    iov = reinterpret_cast<pointer<uint32>>(iov + 2)\r\n    for (let j = 0; j < len; j++) {\r\n      printChar(fd, accessof(reinterpret_cast<pointer<char>>(ptr + j)))\r\n    }\r\n    num += len\r\n  }\r\n\r\n  accessof(pNum) <- static_cast<uint32>(num)\r\n\r\n  return WASI_ERRNO_SUCCESS\r\n}\r\n\r\nexport function fd_close(fd: uint32) {\r\n  return WASI_ERRNO_NOSYS\r\n}\r\n\r\nexport function abort(what?: string) {\r\n  what += ''\r\n  what = `abort(${what}). Build with -s ASSERTIONS=1 for more info.`\r\n  throw new WebAssembly.RuntimeError(what)\r\n}\r\n\r\nexport function clock_time_get(id: uint32, precision: int32, timeOut: pointer<uint64>) {\r\n  if (id !== 0) {\r\n    return WASI_ERRNO_INVAL\r\n  }\r\n\r\n  const now = new Date().getTime()\r\n\r\n  accessof(timeOut) <- reinterpret_cast<uint64>(static_cast<uint64>(now as uint32) * 1000000n)\r\n\r\n  return WASI_ERRNO_SUCCESS\r\n}\r\n\r\nexport function clock_res_get(id: uint32, resOut: pointer<uint64>) {\r\n  if (id !== 0) {\r\n    return WASI_ERRNO_INVAL\r\n  }\r\n\r\n  accessof(resOut) <- static_cast<uint64>(1000000n)\r\n\r\n  return WASI_ERRNO_SUCCESS\r\n}\r\n\r\nexport function random_get(pointer: pointer<uint8>, size: size) {\r\n  const buffer = mapUint8Array(pointer, size)\r\n  if (defined(ENV_NODE)) {\r\n    const crypto = require('crypto')\r\n    crypto.randomFillSync(buffer)\r\n  }\r\n  else {\r\n    crypto.getRandomValues(buffer)\r\n  }\r\n  return WASI_ERRNO_SUCCESS\r\n}\r\n","/* eslint-disable camelcase */\r\n\r\nimport * as mutexUtils from '../../thread/mutex'\r\nimport * as condUtils from '../../thread/cond'\r\nimport * as config from '../../config'\r\n\r\nimport { Table } from '../../heap'\r\nimport * as atomics from '../../thread/atomics'\r\nimport { SELF } from 'common/util/constant'\r\nimport { Mutex } from '../../thread/mutex'\r\nimport { Cond } from '../../thread/cond'\r\nimport { Timespec } from './semaphore'\r\nimport { Pthread, PthreadFlags, PthreadOnce } from '../thread'\r\nimport { readCString } from '../../std/memory'\r\n\r\nexport let wasm_pthread_mutex_init: (mutex: pointer<Mutex>, attr: pointer<void>) => int32\r\n\r\nexport let wasm_pthread_mutex_destroy: (mutex: pointer<Mutex>) => int32\r\n\r\nexport let wasm_pthread_mutex_lock: (mutex: pointer<Mutex>) => int32\r\n\r\nexport let wasm_pthread_mutex_trylock: (mutex: pointer<Mutex>) => int32\r\n\r\nexport let wasm_pthread_mutex_unlock: (mutex: pointer<Mutex>) => int32\r\n\r\nexport let wasm_pthread_cond_init: (cond: pointer<Cond>, attr: pointer<void>) => int32\r\n\r\nexport let wasm_pthread_cond_destroy: (cond: pointer<Cond>) => int32\r\n\r\nexport let wasm_pthread_cond_wait: (cond: pointer<Cond>, mutex: pointer<Mutex>) => int32\r\n\r\nexport let wasm_pthread_cond_timedwait: (cond: pointer<Cond>, mutex: pointer<Mutex>, abstime: pointer<Timespec>) => int32\r\n\r\nexport let wasm_pthread_cond_signal: (cond: pointer<Cond>) => int32\r\n\r\nexport let wasm_pthread_cond_broadcast: (cond: pointer<Cond>) => int32\r\n\r\nexport let wasm_pthread_once: (control: pointer<PthreadOnce>, func: pointer<() => void>) => int32\r\n\r\nexport function wasm_pthread_self2(): pointer<Pthread> {\r\n  return SELF.__SELF_THREAD__ as pointer<Pthread>\r\n}\r\n\r\nexport function wasm_pthread_exit(retval: pointer<void>) {\r\n  const thread: pointer<Pthread> = SELF.__SELF_THREAD__\r\n  thread.retval = retval\r\n  thread.flags |= PthreadFlags.EXIT\r\n}\r\n\r\nexport function wasm_pthread_equal2(t1: pointer<Pthread>, t2: pointer<Pthread>) {\r\n  return t1.id === t2.id ? 1 : 0\r\n}\r\n\r\nexport function wasm_pthread_support() {\r\n  return config.USE_THREADS ? 1 : 0\r\n}\r\n\r\nexport function wasm_cpu_core_count() {\r\n  return navigator.hardwareConcurrency\r\n}\r\n\r\nexport function wasm_threw_error(code: int32, msg: pointer<char>) {\r\n  throw new Error(readCString(msg))\r\n}\r\n\r\nwasm_pthread_mutex_init = function (mutex: pointer<Mutex>, attr: pointer<void>) {\r\n  return mutexUtils.init(mutex)\r\n}\r\n\r\nwasm_pthread_mutex_destroy = function (mutex: pointer<Mutex>) {\r\n  return mutexUtils.destroy(mutex)\r\n}\r\n\r\nwasm_pthread_mutex_lock = function (mutex: pointer<Mutex>) {\r\n  return mutexUtils.lock(mutex)\r\n}\r\n\r\nwasm_pthread_mutex_trylock = function (mutex: pointer<Mutex>) {\r\n  return mutexUtils.tryLock(mutex)\r\n}\r\n\r\nwasm_pthread_mutex_unlock = function (mutex: pointer<Mutex>) {\r\n  return mutexUtils.unlock(mutex)\r\n}\r\n\r\nwasm_pthread_cond_init = function (cond: pointer<Cond>, attr: pointer<void>) {\r\n  return condUtils.init(cond, attr)\r\n}\r\n\r\nwasm_pthread_cond_destroy = function (cond: pointer<Cond>) {\r\n  return condUtils.destroy(cond)\r\n}\r\n\r\nwasm_pthread_cond_wait = function (cond: pointer<Cond>, mutex: pointer<Mutex>) {\r\n  return condUtils.wait(cond, mutex)\r\n}\r\n\r\nwasm_pthread_cond_timedwait = function (cond: pointer<Cond>, mutex: pointer<Mutex>, abstime: pointer<Timespec>) {\r\n  let timeout = Number(abstime.tvSec) * 1000 + abstime.tvNSec / 1000000\r\n  return condUtils.timedWait(cond, mutex, timeout)\r\n}\r\n\r\nwasm_pthread_cond_signal = function (cond: pointer<Cond>) {\r\n  return condUtils.signal(cond)\r\n}\r\n\r\nwasm_pthread_cond_broadcast = function (cond: pointer<Cond>) {\r\n  return condUtils.broadcast(cond)\r\n}\r\n\r\nwasm_pthread_once = function (control: pointer<PthreadOnce>, func: pointer<() => void>) {\r\n  if (atomics.add(addressof(control.atomic), 1) === 0) {\r\n    Table.get(func)()\r\n  }\r\n  return 0\r\n}\r\n\r\nexport function override(data: {\r\n  wasm_pthread_mutex_lock?: (mutex: pointer<Mutex>) => int32,\r\n  wasm_pthread_mutex_trylock?: (mutex: pointer<Mutex>) => int32,\r\n  wasm_pthread_mutex_unlock?: (mutex: pointer<Mutex>) => int32,\r\n  wasm_pthread_cond_wait?: (cond: pointer<Cond>, mutex: pointer<Mutex>) => int32,\r\n  wasm_pthread_cond_timedwait?: (cond: pointer<Cond>, mutex: pointer<Mutex>, abstime: pointer<Timespec>) => int32,\r\n  wasm_pthread_cond_signal?: (cond: pointer<Cond>) => int32,\r\n  wasm_pthread_cond_broadcast?: (cond: pointer<Cond>) => int32\r\n}) {\r\n  if (data.wasm_pthread_mutex_lock) {\r\n    wasm_pthread_mutex_lock = data.wasm_pthread_mutex_lock\r\n  }\r\n  if (data.wasm_pthread_mutex_trylock) {\r\n    wasm_pthread_mutex_trylock = data.wasm_pthread_mutex_trylock\r\n  }\r\n  if (data.wasm_pthread_mutex_unlock) {\r\n    wasm_pthread_mutex_unlock = data.wasm_pthread_mutex_unlock\r\n  }\r\n  if (data.wasm_pthread_cond_wait) {\r\n    wasm_pthread_cond_wait = data.wasm_pthread_cond_wait\r\n  }\r\n  if (data.wasm_pthread_cond_timedwait) {\r\n    wasm_pthread_cond_timedwait = data.wasm_pthread_cond_timedwait\r\n  }\r\n  if (data.wasm_pthread_cond_signal) {\r\n    wasm_pthread_cond_signal = data.wasm_pthread_cond_signal\r\n  }\r\n  if (data.wasm_pthread_cond_broadcast) {\r\n    wasm_pthread_cond_broadcast = data.wasm_pthread_cond_broadcast\r\n  }\r\n}\r\n","/* eslint-disable camelcase */\r\n\r\nimport * as semUtils from '../../thread/semaphore'\r\nimport { Sem } from '../../thread/semaphore'\r\n\r\n@struct\r\nexport class Timespec {\r\n  tvSec: int64\r\n  tvNSec: int32\r\n}\r\n\r\n\r\nexport function wasm_sem_init(sem: pointer<Sem>, pshared: int32, value: uint32) {\r\n  return semUtils.init(sem, value)\r\n}\r\n\r\nexport function wasm_sem_destroy(sem: pointer<Sem>) {\r\n  return semUtils.destroy(sem)\r\n}\r\n\r\nexport function wasm_sem_wait(sem: pointer<Sem>) {\r\n  return semUtils.wait(sem)\r\n}\r\n\r\nexport function wasm_sem_trywait(sem: pointer<Sem>) {\r\n  return semUtils.tryWait(sem)\r\n}\r\n\r\nexport function wasm_sem_timedwait(sem: pointer<Sem>, abstime: pointer<Timespec>) {\r\n  let timeout = Number(abstime.tvSec) * 1000 + abstime.tvNSec / 1000000\r\n  return semUtils.timedWait(sem, timeout)\r\n}\r\n\r\nexport function wasm_sem_post(sem: pointer<Sem>) {\r\n  return semUtils.post(sem)\r\n}\r\n","import { Cond } from '../thread/cond'\r\nimport { Mutex } from '../thread/mutex'\r\n\r\n@struct\r\nexport class PthreadOnce {\r\n  atomic: atomic_int32\r\n}\r\n\r\n@struct\r\nexport class Pthread {\r\n  id: int32\r\n  retval: pointer<void>\r\n  flags: int32\r\n  status: atomic_int32\r\n}\r\n\r\n@struct\r\nexport class ThreadDescriptor {\r\n  flags: int32\r\n  status: PthreadStatus\r\n}\r\n\r\nexport const enum PthreadFlags {\r\n  DETACH = 1,\r\n  POOL = 2,\r\n  EXIT = 4\r\n}\r\n\r\nexport const enum PthreadStatus {\r\n  STOP,\r\n  RUN\r\n}\r\n\r\nexport type ChildThread = {\r\n  thread: pointer<Pthread>\r\n  worker: Worker\r\n  stackPointer: uint32\r\n  threadDescriptor: pointer<ThreadDescriptor>\r\n}\r\n\r\n@struct\r\nexport class ThreadWait {\r\n  thread: pointer<Pthread>\r\n  func: pointer<(args: pointer<void>) => void>\r\n  args: pointer<void>\r\n  cond: Cond\r\n  mutex: Mutex\r\n}\r\n","/**\r\n * https://github.com/yoxjs/yox-common/blob/master/src/util/CustomEvent.ts\r\n * MIT License\r\n * \r\n * @file 事件\r\n */\r\n\r\nimport * as constant from '../util/constant'\r\nimport { CustomEventInterface } from '../types/type'\r\n\r\nexport default class CustomEvent implements CustomEventInterface {\r\n\r\n  public static PHASE_CURRENT = 0\r\n\r\n  public static PHASE_UPWARD = 1\r\n\r\n  public static PHASE_DOWNWARD = constant.MINUS_ONE\r\n\r\n  // 事件名称\r\n  type: string\r\n\r\n  // 事件当前阶段\r\n  phase: number\r\n\r\n  // 事件命名空间\r\n  ns?: string\r\n\r\n  // 哪个组件发出的事件\r\n  target?: any\r\n\r\n  // 原始事件，比如 DOM 事件\r\n  originalEvent?: CustomEventInterface | Event\r\n\r\n  // 是否已阻止事件的默认行为\r\n  isPrevented?: true\r\n\r\n  // 是否已停止事件冒泡\r\n  isStopped?: true\r\n\r\n  // 处理当前事件的监听器，方便外部获取 listener 进行解绑\r\n  listener?: Function\r\n\r\n  /**\r\n   * 构造函数\r\n   *\r\n   * 可以传事件名称，也可以传原生事件对象\r\n   */\r\n  constructor(type: string, originalEvent?: CustomEventInterface | Event) {\r\n    /*\r\n     * 这里不设置命名空间\r\n     * 因为有没有命名空间取决于 Emitter 的构造函数有没有传 true\r\n     * CustomEvent 自己无法决定\r\n     */\r\n    this.type = type\r\n    this.phase = CustomEvent.PHASE_CURRENT\r\n    if (originalEvent) {\r\n      this.originalEvent = originalEvent\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 阻止事件的默认行为\r\n   */\r\n  preventDefault(): this {\r\n    const instance = this\r\n    if (!instance.isPrevented) {\r\n      const { originalEvent } = instance\r\n      if (originalEvent) {\r\n        originalEvent.preventDefault()\r\n      }\r\n      instance.isPrevented = constant.TRUE\r\n    }\r\n    return instance\r\n  }\r\n\r\n  /**\r\n   * 停止事件广播\r\n   */\r\n  stopPropagation(): this {\r\n    const instance = this\r\n    if (!instance.isStopped) {\r\n      const { originalEvent } = instance\r\n      if (originalEvent) {\r\n        originalEvent.stopPropagation()\r\n      }\r\n      instance.isStopped = constant.TRUE\r\n    }\r\n    return instance\r\n  }\r\n\r\n  prevent(): this {\r\n    return this.preventDefault()\r\n  }\r\n\r\n  stop(): this {\r\n    return this.stopPropagation()\r\n  }\r\n\r\n}\r\n","/**\r\n * https://github.com/yoxjs/yox-common/blob/master/src/util/Emitter.ts\r\n * MIT License\r\n * \r\n * @file 事件代理\r\n */\r\n\r\nimport * as is from '../util/is'\r\nimport * as array from '../util/array'\r\nimport CustomEvent from './CustomEvent'\r\nimport * as object from '../util/object'\r\nimport * as string from '../util/string'\r\nimport * as logger from '../util/logger'\r\nimport execute from '../function/execute'\r\nimport * as constant from '../util/constant'\r\nimport { NativeListener, Fn, Task } from '../types/type'\r\n\r\nexport interface EmitterOptions extends Task {\r\n\r\n  // 所在的命名空间\r\n  ns?: string\r\n\r\n  // 监听函数已执行次数\r\n  num?: number\r\n\r\n  // 监听函数的最大可执行次数\r\n  max?: number\r\n\r\n  // 计数器，用于扩展，随便做什么计数都行\r\n  count?: number\r\n\r\n}\r\n\r\n\r\ntype Namespace = {\r\n\r\n  // 事件名称\r\n  type: string\r\n\r\n  // 命名空间\r\n  ns?: string\r\n\r\n}\r\n\r\nexport default class Emitter {\r\n\r\n  /**\r\n   * 是否开启命名空间\r\n   */\r\n  ns: boolean\r\n\r\n  /**\r\n   * 已注册的事件监听\r\n   */\r\n  listeners: Record<string, EmitterOptions[]>\r\n\r\n  /**\r\n   * 原生事件监听，一个事件对应一个 listener\r\n   */\r\n  nativeListeners?: Record<string, NativeListener>\r\n\r\n  constructor(ns?: boolean) {\r\n    this.ns = ns || constant.FALSE\r\n    this.listeners = {}\r\n  }\r\n\r\n  /**\r\n   * 发射事件\r\n   *\r\n   * @param type 事件名称或命名空间\r\n   * @param args 事件处理函数的参数列表\r\n   * @param filter 自定义过滤器\r\n   */\r\n  fire(\r\n    type: string | Namespace,\r\n    args: any[] | void,\r\n    filter?: (\r\n      namespace: Namespace,\r\n      args: any[] | void,\r\n      options: EmitterOptions\r\n    ) => boolean | void\r\n  ): boolean {\r\n\r\n    let instance = this,\r\n\r\n        namespace = is.string(type) ? instance.parse(type as string) : type as Namespace,\r\n\r\n        list = instance.listeners[namespace.type],\r\n\r\n        isComplete = constant.TRUE\r\n\r\n    if (list) {\r\n\r\n      // 避免遍历过程中，数组发生变化，比如增删了\r\n      list = object.copy(list)\r\n\r\n      /*\r\n       * 判断是否是发射事件\r\n       * 如果 args 的第一个参数是 CustomEvent 类型，表示发射事件\r\n       * 因为事件处理函数的参数列表是 (event, data)\r\n       */\r\n      const event = args && args[0] instanceof CustomEvent\r\n        ? args[0] as CustomEvent\r\n        : constant.UNDEFINED\r\n\r\n      array.each(\r\n        list,\r\n        function (options) {\r\n\r\n          // 命名空间不匹配\r\n          if (!matchNamespace(namespace.ns, options, constant.TRUE)\r\n                        // 在 fire 过程中被移除了\r\n                        || !array.has(list, options)\r\n                        // 传了 filter，则用 filter 判断是否过滤此 options\r\n                        || (filter && !filter(namespace, args, options))\r\n          ) {\r\n            return\r\n          }\r\n\r\n          /*\r\n           * 为 event 对象加上当前正在处理的 listener\r\n           * 这样方便业务层移除事件绑定\r\n           * 比如 on('xx', function) 这样定义了匿名 listener\r\n           * 在这个 listener 里面获取不到当前 listener 的引用\r\n           * 为了能引用到，有时候会先定义 var listener = function\r\n           * 然后再 on('xx', listener) 这样其实是没有必要的\r\n           */\r\n          if (event) {\r\n            event.listener = options.fn\r\n          }\r\n\r\n          let result = execute(options.fn, options.ctx, args)\r\n\r\n          if (event) {\r\n            event.listener = constant.UNDEFINED\r\n          }\r\n\r\n          // 执行次数\r\n          options.num = options.num ? (options.num + 1) : 1\r\n\r\n          // 注册的 listener 可以指定最大执行次数\r\n          if (options.num === options.max) {\r\n            instance.off(namespace, options.fn)\r\n          }\r\n\r\n          // 如果没有返回 false，而是调用了 event.stop 也算是返回 false\r\n          if (event) {\r\n            if (result === constant.FALSE) {\r\n              event.prevent().stop()\r\n            }\r\n            else if (event.isStopped) {\r\n              result = constant.FALSE\r\n            }\r\n          }\r\n\r\n          if (result === constant.FALSE) {\r\n            return isComplete = constant.FALSE\r\n          }\r\n        }\r\n      )\r\n\r\n    }\r\n\r\n    return isComplete\r\n\r\n  }\r\n\r\n  /**\r\n   * 注册监听\r\n   *\r\n   * @param type\r\n   * @param listener\r\n   */\r\n  on(\r\n    type: string | Namespace,\r\n    listener: Function | EmitterOptions\r\n  ): Emitter {\r\n\r\n    const instance = this,\r\n\r\n        listeners = instance.listeners,\r\n\r\n        options: EmitterOptions = is.func(listener)\r\n          ? { fn: listener as Fn }\r\n          : listener as EmitterOptions\r\n\r\n    if (is.object(options) && is.func(options.fn)) {\r\n      const namespace = is.string(type) ? instance.parse(type as string) : type as Namespace\r\n      options.ns = namespace.ns\r\n      array.push(\r\n        listeners[namespace.type] || (listeners[namespace.type] = []),\r\n        options\r\n      )\r\n    }\r\n    else if (process.env.NODE_ENV === 'development') {\r\n      logger.fatal('emitter.on(type, listener) invoke failed：\\n\\n\"listener\" is expected to be a Function or an EmitterOptions.\\n')\r\n    }\r\n\r\n    return this\r\n  }\r\n\r\n  one(\r\n    type: string | Namespace,\r\n    listener: Function | EmitterOptions\r\n  ): Emitter {\r\n    if (is.func(listener)) {\r\n      listener = {\r\n        fn: listener as Fn,\r\n        max: 1\r\n      }\r\n    }\r\n    else {\r\n      listener.max = 1\r\n    }\r\n    return this.on(type, listener)\r\n  }\r\n\r\n  /**\r\n   * 取消监听\r\n   *\r\n   * @param type\r\n   * @param listener\r\n   */\r\n  off(\r\n    type?: string | Namespace,\r\n    listener?: Function\r\n  ): void {\r\n\r\n    const instance = this,\r\n\r\n        listeners = instance.listeners\r\n\r\n    if (type) {\r\n\r\n      const namespace = is.string(type) ? instance.parse(type as string) : type as Namespace,\r\n\r\n          name = namespace.type,\r\n\r\n          ns = namespace.ns,\r\n\r\n          matchListener = createMatchListener(listener),\r\n\r\n          each = function (list: EmitterOptions[], name: string) {\r\n            array.each(\r\n              list,\r\n              function (options, index) {\r\n                if (matchListener(options)) {\r\n                  list.splice(index, 1)\r\n                }\r\n              },\r\n              constant.TRUE\r\n            )\r\n            if (!list.length) {\r\n              delete listeners[name]\r\n            }\r\n          },\r\n\r\n          eachNS = function (list: EmitterOptions[], name: string) {\r\n            array.each(\r\n              list,\r\n              function (options, index) {\r\n                if (matchNamespace(ns, options)) {\r\n                  list.splice(index, 1)\r\n                }\r\n              },\r\n              constant.TRUE\r\n            )\r\n            if (!list.length) {\r\n              delete listeners[name]\r\n            }\r\n          }\r\n\r\n      if (name) {\r\n        if (listeners[name]) {\r\n          each(listeners[name], name)\r\n        }\r\n      }\r\n      else if (ns) {\r\n        object.each(listeners, eachNS)\r\n      }\r\n\r\n      /*\r\n       * 在开发阶段进行警告，比如传了 listener 进来，listener 是个空值\r\n       * 但你不知道它是空值\r\n       */\r\n      if (process.env.NODE_ENV === 'development') {\r\n        if (arguments.length > 1 && listener == constant.NULL) {\r\n          logger.warn(`emitter.off(type, listener) is invoked, but \"listener\" is ${listener}.`)\r\n        }\r\n      }\r\n\r\n    }\r\n    else {\r\n      // 清空\r\n      instance.listeners = {}\r\n      /*\r\n       * 在开发阶段进行警告，比如传了 type 进来，type 是个空值\r\n       * 但你不知道它是空值\r\n       */\r\n      if (process.env.NODE_ENV === 'development') {\r\n        if (arguments.length > 0) {\r\n          logger.warn(`emitter.off(type) is invoked, but \"type\" is ${type}.`)\r\n        }\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * 是否已监听某个事件\r\n   *\r\n   * @param type\r\n   * @param listener\r\n   */\r\n  has(\r\n    type: string | Namespace,\r\n    listener?: Function\r\n  ): boolean {\r\n\r\n    let instance = this,\r\n\r\n        listeners = instance.listeners,\r\n\r\n        namespace = is.string(type) ? instance.parse(type as string) : type as Namespace,\r\n\r\n        name = namespace.type,\r\n\r\n        ns = namespace.ns,\r\n\r\n        result = constant.TRUE,\r\n\r\n        matchListener = createMatchListener(listener),\r\n\r\n        each = function (list: EmitterOptions[]) {\r\n          array.each(\r\n            list,\r\n            function (options) {\r\n              if (matchListener(options)) {\r\n                return result = constant.FALSE\r\n              }\r\n            }\r\n          )\r\n          return result\r\n        },\r\n\r\n        eachNS = function (list: EmitterOptions[]) {\r\n          array.each(\r\n            list,\r\n            function (options) {\r\n              if (matchNamespace(ns, options)) {\r\n                return result = constant.FALSE\r\n              }\r\n            }\r\n          )\r\n          return result\r\n        }\r\n\r\n    if (name) {\r\n      if (listeners[name]) {\r\n        each(listeners[name])\r\n      }\r\n    }\r\n    else if (ns) {\r\n      object.each(listeners, eachNS)\r\n    }\r\n\r\n    return !result\r\n\r\n  }\r\n\r\n  /**\r\n   * 把事件类型解析成命名空间格式\r\n   *\r\n   * @param type\r\n   */\r\n  parse(type: string): Namespace {\r\n\r\n    /*\r\n     * 这里 ns 必须为字符串\r\n     * 用于区分 event 对象是否已完成命名空间的解析\r\n     */\r\n    const result = {\r\n      type,\r\n      ns: constant.EMPTY_STRING,\r\n    }\r\n\r\n    // 是否开启命名空间\r\n    if (this.ns) {\r\n      const index = string.indexOf(type, constant.RAW_DOT)\r\n      if (index >= 0) {\r\n        result.type = string.slice(type, 0, index)\r\n        result.ns = string.slice(type, index + 1)\r\n      }\r\n    }\r\n\r\n    return result\r\n\r\n  }\r\n\r\n}\r\n\r\nfunction matchTrue() {\r\n  return constant.TRUE\r\n}\r\n\r\n/**\r\n * 外部会传入 Function 或 EmitterOptions 或 空\r\n *\r\n * 这里根据传入值的不同类型，创建不同的判断函数\r\n *\r\n * 如果传入的是 EmitterOptions，则全等判断\r\n *\r\n * 如果传入的是 Function，则判断函数是否全等\r\n *\r\n * 如果传入的是空，则直接返回 true\r\n *\r\n * @param listener\r\n */\r\nfunction createMatchListener(listener: Function | void): (options: EmitterOptions) => boolean {\r\n  return is.func(listener)\r\n    ? function (options: EmitterOptions) {\r\n      return listener === options.fn\r\n    }\r\n    : matchTrue\r\n}\r\n\r\n/**\r\n * 判断 options 是否能匹配命名空间\r\n *\r\n * 如果 namespace 和 options.ns 都不为空，则需完全匹配\r\n *\r\n * 如果他们两个其中任何一个为空，则不判断命名空间\r\n *\r\n * @param namespace\r\n * @param options\r\n */\r\nfunction matchNamespace(namespace: string | void, options: EmitterOptions, isFire?: boolean): boolean {\r\n  const { ns } = options\r\n  return ns && namespace\r\n    ? ns === namespace\r\n    : (isFire ? constant.TRUE : constant.FALSE)\r\n}\r\n","/**\r\n * @file 判断版本\r\n */\r\n\r\nimport toNumber from './toNumber'\r\n\r\n/**\r\n * 判断给定版本是否符合条件\r\n * \r\n * @param version 待检查版本\r\n * @param checkVersion 版本基准\r\n * @param equal 是否判等\r\n * \r\n * @returns 是否符合条件\r\n */\r\nexport default function checkVersion(version: string, checkVersion: string, equal: boolean = false) {\r\n  const checkVersionArr = checkVersion.split('.')\r\n  const versionArr = version.split('.')\r\n  for (let i = 0; i < versionArr.length; i++) {\r\n    if (equal && i == (versionArr.length - 1) && toNumber(versionArr[i]) >= toNumber(checkVersionArr[i])) {\r\n      return versionArr.length >= checkVersionArr.length\r\n    }\r\n    if (toNumber(versionArr[i]) > toNumber(checkVersionArr[i])) {\r\n      return true\r\n    }\r\n    else if (toNumber(versionArr[i]) < toNumber(checkVersionArr[i])) {\r\n      return false\r\n    }\r\n\r\n    if (i === checkVersionArr.length - 1 && i === versionArr.length - 1) {\r\n      return equal\r\n    }\r\n\r\n    if (i === checkVersionArr.length - 1) {\r\n      return true\r\n    }\r\n    else if (i === versionArr.length - 1) {\r\n      return false\r\n    }\r\n  }\r\n  return true\r\n}\r\n","/**\r\n * @file 合并 TypeArray\r\n */\r\n\r\nimport { TypeArray, TypeArrayConstructor } from '../types/type'\r\n\r\nexport default function concatTypeArray<T extends TypeArrayConstructor>(\r\n  constructor: T,\r\n  arrays: InstanceType<T>[]\r\n): InstanceType<T> {\r\n\r\n  if (!arrays.length) {\r\n    return null\r\n  }\r\n\r\n  if (arrays.length === 1) {\r\n    return arrays[0]\r\n  }\r\n\r\n  let totalLength: number = 0\r\n  let array: TypeArray\r\n  for (array of arrays) {\r\n    totalLength += array.length\r\n  }\r\n  let result = new constructor(totalLength) as InstanceType<T>\r\n\r\n  let offset = 0\r\n  for (array of arrays) {\r\n    result.set(array, offset)\r\n    offset += array.length\r\n  }\r\n  return result\r\n}\r\n","/**\r\n * @file 防抖函数\r\n */\r\n\r\nimport execute from './execute'\r\nimport { Fn } from '../types/type'\r\nimport * as array from '../util/array'\r\nimport * as constant from '../util/constant'\r\nimport { ParamType } from '../types/advanced'\r\n\r\n/**\r\n * 防抖函数\r\n *\r\n * @param fn 需要节制调用的函数\r\n * @param delay 调用的时间间隔，单位毫秒\r\n * @param immediate 是否立即触发\r\n * @return 节流函数\r\n */\r\nexport default function debounce<T extends Fn>(fn: T, delay: number, immediate?: boolean, last: boolean = false): T {\r\n\r\n  let timer: any\r\n  let args: any\r\n\r\n  return function () {\r\n\r\n    let context = this\r\n\r\n    if (last) {\r\n      args = array.toArray(arguments)\r\n    }\r\n\r\n    if (!timer) {\r\n      if (!last) {\r\n        args = array.toArray(arguments)\r\n      }\r\n      if (immediate) {\r\n        execute(fn, context, args as ParamType<T>)\r\n      }\r\n\r\n      timer = setTimeout(\r\n        function () {\r\n          timer = constant.UNDEFINED\r\n          if (!immediate) {\r\n            execute(fn, context, args as ParamType<T>)\r\n          }\r\n        },\r\n        delay\r\n      )\r\n    }\r\n  } as T\r\n}\r\n","/**\r\n * @file 使用指定上下文执行函数\r\n */\r\n\r\nimport * as is from '../util/is'\r\nimport * as constant from '../util/constant'\r\nimport { ReturnType, ParamType } from '../types/advanced'\r\nimport { Fn } from '../types/type'\r\n\r\n/**\r\n * 任性地执行一个函数，不管它有没有、是不是\r\n *\r\n * @param fn 调用的函数\r\n * @param context 执行函数时的 this 指向\r\n * @param args 调用函数的参数，多参数时传入数组\r\n * @return 调用函数的返回值\r\n */\r\nexport default function execute<T extends Fn>(fn: T, context?: any, args?: ParamType<T> | void): ReturnType<T> {\r\n  if (is.func(fn)) {\r\n    return is.array(args)\r\n      ? fn.apply(context, args)\r\n      : context !== constant.UNDEFINED\r\n        ? fn.call(context, args)\r\n        : args !== constant.UNDEFINED\r\n          ? fn(args)\r\n          : fn()\r\n  }\r\n}\r\n","/**\r\n * 生成唯一 id\r\n * \r\n * @internal\r\n * @returns id\r\n */\r\nexport default function generateUUID(): string {\r\n  let d = new Date().getTime()\r\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n    let r = (d + Math.random() * 16) % 16 | 0\r\n    d = Math.floor(d / 16)\r\n    return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16)\r\n  })\r\n}\r\n","\r\nexport default function getTimestamp() {\r\n  return Date.now()\r\n}\r\n","export default function isAudioWorklet() {\r\n  // @ts-ignore\r\n  return typeof registerProcessor === 'function' && typeof sampleRate === 'number' && typeof currentFrame === 'number' && typeof currentTime === 'number'\r\n}\r\n","/**\r\n * @file 判断是否定义\r\n */\r\n\r\nimport * as constant from '../util/constant'\r\n\r\n/**\r\n * 判断是否定义\r\n * \r\n * @param target 待判定变量\r\n */\r\nexport default function isDef(target: any): boolean {\r\n  return target !== constant.UNDEFINED\r\n}\r\n","import isDef from './isDef'\r\n\r\nlet _isLittleEndian: boolean\r\n\r\nexport default function isLittleEndian() {\r\n\r\n  if (isDef(_isLittleEndian)) {\r\n    return _isLittleEndian\r\n  }\r\n\r\n  const buf = new ArrayBuffer(2)\r\n  const view = new DataView(buf)\r\n\r\n  // little-endian write\r\n  view.setInt16(0, 256, true)\r\n  // platform-spec read, if equal then LE\r\n  _isLittleEndian = (new Int16Array(buf))[0] === 256\r\n\r\n  return _isLittleEndian\r\n}\r\n","/**\r\n * @file 判断是否是 native 方法\r\n */\r\n\r\nimport * as is from '../util/is'\r\nimport toString from './toString'\r\nimport * as string from '../util/string'\r\n\r\n/**\r\n * 判断是否是 native 方法\r\n * \r\n * @param target 待判定函数\r\n */\r\nexport default function isNative(target: any): boolean {\r\n  return is.func(target) && string.has(toString(target), '[native code]')\r\n}\r\n","import isDef from './isDef'\r\nimport isAudioWorklet from './isAudioWorklet'\r\n\r\nexport default function isWorker() {\r\n  return !(typeof window === 'object' && isDef(window.document)) && !isAudioWorklet()\r\n}\r\n","/**\r\n * @file 下一个时间片\r\n */\r\n\r\n\r\nimport isNative from './isNative'\r\nimport * as constant from '../util/constant'\r\n\r\ndeclare const setImmediate: Function\r\n\r\nlet nextTick: Function\r\n\r\n// IE (10+) 和 node\r\nif (typeof setImmediate === constant.RAW_FUNCTION && isNative(setImmediate)) {\r\n  nextTick = setImmediate\r\n}\r\n/*\r\n * 用 MessageChannel 去做 setImmediate 的 polyfill\r\n * 原理是将新的 message 事件加入到原有的 dom events 之后\r\n * 兼容性 IE10+ 和其他标准浏览器\r\n */\r\nif (typeof MessageChannel === constant.RAW_FUNCTION && isNative(MessageChannel)) {\r\n  nextTick = function (fn: any) {\r\n    const channel = new MessageChannel()\r\n    channel.port1.onmessage = fn\r\n    channel.port2.postMessage(1)\r\n  }\r\n}\r\nelse if (typeof setTimeout === 'function') {\r\n  nextTick = setTimeout\r\n}\r\n// 没有 setTimeout 是环境，比如 WorkletGlobalScope，先固定一个插槽\r\nelse {\r\n  nextTick = function (fn: Function) {\r\n    setTimeout(fn)\r\n  }\r\n}\r\n\r\nexport default nextTick\r\n","/**\r\n * 将某个文件的代码变成字符串（Webpack 使用）\r\n */\r\n\r\nimport { Data } from '../types/type'\r\n\r\nconst webpackBootstrapFunc = `\r\nfunction webpackBootstrapFunc (modules) {\r\n  var installedModules = {};\r\n  function __webpack_require__(moduleId) {\r\n    if(installedModules[moduleId])\r\n    return installedModules[moduleId].exports;\r\n    var module = installedModules[moduleId] = {\r\n      i: moduleId,\r\n      l: false,\r\n      exports: {}\r\n    };\r\n    if (!modules[moduleId]) {\r\n      console.log('can not found module:', moduleId)\r\n    }\r\n    modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\r\n    module.l = true;\r\n    return module.exports;\r\n  }\r\n  __webpack_require__.m = modules;\r\n  __webpack_require__.c = installedModules;\r\n  __webpack_require__.i = function(value) { return value; };\r\n  __webpack_require__.d = function(exports, definition, getter) {\r\n    if (typeof definition === 'string') {\r\n      if(!__webpack_require__.o(exports, definition)) {\r\n        Object.defineProperty(exports, definition, {\r\n          enumerable: true,\r\n          get: getter\r\n        });\r\n      }\r\n    }\r\n    else {\r\n      for(var key in definition) {\r\n        if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\r\n          Object.defineProperty(exports, key, {\r\n            enumerable: true,\r\n            get: definition[key]\r\n          });\r\n        }\r\n      }\r\n    }\r\n  };\r\n  __webpack_require__.r = function(exports) {\r\n    if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\r\n    \tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\r\n    }\r\n    Object.defineProperty(exports, '__esModule', { value: true });\r\n  };\r\n  __webpack_require__.f = {};\r\n  __webpack_require__.e = function(chunkId) {\r\n    return Promise.all(Object.keys(__webpack_require__.f).reduce(function (promises, key) {\r\n      __webpack_require__.f[key](chunkId, promises);\r\n        return promises;\r\n    \t}, []));\r\n\t};\r\n  __webpack_require__.u = function(chunkId) {\r\n    return chunkId + \"LIB_NAME\";\r\n  };\r\n  __webpack_require__.n = function(module) {\r\n    var getter = module && module.__esModule ?\r\n      function getDefault() { return module['default']; } :\r\n      function getModuleExports() { return module; };\r\n    __webpack_require__.d(getter, 'a', getter);\r\n    return getter;\r\n  };\r\n  (function() {\r\n    var installedChunks = {\r\n      \"main\": 0\r\n    };\r\n    __webpack_require__.f.j = function(chunkId, promises) {\r\n      var installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\r\n      if (installedChunkData !== 0) {\r\n        if(installedChunkData) {\r\n          promises.push(installedChunkData[2]);\r\n        } else {\r\n          if (true) {\r\n            var promise = new Promise(function(resolve, reject){installedChunkData = installedChunks[chunkId] = [resolve, reject]});\r\n            promises.push(installedChunkData[2] = promise);\r\n            var url = __webpack_require__.p + __webpack_require__.u(chunkId);\r\n            var error = new Error();\r\n            var loadingEnded = function(event) {\r\n              if(__webpack_require__.o(installedChunks, chunkId)) {\r\n                installedChunkData = installedChunks[chunkId];\r\n                if(installedChunkData !== 0) installedChunks[chunkId] = undefined;\r\n                if(installedChunkData) {\r\n                  var errorType = event && (event.type === 'load' ? 'missing' : event.type);\r\n                  var realSrc = url;\r\n                  error.message = \"Loading chunk \" + chunkId + \" failed.\\\\n(\" + errorType + \": \" + realSrc + \")\";\r\n                  error.name = \"ChunkLoadError\";\r\n                  error.type = errorType;\r\n                  error.request = realSrc;\r\n                  installedChunkData[1](error);\r\n                }\r\n              }\r\n            };\r\n            __webpack_require__.l(url, loadingEnded);\r\n          }\r\n        }\r\n      }\r\n    };\r\n    var webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\r\n    var [chunkIds, moreModules, runtime] = data;\r\n    var moduleId, chunkId, i = 0;\r\n    if (chunkIds.some(function(id){return installedChunks[id] !== 0})) {\r\n      for(moduleId in moreModules) {\r\n        if(__webpack_require__.o(moreModules, moduleId)) {\r\n          __webpack_require__.m[moduleId] = moreModules[moduleId];\r\n        }\r\n      }\r\n      if(runtime) runtime(__webpack_require__);\r\n    }\r\n    if (parentChunkLoadingFunction) parentChunkLoadingFunction(data);\r\n      for (;i < chunkIds.length; i++) {\r\n        chunkId = chunkIds[i];\r\n        if (__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\r\n          installedChunks[chunkId][0]();\r\n        }\r\n        installedChunks[chunkId] = 0;\r\n      }\r\n    }\r\n    var self = typeof globalThis !== undefined ? globalThis : self\r\n    var exportName = 'LIBRARY_EXPORT_NAME'\r\n    var chunkLoadingGlobal = self[\"webpackChunk\" + exportName] = self[\"webpackChunk\" + exportName] || [];\r\n    chunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\r\n    chunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));\r\n  })();\r\n  (function() {\r\n    var inProgress = {};\r\n    __webpack_require__.l = function(url, done) {\r\n      if (inProgress[url]) { inProgress[url].push(done); return; }\r\n        inProgress[url] = [done];\r\n        var onComplete = function(event) {\r\n          clearTimeout(timeout);\r\n          var doneFns = inProgress[url];\r\n          delete inProgress[url];\r\n          doneFns && doneFns.forEach(function(fn){fn(event)});\r\n        }\r\n        var timeout = setTimeout(onComplete.bind(null, undefined, { type: \"timeout\" }), 120000);\r\n      import(url).then(function() {\r\n        onComplete({\r\n          type: \"load\"\r\n        })\r\n      }, function (error) {\r\n        onComplete({\r\n          type: \"missing\"\r\n        })\r\n      });\r\n    };\r\n  })();\r\n  __webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\r\n  __webpack_require__.p = \"ROOT_URL\";\r\n  __webpack_require__.oe = function(err) { console.error(err); throw err; };\r\n  var f = __webpack_require__(__webpack_require__.s = ENTRY_MODULE);\r\n  return f;\r\n}\r\n`\r\n\r\nconst moduleNameReqExp = '[\\\\.|\\\\-|\\\\+|\\\\w|\\/|@|!]+'\r\n// additional chars when output.path info is true\r\nconst dependencyRegExp = '\\\\(\\\\s*(\\/\\\\*.*?\\\\*\\/)?\\\\s*.*?(' + moduleNameReqExp + ').*?\\\\)'\r\n\r\n// http://stackoverflow.com/a/2593661/130442\r\nfunction quoteRegExp(str: string) {\r\n  return (str + '').replace(/[.?*+^$[\\]\\\\(){}|-]/g, '\\\\$&')\r\n}\r\n\r\nfunction isNumeric(n: any) {\r\n  // 1 * n converts integers, integers as string (\"123\"), 1e3 and \"1e3\" to integers and strings to NaN\r\n  return !isNaN(n)\r\n}\r\n\r\nfunction getModuleDependencies(sources: string, module: string, queueName: string, requiredModules: Data) {\r\n  const retval = {}\r\n  retval[queueName] = []\r\n\r\n  let fnString = module.toString()\r\n  const wrapperSignature = fnString.match(/^(function)?\\s?\\w*\\(\\w+,\\s*(\\w+),\\s*(\\w+)\\)/)\r\n  if (!wrapperSignature) {\r\n    return retval\r\n  }\r\n  const webpackRequireName = wrapperSignature[3]\r\n\r\n  if (!requiredModules.__webpack_exports_process__) {\r\n    requiredModules.__webpack_require__ = webpackRequireName\r\n    requiredModules.__webpack_exports__ = wrapperSignature[2]\r\n    requiredModules.__webpack_exports_process__ = true\r\n  }\r\n\r\n  // main bundle deps\r\n  let re = new RegExp('(\\\\\\\\n|\\\\W)' + quoteRegExp(webpackRequireName) + dependencyRegExp, 'g')\r\n  let match: RegExpExecArray\r\n  while ((match = re.exec(fnString))) {\r\n    if (match[3] === 'dll-reference') {\r\n      continue\r\n    }\r\n    retval[queueName].push(match[3])\r\n  }\r\n\r\n  // dll deps\r\n  re = new RegExp('\\\\(' + quoteRegExp(webpackRequireName) + '\\\\(\"(dll-reference\\\\s(' + moduleNameReqExp + '))\"\\\\)\\\\)' + dependencyRegExp, 'g')\r\n  while ((match = re.exec(fnString))) {\r\n    if (!sources[match[2]]) {\r\n      retval[queueName].push(match[1])\r\n      // @ts-ignore\r\n      sources[match[2]] = __webpack_require__(match[1]).m\r\n    }\r\n    retval[match[2]] = retval[match[2]] || []\r\n    retval[match[2]].push(match[4])\r\n  }\r\n\r\n  // convert 1e3 back to 1000 - this can be important after uglify-js converted 1000 to 1e3\r\n  const keys = Object.keys(retval)\r\n  for (let i = 0; i < keys.length; i++) {\r\n    for (let j = 0; j < retval[keys[i]].length; j++) {\r\n      if (isNumeric(+retval[keys[i]][j])) {\r\n        retval[keys[i]][j] = +retval[keys[i]][j]\r\n      }\r\n    }\r\n  }\r\n\r\n  return retval\r\n}\r\n\r\nfunction hasValuesInQueues(queues) {\r\n  const keys = Object.keys(queues)\r\n  return keys.reduce(function (hasValues, key) {\r\n    return hasValues || queues[key].length > 0\r\n  }, false)\r\n}\r\n\r\nfunction getRequiredModules(sources, moduleId) {\r\n  const modulesQueue = {\r\n    main: [moduleId]\r\n  }\r\n  const requiredModules = {\r\n    main: [],\r\n    __webpack_exports__: '__webpack_exports__',\r\n    __webpack_require__: '__webpack_require__',\r\n    __webpack_exports_process__: false\r\n  }\r\n  const seenModules = {\r\n    main: {}\r\n  }\r\n\r\n  while (hasValuesInQueues(modulesQueue)) {\r\n    const queues = Object.keys(modulesQueue)\r\n    for (let i = 0; i < queues.length; i++) {\r\n      let queueName = queues[i]\r\n      let queue = modulesQueue[queueName]\r\n      let moduleToCheck = queue.pop()\r\n      seenModules[queueName] = seenModules[queueName] || {}\r\n      if (seenModules[queueName][moduleToCheck] || !sources[queueName][moduleToCheck]) {\r\n        continue\r\n      }\r\n      seenModules[queueName][moduleToCheck] = true\r\n      requiredModules[queueName] = requiredModules[queueName] || []\r\n      requiredModules[queueName].push(moduleToCheck)\r\n      let newModules = getModuleDependencies(sources, sources[queueName][moduleToCheck], queueName, requiredModules)\r\n      let newModulesKeys = Object.keys(newModules)\r\n      for (let j = 0; j < newModulesKeys.length; j++) {\r\n        modulesQueue[newModulesKeys[j]] = modulesQueue[newModulesKeys[j]] || []\r\n        modulesQueue[newModulesKeys[j]] = modulesQueue[newModulesKeys[j]].concat(newModules[newModulesKeys[j]])\r\n      }\r\n    }\r\n  }\r\n  return requiredModules\r\n}\r\n\r\nexport default function (moduleId: string, options: {\r\n  varName: string\r\n  exportName?: string\r\n  pointName?: string\r\n  exportIsClass?: boolean\r\n}) {\r\n  const sources = {\r\n    // @ts-ignore\r\n    main: __webpack_modules__\r\n  }\r\n\r\n  const requiredModules = getRequiredModules(sources, moduleId)\r\n\r\n  let src = ''\r\n  let stringifyModuleId = JSON.stringify(moduleId)\r\n\r\n  return src + 'var ' + options.varName + '=(' + webpackBootstrapFunc.replace('ENTRY_MODULE', stringifyModuleId)\r\n    // @ts-ignore\r\n    .replace('ROOT_URL', __webpack_require__.p || '')\r\n    // @ts-ignore\r\n    .replace('LIBRARY_EXPORT_NAME', __LIBRARY_EXPORT_NAME__)\r\n    // @ts-ignore\r\n    .replace('LIB_NAME', __webpack_require__.u && __webpack_require__.u('') || '')\r\n      + ')({' + requiredModules.main.map(function (id) {\r\n    const stringifyId = JSON.stringify(id)\r\n    let source = '' + stringifyId + ': ' + sources.main[id].toString()\r\n    if (stringifyId === stringifyModuleId && options.exportName && options.pointName) {\r\n      const line = `;${requiredModules.__webpack_require__}.d(\r\n          ${requiredModules.__webpack_exports__},\r\n          \"${options.exportName}\",\r\n          function() {\r\n            if (${options.exportIsClass}) {\r\n              for (var key in ${requiredModules.__webpack_exports__}) {\r\n                if (key === '${options.exportName}') {\r\n                  continue;\r\n                }\r\n                var v = ${requiredModules.__webpack_exports__}[key];\r\n                if (typeof v === 'function' && v.name === '${options.pointName}') {\r\n                  return v;\r\n                }\r\n              }\r\n            }\r\n            return ${options.pointName};\r\n          }\r\n        );`\r\n      source = source.slice(0, source.length - 1) + line + '}'\r\n    }\r\n    return source\r\n  }).join(',') + '});'\r\n}\r\n","/**\r\n * @file 拆解字符串，并 trim 每个部分\r\n */\r\n\r\nimport * as is from '../util/is'\r\nimport * as array from '../util/array'\r\n\r\n/**\r\n * 拆解字符串，并 trim 每个部分\r\n * \r\n * @param str 字符串\r\n * @param sep 分隔符\r\n */\r\nexport default function split(str: string | number, sep: string): string[] {\r\n\r\n  const result = []\r\n\r\n  if (is.number(str)) {\r\n    str = str + ''\r\n  }\r\n\r\n  if (str && is.string(str)) {\r\n    array.each(str.split(sep), (part, index) => {\r\n      part = part.trim()\r\n      if (part) {\r\n        result.push(part)\r\n      }\r\n    })\r\n  }\r\n\r\n  return result\r\n}\r\n","/**\r\n * @file 强转为 number\r\n */\r\n\r\nimport * as is from '../util/is'\r\nimport * as constant from '../util/constant'\r\n\r\n/**\r\n * 强转为 number\r\n * \r\n * @param target 待转换值\r\n * @param defaultValue 默认值\r\n * \r\n * @returns 转换之后的值\r\n */\r\nexport default function toNumber(target: any, defaultValue?: number): number {\r\n  return is.numeric(target)\r\n    ? +target\r\n    : defaultValue !== constant.UNDEFINED\r\n      ? defaultValue as number\r\n      : 0\r\n}\r\n","/**\r\n * @file 强转为 string\r\n */\r\n\r\nimport * as constant from '../util/constant'\r\n\r\n/**\r\n * 强转为 string\r\n * \r\n * @param target 待转换的值\r\n * @param defaultValue 默认值\r\n * @returns 转换之后的值\r\n */\r\nexport default function toString(target: any, defaultValue?: string): string {\r\n  return target != constant.NULL && target.toString\r\n    ? target.toString()\r\n    : defaultValue !== constant.UNDEFINED\r\n      ? defaultValue as string\r\n      : constant.EMPTY_STRING\r\n}\r\n","/**\r\n * 顺序执行异步任务，用于有顺序依赖的信令交互\r\n */\r\n\r\nimport * as is from '../util/is'\r\nimport * as array from '../util/array'\r\n\r\ntype Command = {\r\n  task: () => Promise<any>\r\n  resolve: (value: any) => void\r\n  reject: (reason?: any) => void,\r\n  error?: Error\r\n}\r\n\r\nexport default class CommandQueue {\r\n\r\n  private queue: Command[]\r\n\r\n  constructor() {\r\n    this.queue = []\r\n  }\r\n\r\n  private async execute(command: Command) {\r\n    try {\r\n      const result = await command.task()\r\n      command.resolve(result)\r\n    }\r\n    catch (error) {\r\n      command.reject(error)\r\n    }\r\n  }\r\n\r\n  private async next() {\r\n    if (this.queue.length) {\r\n      const command = this.queue[0]\r\n      if (command.error) {\r\n        command.reject(command.error)\r\n      }\r\n      else {\r\n        await this.execute(command)\r\n      }\r\n\r\n      this.queue.shift()\r\n\r\n      if (this.queue.length) {\r\n        this.next()\r\n      }\r\n    }\r\n  }\r\n\r\n  public async push<T extends() => Promise<any>>(task: T): Promise<ReturnType<T>> {\r\n    if (!is.func(task)) {\r\n      throw new TypeError('task must be a function')\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const command = {\r\n        task,\r\n        resolve,\r\n        reject\r\n      }\r\n      this.queue.push(command)\r\n\r\n      if (this.queue.length === 1) {\r\n        this.next()\r\n      }\r\n    })\r\n  }\r\n\r\n  public clear(error?: Error) {\r\n    array.each(this.queue, (command) => {\r\n      command.error = error || new Error('command queue clear')\r\n    })\r\n  }\r\n\r\n  public clearPadding() {\r\n    this.queue.length = 0\r\n  }\r\n\r\n  get length() {\r\n    return this.queue.length\r\n  }\r\n}\r\n","\r\nimport * as is from '../util/is'\r\nexport default abstract class ArrayLike {\r\n\r\n  protected proxy: ArrayLike\r\n\r\n  constructor() {\r\n    this.proxy = new Proxy(this, {\r\n      get(target, p, receiver) {\r\n        if (is.numeric(p)) {\r\n          return target.getIndexValue(+p)\r\n        }\r\n        else {\r\n          return target[p]\r\n        }\r\n      },\r\n      set(target, p, newValue, receiver) {\r\n        if (is.numeric(p)) {\r\n          target.setIndexValue(+p, newValue)\r\n        }\r\n        else {\r\n          target[p] = newValue\r\n        }\r\n        return true\r\n      }\r\n    })\r\n  }\r\n\r\n  protected abstract getIndexValue(index: number): any\r\n  protected abstract setIndexValue(index: number, value: any): void\r\n\r\n  [n: number]: number\r\n}\r\n","/**\r\n * bit 读取器\r\n */\r\n\r\nimport { IOError } from './error'\r\nimport * as logger from '../util/logger'\r\nimport { Uint8ArrayInterface } from './interface'\r\n\r\nexport default class BitReader {\r\n\r\n  private buffer: Uint8Array\r\n\r\n  private pointer: number\r\n\r\n  private bitsLeft: number\r\n\r\n  private size: number\r\n\r\n  private endPointer: number\r\n\r\n  private pos: bigint\r\n\r\n  public error: number\r\n\r\n  public onFlush: (data: Uint8Array) => number\r\n\r\n  /**\r\n   * @param data 待读取的字节\r\n   * @param bigEndian 是否按大端字节序读取，默认大端字节序（网络字节序）\r\n   */\r\n  constructor(size: number = 1 * 1024 * 1024) {\r\n    this.pointer = 0\r\n    this.bitsLeft = 8\r\n    this.pos = 0n\r\n\r\n    this.size = size\r\n    this.endPointer = 0\r\n    this.error = 0\r\n\r\n    this.buffer = new Uint8Array(this.size)\r\n  }\r\n\r\n  /**\r\n   * 读取 1 个比特（不会移动读取指针）\r\n   */\r\n  public peekU1() {\r\n    let result = 0\r\n    if (this.remainingLength() < 1 || this.remainingLength() === 1 && this.bitsLeft === 0) {\r\n      this.flush()\r\n    }\r\n\r\n    let pointer = this.pointer\r\n    let bitsLeft = this.bitsLeft\r\n\r\n    if (bitsLeft === 0) {\r\n      pointer++\r\n      bitsLeft = 8\r\n    }\r\n\r\n    result = (this.buffer[pointer] >> (bitsLeft - 1)) & 0x01\r\n    return result\r\n  }\r\n  /**\r\n   * 读取 1 个比特\r\n   */\r\n  public readU1() {\r\n    let result = 0\r\n\r\n    if (this.remainingLength() < 1 || this.remainingLength() === 1 && this.bitsLeft === 0) {\r\n      this.flush()\r\n    }\r\n\r\n    this.bitsLeft--\r\n\r\n    result = (this.buffer[this.pointer] >> this.bitsLeft) & 0x01\r\n\r\n    if (this.bitsLeft === 0) {\r\n      this.pointer++\r\n      this.bitsLeft = 8\r\n      this.pos++\r\n    }\r\n\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * 读取 n 个比特\r\n   * \r\n   * @param n\r\n   */\r\n  public readU(n: number) {\r\n    let result = 0\r\n    for (let i = 0; i < n; i++) {\r\n      result |= (this.readU1() << (n - i - 1))\r\n    }\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * 读取 n 个比特（不会移动读取指针）\r\n   * \r\n   * @param n\r\n   */\r\n  public peekU(n: number) {\r\n    const pointer = this.pointer\r\n    const bitsLeft = this.bitsLeft\r\n    const pos = this.pos\r\n    const result = this.readU(n)\r\n    this.pointer = pointer\r\n    this.bitsLeft = bitsLeft\r\n    this.pos = pos\r\n    return result\r\n  }\r\n\r\n  /**\r\n   * 获取剩余可读字节数\r\n   * \r\n   * @returns \r\n   */\r\n  public remainingLength() {\r\n    return this.endPointer - this.pointer\r\n  }\r\n\r\n  /**\r\n   * 当前字节剩余的 bit 数\r\n   * \r\n   * @returns \r\n   */\r\n  public getBitLeft() {\r\n    return this.bitsLeft\r\n  }\r\n\r\n  /**\r\n   * 获取当前读取指针位置\r\n   * \r\n   * @returns \r\n   */\r\n  public getPointer() {\r\n    return this.pointer\r\n  }\r\n\r\n  /**\r\n   * 设置读取指针到指定位置\r\n   * \r\n   * @param pointer \r\n   */\r\n  public setPointer(pointer: number) {\r\n    this.pointer = pointer\r\n  }\r\n\r\n  /**\r\n   * 返回当前的绝对位置\r\n   * \r\n   * @returns \r\n   */\r\n  public getPos() {\r\n    return this.pos\r\n  }\r\n\r\n  /**\r\n   * 跳过指定 bit 数\r\n   * \r\n   * @param n \r\n   */\r\n  public skip(n: number) {\r\n    const byte = (n - (n % 8)) / 8\r\n\r\n    this.pointer += byte\r\n    this.pos += BigInt(byte)\r\n\r\n    const bitsLeft = n % 8\r\n\r\n    if (this.bitsLeft <= bitsLeft) {\r\n      this.pointer++\r\n      this.pos++\r\n      this.bitsLeft = 8 - (bitsLeft - this.bitsLeft)\r\n    }\r\n    else {\r\n      this.bitsLeft -= bitsLeft\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 填充剩余缓冲区\r\n   */\r\n  public flush() {\r\n\r\n    if (!this.onFlush) {\r\n      this.error = IOError.INVALID_OPERATION\r\n      throw Error('IOReader error, flush failed because of no flush callback')\r\n    }\r\n\r\n    if (this.bitsLeft === 0) {\r\n      this.pointer++\r\n      this.pos++\r\n    }\r\n\r\n    if (this.size - this.remainingLength() <= 0) {\r\n      return\r\n    }\r\n\r\n    if (this.pointer < this.endPointer) {\r\n      this.buffer.set(this.buffer.subarray(this.pointer, this.endPointer), 0)\r\n\r\n      const len = this.onFlush(this.buffer.subarray(this.endPointer - this.pointer, this.size))\r\n\r\n      if (len < 0) {\r\n        this.error = len\r\n        throw Error('IOReader error, flush failed')\r\n      }\r\n\r\n      this.endPointer = this.endPointer - this.pointer + len\r\n      this.pointer = 0\r\n    }\r\n    else {\r\n      const len = this.onFlush(this.buffer)\r\n\r\n      this.endPointer = len\r\n      this.pointer = 0\r\n      this.bitsLeft = 8\r\n\r\n      if (len < 0) {\r\n        this.error = len\r\n        throw Error('IOReader error, flush failed')\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取缓冲区\r\n   * \r\n   * @returns \r\n   */\r\n  public getBuffer() {\r\n    return this.buffer\r\n  }\r\n\r\n  public appendBuffer(buffer: Uint8ArrayInterface) {\r\n    if (this.size - this.endPointer >= buffer.length) {\r\n      this.buffer.set(buffer, this.endPointer)\r\n      this.endPointer += buffer.length\r\n    }\r\n    else {\r\n      this.buffer.set(this.buffer.subarray(this.pointer, this.endPointer), 0)\r\n      this.endPointer = this.endPointer - this.pointer\r\n      this.pointer = 0\r\n\r\n      if (this.size - this.endPointer >= buffer.length) {\r\n        this.buffer.set(buffer, this.endPointer)\r\n        this.endPointer += buffer.length\r\n      }\r\n      else {\r\n        const len = Math.min(this.size - this.endPointer, buffer.length)\r\n        this.buffer.set(buffer.subarray(0, len), this.endPointer)\r\n        this.endPointer += len\r\n\r\n        logger.warn('BSReader, call appendBuffer but the buffer\\'s size is lagger then the remaining size')\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 重置缓冲区\r\n   */\r\n  public reset() {\r\n    this.pointer = this.endPointer = 0\r\n    this.bitsLeft = 8\r\n    this.error = 0\r\n    this.pos = 0n\r\n  }\r\n\r\n  /**\r\n   * 对齐字节，当处在当前字节的第一个 bit 时不动，否则移动到下一个字节\r\n   */\r\n  public skipPadding() {\r\n    if (this.bitsLeft < 8) {\r\n      this.bitsLeft = 8\r\n      this.pointer++\r\n      this.pos++\r\n    }\r\n  }\r\n}\r\n","/**\r\n * bit 写存器\r\n */\r\n\r\nimport { IOError } from './error'\r\n\r\n/**\r\n * 写字节流工具\r\n */\r\n\r\nexport default class BitWriter {\r\n\r\n  private buffer: Uint8Array\r\n\r\n  private pointer: number\r\n\r\n  private pos: bigint\r\n\r\n  private bitPointer: number\r\n\r\n  private size: number\r\n\r\n  public error: number\r\n\r\n  public onFlush: (data: Uint8Array, pos?: number) => number\r\n\r\n  /**\r\n   * @param data 待写的 Uint8Array\r\n   */\r\n  constructor(size: number = 1 * 1024 * 1024) {\r\n    this.pointer = 0\r\n    this.bitPointer = 0\r\n    this.size = size\r\n    this.error = 0\r\n    this.pos = 0n\r\n\r\n    this.buffer = new Uint8Array(this.size)\r\n  }\r\n\r\n  /**\r\n   * 写一个 bit\r\n   * \r\n   * @param bit \r\n   */\r\n  public writeU1(bit: number) {\r\n    if (this.remainingLength() < 1 || this.remainingLength() === 1 && this.bitPointer >= 8) {\r\n      this.flush()\r\n    }\r\n\r\n    if (bit & 0x01) {\r\n      this.buffer[this.pointer] |= (1 << (7 - this.bitPointer))\r\n    }\r\n    else {\r\n      this.buffer[this.pointer] &= ~(1 << (7 - this.bitPointer))\r\n    }\r\n\r\n\r\n    this.bitPointer++\r\n\r\n    if (this.bitPointer === 8) {\r\n      this.pointer++\r\n      this.pos++\r\n      this.bitPointer = 0\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 写 n 个比特\r\n   * \r\n   * @param n\r\n   */\r\n  public writeU(n: number, v: number) {\r\n    for (let i = 0; i < n; i++) {\r\n      this.writeU1(v >> (n - i - 1 ) & 0x01)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取剩余可写节数\r\n   * \r\n   * @returns \r\n   */\r\n  public remainingLength() {\r\n    return this.size - this.pointer\r\n  }\r\n\r\n  /**\r\n   * 写出缓冲区\r\n   */\r\n  public flush() {\r\n\r\n    if (!this.onFlush) {\r\n      this.error = IOError.INVALID_OPERATION\r\n      throw Error('BSWriter error, flush failed because of no flush callback')\r\n    }\r\n\r\n    if (this.pointer) {\r\n      if (this.bitPointer && this.pointer > 1) {\r\n        const ret = this.onFlush(this.buffer.subarray(0, this.pointer - 1))\r\n        if (ret !== 0) {\r\n          this.error = ret\r\n          throw Error('BSWriter error, flush failed')\r\n        }\r\n        this.buffer[0] = this.buffer[this.pointer]\r\n      }\r\n      else if (this.bitPointer === 0) {\r\n        const ret = this.onFlush(this.buffer.subarray(0, this.pointer))\r\n        if (ret !== 0) {\r\n          this.error = ret\r\n          throw Error('BSWriter error, flush failed')\r\n        }\r\n      }\r\n    }\r\n    this.pointer = 0\r\n  }\r\n\r\n  /**\r\n   * 对齐字节，当处在当前字节的第一个 bit 时不动，否则写入 0 直到下一个字节\r\n   */\r\n  public padding() {\r\n    while (this.bitPointer !== 0) {\r\n      this.writeU1(0)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 重置缓冲区\r\n   */\r\n  public reset() {\r\n    this.pointer = 0\r\n    this.bitPointer = 0\r\n    this.error = 0\r\n    this.pos = 0n\r\n  }\r\n\r\n  /**\r\n   * 获取缓冲区\r\n   * \r\n   * @returns \r\n   */\r\n  public getBuffer() {\r\n    return this.buffer\r\n  }\r\n\r\n  /**\r\n   * 获取当前写指针位置\r\n   * \r\n   * @returns \r\n   */\r\n  public getPointer() {\r\n    return this.pointer\r\n  }\r\n\r\n  /**\r\n   * 获取当前的绝对位置\r\n   * \r\n   * @returns \r\n   */\r\n  public getPos() {\r\n    return this.pos\r\n  }\r\n}\r\n","/**\r\n * 读字节流工具\r\n */\r\n\r\nimport concatTypeArray from '../function/concatTypeArray'\r\nimport * as text from '../util/text'\r\nimport { Uint8ArrayInterface, BytesReaderSync } from './interface'\r\n\r\nexport default class BufferReader implements BytesReaderSync {\r\n\r\n  private data: DataView\r\n\r\n  private buffer: Uint8ArrayInterface\r\n\r\n  private byteStart: number\r\n\r\n  private pos: number\r\n\r\n  private size: number\r\n\r\n  private littleEndian: boolean\r\n\r\n  /**\r\n   * @param data 待读取的字节\r\n   * @param bigEndian 是否按大端字节序读取，默认大端字节序（网络字节序）\r\n   */\r\n  constructor(data: Uint8ArrayInterface, bigEndian: boolean = true) {\r\n    this.buffer = data\r\n    this.data = data instanceof Uint8Array ? new DataView(data.buffer) : data.view\r\n    this.byteStart = data instanceof Uint8Array ? data.byteOffset : 0\r\n\r\n    this.pos = 0\r\n    this.size = data.byteLength\r\n    this.littleEndian = !bigEndian\r\n  }\r\n\r\n  /**\r\n   * 读取 8 位无符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public readUint8() {\r\n    return this.data.getUint8(this.pos++ + this.byteStart)\r\n  }\r\n\r\n  /**\r\n   * 读取 16 位无符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public readUint16() {\r\n    const value = this.data.getUint16(this.pos + this.byteStart, this.littleEndian)\r\n    this.pos += 2\r\n    return value\r\n  }\r\n\r\n  /**\r\n   * 读取 24 位无符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public readUint24() {\r\n    const high = this.readUint16()\r\n    const low = this.readUint8()\r\n    return this.littleEndian ? (low << 16 | high) : (high << 8 | low)\r\n  }\r\n\r\n  /**\r\n   * 读取 32 位无符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public readUint32() {\r\n    const value = this.data.getUint32(this.pos + this.byteStart, this.littleEndian)\r\n    this.pos += 4\r\n    return value\r\n  }\r\n\r\n  /**\r\n   * 读取 64 位无符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public readUint64() {\r\n    const high = BigInt(this.readUint32())\r\n    const low = BigInt(this.readUint32())\r\n    if (this.littleEndian) {\r\n      return low << 32n | high\r\n    }\r\n    else {\r\n      return high << 32n | low\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 读取 8 位有符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public readInt8() {\r\n    return this.data.getInt8(this.pos++ + this.byteStart)\r\n  }\r\n\r\n  /**\r\n   * 读取 16 位有符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public readInt16() {\r\n    const value = this.data.getInt16(this.pos + this.byteStart, this.littleEndian)\r\n    this.pos += 2\r\n    return value\r\n  }\r\n\r\n  /**\r\n   * 读取 24 位有符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public readInt24() {\r\n    const value = this.readUint24()\r\n    return (value & 0x800000) ? (value - 0x1000000) : value\r\n  }\r\n\r\n  /**\r\n   * 读取 32 位有符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public readInt32() {\r\n    const value = this.data.getInt32(this.pos + this.byteStart, this.littleEndian)\r\n    this.pos += 4\r\n    return value\r\n  }\r\n\r\n  /**\r\n   * 读取 64 位有符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public readInt64() {\r\n    const high = BigInt(this.readInt32())\r\n    const low = BigInt(this.readInt32())\r\n    if (this.littleEndian) {\r\n      return low << 32n | high\r\n    }\r\n    else {\r\n      return high << 32n | low\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 读取单精度浮点数\r\n   * \r\n   * @returns \r\n   */\r\n  public readFloat() {\r\n    const value = this.data.getFloat32(this.pos + this.byteStart, this.littleEndian)\r\n    this.pos += 4\r\n    return value\r\n  }\r\n\r\n  /**\r\n   * 读取双精度浮点数\r\n   * \r\n   * @returns \r\n   */\r\n  public readDouble() {\r\n    const value = this.data.getFloat64(this.pos + this.byteStart, this.littleEndian)\r\n    this.pos += 8\r\n    return value\r\n  }\r\n\r\n  /**\r\n   * 读取指定长度的字节，并以 16 进制字符串返回\r\n   * \r\n   * @param length 默认 1\r\n   * @returns \r\n   */\r\n  public readHex(length: number = 1) {\r\n    let hexStr = ''\r\n    for (let i = 0; i < length; i++) {\r\n      const hex = this.readUint8().toString(16)\r\n      hexStr += (hex.length === 1 ? '0' + hex : hex)\r\n    }\r\n    return hexStr\r\n  }\r\n\r\n  /**\r\n   * 读取指定长度的字符串\r\n   * \r\n   * @param length 默认 1\r\n   * @returns \r\n   */\r\n  public readString(length: number = 1) {\r\n    let str: string = ''\r\n    if (length) {\r\n      let start = this.pos\r\n      for (let i = 0; i < length; i++) {\r\n        if (this.buffer[this.pos + i] === 0) {\r\n          start++\r\n        }\r\n        else {\r\n          break\r\n        }\r\n      }\r\n      str = text.decode(this.buffer.subarray(start, start + length))\r\n    }\r\n    this.pos += length\r\n\r\n    return str\r\n  }\r\n\r\n  /**\r\n   * 读取一行字符\r\n   */\r\n  public readLine() {\r\n    let str = ''\r\n\r\n    for (let i = this.pos; i < this.size; i++) {\r\n      if (this.buffer[i] === 0x0a || this.buffer[i] === 0x0d) {\r\n        str += this.readString(i - this.pos)\r\n        break\r\n      }\r\n    }\r\n\r\n\r\n    for (let i = this.pos; i < this.size; i++) {\r\n      if (this.buffer[i] === 0x0a || this.buffer[i] === 0x0d) {\r\n        this.readUint8()\r\n      }\r\n      else {\r\n        break\r\n      }\r\n    }\r\n\r\n    return str\r\n  }\r\n\r\n  /**\r\n   * 获取当前读取指针\r\n   * \r\n   * @returns \r\n   */\r\n  public getPos() {\r\n    return BigInt(this.pos)\r\n  }\r\n\r\n  /**\r\n   * seek 读取指针\r\n   * \r\n   * @param pos \r\n   */\r\n  public seek(pos: number) {\r\n    if (pos > this.size) {\r\n      pos = this.size\r\n    }\r\n    this.pos = Math.max(0, pos)\r\n  }\r\n\r\n  /**\r\n   * 跳过指定字节长度\r\n   * \r\n   * @param length \r\n   */\r\n  public skip(length: number) {\r\n    this.seek(this.pos + length)\r\n  }\r\n\r\n  /**\r\n   * 返回指定字节长度\r\n   * \r\n   * @param length \r\n   */\r\n  public back(length: number) {\r\n    this.seek(this.pos - length)\r\n  }\r\n\r\n  /**\r\n   * 获取剩余可读字节数\r\n   * \r\n   * @returns \r\n   */\r\n  public remainingSize() {\r\n    return this.size - this.pos\r\n  }\r\n\r\n  /**\r\n   * 读取指定长度的二进制 buffer 数据\r\n   * \r\n   * @param length \r\n   * @returns \r\n   */\r\n  public readBuffer(length: number) {\r\n    length = Math.min(length, this.remainingSize())\r\n    const buffer = this.buffer.slice(this.pos, this.pos + length)\r\n    this.pos += length\r\n    return buffer\r\n  }\r\n\r\n  /**\r\n   * 追加 buffer\r\n   * \r\n   * @param buffer \r\n   */\r\n  public appendBuffer(buffer: Uint8ArrayInterface) {\r\n    this.buffer = concatTypeArray(Uint8Array, [\r\n      this.buffer.slice(),\r\n      buffer.slice()\r\n    ])\r\n    this.data = new DataView(this.buffer.buffer)\r\n    this.size += buffer.byteLength\r\n    this.byteStart = 0\r\n  }\r\n\r\n  /**\r\n   * 重新装载数据\r\n   * \r\n   * @param data \r\n   * @param bigEndian \r\n   */\r\n  public resetBuffer(data: Uint8ArrayInterface, bigEndian: boolean = true) {\r\n    this.buffer = data\r\n    this.data = data instanceof Uint8Array ? new DataView(data.buffer) : data.view\r\n    this.byteStart = data instanceof Uint8Array ? data.byteOffset : 0\r\n\r\n    this.pos = 0\r\n    this.size = data.byteLength\r\n    this.littleEndian = !bigEndian\r\n  }\r\n}\r\n","/**\r\n * 写字节流工具\r\n */\r\n\r\nimport * as logger from '../util/logger'\r\nimport { Uint8ArrayInterface, BytesWriterSync } from './interface'\r\nimport * as text from '../util/text'\r\n\r\nexport default class BufferWriter implements BytesWriterSync {\r\n\r\n  private data: DataView\r\n\r\n  private buffer: Uint8ArrayInterface\r\n\r\n  private byteStart: number\r\n\r\n  private pos: number\r\n\r\n  private size: number\r\n\r\n  private littleEndian: boolean\r\n\r\n  /**\r\n   * @param data 待写的 Uint8Array\r\n   * @param bigEndian 是否按大端字节序写，默认大端字节序（网络字节序）\r\n   */\r\n  constructor(data: Uint8ArrayInterface, bigEndian: boolean = true) {\r\n    this.buffer = data\r\n    this.data = data instanceof Uint8Array ? new DataView(data.buffer) : data.view\r\n    this.byteStart = data instanceof Uint8Array ? data.byteOffset : 0\r\n    this.pos = 0\r\n    this.size = data.byteLength\r\n    this.littleEndian = !bigEndian\r\n  }\r\n\r\n  /**\r\n   * 写 8 位无符号整数\r\n   */\r\n  public writeUint8(value: number) {\r\n    this.data.setUint8(this.pos++ + this.byteStart, value)\r\n  }\r\n\r\n  /**\r\n   * 读取 16 位无符号整数\r\n   */\r\n  public writeUint16(value: number) {\r\n    this.data.setUint16(this.pos + this.byteStart, value, this.littleEndian)\r\n    this.pos += 2\r\n  }\r\n\r\n  /**\r\n   * 写 24 位无符号整数\r\n   */\r\n  public writeUint24(value: number) {\r\n    const high = value & 0xf00\r\n    const middle = value & 0x0f0\r\n    const low = value & 0x00f\r\n    if (this.littleEndian) {\r\n      this.writeUint8(low)\r\n      this.writeUint8(middle)\r\n      this.writeUint8(high)\r\n    }\r\n    else {\r\n      this.writeUint8(high)\r\n      this.writeUint8(middle)\r\n      this.writeUint8(low)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 写 32 位无符号整数\r\n   */\r\n  public writeUint32(value: number) {\r\n    this.data.setUint32(this.pos + this.byteStart, value, this.littleEndian)\r\n    this.pos += 4\r\n  }\r\n\r\n  /**\r\n   * 写 64 位无符号整数\r\n   */\r\n  public writeUint64(value: bigint) {\r\n    const low = value & 0xffffffffn\r\n    const high = (value & (0xffffffffn << 32n)) >> 32n\r\n    if (this.littleEndian) {\r\n      this.writeUint32(Number(low))\r\n      this.writeUint32(Number(high))\r\n    }\r\n    else {\r\n      this.writeUint32(Number(high))\r\n      this.writeUint32(Number(low))\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 写 8 位有符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public writeInt8(value: number) {\r\n    this.data.setInt8(this.pos++ + this.byteStart, value)\r\n  }\r\n\r\n  /**\r\n   * 写 16 位有符号整数\r\n   */\r\n  public writeInt16(value: number) {\r\n    this.data.setInt16(this.pos + this.byteStart, value, this.littleEndian)\r\n    this.pos += 2\r\n  }\r\n\r\n  /**\r\n   * 写 24 位有符号整数\r\n   */\r\n  public writeInt24(value: number) {\r\n    this.writeUint24(value < 0 ? (value + 0x1000000) : value)\r\n  }\r\n\r\n  /**\r\n   * 写 32 位有符号整数\r\n   */\r\n  public writeInt32(value: number) {\r\n    this.data.setInt32(this.pos + this.byteStart, value, this.littleEndian)\r\n    this.pos += 4\r\n  }\r\n\r\n  /**\r\n   * 写 64 位有符号整数\r\n   */\r\n  public writeInt64(value: bigint) {\r\n    const low = value & BigInt(0xffffffff)\r\n    const high = (value & (BigInt(0xffffffff) << 32n)) >> 32n\r\n    if (this.littleEndian) {\r\n      this.writeInt32(Number(low))\r\n      this.writeInt32(Number(high))\r\n    }\r\n    else {\r\n      this.writeInt32(Number(high))\r\n      this.writeInt32(Number(low))\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 写单精度浮点数\r\n   * \r\n   * @returns \r\n   */\r\n  public writeFloat(value: number) {\r\n    this.data.setFloat32(this.pos + this.byteStart, value, this.littleEndian)\r\n    this.pos += 4\r\n  }\r\n\r\n  /**\r\n   * 写双精度浮点数\r\n   */\r\n  public writeDouble(value: number) {\r\n    this.data.setFloat64(this.pos + this.byteStart, value, this.littleEndian)\r\n    this.pos += 8\r\n  }\r\n\r\n  /**\r\n   * 获取当前写指针\r\n   * \r\n   * @returns \r\n   */\r\n  public getPos() {\r\n    return this.pos\r\n  }\r\n\r\n  /**\r\n   * seek 写指针\r\n   * \r\n   * @param pos \r\n   */\r\n  public seek(pos: number) {\r\n    if (pos > this.size) {\r\n      pos = this.size\r\n    }\r\n    this.pos = Math.max(0, pos)\r\n  }\r\n\r\n  /**\r\n   * 跳过指定字节长度\r\n   * \r\n   * @param length \r\n   */\r\n  public skip(length: number) {\r\n    this.seek(this.pos + length)\r\n  }\r\n\r\n  /**\r\n   * 返回指定字节长度\r\n   * \r\n   * @param length \r\n   */\r\n  public back(length: number) {\r\n    this.seek(this.pos - length)\r\n  }\r\n\r\n  /**\r\n   * 获取剩余可写节数\r\n   * \r\n   * @returns \r\n   */\r\n  public remainingSize() {\r\n    return this.size - this.pos\r\n  }\r\n\r\n  /**\r\n   * 写指定长度的二进制 buffer 数据\r\n   * \r\n   * @param length \r\n   * @returns \r\n   */\r\n  public writeBuffer(buffer: Uint8ArrayInterface) {\r\n    let length = buffer.length\r\n    if (this.remainingSize() < length) {\r\n      length = this.remainingSize()\r\n      logger.warn(`the remaining buffer size is smaller then the wrote buffer, hope set ${buffer.length}, but set ${length}`)\r\n    }\r\n    this.buffer.set(buffer, this.pos)\r\n    this.pos += buffer.length\r\n  }\r\n\r\n  /**\r\n   * 写一个字符串\r\n   */\r\n  public writeString(str: string) {\r\n    const buffer = text.encode(str)\r\n    this.writeBuffer(buffer)\r\n    return buffer.length\r\n  }\r\n\r\n  /**\r\n   * 获取已写的数据\r\n   * \r\n   * @returns \r\n   */\r\n  public getWroteBuffer() {\r\n    return this.buffer.subarray(0, this.pos)\r\n  }\r\n\r\n  /**\r\n   * 重新装载数据\r\n   * \r\n   * @param data \r\n   * @param bigEndian \r\n   */\r\n  public resetBuffer(data: Uint8ArrayInterface, bigEndian: boolean = true) {\r\n    this.buffer = data\r\n    this.data = data instanceof Uint8Array ? new DataView(data.buffer) : data.view\r\n    this.byteStart = data instanceof Uint8Array ? data.byteOffset : 0\r\n\r\n    this.pos = 0\r\n    this.size = data.byteLength\r\n    this.littleEndian = !bigEndian\r\n  }\r\n}\r\n","\r\nconst RESIZE_CHUNK_SIZE = 1024 * 1024 * 5\r\n\r\n/**\r\n * 文件 IO\r\n */\r\nexport default class FileIO {\r\n\r\n  private handler: FileHandle\r\n\r\n  private file: File\r\n\r\n  private pos: number\r\n\r\n  private writer: FileSystemWritableFileStream\r\n\r\n  private append: boolean\r\n\r\n  private reader: FileReader\r\n\r\n  private size: number\r\n\r\n  private blobSlice: (start?: number, end?: number, contentType?: string) => void\r\n\r\n  private readied: boolean\r\n\r\n  private readHold: {\r\n    resolve: (data?: any) => void,\r\n    reject: (data?: any) => void,\r\n  }\r\n\r\n  constructor(handler: FileHandle, append: boolean = false) {\r\n    this.handler = handler\r\n    this.append = append\r\n    this.readied = false\r\n  }\r\n\r\n  public async ready() {\r\n\r\n    if (this.readied) {\r\n      return\r\n    }\r\n\r\n    this.file = await this.handler.getFile()\r\n    this.writer = await this.handler.createWritable()\r\n    this.pos = this.append ? this.file.size : 0\r\n    this.size = this.pos\r\n\r\n    this.reader = new FileReader()\r\n\r\n    this.blobSlice = File.prototype.slice || File.prototype.mozSlice || File.prototype.webkitSlice\r\n\r\n    this.reader.onloadend = (event) => {\r\n      if (this.readHold) {\r\n        this.readHold.resolve(event.target.result)\r\n        this.readHold = null\r\n      }\r\n    }\r\n\r\n    this.readied = true\r\n  }\r\n\r\n  private async write_(data: ArrayBuffer | ArrayBufferView) {\r\n    await this.writer.write(data)\r\n    this.pos += data.byteLength\r\n    if (this.pos > this.size) {\r\n      this.size += data.byteLength\r\n    }\r\n  }\r\n\r\n  public async write(data: ArrayBuffer | ArrayBufferView) {\r\n    await this.write_(data)\r\n  }\r\n\r\n  private async seek_(position: number) {\r\n    await this.writer.seek(position)\r\n    this.pos = position\r\n  }\r\n\r\n  public async seek(position: number) {\r\n    await this.seek_(position)\r\n  }\r\n\r\n  public async seekToEnd() {\r\n    await this.seek_(this.size)\r\n  }\r\n\r\n  private async resize_(size: number) {\r\n    if (size !== this.file.size) {\r\n      if (size < this.file.size) {\r\n        this.pos = this.file.size\r\n      }\r\n      await this.writer.truncate(size)\r\n      this.size = size\r\n    }\r\n  }\r\n\r\n  public async resize(size: number) {\r\n    await this.resize_(size)\r\n  }\r\n\r\n  public async read_(start: number, end: number): Promise<ArrayBuffer> {\r\n    return new Promise((resolve, reject) => {\r\n      this.readHold = {\r\n        resolve,\r\n        reject\r\n      }\r\n      this.reader.readAsArrayBuffer(this.blobSlice.call(this.file, start, end))\r\n    })\r\n  }\r\n\r\n  public async read(start: number, end: number): Promise<ArrayBuffer> {\r\n    return await this.read_(start, end)\r\n  }\r\n\r\n  public async appendBufferByPosition(buffer: ArrayBuffer | Uint8Array, position: number) {\r\n    await this.writer.close()\r\n    this.file = await this.handler.getFile()\r\n    this.writer = await this.handler.createWritable({\r\n      keepExistingData: true\r\n    })\r\n\r\n    const size = this.file.size\r\n    const length = buffer.byteLength\r\n\r\n    if (position >= this.file.size) {\r\n      await this.resize_(position + length)\r\n      await this.seek_(position)\r\n      await this.write_(buffer)\r\n    }\r\n    else {\r\n      let start = position\r\n      await this.seek_(position)\r\n      await this.write_(buffer)\r\n      while (start < size) {\r\n        const buffer = await this.read_(start, Math.min(start + RESIZE_CHUNK_SIZE, size))\r\n        await this.write_(buffer)\r\n        start += buffer.byteLength\r\n      }\r\n    }\r\n  }\r\n\r\n  private async close_() {\r\n\r\n    if (!this.readied) {\r\n      return\r\n    }\r\n\r\n    await this.writer.close()\r\n    this.file = await this.handler.getFile()\r\n    this.readied = false\r\n  }\r\n\r\n  public async close() {\r\n    await this.close_()\r\n  }\r\n\r\n  public getFile() {\r\n    return this.file\r\n  }\r\n\r\n  public getHandle() {\r\n    return this.handler\r\n  }\r\n\r\n  public getPos() {\r\n    return this.pos\r\n  }\r\n\r\n  public getSize() {\r\n    return this.size\r\n  }\r\n\r\n  public async destroy() {\r\n    await this.close_()\r\n    this.handler = null\r\n    this.file = null\r\n  }\r\n}\r\n","/**\r\n * 读字节流工具\r\n */\r\n\r\nimport { IOError } from './error'\r\nimport * as logger from '../util/logger'\r\nimport IOWriter from './IOWriter'\r\nimport * as text from '../util/text'\r\nimport { Uint8ArrayInterface, BytesReader } from './interface'\r\nimport Sleep from '../timer/Sleep'\r\n\r\nexport default class IOReader implements BytesReader {\r\n\r\n  private data: DataView\r\n\r\n  private buffer: Uint8ArrayInterface\r\n\r\n  private pointer: number\r\n\r\n  private endPointer: number\r\n\r\n  private pos: bigint\r\n\r\n  private size: number\r\n\r\n  private littleEndian: boolean\r\n\r\n  private fileSize_: bigint\r\n\r\n  public error: number\r\n\r\n  public onFlush: (buffer: Uint8Array) => Promise<number> | number\r\n\r\n  public onSeek: (seek: bigint) => Promise<number> | number\r\n\r\n  public onSize: () => Promise<bigint> | bigint\r\n\r\n  public flags: number\r\n\r\n  /**\r\n   * @param data 待读取的字节\r\n   * @param bigEndian 是否按大端字节序读取，默认大端字节序（网络字节序）\r\n   */\r\n  constructor(size: number = 1 * 1024 * 1024, bigEndian: boolean = true, map?: Uint8ArrayInterface) {\r\n    this.pos = 0n\r\n    this.pointer = 0\r\n    this.error = 0\r\n\r\n    this.endPointer = 0\r\n    this.littleEndian = !bigEndian\r\n    this.flags = 0\r\n\r\n    if (map && map.view) {\r\n      this.size = map.length\r\n      this.buffer = map\r\n      this.data = map.view\r\n    }\r\n    else if (map && !map.byteOffset) {\r\n      this.size = map.length\r\n      this.buffer = map\r\n      this.data = new DataView(this.buffer.buffer)\r\n    }\r\n    else {\r\n\r\n      if (map) {\r\n        throw new Error('not support subarray of ArrayBuffer')\r\n      }\r\n\r\n      this.size = Math.max(size, 100 * 1024)\r\n      this.buffer = new Uint8Array(this.size)\r\n      this.data = new DataView(this.buffer.buffer)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 读取 8 位无符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public async readUint8() {\r\n    if (this.remainingLength() < 1) {\r\n      await this.flush(1)\r\n    }\r\n    const value = this.data.getUint8(this.pointer)\r\n    this.pointer++\r\n    this.pos++\r\n    return value\r\n  }\r\n  /**\r\n   * 读取 8 位无符号整数（不会移动读取指针位置）\r\n   * \r\n   * @returns \r\n   */\r\n  public async peekUint8() {\r\n    if (this.remainingLength() < 1) {\r\n      await this.flush(1)\r\n    }\r\n    return this.data.getUint8(this.pointer)\r\n  }\r\n\r\n  /**\r\n   * 读取 16 位无符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public async readUint16() {\r\n    if (this.remainingLength() < 2) {\r\n      await this.flush(2)\r\n    }\r\n    const value = this.data.getUint16(this.pointer, this.littleEndian)\r\n    this.pointer += 2\r\n    this.pos += 2n\r\n    return value\r\n  }\r\n  /**\r\n   * 读取 16 位无符号整数（不会移动读取指针位置）\r\n   * \r\n   * @returns \r\n   */\r\n  public async peekUint16() {\r\n    if (this.remainingLength() < 2) {\r\n      await this.flush(2)\r\n    }\r\n    return this.data.getUint16(this.pointer, this.littleEndian)\r\n  }\r\n\r\n  /**\r\n   * 读取 24 位无符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public async readUint24() {\r\n    if (this.remainingLength() < 3) {\r\n      await this.flush(3)\r\n    }\r\n    const high = await this.readUint16()\r\n    const low = await this.readUint8()\r\n    return this.littleEndian ? (low << 16 | high) : (high << 8 | low)\r\n  }\r\n  /**\r\n   * 读取 24 位无符号整数（不会移动读取指针位置）\r\n   * \r\n   * @returns \r\n   */\r\n  public async peekUint24() {\r\n    if (this.remainingLength() < 3) {\r\n      await this.flush(3)\r\n    }\r\n    const pointer = this.pointer\r\n    const pos = this.pos\r\n\r\n    const high = await this.readUint16()\r\n    const low = await this.readUint8()\r\n    const value = this.littleEndian ? (low << 16 | high) : (high << 8 | low)\r\n\r\n    this.pointer = pointer\r\n    this.pos = pos\r\n\r\n    return value\r\n  }\r\n\r\n  /**\r\n   * 读取 32 位无符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public async readUint32() {\r\n    if (this.remainingLength() < 4) {\r\n      await this.flush(4)\r\n    }\r\n    const value = this.data.getUint32(this.pointer, this.littleEndian)\r\n    this.pointer += 4\r\n    this.pos += 4n\r\n    return value\r\n  }\r\n  /**\r\n   * 读取 32 位无符号整数（不会移动读取指针位置）\r\n   * \r\n   * @returns \r\n   */\r\n  public async peekUint32() {\r\n    if (this.remainingLength() < 4) {\r\n      await this.flush(4)\r\n    }\r\n    return this.data.getUint32(this.pointer, this.littleEndian)\r\n  }\r\n\r\n  /**\r\n   * 读取 64 位无符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public async readUint64() {\r\n    if (this.remainingLength() < 8) {\r\n      await this.flush(8)\r\n    }\r\n    const value = this.data.getBigUint64(this.pointer, this.littleEndian)\r\n    this.pointer += 8\r\n    this.pos += 8n\r\n    return value\r\n  }\r\n  /**\r\n   * 读取 64 位无符号整数（不会移动读取指针位置）\r\n   * \r\n   * @returns \r\n   */\r\n  public async peekUint64() {\r\n    if (this.remainingLength() < 8) {\r\n      await this.flush(8)\r\n    }\r\n    return this.data.getBigUint64(this.pointer, this.littleEndian)\r\n  }\r\n\r\n  /**\r\n   * 读取 8 位有符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public async readInt8() {\r\n    if (this.remainingLength() < 1) {\r\n      await this.flush(1)\r\n    }\r\n    const value = this.data.getInt8(this.pointer)\r\n    this.pointer++\r\n    this.pos++\r\n    return value\r\n  }\r\n  /**\r\n   * 读取 8 位有符号整数（不会移动读取指针位置）\r\n   * \r\n   * @returns \r\n   */\r\n  public async peekInt8() {\r\n    if (this.remainingLength() < 1) {\r\n      await this.flush(1)\r\n    }\r\n    return this.data.getInt8(this.pointer)\r\n  }\r\n\r\n  /**\r\n   * 读取 16 位有符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public async readInt16() {\r\n    if (this.remainingLength() < 2) {\r\n      await this.flush(2)\r\n    }\r\n    const value = this.data.getInt16(this.pointer, this.littleEndian)\r\n    this.pointer += 2\r\n    this.pos += 2n\r\n    return value\r\n  }\r\n  /**\r\n   * 读取 16 位有符号整数（不会移动读取指针位置）\r\n   * \r\n   * @returns \r\n   */\r\n  public async peekInt16() {\r\n    if (this.remainingLength() < 2) {\r\n      await this.flush(2)\r\n    }\r\n    return this.data.getInt16(this.pointer, this.littleEndian)\r\n  }\r\n\r\n  /**\r\n   * 读取 24 位有符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public async readInt24() {\r\n    const value = await this.readUint24()\r\n    return (value & 0x800000) ? (value - 0x1000000) : value\r\n  }\r\n  /**\r\n   * 读取 24 位有符号整数（不会移动读取指针位置）\r\n   * \r\n   * @returns \r\n   */\r\n  public async peekInt24() {\r\n    const value = await this.peekUint24()\r\n    return (value & 0x800000) ? (value - 0x1000000) : value\r\n  }\r\n\r\n  /**\r\n   * 读取 32 位有符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public async readInt32() {\r\n    if (this.remainingLength() < 4) {\r\n      await this.flush(4)\r\n    }\r\n    const value = this.data.getInt32(this.pointer, this.littleEndian)\r\n    this.pointer += 4\r\n    this.pos += 4n\r\n    return value\r\n  }\r\n  /**\r\n   * 读取 32 位有符号整数（不会移动读取指针位置）\r\n   * \r\n   * @returns \r\n   */\r\n  public async peekInt32() {\r\n    if (this.remainingLength() < 4) {\r\n      await this.flush(4)\r\n    }\r\n    return this.data.getInt32(this.pointer, this.littleEndian)\r\n  }\r\n\r\n  /**\r\n   * 读取 64 位有符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public async readInt64() {\r\n    if (this.remainingLength() < 8) {\r\n      await this.flush(8)\r\n    }\r\n\r\n    const value = this.data.getBigInt64(this.pointer, this.littleEndian)\r\n    this.pointer += 8\r\n    this.pos += 8n\r\n    return value\r\n  }\r\n  /**\r\n   * 读取 64 位有符号整数（不会移动读取指针位置）\r\n   * \r\n   * @returns \r\n   */\r\n  public async peekInt64() {\r\n    if (this.remainingLength() < 8) {\r\n      await this.flush(8)\r\n    }\r\n    return this.data.getBigInt64(this.pointer, this.littleEndian)\r\n  }\r\n\r\n  /**\r\n   * 读取单精度浮点数\r\n   * \r\n   * @returns \r\n   */\r\n  public async readFloat() {\r\n    if (this.remainingLength() < 4) {\r\n      await this.flush(4)\r\n    }\r\n    const value = this.data.getFloat32(this.pointer, this.littleEndian)\r\n    this.pointer += 4\r\n    this.pos += 4n\r\n    return value\r\n  }\r\n  /**\r\n   * 读取单精度浮点数（不会移动读取指针位置）\r\n   * \r\n   * @returns \r\n   */\r\n  public async peekFloat() {\r\n    if (this.remainingLength() < 4) {\r\n      await this.flush(4)\r\n    }\r\n    return this.data.getFloat32(this.pointer, this.littleEndian)\r\n  }\r\n\r\n  /**\r\n   * 读取双精度浮点数\r\n   * \r\n   * @returns \r\n   */\r\n  public async readDouble() {\r\n    if (this.remainingLength() < 8) {\r\n      await this.flush(8)\r\n    }\r\n    const value = this.data.getFloat64(this.pointer, this.littleEndian)\r\n    this.pointer += 8\r\n    this.pos += 8n\r\n    return value\r\n  }\r\n  /**\r\n   * 读取双精度浮点数（不会移动读取指针位置）\r\n   * \r\n   * @returns \r\n   */\r\n  public async peekDouble() {\r\n    if (this.remainingLength() < 8) {\r\n      await this.flush(8)\r\n    }\r\n    return this.data.getFloat64(this.pointer, this.littleEndian)\r\n  }\r\n\r\n  /**\r\n   * 读取指定长度的字节，并以 16 进制字符串返回\r\n   * \r\n   * @param length 默认 1\r\n   * @returns \r\n   */\r\n  public async readHex(length: number = 1) {\r\n    let hexStr = ''\r\n    for (let i = 0; i < length; i++) {\r\n      const hex = (await this.readUint8()).toString(16)\r\n      hexStr += (hex.length === 1 ? '0' + hex : hex)\r\n    }\r\n    return hexStr\r\n  }\r\n  /**\r\n   * 读取指定长度的字节，并以 16 进制字符串返回（不会移动读取指针位置）\r\n   * \r\n   * @param length 默认 1\r\n   * @returns \r\n   */\r\n  public async peekHex(length: number = 1) {\r\n\r\n    if (length > this.size) {\r\n      this.error = IOError.INVALID_OPERATION\r\n      logger.fatal('peekHex, length too large')\r\n    }\r\n\r\n    if (this.remainingLength() < length) {\r\n      await this.flush(length)\r\n    }\r\n\r\n    const pointer = this.pointer\r\n    const pos = this.pos\r\n\r\n    let hexStr = ''\r\n    for (let i = 0; i < length; i++) {\r\n      const hex = (await this.readUint8()).toString(16)\r\n      hexStr += (hex.length === 1 ? '0' + hex : hex)\r\n    }\r\n\r\n    this.pointer = pointer\r\n    this.pos = pos\r\n\r\n    return hexStr\r\n  }\r\n\r\n  /**\r\n   * 读取指定长度的二进制数据，不够抛错\r\n   * \r\n   * 第二个参数可传入预先分配的 buffer\r\n   * \r\n   * 返回读取的 Uint8Array\r\n   * \r\n   * @param length \r\n   * @returns \r\n   */\r\n  public async readBuffer(length: number): Promise<Uint8Array>\r\n  public async readBuffer<T extends Uint8ArrayInterface>(length: number, buffer: T): Promise<T>\r\n  public async readBuffer(length: number, buffer?: Uint8ArrayInterface): Promise<Uint8ArrayInterface> {\r\n\r\n    if (!buffer) {\r\n      buffer = new Uint8Array(length)\r\n    }\r\n\r\n    if (this.remainingLength() < length) {\r\n      let index = 0\r\n\r\n      if (this.remainingLength() > 0) {\r\n        const len = this.remainingLength()\r\n        buffer.set(this.buffer.subarray(this.pointer, this.pointer + len), index)\r\n        index += len\r\n        this.pointer += len\r\n        this.pos += BigInt(len)\r\n        length -= len\r\n      }\r\n\r\n      while (length > 0) {\r\n        await this.flush()\r\n\r\n        const len = Math.min(this.endPointer - this.pointer, length)\r\n\r\n        buffer.set(this.buffer.subarray(this.pointer, this.pointer + len), index)\r\n\r\n        index += len\r\n        this.pointer += len\r\n        this.pos += BigInt(len)\r\n        length -= len\r\n      }\r\n    }\r\n    else {\r\n      buffer.set(this.buffer.subarray(this.pointer, this.pointer + length), 0)\r\n      this.pointer += length\r\n      this.pos += BigInt(length)\r\n    }\r\n\r\n    return buffer\r\n  }\r\n  /**\r\n   * 读取指定长度的二进制 buffer 数据（不会移动读取指针位置）\r\n   * \r\n   * @param length \r\n   * @returns \r\n   */\r\n  public async peekBuffer(length: number): Promise<Uint8Array >\r\n  public async peekBuffer<T extends Uint8ArrayInterface>(length: number, buffer: T): Promise<T>\r\n  public async peekBuffer(length: number, buffer?: Uint8ArrayInterface): Promise<Uint8ArrayInterface> {\r\n\r\n    if (length > this.size) {\r\n      this.error = IOError.INVALID_OPERATION\r\n      logger.fatal('peekBuffer, length too large')\r\n    }\r\n\r\n    if (this.remainingLength() < length) {\r\n      await this.flush(length)\r\n    }\r\n\r\n    if (!buffer) {\r\n      buffer = new Uint8Array(length)\r\n    }\r\n\r\n    buffer.set(this.buffer.subarray(this.pointer, this.pointer + length), 0)\r\n\r\n    return buffer\r\n  }\r\n\r\n  /**\r\n   * 读取最多 length 字节的数据到指定 buffer，返回已写入的字节长度\r\n   * \r\n   * @param length \r\n   * @param buffer \r\n   * @returns \r\n   */\r\n  public async readToBuffer(length: number, buffer: Uint8ArrayInterface): Promise<number> {\r\n    if (this.remainingLength() < length) {\r\n      let index = 0\r\n\r\n      if (this.remainingLength() > 0) {\r\n        const len = this.remainingLength()\r\n        buffer.set(this.buffer.subarray(this.pointer, this.pointer + len), index)\r\n        index += len\r\n        this.pointer += len\r\n        this.pos += BigInt(len)\r\n        length -= len\r\n      }\r\n\r\n      while (length > 0) {\r\n        try {\r\n          await this.flush()\r\n        }\r\n        catch (error) {\r\n          if (this.error === IOError.END && index) {\r\n            return index\r\n          }\r\n          else {\r\n            throw error\r\n          }\r\n        }\r\n\r\n        const len = Math.min(this.endPointer - this.pointer, length)\r\n\r\n        buffer.set(this.buffer.subarray(this.pointer, this.pointer + len), index)\r\n\r\n        index += len\r\n        this.pointer += len\r\n        this.pos += BigInt(len)\r\n        length -= len\r\n      }\r\n      return index\r\n    }\r\n    else {\r\n      buffer.set(this.buffer.subarray(this.pointer, this.pointer + length), 0)\r\n      this.pointer += length\r\n      this.pos += BigInt(length)\r\n      return length\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 读取指定长度的字符串\r\n   * \r\n   * @param length 默认 1\r\n   * @returns \r\n   */\r\n  public async readString(length: number = 1) {\r\n    const buffer = await this.readBuffer(length)\r\n    return text.decode(buffer)\r\n  }\r\n  /**\r\n   * 读取指定长度的字符串（不会移动读取指针位置）\r\n   * \r\n   * @param length 默认 1\r\n   * @returns \r\n   */\r\n  public async peekString(length: number = 1) {\r\n    const buffer = await this.peekBuffer(length)\r\n    return text.decode(buffer)\r\n  }\r\n\r\n  /**\r\n   * 读取一行字符\r\n   */\r\n  public async readLine() {\r\n    let str = ''\r\n\r\n    while (true) {\r\n      let got = false\r\n      for (let i = this.pointer; i < this.endPointer; i++) {\r\n        if (this.buffer[i] === 0x0a || this.buffer[i] === 0x0d) {\r\n          if (i !== this.pointer) {\r\n            str += await this.readString(i - this.pointer)\r\n          }\r\n          got = true\r\n          break\r\n        }\r\n      }\r\n\r\n      if (!got) {\r\n        str += await this.readString(this.remainingLength())\r\n        await this.flush()\r\n      }\r\n      else {\r\n        break\r\n      }\r\n    }\r\n\r\n    let next = await this.peekUint8()\r\n    if (next === 0x0a || next === 0x0d) {\r\n      this.pointer++\r\n      if (next === 0x0d) {\r\n        next = await this.peekUint8()\r\n        // \\r\\n\r\n        if (next === 0x0a) {\r\n          this.pointer++\r\n        }\r\n      }\r\n    }\r\n\r\n    return str\r\n  }\r\n  /**\r\n   * 读取一行字符（不会移动读取指针位置）\r\n   */\r\n  public async peekLine() {\r\n    if (this.remainingLength() < this.size) {\r\n      try {\r\n        await this.flush()\r\n      }\r\n      catch (error) {\r\n        if (this.error !== IOError.END) {\r\n          throw error\r\n        }\r\n      }\r\n    }\r\n\r\n    let str = ''\r\n\r\n    let got = false\r\n    for (let i = this.pointer; i < this.endPointer; i++) {\r\n      if (this.buffer[i] === 0x0a || this.buffer[i] === 0x0d) {\r\n        str += await this.peekString(i - this.pointer)\r\n        got = true\r\n        break\r\n      }\r\n    }\r\n\r\n    if (!got) {\r\n      this.error = IOError.INVALID_OPERATION\r\n      logger.fatal('peekLine, out of buffer')\r\n    }\r\n    return str\r\n  }\r\n\r\n  /**\r\n   * 获取当前读取指针\r\n   * \r\n   * @returns \r\n   */\r\n  public getPointer() {\r\n    return this.pointer\r\n  }\r\n\r\n  /**\r\n   * 获取已读字节偏移\r\n   * \r\n   * @returns \r\n   */\r\n  public getPos() {\r\n    return this.pos\r\n  }\r\n\r\n  /**\r\n   * 跳过指定字节长度\r\n   * \r\n   * @param length \r\n   */\r\n  public async skip(length: number) {\r\n\r\n    const backup = length\r\n\r\n    while (this.remainingLength() < length) {\r\n      length -= this.remainingLength()\r\n      this.pointer = this.endPointer\r\n      await this.flush()\r\n    }\r\n\r\n    if (this.remainingLength() >= length) {\r\n      this.pointer += length\r\n    }\r\n\r\n    this.pos += BigInt(backup)\r\n  }\r\n\r\n  /**\r\n   * 获取剩余可读字节数\r\n   * \r\n   * @returns \r\n   */\r\n  public remainingLength() {\r\n    return this.endPointer - this.pointer\r\n  }\r\n\r\n  private async flush_(buffer: Uint8Array) {\r\n    while (true) {\r\n      const len = await this.onFlush(buffer)\r\n      if (len !== IOError.AGAIN) {\r\n        return len\r\n      }\r\n      await new Sleep(0)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 重新填充剩余缓冲区\r\n   * \r\n   * @param need \r\n   * @returns \r\n   */\r\n  public async flush(need: number = 0) {\r\n\r\n    if (!this.onFlush) {\r\n      this.error = IOError.INVALID_OPERATION\r\n      logger.fatal('IOReader error, flush failed because of no flush callback')\r\n    }\r\n\r\n    if (this.size - this.remainingLength() <= 0) {\r\n      return\r\n    }\r\n\r\n    need = Math.min(need, this.size)\r\n\r\n    if (this.pointer < this.endPointer) {\r\n      this.buffer.set(this.buffer.subarray(this.pointer, this.endPointer), 0)\r\n      this.endPointer = this.endPointer - this.pointer\r\n    }\r\n    else {\r\n      this.endPointer = 0\r\n    }\r\n\r\n    this.pointer = 0\r\n\r\n    if (need) {\r\n      while (this.remainingLength() < need) {\r\n        const len = await this.flush_(this.buffer.subarray(this.endPointer))\r\n        if (len < 0) {\r\n          this.error = len\r\n          throw new Error(`IOReader error, flush ${len === IOError.END ? 'ended' : 'failed'}, ret: ${len}`)\r\n        }\r\n        this.endPointer += len\r\n      }\r\n    }\r\n    else {\r\n      const len = await this.flush_(this.buffer.subarray(this.endPointer))\r\n      if (len < 0) {\r\n        this.error = len\r\n        throw new Error(`IOReader error, flush ${len === IOError.END ? 'ended' : 'failed'}, ret: ${len}`)\r\n      }\r\n      this.endPointer += len\r\n    }\r\n    this.error = 0\r\n  }\r\n\r\n  /**\r\n   * \r\n   * seek 到指定位置\r\n   * \r\n   * @param pos \r\n   * @param force false 时可以在目前的缓冲区内 seek，否则丢弃缓冲区内容重新填充指定位置的数据，默认 false\r\n   * @param flush 指定 seek 之后是否马上填充数据，否则只 seek 到目标位置，默认 true\r\n   * @returns \r\n   */\r\n  public async seek(pos: bigint, force: boolean = false, flush: boolean = true) {\r\n    if (!force) {\r\n      const len = Number(pos - this.pos)\r\n      // 可以往回 seek\r\n      if (len < 0 && Math.abs(len) < this.pointer) {\r\n        this.pointer += len\r\n        this.pos = pos\r\n        return\r\n      }\r\n      // 可以直接往后 seek\r\n      else if (len > 0 && this.pointer + len < this.endPointer) {\r\n        this.pointer += len\r\n        this.pos = pos\r\n        return\r\n      }\r\n      else if (len === 0) {\r\n        return\r\n      }\r\n    }\r\n\r\n    if (!this.onSeek) {\r\n      this.error = IOError.INVALID_OPERATION\r\n      logger.fatal('IOReader error, seek failed because of no seek callback')\r\n    }\r\n\r\n    this.pointer = this.endPointer = 0\r\n    this.pos = pos\r\n    const ret = await this.onSeek(pos)\r\n\r\n    if (ret !== 0) {\r\n      this.error = ret\r\n      logger.fatal('IOReader error, seek failed')\r\n    }\r\n    if (flush) {\r\n      await this.flush()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 获取缓冲区\r\n   */\r\n  public getBuffer() {\r\n    return this.buffer\r\n  }\r\n\r\n  /**\r\n   * 写入数据到缓冲区\r\n   * \r\n   * @param buffer \r\n   */\r\n  public appendBuffer(buffer: Uint8Array) {\r\n    if (this.size - this.endPointer >= buffer.length) {\r\n      this.buffer.set(buffer, this.endPointer)\r\n      this.endPointer += buffer.length\r\n    }\r\n    else {\r\n      this.buffer.set(this.buffer.subarray(this.pointer, this.endPointer), 0)\r\n      this.endPointer = this.endPointer - this.pointer\r\n      this.pointer = 0\r\n\r\n      if (this.size - this.endPointer >= buffer.length) {\r\n        this.buffer.set(buffer, this.endPointer)\r\n        this.endPointer += buffer.length\r\n      }\r\n      else {\r\n        const len = Math.min(this.size - this.endPointer, buffer.length)\r\n        this.buffer.set(buffer.subarray(0, len), this.endPointer)\r\n        this.endPointer += len\r\n\r\n        logger.warn('IOReader, call appendBuffer but the buffer\\'s size is lagger then the remaining size')\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 重置 reader\r\n   */\r\n  public reset() {\r\n    this.pointer = this.endPointer = 0\r\n    this.pos = 0n\r\n    this.error = 0\r\n  }\r\n\r\n  /**\r\n   * 设置读取是小端还是大端\r\n   * \r\n   * @param bigEndian \r\n   */\r\n  public setEndian(bigEndian: boolean) {\r\n    this.littleEndian = !bigEndian\r\n  }\r\n\r\n  /**\r\n   * 获取源总字节长度\r\n   * \r\n   * @returns \r\n   */\r\n  public async fileSize() {\r\n    if (this.fileSize_) {\r\n      return this.fileSize_\r\n    }\r\n    if (!this.onSize) {\r\n      logger.warn('IOReader error, fileSize failed because of no onSize callback')\r\n      return 0n\r\n    }\r\n    try {\r\n      this.fileSize_ = await this.onSize()\r\n    }\r\n    catch (error) {\r\n      logger.warn(`IOReader error, call fileSize failed: ${error}`)\r\n      this.fileSize_ = 0n\r\n    }\r\n    return this.fileSize_\r\n  }\r\n\r\n  /**\r\n   * 获取缓冲区长度\r\n   * \r\n   * @returns \r\n   */\r\n  public getBufferSize() {\r\n    return this.size\r\n  }\r\n\r\n  /**\r\n   * 连接到 ioWriter\r\n   * \r\n   * @param ioWriter \r\n   * @param length \r\n   */\r\n  public async pipe(ioWriter: IOWriter, length?: number) {\r\n    if (length) {\r\n      if (this.remainingLength() < length) {\r\n        if (this.remainingLength() > 0) {\r\n          const len = this.remainingLength()\r\n          await ioWriter.writeBuffer(this.buffer.subarray(this.pointer, this.pointer + len))\r\n          this.pointer += len\r\n          this.pos += BigInt(len)\r\n          length -= len\r\n        }\r\n\r\n        while (length > 0) {\r\n          await this.flush()\r\n          const len = Math.min(this.remainingLength(), length)\r\n          await ioWriter.writeBuffer(this.buffer.subarray(this.pointer, this.pointer + len))\r\n          this.pointer += len\r\n          this.pos += BigInt(len)\r\n          length -= len\r\n        }\r\n      }\r\n      else {\r\n        await ioWriter.writeBuffer(this.buffer.subarray(this.pointer, this.pointer + length))\r\n        this.pointer += length\r\n        this.pos += BigInt(length)\r\n      }\r\n    }\r\n    else {\r\n      if (this.remainingLength() > 0) {\r\n        const len = this.remainingLength()\r\n        await ioWriter.writeBuffer(this.buffer.subarray(this.pointer, this.pointer + len))\r\n        this.pointer += len\r\n        this.pos += BigInt(len)\r\n      }\r\n\r\n      while (await this.flush_(this.buffer.subarray(0)) > 0) {\r\n        const len = this.remainingLength()\r\n        await ioWriter.writeBuffer(this.buffer.subarray(this.pointer, this.pointer + len))\r\n        this.pointer += len\r\n        this.pos += BigInt(len)\r\n      }\r\n    }\r\n  }\r\n}\r\n","/**\r\n * 写字节流工具\r\n */\r\n\r\nimport { IOError } from './error'\r\nimport * as text from '../util/text'\r\nimport { Uint8ArrayInterface, BytesWriter } from './interface'\r\n\r\nexport default class IOWriter implements BytesWriter {\r\n\r\n  private data: DataView\r\n\r\n  private buffer: Uint8ArrayInterface\r\n\r\n  private pointer: number\r\n\r\n  private pos: bigint\r\n\r\n  private size: number\r\n\r\n  private littleEndian: boolean\r\n\r\n  public error: number\r\n\r\n  public onFlush: (data: Uint8Array, pos?: bigint) => Promise<number>\r\n  public onSeek: (seek: bigint) =>  Promise<number>\r\n\r\n  /**\r\n   * @param data 待写的 Uint8Array\r\n   * @param bigEndian 是否按大端字节序写，默认大端字节序（网络字节序）\r\n   */\r\n  constructor(size: number = 1 * 1024 * 1024, bigEndian: boolean = true, map?: Uint8ArrayInterface) {\r\n    this.pointer = 0\r\n    this.pos = 0n\r\n    this.size = size\r\n    this.littleEndian = !bigEndian\r\n    this.error = 0\r\n\r\n    if (map && map.view) {\r\n      this.size = map.length\r\n      this.buffer = map\r\n      this.data = map.view\r\n    }\r\n    else if (map && !map.byteOffset) {\r\n      this.size = map.length\r\n      this.buffer = map\r\n      this.data = new DataView(this.buffer.buffer)\r\n    }\r\n    else {\r\n\r\n      if (map) {\r\n        throw new Error('not support subarray of ArrayBuffer')\r\n      }\r\n\r\n      this.buffer = new Uint8Array(this.size)\r\n      this.data = new DataView(this.buffer.buffer)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 写 8 位无符号整数\r\n   */\r\n  public async writeUint8(value: number) {\r\n    if (this.remainingLength() < 1) {\r\n      await this.flush()\r\n    }\r\n    this.data.setUint8(this.pointer, value)\r\n    this.pointer++\r\n    this.pos++\r\n  }\r\n\r\n  /**\r\n   * 读取 16 位无符号整数\r\n   */\r\n  public async writeUint16(value: number) {\r\n    if (this.remainingLength() < 2) {\r\n      await this.flush()\r\n    }\r\n    this.data.setUint16(this.pointer, value, this.littleEndian)\r\n    this.pointer += 2\r\n    this.pos += 2n\r\n  }\r\n\r\n  /**\r\n   * 写 24 位无符号整数\r\n   */\r\n  public async writeUint24(value: number) {\r\n    if (this.remainingLength() < 3) {\r\n      await this.flush()\r\n    }\r\n    const high = (value & 0xff0000) >> 16\r\n    const middle = (value & 0x00ff00) >> 8\r\n    const low = value & 0x0000ff\r\n    if (this.littleEndian) {\r\n      await this.writeUint8(low)\r\n      await this.writeUint8(middle)\r\n      await this.writeUint8(high)\r\n    }\r\n    else {\r\n      await this.writeUint8(high)\r\n      await this.writeUint8(middle)\r\n      await this.writeUint8(low)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 写 32 位无符号整数\r\n   */\r\n  public async writeUint32(value: number) {\r\n    if (this.remainingLength() < 4) {\r\n      await this.flush()\r\n    }\r\n    this.data.setUint32(this.pointer, value, this.littleEndian)\r\n    this.pointer += 4\r\n    this.pos += 4n\r\n  }\r\n\r\n  /**\r\n   * 写 64 位无符号整数\r\n   */\r\n  public async writeUint64(value: bigint) {\r\n    if (this.remainingLength() < 8) {\r\n      await this.flush()\r\n    }\r\n    this.data.setBigUint64(this.pointer, value, this.littleEndian)\r\n    this.pointer += 8\r\n    this.pos += 8n\r\n  }\r\n\r\n  /**\r\n   * 写 8 位有符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public async writeInt8(value: number) {\r\n    if (this.remainingLength() < 1) {\r\n      await this.flush()\r\n    }\r\n    this.data.setInt8(this.pointer, value)\r\n    this.pointer++\r\n    this.pos++\r\n  }\r\n\r\n  /**\r\n   * 写 16 位有符号整数\r\n   */\r\n  public async writeInt16(value: number) {\r\n    if (this.remainingLength() < 2) {\r\n      await this.flush()\r\n    }\r\n    this.data.setInt16(this.pointer, value, this.littleEndian)\r\n    this.pointer += 2\r\n    this.pos += 2n\r\n  }\r\n\r\n  /**\r\n   * 写 24 位有符号整数\r\n   */\r\n  public async writeInt24(value: number) {\r\n    await this.writeUint24(value < 0 ? (value + 0x1000000) : value)\r\n  }\r\n\r\n  /**\r\n   * 写 32 位有符号整数\r\n   */\r\n  public async writeInt32(value: number) {\r\n    if (this.remainingLength() < 4) {\r\n      await this.flush()\r\n    }\r\n    this.data.setInt32(this.pointer, value, this.littleEndian)\r\n    this.pointer += 4\r\n    this.pos += 4n\r\n  }\r\n\r\n  /**\r\n   * 写 64 位有符号整数\r\n   */\r\n  public async writeInt64(value: bigint) {\r\n    if (this.remainingLength() < 8) {\r\n      await this.flush()\r\n    }\r\n    this.data.setBigInt64(this.pointer, value, this.littleEndian)\r\n    this.pointer += 8\r\n    this.pos += 8n\r\n  }\r\n\r\n  /**\r\n   * 写单精度浮点数\r\n   * \r\n   * @returns \r\n   */\r\n  public async writeFloat(value: number) {\r\n    if (this.remainingLength() < 4) {\r\n      await this.flush()\r\n    }\r\n    this.data.setFloat32(this.pointer, value, this.littleEndian)\r\n    this.pointer += 4\r\n    this.pos += 4n\r\n  }\r\n\r\n  /**\r\n   * 写双精度浮点数\r\n   */\r\n  public async writeDouble(value: number) {\r\n    if (this.remainingLength() < 8) {\r\n      await this.flush()\r\n    }\r\n    this.data.setFloat64(this.pointer, value, this.littleEndian)\r\n    this.pointer += 8\r\n    this.pos += 8n\r\n  }\r\n\r\n  /**\r\n   * 获取当前写指针\r\n   * \r\n   * @returns \r\n   */\r\n  public getPointer() {\r\n    return this.pointer\r\n  }\r\n\r\n  public getPos() {\r\n    return this.pos\r\n  }\r\n\r\n  /**\r\n   * 获取剩余可写节数\r\n   * \r\n   * @returns \r\n   */\r\n  public remainingLength() {\r\n    return this.size - this.pointer\r\n  }\r\n\r\n  /**\r\n   * 写指定长度的二进制 buffer 数据\r\n   * \r\n   * @param length \r\n   * @returns \r\n   */\r\n  public async writeBuffer(buffer: Uint8ArrayInterface) {\r\n\r\n    if (!buffer.length) {\r\n      return\r\n    }\r\n\r\n    let length = buffer.length\r\n    if (this.remainingLength() < length) {\r\n      let index = 0\r\n      while (length > 0) {\r\n        await this.flush()\r\n        const len = Math.min(this.size, length)\r\n        this.buffer.set(buffer.subarray(index, index + len), this.pointer)\r\n\r\n        this.pointer += len\r\n        this.pos += BigInt(len)\r\n        index += len\r\n        length -= len\r\n      }\r\n    }\r\n    else {\r\n      this.buffer.set(buffer, this.pointer)\r\n      this.pointer += length\r\n      this.pos += BigInt(length)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 写一个字符串\r\n   */\r\n  public async writeString(str: string) {\r\n    const buffer = text.encode(str)\r\n    await this.writeBuffer(buffer)\r\n    return buffer.length\r\n  }\r\n\r\n  /**\r\n   * 将缓冲区中数据写出\r\n   */\r\n  public async flush() {\r\n    if (!this.onFlush) {\r\n      this.error = IOError.INVALID_OPERATION\r\n      throw Error('IOWriter error, flush failed because of no flush callback')\r\n    }\r\n\r\n    if (this.pointer) {\r\n      const ret = await this.onFlush(this.buffer.subarray(0, this.pointer))\r\n      if (ret !== 0) {\r\n        this.error = ret\r\n        throw Error('IOWriter error, flush failed')\r\n      }\r\n    }\r\n    this.pointer = 0\r\n  }\r\n\r\n  /**\r\n   * 将缓冲区中数据写出到指定位置\r\n   * \r\n   * @param pos \r\n   */\r\n  public async flushToPos(pos: bigint) {\r\n    if (!this.onFlush) {\r\n      this.error = IOError.INVALID_OPERATION\r\n      throw Error('IOWriter error, flush failed because of no flush callback')\r\n    }\r\n    if (this.pointer) {\r\n      const ret = await this.onFlush(this.buffer.subarray(0, this.pointer), pos)\r\n      if (ret !== 0) {\r\n        this.error = ret\r\n        throw Error('IOWriter error, flush failed')\r\n      }\r\n    }\r\n    this.pointer = 0\r\n  }\r\n\r\n  /**\r\n   * seek 到指定位置\r\n   * \r\n   * @param pos \r\n   */\r\n  public async seek(pos: bigint) {\r\n    if (!this.onSeek) {\r\n      this.error = IOError.INVALID_OPERATION\r\n      throw Error('IOWriter error, seek failed because of no seek callback')\r\n    }\r\n\r\n    await this.flush()\r\n\r\n    const ret = await this.onSeek(pos)\r\n\r\n    if (ret !== 0) {\r\n      this.error = ret\r\n      throw Error('IOWriter error, seek failed')\r\n    }\r\n\r\n    this.pos = pos\r\n  }\r\n\r\n  /**\r\n   * 在当前缓冲区映射区间内 seek\r\n   * \r\n   * @param pos \r\n   */\r\n  public seekInline(pos: number) {\r\n    const pointer = this.pointer\r\n    this.pointer = Math.max(0, Math.min(this.size, pos))\r\n    this.pos += BigInt(this.pointer - pointer)\r\n  }\r\n\r\n  /**\r\n   * 跳过指定长度\r\n   * \r\n   * @param length \r\n   */\r\n  public skip(length: number) {\r\n    const pointer = this.pointer\r\n    this.pointer = Math.min(this.size, this.pointer + length)\r\n    this.pos += BigInt(this.pointer - pointer)\r\n  }\r\n\r\n  /**\r\n   * 回退指定长度，不能大于 pointer 大小\r\n   * \r\n   * @param length \r\n   */\r\n  public back(length: number) {\r\n    const pointer = this.pointer\r\n    this.pointer = Math.max(0, this.pointer - length)\r\n    this.pos += BigInt(this.pointer - pointer)\r\n  }\r\n\r\n  /**\r\n   * 获取缓冲区\r\n   * \r\n   * @returns \r\n   */\r\n  public getBuffer() {\r\n    return this.buffer.subarray(0, this.pointer)\r\n  }\r\n\r\n  /**\r\n   * 设置读取是小端还是大端\r\n   * \r\n   * @param bigEndian \r\n   */\r\n  public setEndian(bigEndian: boolean) {\r\n    this.littleEndian = !bigEndian\r\n  }\r\n\r\n  /**\r\n   * 重置 writer\r\n   */\r\n  public reset() {\r\n    this.pointer = 0\r\n    this.pos = 0n\r\n    this.error = 0\r\n  }\r\n\r\n  /**\r\n   * 获取缓冲区长度\r\n   * \r\n   * @returns \r\n   */\r\n  public getBufferSize() {\r\n    return this.size\r\n  }\r\n}\r\n","/**\r\n * 写字节流工具\r\n */\r\n\r\nimport { IOError } from './error'\r\nimport * as text from '../util/text'\r\nimport { Uint8ArrayInterface, BytesWriterSync } from './interface'\r\n\r\nexport default class IOWriterSync implements BytesWriterSync {\r\n\r\n  private data: DataView\r\n\r\n  private buffer: Uint8ArrayInterface\r\n\r\n  private pointer: number\r\n\r\n  private pos: bigint\r\n\r\n  private size: number\r\n\r\n  private littleEndian: boolean\r\n\r\n  public error: number\r\n\r\n  public onFlush: (data: Uint8Array, pos?: bigint) => number\r\n  public onSeek: (seek: bigint) => number\r\n\r\n  /**\r\n   * @param data 待写的 Uint8Array\r\n   * @param bigEndian 是否按大端字节序写，默认大端字节序（网络字节序）\r\n   */\r\n  constructor(size: number = 1 * 1024 * 1024, bigEndian: boolean = true, map?: Uint8ArrayInterface) {\r\n    this.pointer = 0\r\n    this.pos = 0n\r\n    this.size = size\r\n    this.littleEndian = !bigEndian\r\n    this.error = 0\r\n\r\n    if (map && map.view) {\r\n      this.size = map.length\r\n      this.buffer = map\r\n      this.data = map.view\r\n    }\r\n    else if (map && !map.byteOffset) {\r\n      this.size = map.length\r\n      this.buffer = map\r\n      this.data = new DataView(this.buffer.buffer)\r\n    }\r\n    else {\r\n\r\n      if (map) {\r\n        throw new Error('not support subarray of ArrayBuffer')\r\n      }\r\n\r\n      this.buffer = new Uint8Array(this.size)\r\n      this.data = new DataView(this.buffer.buffer)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 写 8 位无符号整数\r\n   */\r\n  public writeUint8(value: number) {\r\n    if (this.remainingLength() < 1) {\r\n      this.flush()\r\n    }\r\n    this.data.setUint8(this.pointer, value)\r\n    this.pointer++\r\n    this.pos++\r\n  }\r\n\r\n  /**\r\n   * 读取 16 位无符号整数\r\n   */\r\n  public writeUint16(value: number) {\r\n    if (this.remainingLength() < 2) {\r\n      this.flush()\r\n    }\r\n    this.data.setUint16(this.pointer, value, this.littleEndian)\r\n    this.pointer += 2\r\n    this.pos += 2n\r\n  }\r\n\r\n  /**\r\n   * 写 24 位无符号整数\r\n   */\r\n  public writeUint24(value: number) {\r\n    if (this.remainingLength() < 3) {\r\n      this.flush()\r\n    }\r\n    const high = (value & 0xff0000) >> 16\r\n    const middle = (value & 0x00ff00) >> 8\r\n    const low = value & 0x0000ff\r\n    if (this.littleEndian) {\r\n      this.writeUint8(low)\r\n      this.writeUint8(middle)\r\n      this.writeUint8(high)\r\n    }\r\n    else {\r\n      this.writeUint8(high)\r\n      this.writeUint8(middle)\r\n      this.writeUint8(low)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 写 32 位无符号整数\r\n   */\r\n  public writeUint32(value: number) {\r\n    if (this.remainingLength() < 4) {\r\n      this.flush()\r\n    }\r\n    this.data.setUint32(this.pointer, value, this.littleEndian)\r\n    this.pointer += 4\r\n    this.pos += 4n\r\n  }\r\n\r\n  /**\r\n   * 写 64 位无符号整数\r\n   */\r\n  public writeUint64(value: bigint) {\r\n    if (this.remainingLength() < 8) {\r\n      this.flush()\r\n    }\r\n    this.data.setBigUint64(this.pointer, value, this.littleEndian)\r\n    this.pointer += 8\r\n    this.pos += 8n\r\n  }\r\n\r\n  /**\r\n   * 写 8 位有符号整数\r\n   * \r\n   * @returns \r\n   */\r\n  public writeInt8(value: number) {\r\n    if (this.remainingLength() < 1) {\r\n      this.flush()\r\n    }\r\n    this.data.setInt8(this.pointer, value)\r\n    this.pointer++\r\n    this.pos++\r\n  }\r\n\r\n  /**\r\n   * 写 16 位有符号整数\r\n   */\r\n  public writeInt16(value: number) {\r\n    if (this.remainingLength() < 2) {\r\n      this.flush()\r\n    }\r\n    this.data.setInt16(this.pointer, value, this.littleEndian)\r\n    this.pointer += 2\r\n    this.pos += 2n\r\n  }\r\n\r\n  /**\r\n   * 写 24 位有符号整数\r\n   */\r\n  public writeInt24(value: number) {\r\n    this.writeUint24(value < 0 ? (value + 0x1000000) : value)\r\n  }\r\n\r\n  /**\r\n   * 写 32 位有符号整数\r\n   */\r\n  public writeInt32(value: number) {\r\n    if (this.remainingLength() < 4) {\r\n      this.flush()\r\n    }\r\n    this.data.setInt32(this.pointer, value, this.littleEndian)\r\n    this.pointer += 4\r\n    this.pos += 4n\r\n  }\r\n\r\n  /**\r\n   * 写 64 位有符号整数\r\n   */\r\n  public writeInt64(value: bigint) {\r\n    if (this.remainingLength() < 8) {\r\n      this.flush()\r\n    }\r\n    this.data.setBigInt64(this.pointer, value, this.littleEndian)\r\n    this.pointer += 8\r\n    this.pos += 8n\r\n  }\r\n\r\n  /**\r\n   * 写单精度浮点数\r\n   * \r\n   * @returns \r\n   */\r\n  public writeFloat(value: number) {\r\n    if (this.remainingLength() < 4) {\r\n      this.flush()\r\n    }\r\n    this.data.setFloat32(this.pointer, value, this.littleEndian)\r\n    this.pointer += 4\r\n    this.pos += 4n\r\n  }\r\n\r\n  /**\r\n   * 写双精度浮点数\r\n   */\r\n  public writeDouble(value: number) {\r\n    if (this.remainingLength() < 8) {\r\n      this.flush()\r\n    }\r\n    this.data.setFloat64(this.pointer, value, this.littleEndian)\r\n    this.pointer += 8\r\n    this.pos += 8n\r\n  }\r\n\r\n  /**\r\n   * 获取当前写指针\r\n   * \r\n   * @returns \r\n   */\r\n  public getPointer() {\r\n    return this.pointer\r\n  }\r\n\r\n  public getPos() {\r\n    return this.pos\r\n  }\r\n\r\n  /**\r\n   * 获取剩余可写节数\r\n   * \r\n   * @returns \r\n   */\r\n  public remainingLength() {\r\n    return this.size - this.pointer\r\n  }\r\n\r\n  /**\r\n   * 写指定长度的二进制 buffer 数据\r\n   * \r\n   * @param length \r\n   * @returns \r\n   */\r\n  public writeBuffer(buffer: Uint8ArrayInterface) {\r\n\r\n    if (!buffer.length) {\r\n      return\r\n    }\r\n\r\n    let length = buffer.length\r\n    if (this.remainingLength() < length) {\r\n      let index = 0\r\n      while (length > 0) {\r\n        this.flush()\r\n        const len = Math.min(this.size, length)\r\n        this.buffer.set(buffer.subarray(index, index + len), this.pointer)\r\n\r\n        this.pointer += len\r\n        this.pos += BigInt(len)\r\n        index += len\r\n        length -= len\r\n      }\r\n    }\r\n    else {\r\n      this.buffer.set(buffer, this.pointer)\r\n      this.pointer += length\r\n      this.pos += BigInt(length)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 写一个字符串\r\n   */\r\n  public writeString(str: string) {\r\n    const buffer = text.encode(str)\r\n    this.writeBuffer(buffer)\r\n    return buffer.length\r\n  }\r\n\r\n  /**\r\n   * 将缓冲区中数据写出\r\n   */\r\n  public flush() {\r\n    if (!this.onFlush) {\r\n      this.error = IOError.INVALID_OPERATION\r\n      throw Error('IOWriter error, flush failed because of no flush callback')\r\n    }\r\n\r\n    if (this.pointer) {\r\n      const ret = this.onFlush(this.buffer.subarray(0, this.pointer))\r\n      if (ret !== 0) {\r\n        this.error = ret\r\n        throw Error('IOWriter error, flush failed')\r\n      }\r\n    }\r\n    this.pointer = 0\r\n  }\r\n\r\n  /**\r\n   * 将缓冲区中数据写出到指定位置\r\n   * \r\n   * @param pos \r\n   */\r\n  public flushToPos(pos: bigint) {\r\n    if (!this.onFlush) {\r\n      this.error = IOError.INVALID_OPERATION\r\n      throw Error('IOWriter error, flush failed because of no flush callback')\r\n    }\r\n    if (this.pointer) {\r\n      const ret = this.onFlush(this.buffer.subarray(0, this.pointer), pos)\r\n      if (ret !== 0) {\r\n        this.error = ret\r\n        throw Error('IOWriter error, flush failed')\r\n      }\r\n    }\r\n    this.pointer = 0\r\n  }\r\n\r\n  /**\r\n   * seek 到指定位置\r\n   * \r\n   * @param pos \r\n   */\r\n  public seek(pos: bigint) {\r\n    if (!this.onSeek) {\r\n      this.error = IOError.INVALID_OPERATION\r\n      throw Error('IOWriter error, seek failed because of no seek callback')\r\n    }\r\n\r\n    this.flush()\r\n\r\n    const ret = this.onSeek(pos)\r\n\r\n    if (ret !== 0) {\r\n      this.error = ret\r\n      throw Error('IOWriter error, seek failed')\r\n    }\r\n\r\n    this.pos = pos\r\n  }\r\n\r\n  /**\r\n   * 在当前缓冲区映射区间内 seek\r\n   * \r\n   * @param pos \r\n   */\r\n  public seekInline(pos: number) {\r\n    const pointer = this.pointer\r\n    this.pointer = Math.max(0, Math.min(this.size, pos))\r\n    this.pos += BigInt(this.pointer - pointer)\r\n  }\r\n\r\n  /**\r\n   * 跳过指定长度\r\n   * \r\n   * @param length \r\n   */\r\n  public skip(length: number) {\r\n    const pointer = this.pointer\r\n    this.pointer = Math.min(this.size, this.pointer + length)\r\n    this.pos += BigInt(this.pointer - pointer)\r\n  }\r\n\r\n  /**\r\n   * 回退指定长度，不能大于 pointer 大小\r\n   * \r\n   * @param length \r\n   */\r\n  public back(length: number) {\r\n    const pointer = this.pointer\r\n    this.pointer = Math.max(0, this.pointer - length)\r\n    this.pos += BigInt(this.pointer - pointer)\r\n  }\r\n\r\n  /**\r\n   * 获取缓冲区\r\n   * \r\n   * @returns \r\n   */\r\n  public getBuffer() {\r\n    return this.buffer.subarray(0, this.pointer)\r\n  }\r\n\r\n  /**\r\n   * 设置读取是小端还是大端\r\n   * \r\n   * @param bigEndian \r\n   */\r\n  public setEndian(bigEndian: boolean) {\r\n    this.littleEndian = !bigEndian\r\n  }\r\n\r\n  /**\r\n   * 重置 writer\r\n   */\r\n  public reset() {\r\n    this.pointer = 0\r\n    this.pos = 0n\r\n    this.error = 0\r\n  }\r\n\r\n  /**\r\n   * 获取缓冲区长度\r\n   * \r\n   * @returns \r\n   */\r\n  public getBufferSize() {\r\n    return this.size\r\n  }\r\n}\r\n","import FileIO from './FileIO'\r\nimport CommandQueue from '../helper/CommandQueue'\r\n\r\n/**\r\n * 安全的文件 IO 操作\r\n */\r\nexport default class SafeFileIO extends FileIO {\r\n\r\n  private commandQueue: CommandQueue\r\n\r\n  constructor(handler: FileHandle, append: boolean = false) {\r\n    super(handler, append)\r\n    this.commandQueue = new CommandQueue()\r\n  }\r\n\r\n  public async write(data: ArrayBuffer | ArrayBufferView) {\r\n    return this.commandQueue.push(async () => {\r\n      return super.write(data)\r\n    })\r\n  }\r\n\r\n  public async seek(position: number) {\r\n    return this.commandQueue.push(async () => {\r\n      return super.seek(position)\r\n    })\r\n  }\r\n\r\n  public async seekToEnd() {\r\n    return this.commandQueue.push(async () => {\r\n      return super.seekToEnd()\r\n    })\r\n  }\r\n\r\n  public async resize(size: number) {\r\n    return this.commandQueue.push(async () => {\r\n      return super.resize(size)\r\n    })\r\n  }\r\n\r\n  public async read(start: number, end: number): Promise<ArrayBuffer> {\r\n    return this.commandQueue.push(async () => {\r\n      return super.read(start, end)\r\n    })\r\n  }\r\n\r\n  public async appendBufferByPosition(buffer: ArrayBuffer | Uint8Array, position: number) {\r\n    return this.commandQueue.push(async () => {\r\n      return super.appendBufferByPosition(buffer, position)\r\n    })\r\n  }\r\n\r\n  public async close() {\r\n    return this.commandQueue.push(async () => {\r\n      return super.close()\r\n    })\r\n  }\r\n\r\n  public async destroy() {\r\n    await super.destroy()\r\n    this.commandQueue.clear()\r\n    this.commandQueue = null\r\n  }\r\n\r\n  get writeQueueSize() {\r\n    return this.commandQueue?.length ?? 0\r\n  }\r\n}\r\n","export default function align(value: number, alignment: number) {\r\n  return (value + (alignment - 1)) & ~(alignment - 1)\r\n}\r\n","/**\r\n * // 计算最大公约数（GCD）\r\n * \r\n * @param a \r\n * @param b \r\n * @returns \r\n */\r\nexport default function gcd(a: number, b: number) {\r\n  while (b !== 0) {\r\n    [a, b] = [b, a % b]\r\n  }\r\n  return a\r\n}\r\n","class FakeMessageChannelPort extends EventTarget {\r\n\r\n  public peer: FakeMessageChannelPort\r\n\r\n  public postMessage(message: any, transfer?: Transferable[]) {\r\n    if (this.peer?.onmessage) {\r\n      this.peer.onmessage({\r\n        data: message\r\n      } as any)\r\n    }\r\n  }\r\n\r\n  public onmessage: (this: FakeMessageChannelPort, ev: MessageEvent<any>) => any\r\n\r\n  public onmessageerror: (this: FakeMessageChannelPort, ev: MessageEvent<any>) => any\r\n\r\n  public close() {\r\n    this.peer = null\r\n  }\r\n\r\n  public start() {\r\n\r\n  }\r\n}\r\n\r\nexport default class FakeMessageChannel {\r\n\r\n  public port1: FakeMessageChannelPort\r\n  public port2: FakeMessageChannelPort\r\n\r\n  constructor() {\r\n    this.port1 = new FakeMessageChannelPort()\r\n    this.port2 = new FakeMessageChannelPort()\r\n    this.port1.peer = this.port2\r\n    this.port2.peer = this.port1\r\n  }\r\n}\r\n","import { Data } from '../types/type'\r\nimport Emitter from '../event/Emitter'\r\nimport isDef from '../function/isDef'\r\n\r\nexport const NOTIFY = 'notify'\r\n\r\nexport const REQUEST = 'request'\r\n\r\nexport interface RpcMessage {\r\n  id?: number | string\r\n  method?: string\r\n  params?: Data\r\n  error?: Data\r\n  result?: Data\r\n  seq?: number\r\n}\r\n\r\n\r\nexport default class IPCPort extends Emitter {\r\n\r\n  protected port: MessagePort\r\n\r\n  private requestMap: Map<number, {\r\n    resolve: (value: any) => void\r\n    reject: (value: any) => void\r\n  }>\r\n\r\n  private seq: number\r\n\r\n  public closed: boolean\r\n\r\n  constructor(port: MessagePort) {\r\n    super(true)\r\n    this.port = port\r\n\r\n    this.port.onmessage = this.handle.bind(this)\r\n\r\n    this.seq = 0\r\n    this.requestMap = new Map()\r\n\r\n    this.port.start()\r\n\r\n    this.closed = false\r\n  }\r\n\r\n  protected handle(event: MessageEvent<any>) {\r\n    const origin = event.data\r\n    const type = origin.type\r\n    const data = origin.data\r\n\r\n    if (type === 'notify') {\r\n      this.fire(NOTIFY, data)\r\n    }\r\n    else if (type === 'reply') {\r\n      const request = this.requestMap.get(data.seq)\r\n      if (request) {\r\n        if (isDef(data.result)) {\r\n          request.resolve(data.result)\r\n        }\r\n        else if (data.error) {\r\n          request.reject(data.error)\r\n        }\r\n        else {\r\n          request.resolve(undefined)\r\n        }\r\n        this.requestMap.delete(data.seq)\r\n      }\r\n    }\r\n    else if (type === 'request') {\r\n      this.fire(REQUEST, data)\r\n    }\r\n  }\r\n\r\n  public notify(method: string, params: Data = {}, transfer: any[] = []) {\r\n    this.port.postMessage({\r\n      type: 'notify',\r\n      data: {\r\n        method,\r\n        params\r\n      }\r\n    }, transfer)\r\n  }\r\n\r\n  public async request<T>(method: string, params: Data = {}, transfer: any[] = []) {\r\n    return new Promise<T>((resolve, reject) => {\r\n\r\n      const id = this.seq++\r\n\r\n      this.requestMap.set(id, {\r\n        resolve,\r\n        reject\r\n      })\r\n\r\n      this.port.postMessage({\r\n        type: 'request',\r\n        data: {\r\n          seq: id,\r\n          method,\r\n          params\r\n        }\r\n      }, transfer)\r\n    })\r\n  }\r\n\r\n  public reply(request: RpcMessage, result?: any, error?: Data, transfer: any[] = []) {\r\n\r\n    const data: Data = {\r\n      seq: request.seq\r\n    }\r\n\r\n    if (isDef(result)) {\r\n      data.result = result\r\n    }\r\n    else if (error) {\r\n      data.error = error\r\n    }\r\n\r\n    if (transfer?.length) {\r\n      this.port.postMessage({\r\n        type: 'reply',\r\n        data\r\n      }, transfer)\r\n    }\r\n    else {\r\n      this.port.postMessage({\r\n        type: 'reply',\r\n        data\r\n      })\r\n    }\r\n  }\r\n\r\n  public getPort() {\r\n    return this.port\r\n  }\r\n\r\n  public destroy() {\r\n    if (this.requestMap.size) {\r\n      this.requestMap.forEach((req) => {\r\n        req.reject('ipc port close')\r\n      })\r\n      this.requestMap.clear()\r\n    }\r\n    if (this.port) {\r\n      this.port.close()\r\n      this.port = null\r\n    }\r\n    this.closed = true\r\n  }\r\n}\r\n","import IPCPort from './IPCPort'\r\n\r\nexport default class NodeIPCPort extends IPCPort {\r\n  constructor(port: MessagePort) {\r\n    super(port)\r\n    // @ts-ignore\r\n    this.port.on('message', this.handle.bind(this))\r\n  }\r\n}\r\n","import isWorker from '../function/isWorker'\r\nimport getTimestamp from '../function/getTimestamp'\r\nimport WorkerSetTimeout from './WorkerSetTimeout'\r\nimport debounce from '../function/debounce'\r\n\r\n\r\nlet workerSetTimeout: WorkerSetTimeout\r\nlet workerSetTimeoutCounter = 0\r\n\r\nfunction createWorkerSetTimeout() {\r\n  if (workerSetTimeout) {\r\n    workerSetTimeoutCounter++\r\n    return workerSetTimeout\r\n  }\r\n  workerSetTimeout = new WorkerSetTimeout()\r\n  workerSetTimeoutCounter = 1\r\n  return workerSetTimeout\r\n}\r\n\r\nfunction deleteWorkerSetTimeout() {\r\n\r\n  if (workerSetTimeoutCounter === 0) {\r\n    return\r\n  }\r\n\r\n  workerSetTimeoutCounter--\r\n  if (workerSetTimeoutCounter === 0) {\r\n    workerSetTimeout.destroy()\r\n    workerSetTimeout = null\r\n  }\r\n}\r\n\r\nexport default class Clock {\r\n\r\n  private messageChannel: MessageChannel\r\n\r\n  private interval: number\r\n\r\n  private started: boolean\r\n\r\n  private timer: number\r\n  private workerTimer: number\r\n\r\n  private workerSetTimeout: WorkerSetTimeout\r\n\r\n  public onClock: (next: () => void) => void\r\n\r\n  private nextTick: () => void\r\n\r\n  /**\r\n   * messageChannel 执行间隔，默认 0.2\r\n   */\r\n  private a: number\r\n\r\n  /**\r\n   * setTimeout 最小执行间隔，默认 4\r\n   */\r\n  private b: number\r\n\r\n  /**\r\n   * 50 毫秒内  messageChannel 执行次数\r\n   */\r\n  private beta: number\r\n\r\n  /**\r\n   * 50 毫秒内  setTimeout 执行次数\r\n   */\r\n  private alpha: number\r\n\r\n  private count: number\r\n\r\n  /**\r\n   * 等效时间\r\n   */\r\n  private equivalent: number\r\n\r\n  private timestamp: number\r\n\r\n  private onVisibilityChange: (event: any) => void\r\n\r\n  private timeoutNext: Function\r\n\r\n  private running: boolean\r\n\r\n  private highPerformance: boolean\r\n\r\n  constructor(interval: number, highPerformance = true) {\r\n    this.started = false\r\n    this.interval = interval\r\n    this.highPerformance = highPerformance\r\n\r\n    this.a = 0.2\r\n    this.b = 4\r\n    this.equivalent = 50\r\n    this.timestamp = 0\r\n\r\n    this.nextTick = () => {\r\n      if (!this.started || this.running) {\r\n        return\r\n      }\r\n\r\n      this.running = true\r\n\r\n      if (this.interval >= 4 || !this.highPerformance) {\r\n        this.timeoutTick()\r\n      }\r\n      else if (this.interval <= 0) {\r\n        this.messageChannel.port1.postMessage(null)\r\n      }\r\n      else {\r\n        const now = getTimestamp()\r\n        if (now - this.timestamp > this.equivalent) {\r\n          this.count = 0\r\n          this.timestamp = now\r\n        }\r\n\r\n        if (this.count < this.beta) {\r\n          this.messageChannel.port1.postMessage(null)\r\n        }\r\n        else {\r\n          this.timeoutTick()\r\n        }\r\n      }\r\n    }\r\n\r\n    this.compute()\r\n\r\n    this.messageChannel = new MessageChannel()\r\n    this.handleEvent()\r\n\r\n    this.timeoutNext = (worker: boolean) => {\r\n      if (worker) {\r\n        this.workerTimer = null\r\n      }\r\n      else {\r\n        this.timer = null\r\n      }\r\n      this.running = false\r\n\r\n      this.count++\r\n\r\n      if (this.onClock) {\r\n        this.onClock(this.nextTick)\r\n      }\r\n      else {\r\n        this.nextTick()\r\n      }\r\n    }\r\n\r\n    if (!isWorker() && document.visibilityState === 'hidden') {\r\n      this.workerSetTimeout = createWorkerSetTimeout()\r\n    }\r\n\r\n    this.running = false\r\n  }\r\n\r\n  private compute(clear: boolean = true) {\r\n    if (this.interval > 0) {\r\n      this.beta = Math.ceil(this.equivalent * (1 - this.b / this.interval) / (this.a - this.b))\r\n      this.alpha = Math.floor(this.equivalent / this.interval - this.beta)\r\n\r\n      if (clear) {\r\n        this.count = 0\r\n      }\r\n    }\r\n  }\r\n\r\n  private timeoutTick() {\r\n    if (this.workerSetTimeout\r\n      && document.visibilityState === 'hidden'\r\n      && this.interval < 1000\r\n    ) {\r\n      this.workerTimer = this.workerSetTimeout.setTimeout(this.timeoutNext, this.interval)\r\n    }\r\n    else {\r\n      this.timer = setTimeout(this.timeoutNext, this.interval)\r\n    }\r\n  }\r\n\r\n  public start() {\r\n    if (this.started) {\r\n      return\r\n    }\r\n    this.started = true\r\n    this.timestamp = getTimestamp()\r\n\r\n    this.nextTick()\r\n  }\r\n\r\n  public stop() {\r\n    this.started = false\r\n    if (this.timer) {\r\n      clearTimeout(this.timer)\r\n      this.timer = null\r\n    }\r\n    if (this.workerTimer && this.workerSetTimeout) {\r\n      this.workerSetTimeout.clearTimeout(this.workerTimer)\r\n    }\r\n    this.running = false\r\n  }\r\n\r\n  public isStarted() {\r\n    return this.started\r\n  }\r\n\r\n  public setInterval(interval: number) {\r\n    this.interval = Math.max(interval, 0)\r\n    this.compute()\r\n  }\r\n\r\n  public getInterval() {\r\n    return this.interval\r\n  }\r\n\r\n  public isZeroTimeout() {\r\n    return this.interval < 4\r\n  }\r\n\r\n  public destroy() {\r\n    this.stop()\r\n\r\n    if (this.workerSetTimeout) {\r\n      deleteWorkerSetTimeout()\r\n      this.workerSetTimeout = null\r\n    }\r\n\r\n    if (this.onVisibilityChange) {\r\n      document.removeEventListener('visibilitychange', this.onVisibilityChange)\r\n      this.onVisibilityChange = null\r\n    }\r\n  }\r\n\r\n  private handleEvent() {\r\n    this.messageChannel.port2.onmessage = () => {\r\n      if (!this.started) {\r\n        return\r\n      }\r\n      this.running = false\r\n      this.count++\r\n      if (this.onClock) {\r\n        this.onClock(this.nextTick)\r\n      }\r\n      else {\r\n        this.nextTick()\r\n      }\r\n    }\r\n\r\n    if (!isWorker()) {\r\n      this.onVisibilityChange = debounce((event) => {\r\n        if (document.visibilityState === 'hidden') {\r\n\r\n          this.workerSetTimeout = createWorkerSetTimeout()\r\n\r\n          if (this.timer) {\r\n            clearTimeout(this.timer)\r\n            this.timer = null\r\n            this.running = false\r\n          }\r\n\r\n          this.nextTick()\r\n        }\r\n        else {\r\n\r\n          if (this.workerTimer) {\r\n            this.workerSetTimeout.clearTimeout(this.workerTimer)\r\n            this.workerTimer = null\r\n            this.running = false\r\n          }\r\n\r\n          if (this.timer) {\r\n            clearTimeout(this.timer)\r\n            this.timer = null\r\n            this.running = false\r\n          }\r\n\r\n          deleteWorkerSetTimeout()\r\n          this.workerSetTimeout = null\r\n\r\n          this.nextTick()\r\n        }\r\n      }, 20)\r\n      document.addEventListener('visibilitychange', this.onVisibilityChange)\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @file 可伸缩循环任务队列\r\n */\r\n\r\nimport Clock from './Clock'\r\nimport getTimestamp from '../function/getTimestamp'\r\nimport { Timeout } from '../types/type'\r\n\r\nexport default class LoopTask {\r\n\r\n  private task: () => any\r\n\r\n  private count: number\r\n\r\n  private emptyCount: number\r\n\r\n  private started: boolean\r\n\r\n  private clock: Clock\r\n\r\n  private timestamp: number\r\n\r\n  private timeout: number\r\n\r\n  private interval: number\r\n\r\n  private startTimer: Timeout\r\n\r\n  private autoInterval: boolean\r\n\r\n  private sync: boolean\r\n\r\n  private tickAfter: () => void\r\n\r\n  private processing: boolean\r\n\r\n  constructor(task: () => any, timeout: number = 0, interval: number = 0, autoInterval: boolean = true, sync: boolean = true) {\r\n    this.task = task\r\n    this.timeout = timeout\r\n    this.interval = interval\r\n    this.autoInterval = autoInterval\r\n    this.sync = sync\r\n\r\n    this.count = 0\r\n    this.emptyCount = 0\r\n    this.timestamp = 0\r\n    this.started = false\r\n    this.processing = false\r\n\r\n    this.clock = new Clock(this.interval)\r\n\r\n    this.clock.onClock = (next) => {\r\n      if (!this.started) {\r\n        return\r\n      }\r\n      this.count++\r\n\r\n      if (this.sync) {\r\n        if (this.tickAfter) {\r\n          this.tickAfter()\r\n          this.tickAfter = null\r\n        }\r\n        if (this.task() === false) {\r\n          this.stop()\r\n        }\r\n        else {\r\n          this.next(next)\r\n        }\r\n      }\r\n      else {\r\n        if (this.processing) {\r\n          return\r\n        }\r\n        this.processing = true\r\n        this.task().then((result: any) => {\r\n          this.processing = false\r\n          if (this.tickAfter) {\r\n            this.tickAfter()\r\n            this.tickAfter = null\r\n          }\r\n          if (result === false) {\r\n            this.stop()\r\n          }\r\n          else {\r\n            this.next(next)\r\n          }\r\n        })\r\n      }\r\n    }\r\n  }\r\n\r\n  private next(next: () => void) {\r\n    if (!this.started) {\r\n      return\r\n    }\r\n    const now = getTimestamp()\r\n    if (this.autoInterval && now - this.timestamp > 50) {\r\n      const load = this.emptyCount / this.count\r\n      /**\r\n       * 1000 毫秒被空闲任务调用超过 10%，将间隔减一\r\n       * 没有空闲任务，将间隔重新置为 0\r\n       */\r\n      if (this.emptyCount === 0) {\r\n        this.clock.setInterval(Math.max(this.clock.getInterval() >> 1, this.interval))\r\n      }\r\n      else if (load < 0.1) {\r\n        this.clock.setInterval(this.clock.getInterval() - 1)\r\n      }\r\n      else if (load > 0.2) {\r\n        this.clock.setInterval(Math.min(this.clock.getInterval() + 1, 20))\r\n      }\r\n      else if (load > 0.5) {\r\n        this.clock.setInterval(this.clock.getInterval() << 1)\r\n      }\r\n      this.count = 0\r\n      this.emptyCount = 0\r\n      this.timestamp = now\r\n    }\r\n    next()\r\n  }\r\n\r\n  public start() {\r\n    this.started = true\r\n    if (this.timeout) {\r\n      this.startTimer = setTimeout(() => {\r\n        this.count = 0\r\n        this.emptyCount = 0\r\n        this.timestamp = getTimestamp()\r\n        this.clock.start()\r\n        this.startTimer = null\r\n      }, this.timeout)\r\n    }\r\n    else {\r\n      this.count = 0\r\n      this.emptyCount = 0\r\n      this.timestamp = getTimestamp()\r\n      this.clock.start()\r\n    }\r\n  }\r\n\r\n  public stop() {\r\n    this.started = false\r\n    this.processing = false\r\n    if (this.startTimer) {\r\n      clearTimeout(this.startTimer)\r\n      this.startTimer = null\r\n    }\r\n    this.clock.stop()\r\n  }\r\n\r\n  public async stopBeforeNextTick() {\r\n    if (this.startTimer) {\r\n      clearTimeout(this.startTimer)\r\n      this.startTimer = null\r\n    }\r\n\r\n    if (!this.clock.isStarted()) {\r\n      return\r\n    }\r\n\r\n    if (this.sync) {\r\n      this.started = false\r\n      this.processing = false\r\n      this.clock.stop()\r\n    }\r\n    else {\r\n      return new Promise<void>((resolve) => {\r\n        this.tickAfter = () => {\r\n          this.started = false\r\n          this.processing = false\r\n          this.clock.stop()\r\n          resolve()\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  public isStarted() {\r\n    return this.started\r\n  }\r\n\r\n  public emptyTask() {\r\n    this.emptyCount++\r\n  }\r\n\r\n  public isZeroTimeout() {\r\n    return this.clock?.isZeroTimeout()\r\n  }\r\n\r\n  public restart() {\r\n    if (this.clock) {\r\n      this.stop()\r\n      this.clock.setInterval(this.interval)\r\n      this.start()\r\n    }\r\n  }\r\n\r\n  public resetInterval() {\r\n    this.clock.setInterval(Math.max(this.clock.getInterval() >> 1, this.interval))\r\n    this.emptyCount = 0\r\n    this.count = 0\r\n    this.timestamp = getTimestamp()\r\n  }\r\n\r\n  public destroy() {\r\n    this.stop()\r\n    this.task =  null\r\n    this.timeout = null\r\n    this.interval = null\r\n  }\r\n}\r\n","/**\r\n * @file sleep\r\n */\r\n\r\nimport { Timeout } from '../types/type'\r\n\r\nexport default class Sleep {\r\n\r\n  private timeout: number\r\n\r\n  private timer: Timeout\r\n\r\n  private resolve: (value?: number) => void\r\n\r\n  private reject: (value?: number) => void\r\n\r\n  private startTime: number\r\n\r\n  /**\r\n   * \r\n   * @param timeout 时间（秒）\r\n   */\r\n  constructor(timeout: number) {\r\n    this.timeout = timeout\r\n  }\r\n\r\n  public then(res: (value?: number) => void, rej?: (value?: number) => void) {\r\n    this.resolve = res\r\n    this.reject = rej\r\n    this.startTime = Date.now()\r\n    this.timer = setTimeout(() => {\r\n      this.resolve(Date.now() - this.startTime)\r\n      this.timer = null\r\n    }, this.timeout * 1000)\r\n  }\r\n\r\n  public stop(resolve: boolean = true) {\r\n    if (this.timer) {\r\n      clearTimeout(this.timer)\r\n      this.timer = null\r\n      if (this.resolve && resolve) {\r\n        this.resolve(Date.now() - this.startTime)\r\n      }\r\n      else if (this.reject && !resolve) {\r\n        this.reject(Date.now() - this.startTime)\r\n      }\r\n    }\r\n  }\r\n\r\n  public reset(timeout?: number) {\r\n\r\n    if (timeout) {\r\n      this.timeout = timeout\r\n    }\r\n\r\n    if (this.timer) {\r\n      clearTimeout(this.timer)\r\n      this.timer = setTimeout(() => {\r\n        this.resolve(Date.now() - this.startTime)\r\n        this.timer = null\r\n      }, this.timeout * 1000)\r\n    }\r\n  }\r\n}\r\n\r\n","/**\r\n * @file 定时任务\r\n */\r\n\r\nimport { Timeout } from '../types/type'\r\n\r\nexport default class Timer {\r\n\r\n  private task: Function\r\n\r\n  private timeout: number\r\n\r\n  private interval: number\r\n\r\n  private timer: Timeout\r\n\r\n  /**\r\n   * \r\n   * @param task 定时任务\r\n   * @param timeout 多久之后开始\r\n   * @param interval 执行间隔\r\n   */\r\n  constructor(task: Function, timeout: number, interval: number) {\r\n    this.task = task\r\n    this.timeout = timeout\r\n    this.interval = interval\r\n  }\r\n\r\n  /**\r\n   * 开始执行\r\n   */\r\n  public start() {\r\n    const me = this\r\n    me.stop()\r\n\r\n    let timeout = me.timeout\r\n    const interval = me.interval\r\n\r\n    const next = function () {\r\n      if (me.task() !== false\r\n        && me.timer\r\n      ) {\r\n        me.timer = setTimeout(next, me.interval)\r\n      }\r\n      else {\r\n        me.stop()\r\n      }\r\n    }\r\n    if (timeout == null) {\r\n      timeout = interval\r\n    }\r\n    me.timer = setTimeout(next, timeout)\r\n  }\r\n\r\n  /**\r\n   * 停止执行\r\n   */\r\n  public stop() {\r\n    if (this.timer) {\r\n      clearTimeout(this.timer)\r\n      this.timer = null\r\n    }\r\n  }\r\n\r\n  public updateInterval(interval: number) {\r\n    this.interval = interval\r\n  }\r\n\r\n  /**\r\n   * 是否正在执行\r\n   */\r\n  public isStarted() {\r\n    return !!this.timer\r\n  }\r\n\r\n  /**\r\n   * 销毁定时任务\r\n   */\r\n  public destroy() {\r\n    this.stop()\r\n    this.task = this.timeout = this.interval = null\r\n  }\r\n}\r\n","\r\nimport sourceLoad from '../function/sourceLoad'\r\n\r\nrequire('./workerSetTimeoutTask')\r\n\r\nexport default class WorkerSetTimeout {\r\n\r\n  private worker: Worker\r\n\r\n  private workerUrl: string\r\n\r\n  private taskMap: Map<number, Function>\r\n\r\n  private id: number\r\n\r\n  constructor() {\r\n\r\n    this.id = 0\r\n    this.taskMap = new Map()\r\n\r\n    const workerSource = `\r\n      ${sourceLoad(require.resolve('./workerSetTimeoutTask'), { varName: 'workerSetTimeoutTask' })}\r\n      workerSetTimeoutTask.default(self)\r\n    `\r\n\r\n    const blob = new Blob([workerSource], { type: 'text/javascript' })\r\n    this.workerUrl = URL.createObjectURL(blob)\r\n\r\n    this.worker = new Worker(this.workerUrl)\r\n\r\n    this.worker.addEventListener('message', (message) => {\r\n      const origin = message.data\r\n      const type = origin.type\r\n      const id = origin.id\r\n      switch (type) {\r\n        case 'pong':\r\n          const task = this.taskMap.get(id)\r\n          if (task) {\r\n            task(true)\r\n          }\r\n          break\r\n      }\r\n    })\r\n  }\r\n\r\n  public setTimeout(task: Function, timeout: number = 0) {\r\n    const id = this.id++\r\n\r\n    this.taskMap.set(id, task)\r\n\r\n    this.worker.postMessage({\r\n      type: 'ping',\r\n      data: {\r\n        timeout,\r\n        id\r\n      }\r\n    })\r\n\r\n    return id\r\n  }\r\n\r\n  public clearTimeout(id: number) {\r\n    this.taskMap.delete(id)\r\n  }\r\n\r\n  public destroy() {\r\n    if (this.worker) {\r\n      this.worker.terminate()\r\n      this.worker = null\r\n    }\r\n\r\n    if (this.workerUrl) {\r\n      URL.revokeObjectURL(this.workerUrl)\r\n      this.workerUrl = null\r\n    }\r\n\r\n    if (this.taskMap) {\r\n      this.taskMap.clear()\r\n      this.taskMap = null\r\n    }\r\n  }\r\n}\r\n","import * as logger from '../util/logger'\r\n\r\nclass WorkerSetTimeout {\r\n\r\n  private worker: Worker\r\n\r\n  constructor(self: Worker) {\r\n    this.worker = self\r\n    this.handleEvents()\r\n  }\r\n\r\n  handleEvents() {\r\n    this.worker.addEventListener('message', (message) => {\r\n      const origin = message.data\r\n      let data = origin.data\r\n\r\n      setTimeout(() => {\r\n        this.worker.postMessage({\r\n          type: 'pong',\r\n          id: data.id\r\n        })\r\n      }, Math.max(data.timeout ?? 0, 4))\r\n    })\r\n  }\r\n}\r\n\r\nexport default function run(self: Worker) {\r\n  try {\r\n    new WorkerSetTimeout(self)\r\n  }\r\n  catch (error) {\r\n    logger.error('new WorkerSetTimeout failed')\r\n  }\r\n}\r\n\r\n\r\n","/**\r\n * @file 数组操作\r\n */\r\n\r\nimport * as is from './is'\r\nimport * as constant from './constant'\r\nimport execute from '../function/execute'\r\n\r\n/**\r\n * 遍历数组\r\n *\r\n * @param array\r\n * @param callback 返回 false 可停止遍历\r\n * @param reversed 是否逆序遍历\r\n */\r\nexport function each<T>(\r\n  array: T[],\r\n  callback: (item: T, index: number) => boolean | void,\r\n  reversed?: boolean\r\n): void {\r\n  if (!array) {\r\n    return\r\n  }\r\n  const { length } = array\r\n  if (length) {\r\n    if (reversed) {\r\n      for (let i = length - 1; i >= 0; i--) {\r\n        if (callback(array[i], i) === constant.FALSE) {\r\n          break\r\n        }\r\n      }\r\n    }\r\n    else {\r\n      for (let i = 0; i < length; i++) {\r\n        if (callback(array[i], i) === constant.FALSE) {\r\n          break\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction nativePush<T>(array: T[], item: T) {\r\n  array[array.length] = item\r\n}\r\n\r\nfunction nativeUnshift<T>(array: T[], item: T) {\r\n  array.unshift(item)\r\n}\r\n\r\n/**\r\n * 添加\r\n *\r\n * @param array\r\n * @param value\r\n * @param action\r\n */\r\nfunction addItem<T>(array: T[], value: T | T[], action: Function) {\r\n  if (is.array(value)) {\r\n    each(\r\n      value as T[],\r\n      function (item: T) {\r\n        action(array, item)\r\n      }\r\n    )\r\n  }\r\n  else {\r\n    action(array, value)\r\n  }\r\n}\r\n\r\n/**\r\n * 往后加\r\n *\r\n * @param array\r\n * @param target\r\n */\r\nexport function push<T>(array: T[], target: T | T[]): void {\r\n  addItem(array, target, nativePush)\r\n}\r\n\r\n/**\r\n * 往前加\r\n *\r\n * @param array\r\n * @param target\r\n */\r\nexport function unshift<T>(array: T[], target: T | T[]): void {\r\n  addItem(array, target, nativeUnshift)\r\n}\r\n\r\n/**\r\n * 数组项在数组中的位置\r\n *\r\n * @param array 数组\r\n * @param target 数组项\r\n * @param strict 是否全等判断，默认是全等\r\n * @return 如果未找到，返回 -1\r\n */\r\nexport function indexOf<T>(array: T[], target: T, strict?: boolean): number {\r\n  let result = constant.MINUS_ONE\r\n  each(\r\n    array,\r\n    function (item: any, index: number) {\r\n      if (strict === constant.FALSE ? item == target : item === target) {\r\n        result = index\r\n        return constant.FALSE\r\n      }\r\n    }\r\n  )\r\n  return result\r\n}\r\n\r\n/**\r\n * 获取数组最后一项\r\n *\r\n * @param array 数组\r\n * @return\r\n */\r\nexport function last<T>(array: T[]): T | void {\r\n  const { length } = array\r\n  if (length > 0) {\r\n    return array[length - 1]\r\n  }\r\n}\r\n\r\n/**\r\n * 弹出数组最后一项\r\n *\r\n * 项目里用的太多，仅用于节省字符\r\n *\r\n * @param array 数组\r\n * @return 弹出的数组项\r\n */\r\nexport function pop<T>(array: T[]): T | void {\r\n  const { length } = array\r\n  if (length > 0) {\r\n    return array.pop()\r\n  }\r\n}\r\n\r\n/**\r\n * 删除数组项\r\n *\r\n * @param array 数组\r\n * @param item 待删除项\r\n * @param strict 是否全等判断，默认是全等\r\n * @return 删除的数量\r\n */\r\nexport function remove<T>(array: T[], target: T, strict?: boolean): number {\r\n  let result = 0\r\n  each(\r\n    array,\r\n    function (item: T, index: number) {\r\n      if (strict === constant.FALSE ? item == target : item === target) {\r\n        array.splice(index, 1)\r\n        result++\r\n      }\r\n    },\r\n    constant.TRUE\r\n  )\r\n  return result\r\n}\r\n\r\n/**\r\n * 数组是否包含 item\r\n *\r\n * @param array 数组\r\n * @param target 可能包含的数组项\r\n * @param strict 是否全等判断，默认是全等\r\n * @return\r\n */\r\nexport function has<T>(array: T[], target: T, strict?: boolean): boolean {\r\n  return indexOf(array, target, strict) >= 0\r\n}\r\n\r\n/**\r\n * 把类数组转成数组\r\n *\r\n * @param array 类数组\r\n * @return\r\n */\r\nexport function toArray<T>(array: T[] | ArrayLike<T>): T[] {\r\n  return is.array(array)\r\n    ? array\r\n    : execute(constant.EMPTY_ARRAY.slice, array)\r\n}\r\n\r\n/**\r\n * 把数组转成对象\r\n *\r\n * @param array 数组\r\n * @param key 数组项包含的字段名称，如果数组项是基本类型，可不传\r\n * @param value\r\n * @return\r\n */\r\nexport function toObject(array: any[], key?: string | null, value?: any): object {\r\n  let result = {}\r\n  each(\r\n    array,\r\n    function (item: any) {\r\n      result[key ? item[key] : item] = value || item\r\n    }\r\n  )\r\n  return result\r\n}\r\n\r\n/**\r\n * 把数组合并成字符串\r\n *\r\n * @param array\r\n * @param separator\r\n * @return\r\n */\r\nexport function join(array: string[], separator: string): string {\r\n  return array.join(separator)\r\n}\r\n\r\n/**\r\n * 用于判断长度大于 0 的数组\r\n *\r\n * @param array\r\n * @return\r\n */\r\nexport function falsy(array: any): boolean {\r\n  return !is.array(array) || !array.length\r\n}\r\n\r\n/**\r\n * 排除数组元素返回新数组\r\n * \r\n * @param source \r\n * @param exc \r\n * @returns \r\n */\r\nexport function exclude(source: any[], exc: any[]) {\r\n  const items = []\r\n\r\n  each(source, (item, index) => {\r\n    if (!has(exc, item)) {\r\n      items.push(item)\r\n    }\r\n  })\r\n\r\n  return items\r\n}\r\n\r\n/**\r\n * 二分查找\r\n * \r\n * @param array \r\n * @param callback 相等返回 0， 往左边查返回 -1， 往右边查返回 1\r\n * @returns \r\n */\r\nexport function binarySearch<T>(array: T[], callback: (item: T) => -1 | 0 | 1) {\r\n  let left = 0\r\n  let right = array.length - 1\r\n  let index = -1\r\n\r\n  while (left <= right) {\r\n    let mid = ((left + right) / 2) >>> 0\r\n\r\n    const ret = callback(array[mid])\r\n\r\n    if (ret === 0) {\r\n      index = mid\r\n      break\r\n    }\r\n    else if (ret === 1) {\r\n      left = mid + 1\r\n    }\r\n    else {\r\n      right = mid - 1\r\n      index = mid\r\n    }\r\n  }\r\n  return index\r\n}\r\n\r\nexport function sortInsert<T>(array: T[], item: T, callback: (item: T) => -1 | 0 | 1) {\r\n  const index = binarySearch(array, callback)\r\n  if (index > -1) {\r\n    array.splice(index, 0, item)\r\n  }\r\n  else {\r\n    array.push(item)\r\n  }\r\n}\r\n","\r\nconst base32 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ234567'\r\n\r\n\r\n/**\r\n * base32 解密\r\n */\r\nexport function decode(text: string): Uint8Array {\r\n  text = text.toUpperCase().replace(/=+$/, '')\r\n  let bits = 0\r\n  let value = 0\r\n\r\n  let index = 0\r\n  const output = new Uint8Array(((text.length * 5) / 8) | 0)\r\n\r\n  for (let i = 0; i < length; i++) {\r\n    value = (value << 5) | base32.indexOf(text[i])\r\n    bits += 5\r\n\r\n    if (bits >= 8) {\r\n      output[index++] = (value >>> (bits - 8)) & 255\r\n      bits -= 8\r\n    }\r\n  }\r\n\r\n  return output\r\n}\r\n\r\n/**\r\n * base32 加密\r\n */\r\nexport function encode(buffer: Uint8Array, padding: boolean = true): string {\r\n  const length = buffer.length\r\n\r\n  let bits = 0\r\n  let value = 0\r\n  let output = ''\r\n\r\n  for (let i = 0; i < length; i++) {\r\n    value = (value << 8) | buffer[i]\r\n    bits += 8\r\n\r\n    while (bits >= 5) {\r\n      output += base32[(value >>> (bits - 5)) & 31]\r\n      bits -= 5\r\n    }\r\n  }\r\n\r\n  if (bits > 0) {\r\n    output += base32[(value << (5 - bits)) & 31]\r\n  }\r\n\r\n  if (padding) {\r\n    while (output.length % 8 !== 0) {\r\n      output += '='\r\n    }\r\n  }\r\n\r\n  return output\r\n}\r\n\r\n","\r\nimport * as array from './array'\r\n\r\nconst base64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='\r\n\r\n/**\r\n * utf8 编码\r\n * @param text \r\n */\r\nfunction utf8Decode(text: string): string {\r\n  let string = '', i = 0, c = 0, c1 = 0, c2 = 0, c3 = 0\r\n  while (i < text.length) {\r\n    c = text.charCodeAt(i)\r\n    if (c < 128) {\r\n      string += String.fromCharCode(c)\r\n      i++\r\n    }\r\n    else if ((c > 191) && (c < 224)) {\r\n      c2 = text.charCodeAt(i + 1)\r\n      string += String.fromCharCode(((c & 31) << 6) | (c2 & 63))\r\n      i += 2\r\n    }\r\n    else {\r\n      c2 = text.charCodeAt(i + 1)\r\n      c3 = text.charCodeAt(i + 2)\r\n      string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63))\r\n      i += 3\r\n    }\r\n  }\r\n  return string\r\n}\r\n\r\n/**\r\n * base64 解密\r\n */\r\nexport function base64Decode(text: string): string {\r\n  let output: string = ''\r\n  let chr1: number, chr2: number, chr3: number, enc1: number, enc2: number, enc3: number, enc4: number, i = 0\r\n  text = text.replace(/[^A-Za-z0-9\\+\\/\\=]/g, '')\r\n\r\n  // 不是 4 的倍数补齐 =\r\n  while (text.length % 4) {\r\n    text += '='\r\n  }\r\n\r\n  while (i < text.length) {\r\n    enc1 = base64.indexOf(text.charAt(i++))\r\n    enc2 = base64.indexOf(text.charAt(i++))\r\n    enc3 = base64.indexOf(text.charAt(i++))\r\n    enc4 = base64.indexOf(text.charAt(i++))\r\n    chr1 = (enc1 << 2) | (enc2 >> 4)\r\n    chr2 = ((enc2 & 15) << 4) | (enc3 >> 2)\r\n    chr3 = ((enc3 & 3) << 6) | enc4\r\n    output += String.fromCharCode(chr1)\r\n    if (enc3 !== 64) {\r\n      output += String.fromCharCode(chr2)\r\n    }\r\n    if (enc4 !== 64) {\r\n      output += String.fromCharCode(chr3)\r\n    }\r\n  }\r\n  return utf8Decode(output)\r\n}\r\n\r\nfunction atobCustom(encodedString: string) {\r\n  function decodeBase64(char: string) {\r\n    const index = base64.indexOf(char)\r\n    return index === -1 ? 0 : index\r\n  }\r\n\r\n  let decodedString = ''\r\n\r\n  for (let i = 0; i < encodedString.length;) {\r\n    const enc1 = decodeBase64(encodedString[i++])\r\n    const enc2 = decodeBase64(encodedString[i++])\r\n    const enc3 = decodeBase64(encodedString[i++])\r\n    const enc4 = decodeBase64(encodedString[i++])\r\n\r\n    const chr1 = (enc1 << 2) | (enc2 >> 4)\r\n    const chr2 = ((enc2 & 15) << 4) | (enc3 >> 2)\r\n    const chr3 = ((enc3 & 3) << 6) | enc4\r\n\r\n    decodedString += String.fromCharCode(chr1)\r\n\r\n    if (enc3 !== 64) {\r\n      decodedString += String.fromCharCode(chr2)\r\n    }\r\n    if (enc4 !== 64) {\r\n      decodedString += String.fromCharCode(chr3)\r\n    }\r\n  }\r\n  return decodedString\r\n}\r\n\r\nexport function base64ToUint8Array(string: string) {\r\n  const binaryData = typeof atob === 'function' ? atob(string) : atobCustom(string)\r\n  const uint8Array = new Uint8Array(binaryData.length)\r\n  for (let i = 0; i < binaryData.length; i++) {\r\n    uint8Array[i] = binaryData.charCodeAt(i)\r\n  }\r\n  return uint8Array\r\n}\r\n\r\nexport const list = [\r\n  'A', 'B', 'C', 'D', 'E', 'F',\r\n  'G', 'H', 'I', 'J', 'K', 'L',\r\n  'M', 'N', 'O', 'P', 'Q', 'R',\r\n  'S', 'T', 'U', 'V', 'W', 'X',\r\n  'Y', 'Z', 'a', 'b', 'c', 'd',\r\n  'e', 'f', 'g', 'h', 'i', 'j',\r\n  'k', 'l', 'm', 'n', 'o', 'p',\r\n  'q', 'r', 's', 't', 'u', 'v',\r\n  'w', 'x', 'y', 'z', '0', '1',\r\n  '2', '3', '4', '5', '6', '7',\r\n  '8', '9', '+', '/'\r\n]\r\n\r\nconst _map: Record<string, number> = { }\r\n\r\narray.each(list, (char, index) => {\r\n  _map[char] = index\r\n})\r\n\r\nexport const map = _map\r\n\r\n","export function abs(a: bigint) {\r\n  return a > 0 ? a : -a\r\n}\r\n\r\nexport function max(a: bigint, b: bigint) {\r\n  return a > b ? a : b\r\n}\r\n\r\nexport function min(a: bigint, b: bigint) {\r\n  return a > b ? b : a\r\n}\r\n","/**\r\n * @file browser\r\n */\r\n\r\nimport { each } from '../util/array'\r\nimport { Browser } from '../types/type'\r\nimport * as is from './is'\r\nimport checkVersion from '../function/checkVersion'\r\n\r\nexport const enum BrowserType {\r\n  ALIPAY = 'alipay',\r\n  WECHAT = 'wechat',\r\n  DING_TALK = 'dingtalk',\r\n  BAIDU_APP = 'baiduApp',\r\n  BAIDU = 'baidu',\r\n  UC = 'uc',\r\n  QQ = 'qq',\r\n  QQ_APP = 'qqApp',\r\n  IE = 'ie',\r\n  EDGE = 'edge',\r\n  CHROME = 'chrome',\r\n  FIREFOX = 'firefox',\r\n  OPERA = 'opera',\r\n  SAFARI = 'safari',\r\n  NEW_EDGE = 'newEdge'\r\n}\r\n\r\nfunction getMajorVersion(version: string) {\r\n  if (!is.string(version)) {\r\n    return ''\r\n  }\r\n  return version.split('.').shift() || ''\r\n}\r\n\r\n/**\r\n * UA 检测浏览器\r\n *\r\n * 返回结果如下：\r\n *\r\n * {\r\n *    name: 'ie',     // 判断多个浏览器时，便于用 name 去 switch\r\n *    ie: true,       // 判断某一个浏览器时，便于 if (ie) { ... }\r\n *    version: '8.0'  // 版本号，string 类型\r\n * }\r\n *\r\n */\r\n\r\n// http://www.fynas.com/ua/search\r\nconst list = [\r\n  [ BrowserType.ALIPAY, /alipay/ ],\r\n  [ BrowserType.WECHAT, /micromessenger/ ],\r\n  [ BrowserType.DING_TALK, /dingtalk[ \\/]([\\d_.]+)/ ],\r\n  [ BrowserType.BAIDU_APP, /baiduboxapp/ ],\r\n  [ BrowserType.BAIDU, /baidubrowser/ ],\r\n  [ BrowserType.BAIDU, /bdbrowser/ ],\r\n  [ BrowserType.UC, /ucbrowser/ ],\r\n  [ BrowserType.UC, /ucweb/ ],\r\n  [ BrowserType.QQ, /qqbrowser/ ],\r\n  [ BrowserType.QQ_APP, /qq/ ],\r\n  [ BrowserType.IE, /iemobile[ \\/]([\\d_.]+)/ ],\r\n  // IE10- 所有版本都有的信息是 MSIE x.0\r\n  [ BrowserType.IE, /msie[ \\/]([\\d_.]+)/ ],\r\n  [ BrowserType.IE, /trident[ \\/]([\\d_.]+)/, 4 ],\r\n  [ BrowserType.EDGE, /edge[ \\/]([\\d_.]+)/ ],\r\n  [ BrowserType.NEW_EDGE, /edg[ \\/]([\\d_.]+)/ ],\r\n  [ BrowserType.CHROME, /chrome[ \\/]([\\d_.]+)/ ],\r\n  [ BrowserType.FIREFOX, /firefox[ \\/]([\\d_.]+)/ ],\r\n  [ BrowserType.OPERA, /opera(?:.*version)?[ \\/]([\\d_.]+)/ ],\r\n  [ BrowserType.SAFARI, /version[ \\/]([\\d_.]+) safari/ ],\r\n  // 新版 Safari UA\r\n  [ BrowserType.SAFARI, /version[ \\/]([\\d_.]+) \\S* safari/ ],\r\n  [ BrowserType.SAFARI, /safari/ ]\r\n]\r\n\r\nconst getMajorVersionMap = {\r\n\r\n}\r\n\r\nconst checkVersionMap = {\r\n\r\n}\r\n\r\n/**\r\n * 获取 UA 的结构化信息\r\n *\r\n * @inner\r\n * @param {string} ua\r\n * @return {Object}\r\n */\r\nfunction parseUA(ua: string): Browser {\r\n\r\n  let name: string\r\n  let version: string\r\n\r\n  each(\r\n    list,\r\n    (item) => {\r\n      let match = (item[1] as RegExp).exec(ua)\r\n      if (match) {\r\n        name = item[0] as string\r\n        version = match[1]\r\n        if (version) {\r\n          version = version.replace(/_/g, '.')\r\n          if (item[2]) {\r\n            version = (parseInt(version, 10) + (item[2] as number)) + '.0'\r\n          }\r\n        }\r\n        return false\r\n      }\r\n    }\r\n  )\r\n\r\n  return {\r\n    name: name || '',\r\n    version: version || '',\r\n    majorVersion: (getMajorVersionMap[name] || getMajorVersion)(version),\r\n    checkVersion: checkVersionMap[name] || checkVersion\r\n  }\r\n\r\n}\r\n\r\nconst browser = parseUA((typeof navigator === 'object' && navigator.userAgent || '').toLowerCase())\r\nif (browser.name) {\r\n  browser[browser.name] = true\r\n}\r\n\r\nexport default browser\r\n","/**\r\n * @file 为了压缩，定义的常量\r\n */\r\n\r\nexport const TRUE = true\r\nexport const FALSE = false\r\nexport const NULL = null\r\nexport const UNDEFINED = void 0\r\nexport const MINUS_ONE = -1\r\n\r\nexport const RAW_TRUE = 'true'\r\nexport const RAW_FALSE = 'false'\r\nexport const RAW_NULL = 'null'\r\nexport const RAW_UNDEFINED = 'undefined'\r\n\r\nexport const RAW_THIS = 'this'\r\nexport const RAW_VALUE = 'value'\r\nexport const RAW_LENGTH = 'length'\r\nexport const RAW_FUNCTION = 'function'\r\nexport const RAW_WILDCARD = '*'\r\nexport const RAW_DOT = '.'\r\nexport const RAW_SLASH = '/'\r\nexport const RAW_TAG = 'tag'\r\n\r\nexport const KEYPATH_PARENT = '..'\r\nexport const KEYPATH_CURRENT = RAW_THIS\r\n\r\n/**\r\n * Single instance for window in browser\r\n */\r\nexport const WINDOW: Window = typeof window !== RAW_UNDEFINED ? window : UNDEFINED\r\n\r\n/**\r\n * Single instance for document in browser\r\n */\r\nexport const DOCUMENT = typeof document !== RAW_UNDEFINED ? document : UNDEFINED\r\n\r\n/**\r\n * Single instance for global in nodejs or browser\r\n */\r\n// @ts-ignore\r\nexport const GLOBAL: Window & NodeJS.Global = typeof globalThis !== RAW_UNDEFINED ? globalThis : (typeof global !== RAW_UNDEFINED ? global : WINDOW)\r\n\r\n/**\r\n * Single instance for self in nodejs or browser\r\n */\r\n// @ts-ignore\r\nexport const SELF: Window & NodeJS.Global = typeof self !== RAW_UNDEFINED ? self : GLOBAL\r\n\r\n/**\r\n * Single instance for noop function\r\n */\r\nexport const EMPTY_FUNCTION = function () {\r\n  /** common */\r\n}\r\n\r\n/**\r\n * 空对象，很多地方会用到，比如 `a || EMPTY_OBJECT` 确保是个对象\r\n */\r\nexport const EMPTY_OBJECT = Object.freeze({})\r\n\r\n/**\r\n * 空数组\r\n */\r\nexport const EMPTY_ARRAY = Object.freeze([])\r\n\r\n/**\r\n * 空字符串\r\n */\r\nexport const EMPTY_STRING = ''\r\n\r\n","/**\r\n * @file 判断\r\n */\r\n\r\nimport * as constant from './constant'\r\n\r\n/**\r\n * Check if value is a function.\r\n *\r\n * @param value\r\n * @return\r\n */\r\nexport function func(value: any): value is Function {\r\n  return typeof value === constant.RAW_FUNCTION\r\n}\r\n\r\n/**\r\n * Check if value is an array.\r\n *\r\n * @param value\r\n * @return\r\n */\r\nexport function array<T>(value: any): value is Array<T> {\r\n  return Array.isArray(value)\r\n}\r\n\r\n/**\r\n * Check if value is an object.\r\n *\r\n * @param value\r\n * @return\r\n */\r\nexport function object(value: any): value is Object {\r\n  // 低版本 IE 会把 null 当作 object\r\n  return value !== constant.NULL && typeof value === 'object'\r\n}\r\n\r\n/**\r\n * Check if value is a string.\r\n *\r\n * @param value\r\n * @return\r\n */\r\nexport function string(value: any): value is string {\r\n  return typeof value === 'string'\r\n}\r\n\r\n/**\r\n * Check if value is a number.\r\n *\r\n * @param value\r\n * @return\r\n */\r\nexport function number(value: any): value is number {\r\n  return typeof value === 'number' && !isNaN(value)\r\n}\r\n\r\n/**\r\n * Check if value is a bigint.\r\n *\r\n * @param value\r\n * @return\r\n */\r\nexport function bigint(value: any): value is bigint {\r\n  return typeof value === 'bigint'\r\n}\r\n\r\n/**\r\n * Check if value is boolean.\r\n *\r\n * @param value\r\n * @return\r\n */\r\nexport function boolean(value: any): value is boolean {\r\n  return typeof value === 'boolean'\r\n}\r\n\r\n/**\r\n * Check if value is numeric.\r\n *\r\n * @param value\r\n * @return\r\n */\r\nexport function numeric(value: any): value is (number | string) {\r\n  return number(value)\r\n    || (string(value) && !isNaN(parseFloat(value)) && isFinite(+value))\r\n}\r\n\r\nconst hasOwn = {}.hasOwnProperty\r\n\r\n/**\r\n * 判断是不是普通字面量对象\r\n *\r\n * @param {*} target\r\n * @return {boolean}\r\n */\r\nexport function isPlainObject(target: any): target is Object {\r\n  if (!object(target) || target.nodeType || target === target.window) {\r\n    return false\r\n  }\r\n\r\n  if ( target.constructor\r\n    && !hasOwn.call(target, 'constructor')\r\n    && !hasOwn.call(target.constructor.prototype || {}, 'isPrototypeOf')) {\r\n    return false\r\n  }\r\n\r\n  let key: string\r\n  for ( key in target ) {\r\n    /* empty */\r\n  }\r\n  return key === undefined || hasOwn.call(target, key)\r\n}\r\n\r\n/**\r\n * 判断 value 是否在指定范围中\r\n * \r\n * @param value 待判断值\r\n * @param min 范围左区间\r\n * @param max 范围右区间\r\n */\r\nexport function range(value: number, min: number, max: number): boolean {\r\n  return value >= min && value <= max\r\n}\r\n\r\n/**\r\n * Check if value is ArrayBuffer.\r\n * \r\n * @param value \r\n * @returns \r\n */\r\nexport function arrayBuffer(value: any): value is ArrayBuffer {\r\n  return value instanceof ArrayBuffer\r\n}\r\n","/**\r\n * @file 路径操作\r\n */\r\n\r\nimport * as string from './string'\r\nimport * as constant from './constant'\r\n\r\nconst dotPattern = /\\./g,\r\n\r\n    asteriskPattern = /\\*/g,\r\n\r\n    doubleAsteriskPattern = /\\*\\*/g,\r\n\r\n    splitCache: Record<string, string[]> = {},\r\n\r\n    patternCache: Record<string, RegExp> = {}\r\n\r\n/**\r\n * 判断 keypath 是否以 prefix 开头，如果是，返回匹配上的前缀长度，否则返回 -1\r\n *\r\n * @param keypath\r\n * @param prefix\r\n * @return\r\n */\r\nexport function match(keypath: string, prefix: string): number {\r\n  if (keypath === prefix) {\r\n    return prefix.length\r\n  }\r\n  prefix += constant.RAW_DOT\r\n  return string.startsWith(keypath, prefix)\r\n    ? prefix.length\r\n    : constant.MINUS_ONE\r\n}\r\n\r\n/**\r\n * 遍历 keypath 的每个部分\r\n *\r\n * @param keypath\r\n * @param callback 返回 false 可中断遍历\r\n */\r\nexport function each(keypath: string, callback: (key: string, isLast: boolean) => boolean | void) {\r\n  /*\r\n   * 如果 keypath 是 toString 之类的原型字段\r\n   * splitCache[keypath] 会取到原型链上的对象\r\n   */\r\n  const list = splitCache.hasOwnProperty(keypath)\r\n    ? splitCache[keypath]\r\n    : (splitCache[keypath] = keypath.split(constant.RAW_DOT))\r\n\r\n  for (let i = 0, lastIndex = list.length - 1; i <= lastIndex; i++) {\r\n    if (callback(list[i], i === lastIndex) === constant.FALSE) {\r\n      break\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 路径组合\r\n *\r\n * @param keypath1\r\n * @param keypath2\r\n */\r\nexport function join(keypath1: string, keypath2: string): string {\r\n  return keypath1 && keypath2\r\n    ? keypath1 + constant.RAW_DOT + keypath2\r\n    : keypath1 || keypath2\r\n}\r\n\r\n/**\r\n * 是否是模糊匹配\r\n *\r\n * @param keypath\r\n */\r\nexport function isFuzzy(keypath: string): boolean {\r\n  return string.has(keypath, constant.RAW_WILDCARD)\r\n}\r\n\r\n/**\r\n * 模糊匹配 keypath\r\n *\r\n * @param keypath 待匹配路径\r\n * @param pattern 匹配规则\r\n */\r\nexport function matchFuzzy(keypath: string, pattern: string): string | void {\r\n  let cache = patternCache[pattern]\r\n  if (!cache) {\r\n    const str = pattern\r\n      .replace(dotPattern, '\\\\.')\r\n      .replace(asteriskPattern, '(\\\\w+)')\r\n      .replace(doubleAsteriskPattern, '([\\.\\\\w]+?)')\r\n    cache = patternCache[pattern] = new RegExp(`^${str}$`)\r\n  }\r\n  const result = keypath.match(cache)\r\n  if (result) {\r\n    return result[1]\r\n  }\r\n}\r\n\r\n/**\r\n * 返回 keypath 的根路径\r\n *\r\n * @param keypath\r\n */\r\nexport function rootPath(keypath: string): string {\r\n  return keypath && keypath.split(constant.RAW_DOT).shift()\r\n}\r\n","/**\r\n * @file 日志\r\n */\r\n\r\nimport * as constant from './constant'\r\nimport toString from '../function/toString'\r\n\r\nexport const TRACE = 0\r\nexport const DEBUG = 1\r\nexport const INFO = 2\r\nexport const WARN = 3\r\nexport const ERROR = 4\r\nexport const FATAL = 5\r\n\r\ntype defined<T extends string> = `defined(${T})`\r\n\r\nconst nativeConsole: Console | null = typeof console !== constant.RAW_UNDEFINED ? console : constant.NULL,\r\n\r\n    /**\r\n     * 当前是否是源码调试，如果开启了代码压缩，empty function 里的注释会被干掉\r\n     */\r\n    defaultLogLevel = /common/.test(toString(constant.EMPTY_FUNCTION)) ? INFO : WARN,\r\n\r\n    /**\r\n     * console 样式前缀\r\n     * ie 和 edge 不支持 console.log 样式\r\n     */\r\n    stylePrefix = constant.WINDOW && /edge|msie|trident/i.test(constant.WINDOW.navigator.userAgent) || true\r\n      ? constant.EMPTY_STRING\r\n      : '%c',\r\n\r\n    /**\r\n     * 日志打印函数\r\n     */\r\n    printLog = nativeConsole\r\n      ? stylePrefix\r\n        ? function (tag: string, msg: string, style: string) {\r\n          nativeConsole.log(stylePrefix + tag, style, msg)\r\n        }\r\n        : function (tag: string, msg: string) {\r\n          nativeConsole.log(tag, msg)\r\n        }\r\n      : constant.EMPTY_FUNCTION\r\n\r\n/**\r\n * 全局调试开关\r\n */\r\nfunction getLogLevel() {\r\n  if (constant.GLOBAL) {\r\n    const logLevel = constant.SELF['COMMON_LOG_LEVEL']\r\n    if (logLevel >= TRACE && logLevel <= FATAL) {\r\n      return logLevel as number\r\n    }\r\n  }\r\n  return defaultLogLevel\r\n}\r\n\r\n/**\r\n * 设置日志输出级别\r\n * \r\n * @param level 日志输出级别\r\n */\r\nexport function setLevel(level: number): void {\r\n  constant.SELF['COMMON_LOG_LEVEL'] = level\r\n}\r\n\r\nfunction getStyle(backgroundColor: string) {\r\n  return `background-color:${backgroundColor};border-radius:12px;color:#fff;font-size:10px;padding:3px 6px;`\r\n}\r\n\r\n/**\r\n * 打印 trace 日志\r\n *\r\n * @param msg\r\n */\r\nexport function trace(msg: string, file: string, line: number): void\r\nexport function trace<args = [defined<'__FILE__'>, defined<'__LINE__'>], enableArgs=defined<'ENABLE_LOG_PATH'>>(msg: string): void\r\nexport function trace(msg: string, file?: string, line?: number): void {\r\n  if (getLogLevel() <= TRACE) {\r\n    printLog(`[${arguments[1]}][line ${arguments[2]}] [trace]`, msg, getStyle('#999'))\r\n  }\r\n}\r\n\r\n/**\r\n * 打印 debug 日志\r\n *\r\n * @param msg\r\n */\r\nexport function debug(msg: string, file: string, line: number): void\r\nexport function debug<args = [defined<'__FILE__'>, defined<'__LINE__'>], enableArgs=defined<'ENABLE_LOG_PATH'>>(msg: string): void\r\nexport function debug(msg: string, file?: string, line?: number): void  {\r\n  if (getLogLevel() <= DEBUG) {\r\n    printLog(`[${arguments[1]}][line ${arguments[2]}] [debug]`, msg, getStyle('#999'))\r\n  }\r\n}\r\n\r\n/**\r\n * 打印 info 日志\r\n *\r\n * @param msg\r\n */\r\nexport function info(msg: string, file: string, line: number): void\r\nexport function info<args = [defined<'__FILE__'>, defined<'__LINE__'>], enableArgs=defined<'ENABLE_LOG_PATH'>>(msg: string): void\r\nexport function info(msg: string, file?: string, line?: number): void {\r\n  if (getLogLevel() <= INFO) {\r\n    printLog(`[${arguments[1]}][line ${arguments[2]}] [info]`, msg, getStyle('#2db7f5'))\r\n  }\r\n}\r\n\r\n/**\r\n * 打印 warn 日志\r\n *\r\n * @param msg\r\n */\r\nexport function warn(msg: string, file: string, line: number): void\r\nexport function warn<args = [defined<'__FILE__'>, defined<'__LINE__'>], enableArgs=defined<'ENABLE_LOG_PATH'>>(msg: string): void\r\nexport function warn(msg: string, file?: string, line?: number): void {\r\n  if (getLogLevel() <= WARN) {\r\n    printLog(`[${arguments[1]}][line ${arguments[2]}] [warn]`, msg, getStyle('#f90'))\r\n  }\r\n}\r\n\r\n/**\r\n * 打印 error 日志\r\n *\r\n * @param msg\r\n */\r\nexport function error(msg: string, file: string, line: number): void\r\nexport function error<args = [defined<'__FILE__'>, defined<'__LINE__'>], enableArgs=defined<'ENABLE_LOG_PATH'>>(msg: string): void\r\nexport function error(msg: string, file?: string, line?: number): void {\r\n  if (getLogLevel() <= ERROR) {\r\n    printLog(`[${arguments[1]}][line ${arguments[2]}] [error]`, msg, getStyle('#ed4014'))\r\n  }\r\n}\r\n\r\n/**\r\n * 致命错误，中断程序\r\n *\r\n * @param msg\r\n */\r\nexport function fatal(msg: string, file: string, line: number): void\r\nexport function fatal<args = [defined<'__FILE__'>, defined<'__LINE__'>], enableArgs=defined<'ENABLE_LOG_PATH'>>(msg: string): void\r\nexport function fatal(msg: string, file?: string, line?: number): void {\r\n  if (getLogLevel() <= FATAL) {\r\n    error(msg, file, line)\r\n    throw new Error(`[${arguments[1]}][line ${arguments[2]}] [fatal]: ${msg}`)\r\n  }\r\n}\r\n\r\n/**\r\n * 根据日志等级打印\r\n * \r\n * @param level \r\n * @param msg \r\n * @param tag \r\n */\r\nexport function log(level: number, msg: string, file: string, line: number): void\r\nexport function log<args = [defined<'__FILE__'>, defined<'__LINE__'>], enableArgs=defined<'ENABLE_LOG_PATH'>>(level: number, msg: string): void\r\nexport function log(level: number, msg: string, file?: string, line?: number): void {\r\n  if (level === TRACE) {\r\n    trace(msg, arguments[2], arguments[3])\r\n  }\r\n  else if (level === DEBUG) {\r\n    debug(msg, arguments[2], arguments[3])\r\n  }\r\n  else if (level === INFO) {\r\n    info(msg, arguments[2], arguments[3])\r\n  }\r\n  else if (level === WARN) {\r\n    warn(msg, arguments[2], arguments[3])\r\n  }\r\n  else if (level === ERROR) {\r\n    error(msg, arguments[2], arguments[3])\r\n  }\r\n  else if (level === FATAL) {\r\n    fatal(msg, arguments[2], arguments[3])\r\n  }\r\n}\r\n\r\n/**\r\n * @internal\r\n * 是否上传，全局配置\r\n */\r\nlet enableUpload: boolean = true\r\n\r\n/**\r\n * @internal\r\n * 日志上传等级，全局配置\r\n */\r\nlet uploadLevel: number = WARN\r\n\r\n/**\r\n * 打开日志上传\r\n * \r\n */\r\nexport function enableUploadLog(): void {\r\n  enableUpload = true\r\n}\r\n\r\n/**\r\n * 关闭日志上传\r\n */\r\nexport function disableUploadLog(): void {\r\n  enableUpload = false\r\n}\r\n\r\n/**\r\n * 是否可以上传日志\r\n */\r\nexport function canUploadLog() {\r\n  return enableUpload\r\n}\r\n\r\n/**\r\n * 设置日志上传等级\r\n */\r\nexport function setUploadLevel(level: number) {\r\n  uploadLevel = level\r\n}\r\n\r\n/**\r\n * 获取日志上传等级\r\n */\r\nexport function getUploadLevel() {\r\n  return uploadLevel\r\n}\r\n","/**\r\n * @file 对象操作\r\n */\r\n\r\nimport * as is from './is'\r\nimport * as array from './array'\r\nimport { Data } from '../types/type'\r\nimport * as constant from './constant'\r\nimport * as keypathUtil from './keypath'\r\nimport isDef from '../function/isDef'\r\n\r\n/**\r\n * 获取对象的 key 的数组\r\n *\r\n * @param object\r\n * @return\r\n */\r\nexport function keys<T>(object: T): string[] {\r\n  if (!isDef(object)) {\r\n    return []\r\n  }\r\n  return Object.keys(object)\r\n}\r\n\r\nfunction sortKeyByAsc(a: string, b: string): number {\r\n  return a.length - b.length\r\n}\r\n\r\nfunction sortKeyByDesc(a: string, b: string): number {\r\n  return b.length - a.length\r\n}\r\n\r\n/**\r\n * 排序对象的 key\r\n *\r\n * @param object\r\n * @param desc 是否逆序，默认从小到大排序\r\n * @return\r\n */\r\nexport function sort(object: Data, desc?: boolean): string[] {\r\n  return keys(object).sort(desc ? sortKeyByDesc : sortKeyByAsc)\r\n}\r\n\r\n/**\r\n * 遍历对象\r\n *\r\n * @param object\r\n * @param callback 返回 false 可停止遍历\r\n */\r\nexport function each<T extends Data>(object: T, callback: (value: T[keyof T], key: string) => boolean | void): void {\r\n  for (let key in object) {\r\n    if (callback(object[key], key) === constant.FALSE) {\r\n      break\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 清空对象所有的键值对\r\n *\r\n * @param object\r\n */\r\nexport function clear(object: Data): void {\r\n  each(\r\n    object,\r\n    function (_, key) {\r\n      delete object[key]\r\n    }\r\n  )\r\n}\r\n\r\nfunction _extend<T, U>(original: T, object: U): T & U {\r\n  if (!is.object(original)) {\r\n    return object as any\r\n  }\r\n  else if (!is.object(object)) {\r\n    return original as any\r\n  }\r\n  each(\r\n    object,\r\n    function (value, key) {\r\n      original[key] = value\r\n    }\r\n  )\r\n  return original as any\r\n}\r\n\r\n/**\r\n * 扩展对象\r\n *\r\n * @return\r\n */\r\nexport function extend<T, U, V>(original: T, object: U, object2?: V): T & U & V {\r\n  return _extend(_extend(original, object), object2)\r\n}\r\n\r\n/**\r\n * 合并对象\r\n *\r\n * @return\r\n */\r\nexport function merge(object1: Data | void, object2: Data | void): Data | void {\r\n  return object1 && object2\r\n    ? extend(extend({}, object1), object2)\r\n    : object1 || object2\r\n}\r\n\r\n/**\r\n * 拷贝对象\r\n *\r\n * @param object\r\n * @param deep 是否需要深拷贝\r\n * @return\r\n */\r\nexport function copy(object: any, deep?: boolean): any {\r\n  let result = object\r\n  if (is.array(object)) {\r\n    if (deep) {\r\n      result = []\r\n      array.each(\r\n        object,\r\n        function (item, index) {\r\n          result[index] = copy(item, deep)\r\n        }\r\n      )\r\n    }\r\n    else {\r\n      result = object.slice()\r\n    }\r\n  }\r\n  else if (is.object(object)) {\r\n    result = {}\r\n    each(\r\n      object,\r\n      function (value, key) {\r\n        result[key] = deep ? copy(value, deep) : value\r\n      }\r\n    )\r\n  }\r\n  return result\r\n}\r\n\r\n/**\r\n * 从对象中查找一个 keypath\r\n *\r\n * 返回值是空时，表示没找到值\r\n *\r\n * @param object\r\n * @param keypath\r\n * @return\r\n */\r\nexport function get(object: any, keypath: string, defaultValue?: any): any {\r\n\r\n  let result: any\r\n\r\n  keypathUtil.each(\r\n    keypath,\r\n    function (key, isLast) {\r\n\r\n      if (object != constant.NULL) {\r\n\r\n        // 先直接取值\r\n        let value = object[key],\r\n\r\n            // 紧接着判断值是否存在\r\n            hasValue = value !== constant.UNDEFINED\r\n\r\n        if (isLast) {\r\n          if (hasValue) {\r\n            result = value\r\n          }\r\n          else {\r\n            result = constant.UNDEFINED\r\n          }\r\n        }\r\n        else {\r\n          object = value\r\n        }\r\n      }\r\n      else {\r\n        result = constant.UNDEFINED\r\n        return constant.FALSE\r\n      }\r\n\r\n    }\r\n  )\r\n\r\n  // 没找到使用默认值\r\n  if (result === constant.UNDEFINED) {\r\n    result = defaultValue\r\n  }\r\n\r\n  return result\r\n\r\n}\r\n\r\n/**\r\n * 为对象设置一个键值对\r\n *\r\n * @param object\r\n * @param keypath\r\n * @param value\r\n * @param autofill 是否自动填充不存在的对象，默认自动填充\r\n */\r\nexport function set(object: Data, keypath: string, value: any, autofill?: boolean): void {\r\n  keypathUtil.each(\r\n    keypath,\r\n    function (key, isLast) {\r\n      if (isLast) {\r\n        object[key] = value\r\n      }\r\n      else if (object[key]) {\r\n        object = object[key]\r\n      }\r\n      else if (autofill) {\r\n        object = object[key] = {}\r\n      }\r\n      else {\r\n        return constant.FALSE\r\n      }\r\n    }\r\n  )\r\n}\r\n\r\n/**\r\n * 对象是否包含某个 key\r\n *\r\n * @param object\r\n * @param key\r\n * @return\r\n */\r\nexport function has<T extends Data>(object: T, key: keyof T): boolean {\r\n  // 不用 hasOwnProperty，性能差\r\n  return object[key] !== constant.UNDEFINED\r\n}\r\n\r\n/**\r\n * 是否是空对象\r\n *\r\n * @param object\r\n * @return\r\n */\r\nexport function falsy(object: any): boolean {\r\n  return !is.object(object)\r\n    || is.array(object)\r\n    || !keys(object).length\r\n}\r\n\r\n/**\r\n * 获取两个对象的 value 不同的 key\r\n * \r\n * @param obj1 \r\n * @param obj2 \r\n */\r\nexport function diff(obj1: Object, obj2: Object): string[] {\r\n  let differences: string[] = []\r\n\r\n  each(obj1, (value, key) => {\r\n    if (is.array(value) || is.isPlainObject(value)) {\r\n      if (obj2[key] == null || diff(value, obj2[key]).length > 0) {\r\n        differences.push(key)\r\n      }\r\n    }\r\n    else if (value !== obj2[key]) {\r\n      differences.push(key)\r\n    }\r\n  })\r\n\r\n  return differences\r\n}\r\n\r\n/**\r\n * 序列化对象\r\n * \r\n * @param data\r\n */\r\nexport function param(data: Object | Array<any>) {\r\n  let result = []\r\n  const add = (key: string | number, value: any) => {\r\n    value = is.func(value) ? value() : (value == null ? '' : value)\r\n    result[result.length] = encodeURIComponent(key) + '=' + encodeURIComponent(value)\r\n  }\r\n  if (is.array(data) || is.isPlainObject(data)) {\r\n    if (is.array(data)) {\r\n      array.each(data, (value, key) => {\r\n        add(key, value)\r\n      })\r\n    }\r\n    else {\r\n      each(data, (value, key) => {\r\n        add(key, value)\r\n      })\r\n    }\r\n  }\r\n  return result.join('&').replace(/%20/g, '+')\r\n}\r\n\r\n/**\r\n * 将 object 的 value 变成数组\r\n */\r\nexport function toArray(data: Object) {\r\n  const result = []\r\n  each(data, (value) => {\r\n    result.push(value)\r\n  })\r\n  return result\r\n}\r\n\r\n/**\r\n * \r\n * 更新两个同一类型的对象\r\n * \r\n * @param obj1 \r\n * @param obj2 \r\n * @returns \r\n */\r\nexport function update(obj1: Object, obj2: Object) {\r\n  if (!is.object(obj1) || !is.object(obj2)) {\r\n    return\r\n  }\r\n\r\n  each(obj2, (value, key) => {\r\n    if (is.object(value) && is.object(obj1[key])) {\r\n      update(obj1[key], value)\r\n    }\r\n    else {\r\n      obj1[key] = obj2[key]\r\n    }\r\n  })\r\n\r\n  return obj1\r\n}\r\n\r\n/**\r\n * 反转 object 的 key value\r\n */\r\nexport function reverse(obj: Record<number | string | symbol, number | string | symbol>) {\r\n  const result = {}\r\n  each(obj, (value, key) => {\r\n    result[value] = key\r\n  })\r\n  return result\r\n}\r\n","/**\r\n * UA 检测操作系统\r\n *\r\n * 返回结果如下：\r\n *\r\n * {\r\n *    name: 'mac',     // 判断多个浏览器时，便于用 name 去 switch\r\n *    mac: true,       // 判断某一个浏览器时，便于 if (mac) { ... }\r\n *    version: '8.0'   // 版本号，string 类型\r\n * }\r\n *\r\n */\r\n\r\nimport { OS } from '../types/type'\r\nimport { each } from '../util/array'\r\n\r\n/**\r\n * linux 发行版太多了，很多是没有版本信息的，只匹配 Linux 标识\r\n */\r\n\r\n// 优先判断移动版，因为移动版通常会带着 PC 的标识，反过来则不会\r\nconst list = [\r\n  [ 'harmony', /harmonyos ([\\d_.]+)/ ],\r\n  [ 'harmony', /openharmony ([\\d_.]+)/ ],\r\n  [ 'iphone', /iphone os ([\\d_.]+)/ ],\r\n  [ 'ipad', /ipad; cpu os ([\\d_.]+)/ ],\r\n  [ 'itouch', /itouch; cpu os ([\\d_.]+)/ ],\r\n  [ 'android', /android ([\\d_.]+)/ ],\r\n  [ 'wp', /windows phone ([\\d_.]+)/ ],\r\n  [ 'windows', /windows nt ([\\d_.]+)/ ],\r\n  [ 'linux', /linux/ ],\r\n  [ 'mac', /mac os x ([\\d_.]+)/ ]\r\n]\r\n\r\nconst iosMap = {\r\n  iphone: 1,\r\n  ipad: 1,\r\n  itouch: 1\r\n}\r\n\r\n/**\r\n * 获取 UA 的结构化信息\r\n *\r\n * @inner\r\n * @param {string} ua\r\n * @return {Object}\r\n */\r\nfunction parseUA(ua: string): OS {\r\n\r\n  let name: string\r\n  let version: string\r\n\r\n  each(\r\n    list,\r\n    (item) => {\r\n      let match = (item[1] as RegExp).exec(ua)\r\n      if (match) {\r\n        name = item[0] as string\r\n        version = match[1]\r\n        if (version) {\r\n          version = version.replace(/_/g, '.')\r\n        }\r\n        return false\r\n      }\r\n    }\r\n  )\r\n\r\n  return {\r\n    name: name || '',\r\n    version: version || '',\r\n    mobile: ua.indexOf('mobile') > -1\r\n  }\r\n}\r\n\r\nconst os = parseUA((typeof navigator === 'object' && navigator.userAgent || '').toLowerCase())\r\nif (os.name) {\r\n  os[os.name] = true\r\n  if (iosMap[os.name]) {\r\n    os.ios = true\r\n  }\r\n}\r\n\r\nexport default os\r\n","/**\r\n * @file string 操作\r\n */\r\n\r\nimport * as is from './is'\r\nimport * as constant from './constant'\r\nimport toString from '../function/toString'\r\n\r\nconst capitalizePattern = /^[a-z]/, capitalizeCache: Record<string, string> = {}\r\n\r\n/**\r\n * 首字母大写\r\n *\r\n * @param str\r\n * @return\r\n */\r\nexport function capitalize(str: string): string {\r\n  if (!capitalizeCache[str]) {\r\n    capitalizeCache[str] = str.replace(\r\n      capitalizePattern,\r\n      upper\r\n    )\r\n  }\r\n  return capitalizeCache[str]\r\n}\r\n\r\n/**\r\n * 清除两侧空白符\r\n *\r\n * @param str\r\n * @return 清除两侧空白符的字符串\r\n */\r\nexport function trim(str: any): string {\r\n  return falsy(str)\r\n    ? constant.EMPTY_STRING\r\n    : str.trim()\r\n}\r\n\r\n/**\r\n * 截取字符串\r\n *\r\n * @param str\r\n * @param start\r\n * @param end\r\n * @return\r\n */\r\nexport function slice(str: string, start: number, end?: number): string {\r\n  return is.number(end)\r\n    ? start === end\r\n      ? constant.EMPTY_STRING\r\n      : str.slice(start, end)\r\n    : str.slice(start)\r\n}\r\n\r\n/**\r\n * 获取子串的起始位置\r\n *\r\n * @param str\r\n * @param part\r\n * @param start\r\n * @return\r\n */\r\nexport function indexOf(str: string, part: string, start?: number): number {\r\n  return str.indexOf(part, start !== constant.UNDEFINED ? start : 0)\r\n}\r\n\r\n/**\r\n * 获取子串的起始位置\r\n *\r\n * @param str\r\n * @param part\r\n * @param end\r\n * @return\r\n */\r\nexport function lastIndexOf(str: string, part: string, end?: number): number {\r\n  return str.lastIndexOf(part, end !== constant.UNDEFINED ? end : str.length)\r\n}\r\n\r\n/**\r\n * str 是否以 part 开头\r\n *\r\n * @param str\r\n * @param part\r\n * @return\r\n */\r\nexport function startsWith(str: string, part: string): boolean {\r\n  return indexOf(str, part) === 0\r\n}\r\n\r\n/**\r\n * str 是否以 part 结束\r\n *\r\n * @param str\r\n * @param part\r\n * @return\r\n */\r\nexport function endsWith(str: string, part: string): boolean {\r\n  const offset = str.length - part.length\r\n  return offset >= 0 && lastIndexOf(str, part) === offset\r\n}\r\n\r\n/**\r\n * 获取某个位置的字符\r\n */\r\nexport function charAt(str: string, index?: number): string {\r\n  return str.charAt(index || 0)\r\n}\r\n\r\n/**\r\n * 获取某个位置的字符编码\r\n */\r\nexport function codeAt(str: string, index?: number): number {\r\n  return str.charCodeAt(index || 0)\r\n}\r\n\r\n/**\r\n * 大写格式\r\n */\r\nexport function upper(str: string): string {\r\n  return str.toUpperCase()\r\n}\r\n\r\n/**\r\n * 小写格式\r\n */\r\nexport function lower(str: string): string {\r\n  return str.toLowerCase()\r\n}\r\n\r\n/**\r\n * str 是否包含 part\r\n *\r\n * @param str\r\n * @param part\r\n * @return 是否包含\r\n */\r\nexport function has(str: string, part: string): boolean {\r\n  return indexOf(str, part) >= 0\r\n}\r\n\r\n/**\r\n * 判断长度大于 0 的字符串\r\n *\r\n * @param str\r\n * @return\r\n */\r\nexport function falsy(str: any): boolean {\r\n  return !is.string(str) || !str.length\r\n}\r\n\r\n/**\r\n * 格式化输出\r\n * \r\n * @param string \r\n * @param args \r\n * @returns \r\n */\r\nexport function format(string: string, ...args: any[]) {\r\n  let i = 0\r\n  const length = args.length\r\n  return string.replace(/(%[sdvx%])|(%0(\\d)+[dx])/g, (str) => {\r\n    if (i >= length) {\r\n      // missing argument\r\n      return str\r\n    }\r\n\r\n    const arg = args[i++]\r\n\r\n    if (/%0(\\d)+[dx]/g.test(str)) {\r\n      const length = parseInt(str.substring(1))\r\n      let result = str[str.length - 1] === 'd' ? toString(Number(arg)) : Number(arg).toString(16)\r\n      if (length > result.length) {\r\n        result = new Array(length - result.length).fill('0').join('') + result\r\n      }\r\n      return result\r\n    }\r\n\r\n    switch (str) {\r\n      case '%%':\r\n        return '%'\r\n      case '%s':\r\n        return String(arg)\r\n      case '%d':\r\n        return toString(Number(arg))\r\n      case '%v':\r\n        return ''\r\n      case '%x':\r\n        return Number(arg).toString(16)\r\n    }\r\n    return str\r\n  })\r\n}\r\n","import isWorker from '../function/isWorker'\r\nimport browser from './browser'\r\n\r\n\r\nfunction supportedFeatures() {\r\n\r\n  let blob = typeof Blob === 'function'\r\n  let wasm = typeof WebAssembly === 'object' && typeof WebAssembly.instantiate === 'function'\r\n  let fetchSupported = typeof fetch === 'function'\r\n  let documentSupport = typeof document === 'object'\r\n\r\n  let canvas = documentSupport && document.createElement('canvas')\r\n  let webgl = canvas && !!canvas.getContext('webgl')\r\n  let offscreenCanvas = typeof OffscreenCanvas === 'function'\r\n\r\n  let worker = typeof Worker === 'function'\r\n\r\n  let arrayBuffer = typeof ArrayBuffer === 'function'\r\n\r\n  let atomics = typeof Atomics === 'object' && Atomics[Symbol.toStringTag] === 'Atomics'\r\n\r\n  let audioContext = typeof AudioContext === 'function' || typeof webkitAudioContext === 'function'\r\n  let audioWorklet = typeof AudioWorklet === 'function'\r\n\r\n  let videoDecoder = typeof VideoDecoder === 'function'\r\n  let videoEncoder = typeof VideoEncoder === 'function'\r\n\r\n  let audioDecoder = typeof AudioDecoder === 'function'\r\n  let audioEncoder = typeof AudioEncoder === 'function'\r\n\r\n  let shareArrayBuffer = typeof SharedArrayBuffer === 'function'\r\n\r\n  let mse = typeof MediaSource == 'function' || typeof ManagedMediaSource === 'function'\r\n\r\n  let proxy = typeof Proxy === 'function'\r\n\r\n  let thread = (worker || isWorker()) && shareArrayBuffer && atomics && proxy\r\n\r\n  let jspi = typeof WebAssembly.Suspending === 'function' && typeof WebAssembly.promising === 'function'\r\n\r\n  // safari 低于 11 不支持\r\n  if (browser.safari && !browser.checkVersion(browser.majorVersion, '11', true)) {\r\n    wasm = false\r\n  }\r\n\r\n  // chrome 94 以上才支持 webcodec\r\n  if (browser.chrome && !browser.checkVersion(browser.majorVersion, '94', true)) {\r\n    videoDecoder = false\r\n    audioDecoder = false\r\n  }\r\n\r\n  // safari 17 之前渲染 VideoFrame 有问题\r\n  if (browser.safari && !browser.checkVersion(browser.majorVersion, '17', true)) {\r\n    videoDecoder = false\r\n  }\r\n\r\n  let webgpu = typeof navigator === 'object' && typeof navigator.gpu === 'object'\r\n\r\n  let workerMSE = typeof MediaSourceHandle === 'function'\r\n\r\n  let webAssemblyGlobal = wasm && typeof WebAssembly.Global === 'function'\r\n\r\n  return {\r\n    browser,\r\n    blob,\r\n    wasm,\r\n    fetch: fetchSupported,\r\n    webgl,\r\n    worker,\r\n    mse,\r\n    arrayBuffer,\r\n    audioContext,\r\n    audioWorklet,\r\n    videoDecoder,\r\n    videoEncoder,\r\n    audioDecoder,\r\n    audioEncoder,\r\n    atomics,\r\n    shareArrayBuffer,\r\n    thread,\r\n    webgpu,\r\n    offscreenCanvas,\r\n    workerMSE,\r\n    webAssemblyGlobal,\r\n    jspi,\r\n    proxy,\r\n    simd: (browser.chrome || browser.newEdge) && browser.checkVersion(browser.majorVersion, '91', true)\r\n      || browser.firefox && browser.checkVersion(browser.majorVersion, '89', true)\r\n      || browser.safari && browser.checkVersion(browser.version, '16.4', true),\r\n    wasmBaseSupported: fetchSupported && wasm && webgl && audioContext && arrayBuffer && webAssemblyGlobal\r\n  }\r\n}\r\n\r\nconst support = supportedFeatures()\r\n\r\nexport default support\r\n","const encoder = typeof TextEncoder === 'function' ? new TextEncoder() : null\r\nconst decoder = typeof TextDecoder === 'function' ? new TextDecoder() : null\r\n\r\nexport function encode(data: string) {\r\n  if (encoder) {\r\n    return encoder.encode(data)\r\n  }\r\n\r\n  const array = []\r\n\r\n  for (let i = 0; i < data.length; ++i) {\r\n    let u = data.charCodeAt(i)\r\n    if (u >= 55296 && u <= 57343) {\r\n      let u1 = data.charCodeAt(++i)\r\n      u = 65536 + ((u & 1023) << 10) | u1 & 1023\r\n    }\r\n    if (u <= 127) {\r\n      array.push(u)\r\n    }\r\n    else if (u <= 2047) {\r\n      array.push(192 | u >> 6)\r\n      array.push(128 | u & 63)\r\n    }\r\n    else if (u <= 65535) {\r\n      array.push(224 | u >> 12)\r\n      array.push(128 | u >> 6 & 63)\r\n      array.push(128 | u & 63)\r\n    }\r\n    else {\r\n      array.push(240 | u >> 18)\r\n      array.push(128 | u >> 12 & 63)\r\n      array.push(128 | u >> 6 & 63)\r\n      array.push(128 | u & 63)\r\n    }\r\n  }\r\n  return new Uint8Array(array)\r\n}\r\n\r\nfunction decodeJS(data: Uint8Array | number[]) {\r\n  let result = ''\r\n\r\n  for (let i = 0; i < data.length;) {\r\n    let u0 = data[i++ >>> 0]\r\n    if (!(u0 & 128)) {\r\n      result += String.fromCharCode(u0)\r\n      continue\r\n    }\r\n    let u1 = data[i++ >>> 0] & 63\r\n    if ((u0 & 224) == 192) {\r\n      result += String.fromCharCode((u0 & 31) << 6 | u1)\r\n      continue\r\n    }\r\n    let u2 = data[i++ >>> 0] & 63\r\n    if ((u0 & 240) == 224) {\r\n      u0 = (u0 & 15) << 12 | u1 << 6 | u2\r\n    }\r\n    else {\r\n      u0 = (u0 & 7) << 18 | u1 << 12 | u2 << 6 | data[i++ >>> 0] & 63\r\n    }\r\n    if (u0 < 65536) {\r\n      result += String.fromCharCode(u0)\r\n    }\r\n    else {\r\n      let ch = u0 - 65536\r\n      result += String.fromCharCode(55296 | ch >> 10, 56320 | ch & 1023)\r\n    }\r\n  }\r\n  return result\r\n}\r\n\r\nexport function decode(data: Uint8Array | number[]) {\r\n  if (data instanceof Uint8Array && decoder && !(typeof SharedArrayBuffer === 'function' && data.buffer instanceof SharedArrayBuffer)) {\r\n    try {\r\n      // chrome 偶现 data.buffer instanceof SharedArrayBuffer 返回 false 但其实是 SharedArrayBuffer 的情况\r\n      return decoder.decode(data)\r\n    }\r\n    catch (error) {\r\n      return decodeJS(data)\r\n    }\r\n  }\r\n  return decodeJS(data)\r\n}\r\n","/**\r\n * @file url 操作\r\n */\r\n\r\nimport * as is from '../util/is'\r\nimport split from '../function/split'\r\nimport * as array from '../util/array'\r\nimport * as object from '../util/object'\r\n\r\n/**\r\n * 把查询字符串解析成对象\r\n * @param queryStr \r\n */\r\nexport function parseQuery(queryStr: string, separator: string = '&'): Record<string, string> {\r\n  const result = {}\r\n  if (is.string(queryStr) && queryStr.indexOf('=') >= 0) {\r\n    let firstChar = queryStr.charAt(0)\r\n    let startIndex = (firstChar === '?' || firstChar === '#') ? 1 : 0\r\n    if (startIndex > 0) {\r\n      queryStr = queryStr.substr(startIndex)\r\n    }\r\n    array.each(split(queryStr, separator), (item) => {\r\n      let terms = item.split('=')\r\n      if (terms.length === 2) {\r\n        let key = terms[0]?.trim()\r\n        if (key) {\r\n          result[key] = decodeURIComponent(terms[1])\r\n        }\r\n      }\r\n    })\r\n  }\r\n  return result\r\n}\r\n\r\n/**\r\n * 把对象序列化成查询字符串\r\n *\r\n * @param query\r\n * @return\r\n */\r\nexport function stringifyQuery(query: Record<string, string | number | boolean>, separator: string = '&'): string {\r\n  const result = []\r\n  if (is.isPlainObject(query)) {\r\n    object.each<Record<string, string | number | boolean>>(query, (value, key) => {\r\n      result.push(key + '=' + encodeURIComponent(is.object(value) ? JSON.stringify(value) : value))\r\n    })\r\n  }\r\n  return result.join(separator)\r\n}\r\n\r\n/**\r\n * 解析 url，返回格式遵循 location 属性的命名\r\n * \r\n * @param url 如果不传，使用当前地址\r\n */\r\nexport function parse(url: string) {\r\n\r\n  const key = ['source', 'protocol', 'authority', 'userInfo', 'user', 'password', 'host', 'port', 'relative', 'path', 'directory', 'file', 'query', 'anchor']\r\n  const parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/\r\n\r\n  const result: Partial<any> = {}\r\n  const m = parser.exec(url)\r\n  let i = 14\r\n\r\n  while (i--) {\r\n    result[key[i]] = m[i] ?? ''\r\n  }\r\n  return {\r\n    protocol: result.protocol as string,\r\n    file: result.file as string,\r\n    host: result.host as string,\r\n    port: result.port as string,\r\n    user: result.user as string,\r\n    password: result.password as string,\r\n    origin: `${result.protocol}://${result.authority}`,\r\n    pathname: result.path as string,\r\n    search: `?${result.query}`,\r\n    hash: result.anchor ? `#${result.anchor}` : ''\r\n  }\r\n}\r\n\r\n/**\r\n * 把参数混入一个 url\r\n * \r\n * @param query \r\n * @param url \r\n * @param applyHash \r\n */\r\nexport function mixin(query: Record<string, any>, applyHash: boolean, url?: string): string {\r\n  if (url == null) {\r\n    url = document.URL\r\n  }\r\n\r\n  let scheme = parse(url)\r\n  let params = parseQuery(applyHash ? scheme.hash : scheme.search)\r\n  object.extend(params, query)\r\n  let paramStr = object.param(params)\r\n\r\n  url = scheme.origin + scheme.pathname\r\n\r\n  if (applyHash) {\r\n    url += scheme.search\r\n  }\r\n  else if (paramStr) {\r\n    url += '?' + paramStr\r\n  }\r\n\r\n  if (!applyHash) {\r\n    url += scheme.hash\r\n  }\r\n  else if (paramStr) {\r\n    url += '#' + paramStr\r\n  }\r\n\r\n  return url\r\n}\r\n\r\nconst SLASH_DOT_REGEX = /(?:\\/|^)\\.(?=\\/)/g\r\nconst SLASH_DOT_DOT_REGEX = /(?:\\/|^)\\.\\.\\/(?!\\.\\.\\/)[^\\/]*(?=\\/)/g\r\nconst FIRST_SEGMENT_REGEX = /^(?=([^\\/?#]*))\\1([^]*)$/\r\nconst URL_REGEX = /^(?=((?:[a-zA-Z0-9+\\-.]+:)?))\\1(?=((?:\\/\\/[^\\/?#]*)?))\\2(?=((?:(?:[^?#\\/]*\\/)*[^;?#\\/]*)?))\\3((?:;[^?#]*)?)(\\?[^#]*)?(#[^]*)?$/\r\n\r\nfunction buildURLFromParts(parts: {\r\n  scheme: string\r\n  netLoc: string\r\n  path: string\r\n  params: string\r\n  query: string\r\n  fragment: string\r\n}) {\r\n  return (\r\n    parts.scheme +\r\n    parts.netLoc +\r\n    parts.path +\r\n    parts.params +\r\n    parts.query +\r\n    parts.fragment\r\n  )\r\n}\r\n\r\nfunction parseURL(url: string) {\r\n  const parts = URL_REGEX.exec(url)\r\n  if (!parts) {\r\n    return null\r\n  }\r\n  return {\r\n    scheme: parts[1] || '',\r\n    netLoc: parts[2] || '',\r\n    path: parts[3] || '',\r\n    params: parts[4] || '',\r\n    query: parts[5] || '',\r\n    fragment: parts[6] || ''\r\n  }\r\n}\r\n\r\nexport function normalizePath(path: string) {\r\n  // The following operations are\r\n  // then applied, in order, to the new path:\r\n  // 6a) All occurrences of \"./\", where \".\" is a complete path\r\n  // segment, are removed.\r\n  // 6b) If the path ends with \".\" as a complete path segment,\r\n  // that \".\" is removed.\r\n  path = path.split('').reverse().join('').replace(SLASH_DOT_REGEX, '')\r\n  // 6c) All occurrences of \"<segment>/../\", where <segment> is a\r\n  // complete path segment not equal to \"..\", are removed.\r\n  // Removal of these path segments is performed iteratively,\r\n  // removing the leftmost matching pattern on each iteration,\r\n  // until no matching pattern remains.\r\n  // 6d) If the path ends with \"<segment>/..\", where <segment> is a\r\n  // complete path segment not equal to \"..\", that\r\n  // \"<segment>/..\" is removed.\r\n  while (\r\n    path.length !== (path = path.replace(SLASH_DOT_DOT_REGEX, '')).length\r\n  ) {}\r\n  return path.split('').reverse().join('')\r\n}\r\n\r\n/**\r\n * from https://github.com/tjenkinson/url-toolkit\r\n * \r\n */\r\nexport function buildAbsoluteURL(baseURL: string, relativeURL: string, opts?: {\r\n  alwaysNormalize?: boolean\r\n}) {\r\n  opts = opts || {}\r\n  // remove any remaining space and CRLF\r\n  baseURL = baseURL.trim()\r\n  relativeURL = relativeURL.trim()\r\n  if (!relativeURL) {\r\n    // 2a) If the embedded URL is entirely empty, it inherits the\r\n    // entire base URL (i.e., is set equal to the base URL)\r\n    // and we are done.\r\n    if (!opts.alwaysNormalize) {\r\n      return baseURL\r\n    }\r\n    let basePartsForNormalize = parseURL(baseURL)\r\n    if (!basePartsForNormalize) {\r\n      throw new Error('Error trying to parse base URL.')\r\n    }\r\n    basePartsForNormalize.path = normalizePath(basePartsForNormalize.path)\r\n    return buildURLFromParts(basePartsForNormalize)\r\n  }\r\n  let relativeParts = parseURL(relativeURL)\r\n  if (!relativeParts) {\r\n    throw new Error('Error trying to parse relative URL.')\r\n  }\r\n  if (relativeParts.scheme) {\r\n    // 2b) If the embedded URL starts with a scheme name, it is\r\n    // interpreted as an absolute URL and we are done.\r\n    if (!opts.alwaysNormalize) {\r\n      return relativeURL\r\n    }\r\n    relativeParts.path = normalizePath(relativeParts.path)\r\n    return buildURLFromParts(relativeParts)\r\n  }\r\n  let baseParts = parseURL(baseURL)\r\n  if (!baseParts) {\r\n    throw new Error('Error trying to parse base URL.')\r\n  }\r\n  if (!baseParts.netLoc && baseParts.path && baseParts.path[0] !== '/') {\r\n    // If netLoc missing and path doesn't start with '/', assume everything before the first '/' is the netLoc\r\n    // This causes 'example.com/a' to be handled as '//example.com/a' instead of '/example.com/a'\r\n    let pathParts = FIRST_SEGMENT_REGEX.exec(baseParts.path)\r\n    baseParts.netLoc = pathParts[1]\r\n    baseParts.path = pathParts[2]\r\n  }\r\n  if (baseParts.netLoc && !baseParts.path) {\r\n    baseParts.path = '/'\r\n  }\r\n  const builtParts = {\r\n    // 2c) Otherwise, the embedded URL inherits the scheme of\r\n    // the base URL.\r\n    scheme: baseParts.scheme,\r\n    netLoc: relativeParts.netLoc,\r\n    path: null,\r\n    params: relativeParts.params,\r\n    query: relativeParts.query,\r\n    fragment: relativeParts.fragment,\r\n  }\r\n  if (!relativeParts.netLoc) {\r\n    // 3) If the embedded URL's <net_loc> is non-empty, we skip to\r\n    // Step 7.  Otherwise, the embedded URL inherits the <net_loc>\r\n    // (if any) of the base URL.\r\n    builtParts.netLoc = baseParts.netLoc\r\n    // 4) If the embedded URL path is preceded by a slash \"/\", the\r\n    // path is not relative and we skip to Step 7.\r\n    if (relativeParts.path[0] !== '/') {\r\n      if (!relativeParts.path) {\r\n        // 5) If the embedded URL path is empty (and not preceded by a\r\n        // slash), then the embedded URL inherits the base URL path\r\n        builtParts.path = baseParts.path\r\n        // 5a) if the embedded URL's <params> is non-empty, we skip to\r\n        // step 7; otherwise, it inherits the <params> of the base\r\n        // URL (if any) and\r\n        if (!relativeParts.params) {\r\n          builtParts.params = baseParts.params\r\n          // 5b) if the embedded URL's <query> is non-empty, we skip to\r\n          // step 7; otherwise, it inherits the <query> of the base\r\n          // URL (if any) and we skip to step 7.\r\n          if (!relativeParts.query) {\r\n            builtParts.query = baseParts.query\r\n          }\r\n        }\r\n      }\r\n      else {\r\n        // 6) The last segment of the base URL's path (anything\r\n        // following the rightmost slash \"/\", or the entire path if no\r\n        // slash is present) is removed and the embedded URL's path is\r\n        // appended in its place.\r\n        let baseURLPath = baseParts.path\r\n        let newPath =\r\n          baseURLPath.substring(0, baseURLPath.lastIndexOf('/') + 1) +\r\n          relativeParts.path\r\n        builtParts.path = normalizePath(newPath)\r\n      }\r\n    }\r\n  }\r\n  if (builtParts.path === null) {\r\n    builtParts.path = opts.alwaysNormalize\r\n      ? normalizePath(relativeParts.path)\r\n      : relativeParts.path\r\n  }\r\n  return buildURLFromParts(builtParts)\r\n}\r\n","import BufferReader from '../io/BufferReader'\r\nimport { BytesReaderSync, BytesReader, BytesWriter, BytesWriterSync } from '../io/interface'\r\n\r\nexport const enum SectionId {\r\n  Custom,\r\n  Type,\r\n  Import,\r\n  Function,\r\n  Table,\r\n  Memory,\r\n  Global,\r\n  Export,\r\n  Start,\r\n  Element,\r\n  Code,\r\n  Data\r\n}\r\n\r\nexport const enum ExternalKind {\r\n  Function,\r\n  Table,\r\n  Memory,\r\n  Global\r\n}\r\n\r\nexport function readULeb128(reader: BytesReaderSync) {\r\n  let result = 0\r\n  let shift = 0\r\n  while (true) {\r\n    const byte = reader.readUint8()\r\n\r\n    result |= (byte & 0x7f) << shift\r\n    shift += 7\r\n\r\n    if (!(byte & 0x80)) {\r\n      break\r\n    }\r\n  }\r\n  return result\r\n}\r\n\r\nexport async function readULeb128Async(reader: BytesReader) {\r\n  let result = 0\r\n  let shift = 0\r\n  while (true) {\r\n    const byte = await reader.readUint8()\r\n\r\n    result |= (byte & 0x7f) << shift\r\n    shift += 7\r\n\r\n    if (!(byte & 0x80)) {\r\n      break\r\n    }\r\n  }\r\n  return result\r\n}\r\n\r\nexport function readSLeb128(reader: BytesReaderSync) {\r\n  let result = 0\r\n  let shift = 0\r\n  let byte: number\r\n  while (true) {\r\n    byte = reader.readUint8()\r\n\r\n    result |= (byte & 0x7f) << shift\r\n    shift += 7\r\n\r\n    if (!(byte & 0x80)) {\r\n      break\r\n    }\r\n  }\r\n\r\n  // 符号扩展，将最高有效位的符号位扩展到高位\r\n  if (byte & 0x40) {\r\n    // 如果最高有效位是 1（负数），则将高位全部置为 1\r\n    result |= (~0 << shift)\r\n  }\r\n\r\n  return result\r\n}\r\n\r\nexport async function readSLeb128Async(reader: BytesReader) {\r\n  let result = 0\r\n  let shift = 0\r\n  let byte: number\r\n  while (true) {\r\n    byte = await reader.readUint8()\r\n\r\n    result |= (byte & 0x7f) << shift\r\n    shift += 7\r\n\r\n    if (!(byte & 0x80)) {\r\n      break\r\n    }\r\n  }\r\n\r\n  // 符号扩展，将最高有效位的符号位扩展到高位\r\n  if (byte & 0x40) {\r\n    // 如果最高有效位是 1（负数），则将高位全部置为 1\r\n    result |= (~0 << shift)\r\n  }\r\n\r\n  return result\r\n}\r\n\r\nexport function writeSleb128(writer: BytesWriterSync, value: number) {\r\n  let more = true\r\n  while (more) {\r\n    let byte = value & 0x7f\r\n    value >>= 7\r\n    // 如果还有未编码的位，设置高位为 1\r\n    if ((value === 0 && (byte & 0x40) === 0) || (value === -1 && (byte & 0x40) !== 0)) {\r\n      more = false\r\n    }\r\n    else {\r\n      byte |= 0x80\r\n    }\r\n    writer.writeUint8(byte)\r\n  }\r\n}\r\n\r\nexport async function writeSleb128Async(writer: BytesWriter, value: number) {\r\n  let more = true\r\n  while (more) {\r\n    let byte = value & 0x7f\r\n    value >>= 7\r\n    // 如果还有未编码的位，设置高位为 1\r\n    if ((value === 0 && (byte & 0x40) === 0) || (value === -1 && (byte & 0x40) !== 0)) {\r\n      more = false\r\n    }\r\n    else {\r\n      byte |= 0x80\r\n    }\r\n    await writer.writeUint8(byte)\r\n  }\r\n}\r\n\r\nexport function writeUleb128(writer: BytesWriterSync, value: number) {\r\n  do {\r\n    let byte = value & 0x7f\r\n    value >>= 7\r\n    // 如果还有未编码的位，设置高位为 1\r\n    if (value !== 0) {\r\n      byte |= 0x80\r\n    }\r\n    writer.writeUint8(byte)\r\n  } while (value !== 0)\r\n}\r\n\r\nexport async function writeUleb128Async(writer: BytesWriter, value: number) {\r\n  do {\r\n    let byte = value & 0x7f\r\n    value >>= 7\r\n    // 如果还有未编码的位，设置高位为 1\r\n    if (value !== 0) {\r\n      byte |= 0x80\r\n    }\r\n    await writer.writeUint8(byte)\r\n  } while (value !== 0)\r\n}\r\n\r\nexport function setMemoryShared(wasm: Uint8Array, shared: boolean) {\r\n  const reader = new BufferReader(wasm, true)\r\n\r\n  reader.skip(8)\r\n\r\n  while (reader.remainingSize()) {\r\n    const sectionId = reader.readUint8()\r\n\r\n    const size = readULeb128(reader)\r\n\r\n    if (sectionId === SectionId.Import) {\r\n      let count = readULeb128(reader)\r\n      while (count--) {\r\n        const moduleLen = readULeb128(reader)\r\n        reader.skip(moduleLen)\r\n        const fieldLen = readULeb128(reader)\r\n        reader.skip(fieldLen)\r\n        const externalKind = reader.readUint8()\r\n        switch (externalKind) {\r\n          case ExternalKind.Function: {\r\n            // type index of the function signature\r\n            readULeb128(reader)\r\n            break\r\n          }\r\n          case ExternalKind.Global: {\r\n            // content_type\r\n            readSLeb128(reader)\r\n            // mutability\r\n            readULeb128(reader)\r\n            break\r\n          }\r\n          case ExternalKind.Memory: {\r\n            const pos = Number(reader.getPos())\r\n            if (shared) {\r\n              wasm[pos] = wasm[pos] | 2\r\n            }\r\n            else {\r\n              wasm[pos] = wasm[pos] & ~2\r\n            }\r\n            return\r\n          }\r\n          case ExternalKind.Table: {\r\n            // elem_type\r\n            readSLeb128(reader)\r\n            const flags = readULeb128(reader)\r\n            readULeb128(reader)\r\n\r\n            if (flags & 0x01) {\r\n              // maximum\r\n              readULeb128(reader)\r\n            }\r\n            break\r\n          }\r\n        }\r\n      }\r\n      return\r\n    }\r\n    else {\r\n      reader.skip(size)\r\n    }\r\n  }\r\n}\r\n","/*\r\n * libmedia video scaler\r\n *\r\n * 版权所有 (C) 2024 赵高兴\r\n * Copyright (C) 2024 Gaoxing Zhao\r\n *\r\n * 此文件是 libmedia 的一部分\r\n * This file is part of libmedia.\r\n * \r\n * libmedia 是自由软件；您可以根据 GNU Lesser General Public License（GNU LGPL）3.1\r\n * 或任何其更新的版本条款重新分发或修改它\r\n * libmedia is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU Lesser General Public\r\n * License as published by the Free Software Foundation; either\r\n * version 3.1 of the License, or (at your option) any later version.\r\n * \r\n * libmedia 希望能够为您提供帮助，但不提供任何明示或暗示的担保，包括但不限于适销性或特定用途的保证\r\n * 您应自行承担使用 libmedia 的风险，并且需要遵守 GNU Lesser General Public License 中的条款和条件。\r\n * libmedia is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n * Lesser General Public License for more details.\r\n *\r\n */\r\n\r\nimport { AVPixelFormat } from 'avutil/pixfmt'\r\nimport AVFrame from 'avutil/struct/avframe'\r\nimport { WebAssemblyResource } from 'cheap/webassembly/compiler'\r\nimport WebAssemblyRunner from 'cheap/webassembly/WebAssemblyRunner'\r\nimport * as logger from 'common/util/logger'\r\n\r\nexport const enum ScaleAlgorithm {\r\n  FAST_BILINEAR = 1,\r\n  BILINEAR = 2,\r\n  BICUBIC = 4,\r\n  X = 8,\r\n  POINT = 0x10,\r\n  AREA = 0x20,\r\n  BICUBLIN = 0x40,\r\n  GAUSS = 0x80,\r\n  SINC = 0x100,\r\n  LANCZOS = 0x200,\r\n  SPLINE = 0x400\r\n}\r\n\r\nexport interface ScaleParameters {\r\n  width: int32\r\n  height: int32\r\n  format: AVPixelFormat\r\n}\r\n\r\nexport type VideoScalerOptions = {\r\n  resource: WebAssemblyResource\r\n}\r\n\r\nexport default class VideoScaler {\r\n\r\n  private scaler: WebAssemblyRunner\r\n\r\n  private options: VideoScalerOptions\r\n\r\n  private inputParameters: ScaleParameters\r\n  private outputParameters: ScaleParameters\r\n\r\n  constructor(options: VideoScalerOptions) {\r\n    this.options = options\r\n    this.scaler = new WebAssemblyRunner(this.options.resource)\r\n  }\r\n\r\n  public async open(input: ScaleParameters, output: ScaleParameters, algorithm: ScaleAlgorithm = ScaleAlgorithm.BILINEAR) {\r\n\r\n    this.inputParameters = input\r\n    this.outputParameters = output\r\n\r\n    await this.scaler.run()\r\n\r\n    this.scaler.call(\r\n      'scale_set_input_parameters',\r\n      input.width,\r\n      input.height,\r\n      input.format\r\n    )\r\n    this.scaler.call(\r\n      'scale_set_output_parameters',\r\n      output.width,\r\n      output.height,\r\n      output.format\r\n    )\r\n\r\n    let ret = this.scaler.call<int32>('scale_init', algorithm)\r\n    if (ret < 0) {\r\n      logger.fatal(`open scaler failed, ret: ${ret}`)\r\n    }\r\n  }\r\n\r\n  public scale(src: pointer<AVFrame>, dst: pointer<AVFrame>) {\r\n    return this.scaler.call<int32>('scale_process', src, dst)\r\n  }\r\n\r\n  public close() {\r\n    this.scaler.call('scale_destroy')\r\n    this.scaler.destroy()\r\n    this.scaler = null\r\n  }\r\n\r\n  public getInputScaleParameters() {\r\n    return this.inputParameters\r\n  }\r\n\r\n  public getOutputScaleParameters() {\r\n    return this.outputParameters\r\n  }\r\n}\r\n","module.exports = \"AGFzbQEAAAABKQhgAn9/AGACf34AYAJ/fQBgAn98AGABfwF/YAF/AX5gAX8BfWABfwF8AhIBA2VudgZtZW1vcnkCAwGAgAQDDw4AAAABAgMEBAQEBAUGBweIAQ4Gd3JpdGU4AAAHd3JpdGUxNgABB3dyaXRlMzIAAgd3cml0ZTY0AAMId3JpdGVmMzIABAh3cml0ZWY2NAAFBXJlYWQ4AAYGcmVhZFU4AAcGcmVhZDE2AAgHcmVhZFUxNgAJBnJlYWQzMgAKBnJlYWQ2NAALB3JlYWRmMzIADAdyZWFkZjY0AA0KfQ4JACAAIAE6AAALCQAgACABOwEACwkAIAAgATYCAAsJACAAIAE3AwALCQAgACABOAIACwkAIAAgATkDAAsHACAALAAACwcAIAAtAAALBwAgAC4BAAsHACAALwEACwcAIAAoAgALBwAgACkDAAsHACAAKgIACwcAIAArAwAL\";","module.exports = \"AGFzbQEAAAABLAdgAX8Bf2ABfwF+YAJ/fwF/YAJ/fgF+YAN/f38Bf2ADf35+AX5gA39/fgF/AhIBA2VudgZtZW1vcnkCAwGAgAQDKCcAAAABAgICAwICAgMCAgIDAgICAwICAgMCAgIDAgICAwQEBAUCAgYHhgMnBWxvYWQ4AAAGbG9hZDE2AAEGbG9hZDMyAAIGbG9hZDY0AAMGc3RvcmU4AAQHc3RvcmUxNgAFB3N0b3JlMzIABgdzdG9yZTY0AAcEYWRkOAAIBWFkZDE2AAkFYWRkMzIACgVhZGQ2NAALBHN1YjgADAVzdWIxNgANBXN1YjMyAA4Fc3ViNjQADwRhbmQ4ABAFYW5kMTYAEQVhbmQzMgASBWFuZDY0ABMDb3I4ABQEb3IxNgAVBG9yMzIAFgRvcjY0ABcEeG9yOAAYBXhvcjE2ABkFeG9yMzIAGgV4b3I2NAAbCWV4Y2hhbmdlOAAcCmV4Y2hhbmdlMTYAHQpleGNoYW5nZTMyAB4KZXhjaGFuZ2U2NAAfEWNvbXBhcmVfZXhjaGFuZ2U4ACASY29tcGFyZV9leGNoYW5nZTE2ACESY29tcGFyZV9leGNoYW5nZTMyACISY29tcGFyZV9leGNoYW5nZTY0ACMGbm90aWZ5ACQEd2FpdAAlC3dhaXRUaW1lb3V0ACYKugMnCAAgAP4SAAALCAAgAP4TAQALCAAgAP4QAgALCAAgAP4RAwALDAAgACAB/hkAACABCwwAIAAgAf4aAQAgAQsMACAAIAH+FwIAIAELDAAgACAB/hgDACABCwoAIAAgAf4gAAALCgAgACAB/iEBAAsKACAAIAH+HgIACwoAIAAgAf4fAwALCgAgACAB/icAAAsKACAAIAH+KAEACwoAIAAgAf4lAgALCgAgACAB/iYDAAsKACAAIAH+LgAACwoAIAAgAf4vAQALCgAgACAB/iwCAAsKACAAIAH+LQMACwoAIAAgAf41AAALCgAgACAB/jYBAAsKACAAIAH+MwIACwoAIAAgAf40AwALCgAgACAB/jwAAAsKACAAIAH+PQEACwoAIAAgAf46AgALCgAgACAB/jsDAAsKACAAIAH+QwAACwoAIAAgAf5EAQALCgAgACAB/kECAAsKACAAIAH+QgMACwwAIAAgASAC/koAAAsMACAAIAEgAv5LAQALDAAgACABIAL+SAIACwwAIAAgASAC/kkDAAsKACAAIAH+AAIACwwAIAAgAUJ//gECAAsMACAAIAEgAv4BAgAL\";","module.exports = \"AGFzbQEAAAABEANgAX8Bf2ABfwBgAn9/AX8CWQYDZW52Bm1lbW9yeQIDAYCABANlbnYGbWFsbG9jAAADZW52BGZyZWUAAQNlbnYGY2FsbG9jAAIDZW52B3JlYWxsb2MAAgNlbnYNYWxpZ25lZF9hbGxvYwACAwYFAAECAgIHMwUGbWFsbG9jAAUEZnJlZQAGBmNhbGxvYwAHB3JlYWxsb2MACAxhbGlnbmVkQWxsb2MACQoqBQYAIAAQAAsGACAAEAELCAAgACABEAILCAAgACABEAMLCAAgACABEAML\";","module.exports = \"AGFzbQEAAAABEwNgAX8Bf2ACf38Bf2ADf39/AX8CEgEDZW52Bm1lbW9yeQIDAYCABAMIBwAAAAECAAAHQwcEbG9jawAAB3RyeWxvY2sAAQZ1bmxvY2sAAgR3YWl0AAMJdGltZWR3YWl0AAQGc2lnbmFsAAUJYnJvYWRjYXN0AAYKjgIHVgEBfyAAQQBBAf5IAgAhASABQQBHBEADQCABQQJGBH9BAQUgAEEBQQL+SAIAQQBHCwRAIABBAkJ//gECABoLIABBAEEC/kgCACEBIAFBAEcNAAsLQQALFwAgAEEAQQH+SAIAQQBGBH9BAAVBEAsLIwAgAEEB/iUCAEEBRwRAIABBAP4XAgAgAEEB/gACABoLQQALHQAgACAA/hACACABEAIaQn/+AQIAGiABEAAaQQALKQAgACAA/hACACABEAIaIAIpAwD+AQIAIAEQABpBAkYEf0HwAAVBAAsLFgAgAEEB/h4CABogAEEB/gACABpBAAsaACAAQQH+HgIAGiAAQYCAgIAE/gACABpBAAs=\";","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".avtranscoder.js\";\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","var inProgress = {};\nvar dataWebpackPrefix = \"AVTranscoder:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = (url, done, key, chunkId) => {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\n\t\tscript.src = url;\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = (prev, event) => {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach((fn) => (fn(event)));\n\t\tif(prev) return prev(event);\n\t}\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t\"main\": 0\n};\n\n__webpack_require__.f.j = (chunkId, promises) => {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise((resolve, reject) => (installedChunkData = installedChunks[chunkId] = [resolve, reject]));\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = (event) => {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkAVTranscoder\"] = self[\"webpackChunkAVTranscoder\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","","// module factories are used so entry inlining is disabled\n// startup\n// Load entry module and return exports\nvar __webpack_exports__ = __webpack_require__(\"./src/avtranscoder/AVTranscoder.ts\");\n",""],"names":[],"sourceRoot":""}
"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[369],{58469:(e,t,i)=>{i.d(t,{En:()=>o,Hm:()=>n,Ij:()=>f,XC:()=>l,_5:()=>h,hY:()=>s,uF:()=>a});var r=i(77231);const a={1:"Main",2:"LC",3:"LC",4:"LC",5:"HE",6:"HE"},n={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,r.N_,r.N_,r.N_],o=[r.N_,1,2,3,4,5,6,7];function h(e){let t=r.N_,i=r.N_,a=r.N_;var n,h;return e.length>=2&&(t=e[0]>>3&31,i=null!==(n=s[(7&e[0])<<1|e[1]>>7])&&void 0!==n?n:48e3,a=null!==(h=o[e[1]>>3&15])&&void 0!==h?h:2),{profile:t,sampleRate:i,channels:a}}function l(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t){const{profile:i,sampleRate:r,channels:a}=h(t);e.codecpar.profile=i,e.codecpar.sampleRate=r,e.codecpar.chLayout.nbChannels=a}}function f(e){const t=n[e.sampleRate],i=e.chLayout.nbChannels,r=new Uint8Array(2);return r[0]=(31&e.profile)<<3|(14&t)>>1,r[1]=(1&t)<<7|(15&i)<<3,r}},90412:(e,t,i)=>{i.d(t,{Ui:()=>u,XC:()=>c,Yj:()=>p,k9:()=>d,zk:()=>h});var r=i(63939),a=i(37246),n=i(11573),s=i(83314),o=i(97317);const h={0:"Main",1:"High",2:"Professional"},l=[{level:20,maxResolution:2359296},{level:21,maxResolution:4460544},{level:30,maxResolution:10653696},{level:31,maxResolution:17040384},{level:40,maxResolution:21233664},{level:41,maxResolution:21233664},{level:50,maxResolution:35651584},{level:51,maxResolution:35651584},{level:52,maxResolution:35651584},{level:53,maxResolution:35651584},{level:60,maxResolution:142606336},{level:61,maxResolution:142606336},{level:62,maxResolution:142606336},{level:63,maxResolution:142606336}],f=[20,21,22,23,30,31,32,33,40,41,42,43,50,51,52,53,60,61,62,63,70,71,72,73];function d(e,t,i){const r=e*t;for(const e of l)if(r<=e.maxResolution)return e.level}function c(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=4){const i=u(t);e.codecpar.profile=i.profile,e.codecpar.level=i.level}}function u(e){const t=new a.A(e.length);t.appendBuffer(e),t.readU1(),t.readU(7);const i=t.readU(3),r=t.readU(5),n=t.readU1();let s=t.readU1()?10:8;return t.readU1()&&(s=12),{profile:i,level:r,tier:n,bitDepth:s,monochrome:t.readU1(),chromaSubsamplingX:t.readU1(),chromaSubsamplingY:t.readU1(),chromaSamplePosition:t.readU(2)}}function p(e,t){const i=new s.A(4);i.writeU1(1),i.writeU(7,1);const h=function(e){const t=new a.A;t.appendBuffer(e);const i=[];for(;t.remainingLength();){const r=t.getPos();t.readU1(),t.readU(4);const a=t.readU1(),s=t.readU1();t.readU1(),a&&t.readU(8);const o=s?n.v(t):e.length-1-a,h=t.getPos()-r;i.push(e.subarray(r,r+h+o)),t.skip(8*o)}return i}(t).find((e=>1==(e[0]>>>3&15)));if(h){const e=function(e){const t=new a.A(e.length);t.appendBuffer(e),t.readU1(),t.readU(4);const i=t.readU1(),r=t.readU1();t.readU1(),i&&t.readU(8),r&&n.v(t);const s=n.f(t,3),o=(n.f(t,1),n.f(t,1));let h=0,l=0,d=[0],c=[0],u=[0],p=[0],g=[0],w=[0],U=0,m=[0],b=[0],x=[0];if(o)c[0]=n.f(t,5);else{h=n.f(t,1),h?(n.f(t,32),n.f(t,32),n.f(t,1)&&n.d(t),n.f(t,1)&&(U=n.f(t,5),n.f(t,32),n.f(t,5),n.f(t,5))):l=0;let e=n.f(t,1),i=n.f(t,5);for(let r=0;r<=i;r++){if(d[r]=n.f(t,12),c[r]=n.f(t,5),c[r]>7?u[r]=n.f(t,1):u[r]=0,l){if(p[r]=n.f(t,1),p[r]){let e=U+1;m[r]=n.f(t,e),b[r]=n.f(t,e),x[r]=n.f(t,1)}}else p[r]=0;e&&(g[r]=n.f(t,1),g[r]&&(w[r]=n.f(t,4)))}}let R=n.f(t,4),v=n.f(t,4),_=R+1,B=n.f(t,_);_=v+1;let I=n.f(t,_),y=0,k=0,P=0;y=o?0:n.f(t,1),y&&(n.f(t,4),n.f(t,3)),n.f(t,1),n.f(t,1),n.f(t,1);let A=0,S=0,M=0,L=0,z=0,F=0,D=2,E=2,C=0;o||(n.f(t,1),n.f(t,1),n.f(t,1),n.f(t,1),L=n.f(t,1),L?(z=n.f(t,1),F=n.f(t,1)):(z=0,F=0),D=n.f(t,1)?2:n.f(t,1),D>0?n.f(t,1)?2:n.f(t,1):2,L&&n.f(t,3)),n.f(t,1),n.f(t,1),n.f(t,1);let V=n.f(t,1),O=0,N=0,T=0;2==s&&V?(O=n.f(t,1),N=O?12:10):s<=2&&(N=V?10:8),T=1==s?0:n.f(t,1);let Y=0,W=0,$=0;n.f(t,1)?(Y=n.f(t,8),W=n.f(t,8),$=n.f(t,8)):(Y=2,W=2,$=2);let X=0,H=0,J=0,j=0,Z=0;return T?(X=n.f(t,1),H=1,J=1,j=0,Z=0):1==Y&&13==W&&0==$?(X=1,H=0,J=0,Z=n.f(t,1)):(X=n.f(t,1),0==s?(H=1,J=1):1==s?(H=0,J=0):12==N?(H=n.f(t,1),J=H?n.f(t,1):0):(H=1,J=0),H&&J&&(j=n.f(t,2)),Z=n.f(t,1)),n.f(t,1),{width:B+1,height:I+1,profile:s,level:f[c[0]],tier:u[0],bitDepth:N,monoChrome:T,colorRange:X,colorPrimaries:Y,transferCharacteristics:W,matrixCoefficients:$,subsamplingX:H,subsamplingY:J,chromaSamplePosition:j}}(h);i.writeU(3,e.profile),i.writeU(5,e.level),i.writeU(1,e.tier),i.writeU(1,e.bitDepth>8?1:0),i.writeU(1,12===e.bitDepth?1:0),i.writeU(1,e.monoChrome),i.writeU(1,e.subsamplingX),i.writeU(1,e.subsamplingY),i.writeU(1,e.chromaSamplePosition)}else{const t=o.g[r.f[15](e+28)];i.writeU(3,r.f[15](e+48)),i.writeU(5,r.f[15](e+52)),i.writeU(1,0),i.writeU(1,t.comp[0].depth>8?1:0),i.writeU(1,12===t.comp[0].depth?1:0),i.writeU(1,0),i.writeU(1,1),i.writeU(1,1),i.writeU(1,0)}return i.writeU(8,0),i.getBuffer()}},20620:(e,t,i)=>{i.d(t,{Jk:()=>I,MB:()=>x,OD:()=>B,S1:()=>v,XC:()=>k,ci:()=>y,k9:()=>b,oT:()=>_,tZ:()=>U,wf:()=>P});var r=i(63939),a=i(50932),n=i(72739),s=i(729),o=i(31865),h=i(37246),l=i(4624),f=i(14686),d=i(71517),c=i(60264),u=i(37837),p=i(23991),g="src/avformat/codecs/h264.ts";const w=3,U={66:"Constrained Baseline",77:"Main",100:"High",110:"High10",122:"High422",244:"High444"},m=[{level:10,maxResolution:25344,maxFrameRate:15},{level:11,maxResolution:25344,maxFrameRate:30},{level:12,maxResolution:101376,maxFrameRate:30},{level:13,maxResolution:101376,maxFrameRate:30},{level:20,maxResolution:101376,maxFrameRate:30},{level:21,maxResolution:202752,maxFrameRate:30},{level:22,maxResolution:414720,maxFrameRate:30},{level:30,maxResolution:414720,maxFrameRate:30},{level:31,maxResolution:921600,maxFrameRate:30},{level:32,maxResolution:1310720,maxFrameRate:60},{level:40,maxResolution:2097152,maxFrameRate:30},{level:41,maxResolution:2097152,maxFrameRate:60},{level:42,maxResolution:2228224,maxFrameRate:60},{level:50,maxResolution:8912896,maxFrameRate:30},{level:51,maxResolution:8912896,maxFrameRate:60},{level:52,maxResolution:8912896,maxFrameRate:120},{level:60,maxResolution:35651584,maxFrameRate:30},{level:61,maxResolution:35651584,maxFrameRate:60},{level:62,maxResolution:35651584,maxFrameRate:120}];function b(e,t,i){const r=e*t;for(const e of m)if(r<=e.maxResolution&&i<=e.maxFrameRate)return e.level}function x(e){const t=new o.A(e);t.skip(5);const i=[],r=[],a=[],n=31&t.readUint8();for(let e=0;e<n;e++){const e=t.readUint16();i.push(t.readBuffer(e))}const s=t.readUint8();for(let e=0;e<s;e++){const e=t.readUint16();r.push(t.readBuffer(e))}if(t.remainingSize()>4){t.skip(3);const e=t.readUint8();if(e>0)for(let i=0;i<e;i++){const e=t.readUint16();a.push(t.readBuffer(e))}}return{spss:i,ppss:r,spsExts:a}}function R(e,t,i=[]){e.length>32&&(l.R8(`h264 metadata's sps max length is 32, but get ${e.length}`,g,210),e=e.slice(0,32)),e.length>256&&(l.R8(`h264 metadata's pps max length is 256, but get ${e.length}`,g,214),e=e.slice(0,256));let r=7;r=e.reduce(((e,t)=>e+2+t.length),r),r=t.reduce(((e,t)=>e+2+t.length),r);const a=e[0],o=P(a);66!==o.profile&&77!==o.profile&&88!==o.profile&&(r+=4,i.length&&(r=i.reduce(((e,t)=>e+2+t.length),r)));const h=new Uint8Array(r),f=new s.A(h);return f.writeUint8(1),f.writeUint8(a[1]),f.writeUint8(a[2]),f.writeUint8(a[3]),f.writeUint8(252|w),f.writeUint8(224|31&e.length),n.__(e,(e=>{f.writeUint16(e.length),f.writeBuffer(e)})),f.writeUint8(t.length),n.__(t,(e=>{f.writeUint16(e.length),f.writeBuffer(e)})),66!==o.profile&&77!==o.profile&&88!==o.profile&&(f.writeUint8(252|o.chromaFormatIdc),f.writeUint8(248|o.bitDepthLumaMinus8),f.writeUint8(248|o.bitDepthChromaMinus8),i.length&&n.__(i,(e=>{f.writeUint16(e.length),f.writeBuffer(e)}))),h}function v(e){let t=(0,c.py)(e);if(t.length>1){const e=[],i=[],r=[];if(t.forEach((t=>{const a=31&t[0];7===a?e.push(t):8===a?i.push(t):13===a&&r.push(t)})),e.length&&i.length)return R(e,i,r)}}function _(e){let t,i=(0,c.py)(e),r=!1;if(i.length>1){const e=[],r=[],a=[];i.forEach((t=>{const i=31&t[0];7===i?e.push(t):8===i?r.push(t):13===i&&a.push(t)})),e.length&&r.length&&(t=R(e,r,a)),i=i.filter((e=>{const t=31&e[0];return 9!==t&&8!==t&&7!==t&&13!==t}))}const a=i.reduce(((e,t)=>e+w+1+t.length),0),o=(0,u.sY)(a),h=(0,f.s3)(o,a),l=new s.A(h);return n.__(i,(e=>{3===w?l.writeUint32(e.length):2===w?l.writeUint24(e.length):1===w?l.writeUint16(e.length):l.writeUint8(e.length),l.writeBuffer(e.subarray(0)),5==(31&e[0])&&(r=!0)})),{bufferPointer:o,length:a,key:r,extradata:t}}function B(e,t){const i=t?3&t[4]:w;let r=[],a=[],h=[],l=!1;if(t){const e=x(t);r=e.spss,a=e.ppss,h=e.spsExts,l=!0}const d=[],c=[],p=new o.A(e);for(;p.remainingSize()>0;){let t=0;t=3===i?p.readUint32():2===i?p.readUint24():1===i?p.readUint16():p.readUint8();const r=e.subarray(0|Number(0xffffffffn&p.getPos()),(0|Number(0xffffffffn&p.getPos()))+t);p.skip(t);const a=31&r[0];6===a?c.push(r):9!==a&&d.push(r)}let g=r.reduce(((e,t)=>e+4+t.length),0);g=a.reduce(((e,t)=>e+4+t.length),g),g=h.reduce(((e,t)=>e+4+t.length),g),g=c.reduce(((e,t)=>e+4+t.length),g),g=d.reduce(((e,t,i)=>e+(i?3:4)+t.length),g);const U=(0,u.sY)(g+6),m=new s.A((0,f.s3)(U,g+6));return m.writeUint8(0),m.writeUint8(0),m.writeUint8(0),m.writeUint8(1),m.writeUint8(9),m.writeUint8(240),n.__(c,(e=>{m.writeUint8(0),m.writeUint8(0),m.writeUint8(0),m.writeUint8(1),m.writeBuffer(e)})),n.__(r,(e=>{m.writeUint8(0),m.writeUint8(0),m.writeUint8(0),m.writeUint8(1),m.writeBuffer(e)})),n.__(a,(e=>{m.writeUint8(0),m.writeUint8(0),m.writeUint8(0),m.writeUint8(1),m.writeBuffer(e)})),n.__(h,(e=>{m.writeUint8(0),m.writeUint8(0),m.writeUint8(0),m.writeUint8(1),m.writeBuffer(e)})),n.__(d,((e,t)=>{m.writeUint8(0),m.writeUint8(0),t||m.writeUint8(0),m.writeUint8(1),m.writeBuffer(e),5==(31&e[0])&&(l=!0)})),{bufferPointer:U,length:g+6,key:l}}function I(e,t){var i;if(!(1&r.f[15](e+36)))return;const a=(0,d.iI)(e);if((0,c.Bs)(a))return;const n=null!==(i=t.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:w;let s=[],h=[],l=[],p=[];const g=new o.A(a);for(;g.remainingSize()>0;){let e=0;e=3===n?g.readUint32():2===n?g.readUint24():1===n?g.readUint16():g.readUint8();const t=a.subarray(0|Number(0xffffffffn&g.getPos()),(0|Number(0xffffffffn&g.getPos()))+e);g.skip(e);const i=31&t[0];7===i?s.push(t):8===i?h.push(t):13===i?l.push(t):p.push(t)}if(s.length||h.length){const t=R(s,h,l),i=(0,u.sY)(t.length);(0,f.lW)(i,t.length,t),(0,d.Ow)(e,1,i,t.length)}}function y(e,t=!1){if(!(1&r.f[15](e+36)||t))return;const i=(0,d.iI)(e);if(!(0,c.Bs)(i))return;let n=(0,c.py)(i);if(n.length>1){const t=[],i=[],s=[];if(n.forEach((e=>{const r=31&e[0];7===r?t.push(e):8===r?i.push(e):13===r&&s.push(e)})),t.length&&i.length){const n=R(t,i,s),o=(0,u.sY)(n.length);(0,f.lW)(o,n.length,n),(0,d.Ow)(e,1,o,n.length),a.M[15](e+36,1|r.f[15](e+36))}}}function k(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){e.metadata.naluLengthSizeMinusOne=3&t[4];const{spss:i}=x(t);if(i.length){const{profile:t,level:r,width:a,height:n}=P(i[0]);e.codecpar.profile=t,e.codecpar.level=r,e.codecpar.width=a,e.codecpar.height=n}}}function P(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);const i=(0,c.BN)(e.subarray(t)),r=new h.A(i.length);r.appendBuffer(i),r.readU1(),r.readU(2),r.readU(5);const a=r.readU(8);r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU(2);const n=r.readU(8);p.xb(r);let s=1,o=0,l=0;if((100==a||110==a||122==a||244==a||44==a||83==a||86==a||118==a||128==a||138==a||139==a||134==a||135==a)&&(s=p.xb(r),3===s&&r.readU1(),o=p.xb(r),l=p.xb(r),r.readU1(),r.readU1())){const e=new Array(8);for(let t=0;t<(3!=s?8:12);t++)e[t]=r.readU1()}const f=p.xb(r),d=p.xb(r);let u=0,g=0;if(0===d)u=p.xb(r);else if(1===d){g=r.readU1(),p.$x(r),p.$x(r);const e=p.xb(r);for(let t=0;t<e;t++)p.$x(r)}p.xb(r),r.readU1();const w=p.xb(r),U=p.xb(r),m=r.readU1();let b=16*(w+1),x=(2-m)*(U+1)*16;m||r.readU1(),r.readU1();const R=r.readU1();if(R){let e=1,t=2-R;1===s?(e=2,t=2*(2-R)):2===R&&(e=2,t=2-R),b-=e*(p.xb(r)+p.xb(r)),x-=t*(p.xb(r)+p.xb(r))}return{profile:a,level:n,width:b,height:x,chromaFormatIdc:s,bitDepthLumaMinus8:o,bitDepthChromaMinus8:l,frameMbsOnlyFlag:m,picOrderCntType:d,log2MaxPicOrderCntLsbMinus4:u,deltaPicOrderAlwaysZeroFlag:g,log2MaxFrameNumMinus4:f}}},53e3:(e,t,i)=>{i.d(t,{HL:()=>m,Jk:()=>_,OD:()=>v,S1:()=>x,XC:()=>I,ZU:()=>k,ci:()=>B,dT:()=>p,k9:()=>w,oT:()=>R,wf:()=>y});var r=i(63939),a=i(50932),n=i(72739),s=i(729),o=i(31865),h=i(37246),l=i(14686),f=i(60264),d=i(71517),c=i(37837),u=i(23991);const p={1:"Main",2:"Main10",3:"MainStillPicture",4:"Main444"},g=[{level:10,maxLumaSamplesPerSecond:552960,maxLumaPictureSize:36864,maxBitRate:{main:128,main10:150}},{level:20,maxLumaSamplesPerSecond:3686400,maxLumaPictureSize:122880,maxBitRate:{main:1500,main10:1875}},{level:21,maxLumaSamplesPerSecond:7372800,maxLumaPictureSize:245760,maxBitRate:{main:3e3,main10:3750}},{level:30,maxLumaSamplesPerSecond:16588800,maxLumaPictureSize:552960,maxBitRate:{main:6e3,main10:7500}},{level:31,maxLumaSamplesPerSecond:33177600,maxLumaPictureSize:983040,maxBitRate:{main:1e4,main10:12500}},{level:40,maxLumaSamplesPerSecond:66846720,maxLumaPictureSize:2228224,maxBitRate:{main:12e3,main10:15e3}},{level:41,maxLumaSamplesPerSecond:133693440,maxLumaPictureSize:2228224,maxBitRate:{main:2e4,main10:25e3}},{level:50,maxLumaSamplesPerSecond:267386880,maxLumaPictureSize:8912896,maxBitRate:{main:25e3,main10:4e4}},{level:51,maxLumaSamplesPerSecond:534773760,maxLumaPictureSize:8912896,maxBitRate:{main:4e4,main10:6e4}},{level:52,maxLumaSamplesPerSecond:1069547520,maxLumaPictureSize:35651584,maxBitRate:{main:6e4,main10:1e5}},{level:60,maxLumaSamplesPerSecond:1069547520,maxLumaPictureSize:35651584,maxBitRate:{main:6e4,main10:1e5}},{level:61,maxLumaSamplesPerSecond:2139095040,maxLumaPictureSize:89128960,maxBitRate:{main:12e4,main10:24e4}},{level:62,maxLumaSamplesPerSecond:4278190080,maxLumaPictureSize:356515840,maxBitRate:{main:24e4,main10:48e4}}];function w(e,t,i,r,a){a/=1e3;const n=1===e?"main":"main10",s=t*i*r;for(const e of g)if(s<=e.maxLumaSamplesPerSecond&&t*i<=e.maxLumaPictureSize&&a<=e.maxBitRate[n])return e.level}const U=3;function m(e){const t=new o.A(e,!0);t.skip(22);let i=[],r=[],a=[];const n=t.readUint8();for(let e=0;e<n;e++){const e=63&t.readUint8(),n=t.readUint16(),s=[];for(let e=0;e<n;e++){const e=t.readUint16();s.push(t.readBuffer(e))}32===e?i=s:33===e?r=s:34===e&&(a=s)}return{vpss:i,spss:r,ppss:a}}function b(e,t,i){const r=t[0];let a=23;e.length&&(a+=3,a=e.reduce(((e,t)=>e+2+t.length),a)),t.length&&(a+=3,a=t.reduce(((e,t)=>e+2+t.length),a)),i.length&&(a+=3,a=i.reduce(((e,t)=>e+2+t.length),a));const o=new Uint8Array(a),h=new s.A(o,!0),l=y(r);h.writeUint8(1),h.writeUint8(r[1]),h.writeUint8(r[2]),h.writeUint8(r[3]),h.writeUint8(r[4]),h.writeUint8(r[5]),h.writeUint8(r[6]),h.writeUint8(r[7]),h.writeUint8(r[8]),h.writeUint8(r[9]),h.writeUint8(r[10]),h.writeUint8(r[11]),h.writeUint8(l.level),h.writeUint8(1020),h.writeUint8(0),h.writeUint8(16320),h.writeUint8(16320|l.chroma_format_idc),h.writeUint8(8160|l.bit_depth_luma_minus8),h.writeUint8(8160|l.bit_depth_chroma_minus8),h.writeUint16(0),h.writeUint8(8|(1&r[0])<<2|U);let f=0;return e.length&&f++,t.length&&f++,i.length&&f++,h.writeUint8(f),e.length&&(h.writeUint8(160),h.writeUint16(e.length),n.__(e,(e=>{h.writeUint16(e.length),h.writeBuffer(e)}))),t.length&&(h.writeUint8(161),h.writeUint16(t.length),n.__(t,(e=>{h.writeUint16(e.length),h.writeBuffer(e)}))),i.length&&(h.writeUint8(162),h.writeUint16(i.length),n.__(i,(e=>{h.writeUint16(e.length),h.writeBuffer(e)}))),o}function x(e){let t=(0,f.py)(e);if(t.length>=2){const e=[],i=[],r=[];if(t.forEach((t=>{const a=t[0]>>>1&63;32===a?e.push(t):33===a?i.push(t):34===a&&r.push(t)})),i.length&&r.length)return b(e,i,r)}}function R(e){let t,i=!1,r=(0,f.py)(e);if(r.length>=2){const e=[],i=[],a=[];r.forEach((t=>{const r=t[0]>>>1&63;32===r?e.push(t):33===r?i.push(t):34===r&&a.push(t)})),i.length&&a.length&&(t=b(e,i,a),r=r.filter((e=>{const t=e[0]>>>1&63;return 32!==t&&33!==t&&34!==t&&35!==t})))}const a=r.reduce(((e,t)=>e+U+1+t.length),0),o=(0,c.sY)(a),h=(0,l.s3)(o,a),d=new s.A(h);return n.__(r,(e=>{3===U?d.writeUint32(e.length):2===U?d.writeUint24(e.length):1===U?d.writeUint16(e.length):d.writeUint8(e.length),d.writeBuffer(e.subarray(0));const t=e[0]>>>1&63;19!==t&&20!==t&&21!==t||(i=!0)})),{bufferPointer:o,length:a,extradata:t,key:i}}function v(e,t){const i=t?3&t[21]:U;let r=[],a=[],h=[],f=!1;if(t){const e=m(t);r=e.vpss,a=e.spss,h=e.ppss,f=!0}const d=[],u=new o.A(e);for(;u.remainingSize()>0;){let e=0;e=3===i?u.readUint32():2===i?u.readUint24():1===i?u.readUint16():u.readUint8(),d.push(u.readBuffer(e))}let p=r.reduce(((e,t)=>e+4+t.length),0);p=a.reduce(((e,t)=>e+4+t.length),p),p=h.reduce(((e,t)=>e+4+t.length),p),p=d.reduce(((e,t,i)=>e+(i?3:4)+t.length),p);const g=(0,c.sY)(p+7),w=(0,l.s3)(g,p+7),b=new s.A(w);return b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeUint8(70),b.writeUint8(0),b.writeUint8(240),n.__(r,(e=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(e)})),n.__(a,(e=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(e)})),n.__(h,(e=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(e)})),n.__(d,((e,t)=>{b.writeUint8(0),b.writeUint8(0),t||b.writeUint8(0),b.writeUint8(1),b.writeBuffer(e);const i=e[0]>>>1&63;19!==i&&20!==i&&21!==i||(f=!0)})),{bufferPointer:g,length:p+7,key:f}}function _(e,t){var i;if(!(1&r.f[15](e+36)))return;const a=(0,d.iI)(e);if((0,f.Bs)(a))return;const n=null!==(i=t.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:U;let s=[],h=[],u=[];const p=new o.A(a);for(;p.remainingSize()>0;){let e=0;e=3===n?p.readUint32():2===n?p.readUint24():1===n?p.readUint16():p.readUint8();const t=a.subarray(0|Number(0xffffffffn&p.getPos()),(0|Number(0xffffffffn&p.getPos()))+e);p.skip(e);const i=t[0]>>>1&63;33===i?h.push(t):34===i?u.push(t):32===i&&s.push(t)}if(h.length||u.length||s.length){const t=b(s,h,u),i=(0,c.sY)(t.length);(0,l.lW)(i,t.length,t),(0,d.Ow)(e,1,i,t.length)}}function B(e,t=!1){if(!(1&r.f[15](e+36)||t))return;const i=(0,d.iI)(e);if(!(0,f.Bs)(i))return;let n=(0,f.py)(i);if(n.length>2){const t=[],i=[],s=[];if(n.forEach((e=>{const r=e[0]>>>1&63;32===r?t.push(e):33===r?i.push(e):34===r&&s.push(e)})),t.length&&i.length&&s.length){const n=b(t,i,s),o=(0,c.sY)(n.length);(0,l.lW)(o,n.length,n),(0,d.Ow)(e,1,o,n.length),a.M[15](e+36,1|r.f[15](e+36))}}}function I(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){e.metadata.naluLengthSizeMinusOne=3&t[21];const{spss:i}=m(t);if(i.length){const{profile:t,level:r,width:a,height:n}=y(i[0]);e.codecpar.profile=t,e.codecpar.level=r,e.codecpar.width=a,e.codecpar.height=n}}}function y(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);let i=0,r=0,a=0,n=0,s=0,o=0,l=1,d=0,c=0,p=0,g=0;const w=(0,f.BN)(e.subarray(t)),U=new h.A(w.length);U.appendBuffer(w),U.readU1(),U.readU(6),U.readU(6),U.readU(3),U.readU(4);const m=U.readU(3);U.readU1();let b=0;if(m<=6){d=U.readU(2),c=U.readU1(),i=U.readU(5),p=U.readU(32),g=U.readU(48),r=U.readU(8);const e=new Array(6),t=new Array(6);for(let i=0;i<m;i++)e[i]=U.readU1(),t[i]=U.readU1();if(m>0)for(let e=m;e<8;e++)U.readU(2);for(let i=0;i<m;i++)e[i]&&(U.readU(2),U.readU(1),U.readU(5),U.readU(32),U.readU(1),U.readU(1),U.readU(1),U.readU(1),U.readU(44)),t[i]&&U.readU(8);u.xb(U),l=u.xb(U),3===l&&(b=U.readU(1)),a=u.xb(U),n=u.xb(U);let h=0,f=0,w=0,x=0;U.readU1()&&(h=u.xb(U),f=u.xb(U),w=u.xb(U),x=u.xb(U)),s=u.xb(U),o=u.xb(U);let R=2,v=2;0===l?R=v=0:2===l?(R=2,v=1):3===l&&(R=v=1),a-=R*(1<<s+1)*(h+f),n-=v*(1<<s+1)*(w+x)}const x=u.xb(U)+4;for(let e=U.readU1()?0:m;e<m+1;e++)u.xb(U),u.xb(U),u.xb(U);const R=u.xb(U)+3,v=u.xb(U),_=u.xb(U)+2,B=u.xb(U),I=R+v,y=R-1,k=a+(1<<I)-1>>I,P=n+(1<<I)-1>>I;return{profile:i,level:r,width:a,height:n,chroma_format_idc:l,bit_depth_luma_minus8:s,bit_depth_chroma_minus8:o,general_profile_space:d,general_tier_flag:c,general_profile_compatibility_flags:p,constraint_flags:g,separate_colour_plane_flag:b,log2_min_cb_size:R,log2_diff_max_min_coding_block_size:v,log2_min_tb_size:_,log2_diff_max_min_transform_block_size:B,log2_max_trafo_size:B+_,log2_ctb_size:I,log2_min_pu_size:y,ctb_width:k,ctb_height:P,ctb_size:k*P,min_cb_width:a>>R,min_cb_height:n>>R,min_tb_width:a>>_,min_tb_height:n>>_,min_pu_width:a>>y,min_pu_height:n>>y,log2_max_poc_lsb:x}}function k(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);const i=(0,f.BN)(e.subarray(t)),r=new h.A(i.length);return r.appendBuffer(i),{pps_pic_parameter_set_id:u.xb(r),pps_seq_parameter_set_id:u.xb(r),dependent_slice_segment_flag:r.readU1(),output_flag_present_flag:r.readU1(),num_extra_slice_header_bits:r.readU(3)}}},58919:(e,t,i)=>{i.d(t,{Ui:()=>g,XC:()=>p,Yj:()=>w,k9:()=>u,wN:()=>d});var r=i(63939),a=i(9599),n=i(29170),s=i(37246),o=i(77231),h=i(97317),l=i(44328),f=i(729);const d={0:"Profile0",1:"Profile1",2:"Profile2",3:"Profile3"},c=[{level:10,maxResolution:196608,maxFrameRate:30},{level:11,maxResolution:196608,maxFrameRate:60},{level:20,maxResolution:518400,maxFrameRate:30},{level:21,maxResolution:518400,maxFrameRate:60},{level:30,maxResolution:2073600,maxFrameRate:30},{level:31,maxResolution:2073600,maxFrameRate:60},{level:40,maxResolution:3686400,maxFrameRate:30},{level:41,maxResolution:3686400,maxFrameRate:60},{level:50,maxResolution:8294400,maxFrameRate:30},{level:51,maxResolution:8294400,maxFrameRate:60},{level:60,maxResolution:8847360,maxFrameRate:30},{level:61,maxResolution:8847360,maxFrameRate:60},{level:70,maxResolution:35389440,maxFrameRate:30},{level:71,maxResolution:35389440,maxFrameRate:60}];function u(e,t,i){const r=e*t;for(const e of c)if(r<=e.maxResolution&&i<=e.maxFrameRate)return e.level}function p(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){const i=g(t);e.codecpar.profile=i.profile,e.codecpar.level=i.level}}function g(e){const t=new s.A(e.length);return t.appendBuffer(e),{profile:t.readU(8),level:t.readU(8),bitDepth:t.readU(4),chromaSubsampling:t.readU(3),fullRangeFlag:t.readU1(),colorPrimaries:t.readU(8),colorTrc:t.readU(8),colorSpace:t.readU(8)}}function w(e){const t=new f.A(new Uint8Array(8)),i=function(e){let t=r.f[15](e+48),i=r.f[15](e+52);i===o.N_&&(i=u(r.f[15](e+56),r.f[15](e+60),(0,l.lb)((0,n.A)(e+72,a.P))));const s=h.g[r.f[15](e+28)];let f=r.f[15](e+40),d=1;s&&(f=s.comp[0].depth,1===s.log2ChromaW&&1===s.log2ChromaH?1===r.f[15](e+100)&&(d=0):1===s.log2ChromaW&&0===s.log2ChromaH?d=2:0===s.log2ChromaW&&0===s.log2ChromaH&&(d=3));const c=2===r.f[15](e+84)?1:0;return t===o.N_&&f&&(t=0==d||1==d?8==f?0:2:8==f?1:3),{profile:t,level:i,bitDepth:f,chromaSubsampling:d,fullRange:c}}(e);return t.writeUint8(i.profile),t.writeUint8(i.level),t.writeUint8(i.bitDepth<<4|i.chromaSubsampling<<1|i.fullRange),t.writeUint8(r.f[15](e+88)),t.writeUint8(r.f[15](e+92)),t.writeUint8(r.f[15](e+96)),t.writeUint16(0),t.getWroteBuffer()}},55611:(e,t,i)=>{i.d(t,{Jk:()=>R,OD:()=>x,QA:()=>_,Ui:()=>y,XC:()=>B,ci:()=>v,oT:()=>b,wf:()=>I});var r=i(63939),a=i(50932),n=i(72739),s=i(729),o=i(31865),h=i(37246),l=i(14686),f=i(60264),d=i(71517),c=i(37837),u=i(23991),p=i(83314);const g=3;function w(e){const t=e.readU(9),i=e.readU(3),r=e.readU(2),a=e.readU(2),n=e.readU(3);e.readU(5),e.readU(2);const s=e.readU(6),o=e.readU(7),h=e.readU(1),l=e.readU(8),f=e.readU(1),d=e.readU(1),c=[],u=[];if(s){for(let t=0;t<s-1;t++)c[t]=e.readU(8);c[s-1]=e.readU(6)}else e.readU(6);if(i>1){let t=0;for(let r=i-2;r>=0;--r)t|=e.readU(1)<<r;for(let t=i;t<=8&&i>1;++t)e.readU(1);for(let r=i-2;r>=0;--r)t&1<<r&&(u[r]=e.readU(8))}const p=e.readU(8),g=[];if(p)for(let t=0;t<p;t++)g.push(e.readU(8));return{olsIdx:t,numSublayers:i,bitDepthMinus8:n,chromaFormatIdc:a,constantFrameRate:r,generalProfileIdc:o,generalTierFlag:h,generalLevelIdc:l,ptlFrameOnlyConstraintFlag:f,ptlMultilayerEnabledFlag:d,generalConstraintInfo:c,sublayerLevelIdc:u,generalSubProfileIdc:g,maxPictureWidth:e.readU(16),maxPictureHeight:e.readU(16),avgFramerate:e.readU(16)}}function U(e){const t=new o.A(e,!0);if(1&t.readUint8()){const i=new h.A;i.appendBuffer(e.subarray(1)),w(i),t.skip(i.getPos())}let i=[],r=[],a=[];const n=t.readUint8();for(let e=0;e<n;e++){const e=31&t.readUint8();let n=1;13!==e&&12!==e&&(n=t.readUint16());const s=[];for(let e=0;e<n;e++){const e=t.readUint16();s.push(t.readBuffer(e))}14===e?i=s:15===e?r=s:16===e&&(a=s)}return{vpss:i,spss:r,ppss:a}}function m(e,t,i){const r=t[0];let a;if(r){const e=I(r);let t=e.generalConstraintInfo;t.length||(t=new Array(12).fill(0));const i=new p.A;if(i.writeU(9,0),i.writeU(3,e.spsMaxSublayersMinus1+1),i.writeU(2,1),i.writeU(2,e.chromaFormatIdc),i.writeU(3,e.bitDepthMinus8),i.writeU(5,31),i.writeU(2,0),i.writeU(6,t.length),i.writeU(7,e.profile),i.writeU1(e.tierFlag),i.writeU(8,e.level),i.writeU1(e.ptlFrameOnlyConstraintFlag),i.writeU1(e.ptlMultilayerEnabledFlag),t.length){for(let e=0;e<t.length-1;e++)i.writeU(8,t[e]);i.writeU(6,t[t.length-1])}else i.writeU(6,63);if(e.spsMaxSublayersMinus1+1>1){let t=0;for(let i=e.spsMaxSublayersMinus1-1;i>=0;i--)t=t<<1|e.ptlSublayerLevelPresentFlag[i];i.writeU(e.spsMaxSublayersMinus1,t);for(let t=e.spsMaxSublayersMinus1+1;t<=8&&e.spsMaxSublayersMinus1>0;++t)i.writeU1(0);for(let t=e.spsMaxSublayersMinus1-1;t>=0;t--)e.ptlSublayerLevelPresentFlag[t]&&i.writeU(8,e.sublayerLevelIdc[t])}i.writeU(8,e.generalSubProfileIdc.length);for(let t=0;t<e.generalSubProfileIdc.length;t++)i.writeU(8,e.sublayerLevelIdc[t]);i.writeU(16,e.width),i.writeU(16,e.height),i.writeU(16,0),i.padding(),a=i.getBuffer().subarray(0,i.getPointer())}let o=2+(a?a.length:0);e.length&&(o+=3,o=e.reduce(((e,t)=>e+2+t.length),o)),t.length&&(o+=3,o=t.reduce(((e,t)=>e+2+t.length),o)),i.length&&(o+=3,o=i.reduce(((e,t)=>e+2+t.length),o));const h=new Uint8Array(o),l=new s.A(h,!0);l.writeUint8(g<<1|(a?1:0)|248),a&&l.writeBuffer(a);let f=0;return e.length&&f++,t.length&&f++,i.length&&f++,l.writeUint8(f),e.length&&(l.writeUint8(142),l.writeUint16(e.length),n.__(e,(e=>{l.writeUint16(e.length),l.writeBuffer(e)}))),t.length&&(l.writeUint8(143),l.writeUint16(t.length),n.__(t,(e=>{l.writeUint16(e.length),l.writeBuffer(e)}))),i.length&&(l.writeUint8(144),l.writeUint16(i.length),n.__(i,(e=>{l.writeUint16(e.length),l.writeBuffer(e)}))),h}function b(e){let t,i=!1,r=(0,f.py)(e);if(r.length>=2){const e=[],i=[],a=[];r.forEach((t=>{const r=t[1]>>>3&31;14===r?e.push(t):15===r?i.push(t):16===r&&a.push(t)})),i.length&&a.length&&(t=m(e,i,a),r=r.filter((e=>{const t=e[1]>>>3&31;return 14!==t&&15!==t&&16!==t&&20!==t})))}const a=r.reduce(((e,t)=>e+g+1+t.length),0),o=(0,c.sY)(a),h=(0,l.s3)(o,a),d=new s.A(h);return n.__(r,(e=>{3===g?d.writeUint32(e.length):2===g?d.writeUint24(e.length):1===g?d.writeUint16(e.length):d.writeUint8(e.length),d.writeBuffer(e.subarray(0));const t=e[1]>>>3&31;8!==t&&7!==t&&9!==t&&10!==t||(i=!0)})),{bufferPointer:o,length:a,extradata:t,key:i}}function x(e,t){const i=t?t[0]>>>1&3:g;let r=[],a=[],h=[],f=!1;if(t){const e=U(t);r=e.vpss,a=e.spss,h=e.ppss,f=!0}const d=[],u=new o.A(e);for(;u.remainingSize()>0;){let e=0;e=3===i?u.readUint32():2===i?u.readUint24():1===i?u.readUint16():u.readUint8(),d.push(u.readBuffer(e))}let p=r.reduce(((e,t)=>e+4+t.length),0);p=a.reduce(((e,t)=>e+4+t.length),p),p=h.reduce(((e,t)=>e+4+t.length),p),p=d.reduce(((e,t,i)=>e+(i?3:4)+t.length),p);const w=(0,c.sY)(p+7),m=(0,l.s3)(w,p+7),b=new s.A(m);return b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeUint8(0),b.writeUint8(160),b.writeUint8(240),n.__(r,(e=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(e)})),n.__(a,(e=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(e)})),n.__(h,(e=>{b.writeUint8(0),b.writeUint8(0),b.writeUint8(0),b.writeUint8(1),b.writeBuffer(e)})),n.__(d,((e,t)=>{b.writeUint8(0),b.writeUint8(0),t||b.writeUint8(0),b.writeUint8(1),b.writeBuffer(e);const i=e[1]>>>3&31;8!==i&&7!==i&&9!==i&&10!==i||(f=!0)})),{bufferPointer:w,length:p+7,key:f}}function R(e,t){var i;if(!(1&r.f[15](e+36)))return;const a=(0,d.iI)(e);if((0,f.Bs)(a))return;const n=null!==(i=t.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:g;let s=[],h=[],u=[];const p=new o.A(a);for(;p.remainingSize()>0;){let e=0;e=3===n?p.readUint32():2===n?p.readUint24():1===n?p.readUint16():p.readUint8();const t=a.subarray(0|Number(0xffffffffn&p.getPos()),(0|Number(0xffffffffn&p.getPos()))+e);p.skip(e);const i=t[1]>>>3&31;15===i?h.push(t):16===i?u.push(t):14===i&&s.push(t)}if(h.length||u.length||s.length){const t=m(s,h,u),i=(0,c.sY)(t.length);(0,l.lW)(i,t.length,t),(0,d.Ow)(e,1,i,t.length)}}function v(e,t=!1){if(!(1&r.f[15](e+36)||t))return;const i=(0,d.iI)(e);if(!(0,f.Bs)(i))return;let n=(0,f.py)(i);if(n.length>2){const t=[],i=[],s=[];if(n.forEach((e=>{const r=e[1]>>>3&31;14===r?t.push(e):15===r?i.push(e):16===r&&s.push(e)})),t.length&&i.length&&s.length){const n=m(t,i,s),o=(0,c.sY)(n.length);(0,l.lW)(o,n.length,n),(0,d.Ow)(e,1,o,n.length),a.M[15](e+36,1|r.f[15](e+36))}}}function _(e,t){const{profile:i,level:r,width:a,height:n}=I(t);e.codecpar.profile=i,e.codecpar.level=r,e.codecpar.width=a,e.codecpar.height=n}function B(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){e.metadata.naluLengthSizeMinusOne=t[0]>>>1&3;const{spss:i}=U(t);i.length&&_(e,i[0])}}function I(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);let i=0,r=0,a=0,n=0,s=0,o=1,l=0,d=0,c=0;const p=[],g=[],w=[],U=[],m=(0,f.BN)(e.subarray(t)),b=new h.A(m.length);b.appendBuffer(m),b.readU1(),b.readU1(),b.readU(6),b.readU(5),b.readU(3),b.readU(8);const x=b.readU(3);o=b.readU(2);const R=b.readU(2);if(b.readU(1)){if(i=b.readU(7),l=b.readU(1),r=b.readU(8),d=b.readU(1),c=b.readU(1),b.readU(1)){for(let e=0;e<8;e++)p[e]=b.readU(8);p[8]=b.readU(7);const e=b.readU(8);b.readU(e)}b.skipPadding();for(let e=x-1;e>=0;e--)g[e]=b.readU(1);b.skipPadding();for(let e=x-1;e>=0;e--)g[e]&&(w[e]=b.readU(8));const e=b.readU(8);if(e)for(let t=0;t<e;t++)U[t]=b.readU(32)}b.readU1(),b.readU1()&&b.readU1();const v=a=u.xb(b),_=n=u.xb(b);if(b.readU1()&&(u.xb(b),u.xb(b),u.xb(b),u.xb(b)),b.readU1()){const e=u.xb(b),t=R+5,i=1<<t,r=v/(1<<t),a=_/(1<<t),n=Math.ceil(Math.log2(r)),s=Math.ceil(Math.log2(a));let o=0,h=0,l=0;e>0&&(l=b.readU1(),h=b.readU1());for(let t=0;e>0&&t<=e;t++)h&&0!=t||(t>0&&v>i&&b.readU(n),t>0&&_>i&&b.readU(s),t<e&&v>i&&b.readU(n),t<e&&_>i&&b.readU(s)),l||b.readU(2);if(o=u.xb(b)+1,b.readU(1)&&b.readU(1))for(let t=0;t<=e;t++)b.readU(o)}s=u.xb(b),b.readU(1),b.readU(1);const B=b.readU(4),I=b.readU(1);let y=0;I&&(y=u.xb(b));const k=[],P=b.readU(2);for(let e=0;e<8*P;e++)k[e]=b.readU(1);return{profile:i,level:r,width:a,height:n,chromaFormatIdc:o,bitDepthMinus8:s,generalProfileSpace:0,tierFlag:l,generalConstraintInfo:p,generalSubProfileIdc:U,ptlFrameOnlyConstraintFlag:d,ptlMultilayerEnabledFlag:c,spsMaxSublayersMinus1:x,ptlSublayerLevelPresentFlag:g,sublayerLevelIdc:w,sps_log2_max_pic_order_cnt_lsb_minus4:B,sps_poc_msb_cycle_flag:I,sps_poc_msb_cycle_len_minus1:y,sps_num_extra_ph_bytes:P,sps_extra_ph_bit_present_flag:k}}function y(e){0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(e=function(e){let t=(0,f.py)(e);if(t.length>=2){const e=[],i=[],r=[];if(t.forEach((t=>{const a=t[1]>>>3&31;14===a?e.push(t):15===a?i.push(t):16===a&&r.push(t)})),i.length&&r.length)return m(e,i,r)}}(e));const t=new h.A;return t.appendBuffer(e),1&t.readU(8)?w(t):{}}},28773:(e,t,i)=>{i.r(t),i.d(t,{default:()=>k});var r=i(134),a=i(63939),n=i(50932),s=i(58121),o=i(68243),h=i(4624),l=i(35028),f=i(20620),d=i(58469),c=i(53e3),u=i(55611),p=i(90412),g=i(58919),w=i(9705),U=i(85947),m=i(14686),b=i(37837),x=i(71517),R=i(65977),v=i(44328),_=i(77231),B=i(72739),I=i(52071),y="src/avformat/formats/IFlvFormat.ts";class k extends U.A{constructor(e={}){super(),(0,r.A)(this,"type",0),(0,r.A)(this,"header",void 0),(0,r.A)(this,"script",void 0),(0,r.A)(this,"options",void 0),(0,r.A)(this,"firstTagPos",void 0),this.header=new s.A,this.script=new o.A,this.options=e}init(e){e.ioReader&&e.ioReader.setEndian(!0)}async readHeader(e){try{if("FLV"!==await e.ioReader.peekString(3))return h.z3("the file format is not flv",y,101),w.LR;await this.header.read(e.ioReader),0!==await e.ioReader.readUint32()&&h.R8("the previousTagSize0 is not 0",y,108);let t=0;if(18===await e.ioReader.peekUint8()){await e.ioReader.skip(1);const i=await e.ioReader.readUint24();await e.ioReader.skip(7),t=await this.script.read(e.ioReader,i)}return t>=0&&(this.firstTagPos=e.ioReader.getPos()),t}catch(t){return h.z3(t.message,y,126),e.ioReader.error}}async readCodecConfigurationRecord(e,t,i){const r=(0,b.sY)(i);t.codecpar.extradata=r,t.codecpar.extradataSize=i,await e.ioReader.readBuffer(i,(0,m.JW)(r,i)),t.sideData[1]=(0,m.s3)(r,i).slice(),27===t.codecpar.codecId?f.XC(t):173===t.codecpar.codecId?c.XC(t):196===t.codecpar.codecId?u.XC(t):225===t.codecpar.codecId?p.XC(t):167===t.codecpar.codecId&&g.XC(t)}async readAVPacketData(e,t,i,r){const a=(0,b.sY)(r);(0,x.NX)(i,a,r),await e.ioReader.readBuffer(r,(0,m.JW)(a,r)),27===t.codecpar.codecId?(f.Jk(i,t),n.M[15](i+80,1)):173===t.codecpar.codecId?(c.Jk(i,t),n.M[15](i+80,1)):196===t.codecpar.codecId&&(u.Jk(i,t),n.M[15](i+80,1))}async readAVPacket_(e,t){const i=e.ioReader.getPos();n.M[17](t+56,i);const r=31&await e.ioReader.readUint8(),s=await e.ioReader.readUint24();let o=await e.ioReader.readUint24();const f=await e.ioReader.readUint8();if(f&&(o|=f<<24),n.M[17](t+16,BigInt(Math.floor(o))),n.M[17](t+8,BigInt(Math.floor(o))),await e.ioReader.skip(3),8===r){let i=e.getStreamByMediaType(1);i&&n.M[15](t+32,i.index),n.M[15](t+36,1|a.f[15](t+36));const r=await e.ioReader.readUint8();if(i)if(86018===i.codecpar.codecId)if(0===await e.ioReader.readUint8()){const i=s-2,r=(0,b.sY)(i);(0,x.Ow)(t,1,r,i),await e.ioReader.readBuffer(i,(0,m.JW)(r,i))}else await this.readAVPacketData(e,i,t,s-2);else await this.readAVPacketData(e,i,t,s-1);else{i=e.createStream(),n.M[15](t+32,i.index),i.codecpar.codecType=1,i.timeBase.den=1e3,i.timeBase.num=1,i.startTime=a.f[17](t+8)||a.f[17](t+16),this.script.onMetaData.duration&&(i.duration=BigInt(Math.floor(1e3*this.script.onMetaData.duration))),i.codecpar.chLayout.nbChannels=1&~r?1:2,i.codecpar.sampleRate=44100<<((12&r)>>>2)>>3,i.codecpar.bitsPerCodedSample=2&r?16:8;const o=(240&r)>>4;if(i.codecpar.codecId=0===o||3===o?8===i.codecpar.bitsPerCodedSample?65541:65536:l.FJ[o],86018===i.codecpar.codecId)if(0===await e.ioReader.readUint8()){const t=s-2,r=(0,b.sY)(t);i.codecpar.extradata=r,i.codecpar.extradataSize=t,await e.ioReader.readBuffer(t,(0,m.JW)(r,t)),i.sideData[1]=(0,m.s3)(r,t).slice(),d.XC(i)}else await this.readAVPacketData(e,i,t,s-2);else 86051===i.codecpar.codecId?(i.codecpar.sampleRate=16e3,i.codecpar.chLayout.nbChannels=1):65543!==i.codecpar.codecId&&65542!==i.codecpar.codecId||(i.codecpar.sampleRate=8e3),await this.readAVPacketData(e,i,t,s-1);this.onStreamAdd&&this.onStreamAdd(i)}}else{if(9!==r){if(18===r){let i=await this.script.read(e.ioReader,s);return i<0?i:await this.readAVPacket_(e,t)}return h.R8(`invalid tag type: ${r}, try to sync to next tag`,y,458),await this.syncTag(e),this.readAVPacket_(e,t)}{let i=e.getStreamByMediaType(0);i&&n.M[15](t+32,i.index);const r=await e.ioReader.readUint8();if(i)if((112&r)>>4==1&&n.M[15](t+36,1|a.f[15](t+36)),128&r){await e.ioReader.skip(4);const o=15&r;if(173!==i.codecpar.codecId&&196!==i.codecpar.codecId||n.M[15](t+80,1),0===o){const i=s-5,r=(0,b.sY)(i);(0,x.Ow)(t,1,r,i),await e.ioReader.readBuffer(i,(0,m.JW)(r,i))}else if(2===o)n.M[15](t+36,32|a.f[15](t+36));else if(1===o||3===o)if(1!==o||173!==i.codecpar.codecId&&196!==i.codecpar.codecId)await this.readAVPacketData(e,i,t,s-5);else{const r=await e.ioReader.readUint24();n.M[17](t+8,a.f[17](t+16)+BigInt(Math.floor(r))),await this.readAVPacketData(e,i,t,s-8)}}else if(27===i.codecpar.codecId||173===i.codecpar.codecId||12===i.codecpar.codecId){n.M[15](t+80,1);const r=await e.ioReader.readUint8(),o=await e.ioReader.readUint24();if(n.M[17](t+8,a.f[17](t+16)+BigInt(Math.floor(o))),0===r){const i=s-5,r=(0,b.sY)(i);(0,x.Ow)(t,1,r,i),await e.ioReader.readBuffer(i,(0,m.JW)(r,i))}else 2===r?n.M[15](t+36,32|a.f[15](t+36)):await this.readAVPacketData(e,i,t,s-5)}else await this.readAVPacketData(e,i,t,s-1);else{if(i=e.createStream(),n.M[15](t+32,i.index),i.codecpar.codecType=0,i.timeBase.den=1e3,i.timeBase.num=1,i.startTime=a.f[17](t+8)||a.f[17](t+16),this.script.onMetaData.duration&&(i.duration=BigInt(Math.floor(1e3*this.script.onMetaData.duration))),this.script.onMetaData.width>0&&(i.codecpar.width=this.script.onMetaData.width),this.script.onMetaData.height>0&&(i.codecpar.height=this.script.onMetaData.height),(112&r)>>4==1&&n.M[15](t+36,1|a.f[15](t+36)),128&r){const o=await e.ioReader.readUint32();o===(0,R.A)("hvc1")?(i.codecpar.codecId=173,n.M[15](t+80,1)):o===(0,R.A)("vvc1")?(i.codecpar.codecId=196,n.M[15](t+80,1)):o===(0,R.A)("av01")?i.codecpar.codecId=225:o===(0,R.A)("vp09")&&(i.codecpar.codecId=167);const h=15&r;if(0===h)await this.readCodecConfigurationRecord(e,i,s-5);else if(2===h)n.M[15](t+36,32|a.f[15](t+36));else if(1===h||3===h)if(1!==h||173!==i.codecpar.codecId&&196!==i.codecpar.codecId)await this.readAVPacketData(e,i,t,s-5);else{const r=await e.ioReader.readUint24();n.M[17](t+8,a.f[17](t+16)+BigInt(Math.floor(r))),await this.readAVPacketData(e,i,t,s-8)}}else if(i.codecpar.codecId=l.U5[15&r],27===i.codecpar.codecId||173===i.codecpar.codecId||196===i.codecpar.codecId||12===i.codecpar.codecId){n.M[15](t+80,1);const r=await e.ioReader.readUint8(),o=await e.ioReader.readUint24();n.M[17](t+8,a.f[17](t+16)+BigInt(Math.floor(o))),0===r?await this.readCodecConfigurationRecord(e,i,s-5):2===r?n.M[15](t+36,32|a.f[15](t+36)):await this.readAVPacketData(e,i,t,s-5)}else await this.readAVPacketData(e,i,t,s-1);this.onStreamAdd&&this.onStreamAdd(i)}}}const c=e.ioReader.getPos()-i,u=BigInt(Math.floor(await e.ioReader.readUint32()));return c!==u?(h.R8(`tag ${r} size not match, size: ${c}, previousTagSize: ${u}`,y,467),w.LR):0}async readAVPacket(e,t){try{return n.M[15](t+76,1e3),n.M[15](t+72,1),await this.readAVPacket_(e,t)}catch(t){return-1048576!==e.ioReader.error&&h.z3(t.message,y,483),e.ioReader.error}}async syncTag(e){let t=_.Dh;for(;;)try{const i=await e.ioReader.readUint8();if(8===i||9===i){t=e.ioReader.getPos()-BigInt(1);const i=await e.ioReader.readUint24();if(i>10485760){await e.ioReader.seek(t+BigInt(1));continue}await e.ioReader.skip(7+i);if(e.ioReader.getPos()-t!==BigInt(Math.floor(await e.ioReader.readUint32()))){await e.ioReader.seek(t+BigInt(1)),t=_.Dh;continue}{let i=0;for(;i<=3;){const t=e.ioReader.getPos(),r=await e.ioReader.readUint8();if(8!==r&&9!==r&&18!==r)break;{const r=await e.ioReader.readUint24();await e.ioReader.skip(7+r);if(e.ioReader.getPos()-t!==BigInt(Math.floor(await e.ioReader.readUint32())))break;i++}}if(!(i<3))break;await e.ioReader.seek(t+BigInt(1)),t=_.Dh}}}catch(e){break}t!==_.Dh&&await e.ioReader.seek(t)}async seek(e,t,i,r){const a=e.ioReader.getPos();if(2&r)return await e.ioReader.seek(i),4&r||await this.syncTag(e),a;if(t&&t.sampleIndexes.length){let r=B.El(t.sampleIndexes,(e=>e.pts>i?-1:1));if(r>0&&(0,v.k)(i-t.sampleIndexes[r-1].pts,t.timeBase,_.i0)<BigInt(1e4))return h.Yz(`seek in sampleIndexes, found index: ${r}, pts: ${t.sampleIndexes[r-1].pts}, pos: ${t.sampleIndexes[r-1].pos}`,y,581),await e.ioReader.seek(t.sampleIndexes[r-1].pos),a}if(this.script.canSeek()){const{pos:r,dts:n}=this.script.dts2Position(Number((0,v.k)(i,t.timeBase,_.i0)/BigInt(1e3)));if(r>0){h.Yz(`seek in filepositions, found pts: ${n}, pos: ${r}`,y,590),await e.ioReader.seek(BigInt(Math.floor(r)));const t=await e.ioReader.peekUint8();return 8!==t&&9!==t&&18!==t&&await this.syncTag(e),a}}return h.Yz("not found any keyframe index, try to seek in bytes",y,600),(0,I.A)(e,t,i,this.firstTagPos,this.readAVPacket.bind(this),this.syncTag.bind(this))}getAnalyzeStreamsCount(){let e=0;return this.header.hasAudio&&e++,this.header.hasVideo&&e++,e}}},85947:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(134);class a{constructor(){(0,r.A)(this,"type",-1),(0,r.A)(this,"onStreamAdd",void 0)}destroy(e){}}},58121:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(134);class a{constructor(){(0,r.A)(this,"signature",void 0),(0,r.A)(this,"version",void 0),(0,r.A)(this,"flags",void 0),(0,r.A)(this,"dataOffset",void 0),(0,r.A)(this,"hasVideo",void 0),(0,r.A)(this,"hasAudio",void 0),this.signature="FLV",this.version=1,this.flags=0,this.dataOffset=9,this.hasAudio=!1,this.hasVideo=!1}async read(e){this.signature=await e.readString(3),this.version=await e.readUint8(),this.flags=await e.readUint8(),this.dataOffset=await e.readUint32(),this.hasAudio=!!(4&this.flags),this.hasVideo=!!(1&this.flags)}write(e){this.flags=0,this.hasAudio&&(this.flags|=4),this.hasVideo&&(this.flags|=1),e.writeString(this.signature),e.writeUint8(this.version),e.writeUint8(this.flags),e.writeUint32(this.dataOffset)}}},68243:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(134),a=i(35336),n=i(67672),s=i(72739),o=i(95335),h=i(92647),l=i(4624),f=i(94889),d=i(9705);class c{constructor(){(0,r.A)(this,"onMetaData",void 0),this.onMetaData={audiocodecid:10,canSeekToEnd:!1,width:0,height:0,stereo:!0,videocodecid:7}}async parseObject(e,t){return{key:await e.readString(await e.readUint16()),value:await this.parseValue(e,t)}}async parseValue(e,t){let i;switch(await e.readUint8()){case 0:i=await e.readDouble();break;case 1:i=!!await e.readUint8();break;case 2:i=await e.readString(await e.readUint16());break;case 3:for(i={};e.getPos()<t;){const{key:r,value:a}=await this.parseObject(e,t);if(i[r]=a,9==(16777215&await e.peekUint24())){await e.skip(3);break}}break;case 8:for(i={},await e.skip(4);e.getPos()<t;){const{key:r,value:a}=await this.parseObject(e,t);if(i[r]=a,9==(16777215&await e.peekUint24())){await e.skip(3);break}}break;case 9:i=null;break;case 10:i=[];const r=await e.readUint32();for(let a=0;a<r;a++)i.push(await this.parseValue(e,t));break;case 11:const a=await e.readDouble(),n=await e.readInt16();i=new Date(a+60*n*1e3);break;case 12:i=await e.readString(await e.readUint32())}return i}async read(e,t){const i=e.getPos(),r=i+BigInt(Math.floor(t)),a=await this.parseValue(e,r),n=await this.parseValue(e,r);this[a]=n;const s=Number(e.getPos()-i),o=await e.readUint32();return s+11!==o?(l.R8(`script size not match, size: ${s+11}, previousTagSize: ${o}`,"src/avformat/formats/flv/FlvScriptTag.ts",150),d.LR):0}writeValue(e,t){n.ai(t)?(e.writeUint8(0),e.writeDouble(t)):n.o(t)?(e.writeUint8(0),e.writeDouble(Number(t))):n.zM(t)?(e.writeUint8(1),e.writeUint8(t?1:0)):n.Yj(t)?t.length>=65536?(e.writeUint8(12),e.writeUint32(t.length),e.writeString(t)):(e.writeUint8(2),e.writeUint16(t.length),e.writeString(t)):n.YO(t)?(e.writeUint8(10),e.writeUint32(t.length),s.__(t,(t=>{this.writeValue(e,t)}))):n.Ik(t)?(e.writeUint8(3),o.__(t,((t,i)=>{e.writeUint16(i.length),e.writeString(i),this.writeValue(e,t)})),e.writeUint24(9)):t instanceof Date&&(e.writeUint8(11),e.writeDouble(t.getTime()),e.writeInt16(0))}computeSize(){const e=[],t=new a.A;return t.onFlush=t=>(e.push(t.slice()),0),this.writeValue(t,"onMetaData"),this.writeValue(t,this.onMetaData),t.flush(),(0,h.A)(Uint8Array,e).length}write(e){if(this.onMetaData){const t=[],i=new a.A;i.onFlush=e=>(t.push(e.slice()),0),this.writeValue(i,"onMetaData"),this.writeValue(i,this.onMetaData),i.flush();const r=(0,h.A)(Uint8Array,t),n=e.getPos();f.xk(e,18,r.length,BigInt(0)),e.writeBuffer(r),e.writeUint32(Number(e.getPos()-n))}}dts2Position(e){if(this.canSeek()){let t=-1;const i=this.onMetaData.keyframes.times,r=this.onMetaData.keyframes.filepositions;let a;for(a=0;a<i.length;a++){if(i[a]===e){t=a;break}if(i[a]>e){t=Math.max(a-1,0);break}}return a&&a===i.length&&(t=i.length-1),{pos:r[t],dts:i[t]}}return{pos:-1,dts:-1}}position2DTS(e){if(this.canSeek()){let i=-1;const r=this.onMetaData.keyframes.times,a=this.onMetaData.keyframes.filepositions;let n=0;for(n=0;n<a.length;n++)if(a[n]>e){i=n;break}var t;return n===a.length?null!==(t=this.onMetaData.duration)&&void 0!==t?t:r[r.length-1]:r[i]}return-1}canSeek(){return!!(this.onMetaData.keyframes&&this.onMetaData.keyframes.filepositions&&this.onMetaData.keyframes.filepositions.length)}}},35028:(e,t,i)=>{i.d(t,{FJ:()=>a,FV:()=>r,IO:()=>s,U5:()=>n});const r={86018:10,86017:2,86051:11,69645:1,86049:6,65543:7,65542:8,27:7,173:12,196:13,12:9,4:2,86:3,92:4,106:5,131:6},a={10:86018,2:86017,11:86051,1:69645,4:86049,5:86049,6:86049,7:65543,8:65542},n={7:27,12:173,13:196,9:12,2:4,3:86,4:92,5:106,6:131},s={86018:1,86017:0,86051:0,65543:0,65542:0,69645:0,86049:0,27:4,12:4,173:4,196:4,167:4,225:4,4:0,86:0,92:0,106:0,131:0}},94889:(e,t,i)=>{i.d(t,{BV:()=>n,VU:()=>o,ii:()=>s,xk:()=>a});var r=i(35028);function a(e,t,i,r){e.writeUint8(t),e.writeUint24(i),e.writeUint24(Number(r&BigInt(16777215))),e.writeUint8(Number(r>>BigInt(24)&BigInt(255))),e.writeUint24(0)}function n(e,t){let i=2;(86018===t.codecpar.codecId||t.codecpar.chLayout.nbChannels>1)&&(i|=1),86018===t.codecpar.codecId||t.codecpar.sampleRate>=44e3?i|=12:t.codecpar.sampleRate>=22e3?i|=8:t.codecpar.sampleRate>=11e3&&(i|=4),i|=r.FV[t.codecpar.codecId]<<4,e.writeUint8(i)}function s(e,t,i){let a=15&r.FV[t.codecpar.codecId];27!==t.codecpar.codecId&&12!==t.codecpar.codecId&&173!==t.codecpar.codecId&&196!==t.codecpar.codecId||(a|=1&i?16:32),e.writeUint8(a)}function o(e,t,i,r){let a=15&i|128;27!==t.codecpar.codecId&&173!==t.codecpar.codecId&&196!==t.codecpar.codecId&&167!==t.codecpar.codecId&&225!==t.codecpar.codecId||(a|=1&r?16:32),e.writeUint8(a)}},2187:(e,t,i)=>{i.d(t,{d:()=>s});var r=i(72739),a=i(44328),n=i(77231);function s(e,t,i){let s=BigInt(0);return r.__(e,(e=>{s+=e.codecpar.bitRate*(0,a.k)(t,i,n.i0)/BigInt(8e3)})),s}},65977:(e,t,i)=>{i.d(t,{A:()=>n});var r=i(4624),a="src/avformat/function/mktag.ts";function n(e){4!==e.length&&r.R8(`tag length is not 4, tag: ${e}`,a,30);let t=0;for(let i=0;i<4;i++)t=t<<8|e.charCodeAt(i);return t}},52071:(e,t,i)=>{i.d(t,{A:()=>u});var r=i(63939),a=i(9599),n=i(29170),s=i(77231),o=i(44328),h=i(2187),l=i(71517),f=i(9705),d=i(4624),c="src/avformat/function/seekInBytes.ts";async function u(e,t,i,u,p,g){const w=e.ioReader.getPos(),U=await e.ioReader.fileSize();let m=s.Dh,b=i;t.startTime!==s.Dh?b-=t.startTime:b-=t.firstDTS;const x=(0,o.k)(i,t.timeBase,s.i0);if(x<BigInt(1e4))return d.Yz(`seek pts is earlier then 10s, seek to first packet pos(${u}) directly`,c,63),await e.ioReader.seek(u),w;let R=(0,h.d)(e.streams,b,t.timeBase);const v=U-(0,h.d)(e.streams,BigInt(5e3),s.i0),_=(0,h.d)(e.streams,BigInt(1e4),s.i0);if(R>v&&(R=v),R<u)return await e.ioReader.seek(u),w;const B=(0,l._5)();let I=U,y=BigInt(0);for(;;){if(I-y<_){m=y;break}await e.ioReader.seek(R),await g(e);const t=e.ioReader.getPos();if(!(await p(e,B)>=0))break;{const e=(0,o.k)(r.f[17](B+8),(0,n.A)(B+72,a.P),s.i0),i=e-x;if(d.Yz(`try to seek to pos: ${R}, got packet pts: ${r.f[17](B+8)}(${e}ms), diff: ${i}ms`,c,98),i<=BigInt(0)&&-i<BigInt(1e4)){m=t;break}i>BigInt(0)?(I=R,R=y+I>>BigInt(1)):(y=R,R=y+I>>BigInt(1))}}return(0,l.Qe)(B),m!==s.Dh?(d.Yz(`finally seek to pos ${m}`,c,124),await e.ioReader.seek(m),await g(e),w):(await e.ioReader.seek(w),BigInt(f.E$))}},11573:(e,t,i)=>{function r(e,t){let i=0;for(let r=0;r<t;r++)i=2*i+e.readU1();return i}function a(e){let t=0;for(;!r(e,1);)t++;return t>=32?0:r(e,t)+(1<<t)-1}function n(e){let t=0,i=0;for(let a=0;a<8;a++){let n=r(e,8);if(t|=(127&n)<<7*a,i+=1,!(128&n))break}return t}i.d(t,{d:()=>a,f:()=>r,v:()=>n})},23991:(e,t,i)=>{function r(e){let t=0,i=0;for(;i<32&&0===e.readU1();)i++;return t=e.readU(i),t+=(1<<i)-1,t}function a(e){let t=r(e);return t=1&t?(t+1)/2:-t/2,t}i.d(t,{$x:()=>a,xb:()=>r})},39381:(e,t,i)=>{i.d(t,{E3:()=>n,Sg:()=>h,Y0:()=>o});var r=i(63939);function a(e){return r.f[2](e)}function n(e){return a(e+1)<<8|a(e)}function s(e){return a(e)<<8|a(e+1)}function o(e){return n(e+2)<<16|n(e)}function h(e){return s(e)<<16|s(e+2)}},60264:(e,t,i)=>{function r(e){return e.length>4&&0===e[0]&&0===e[1]&&(1===e[2]||0===e[2]&&1===e[3])}function a(e,t){let i=0;for(let r=t;r<e.length;r++)switch(e[r]){case 0:i++;break;case 1:if(i>=2)return{offset:r-Math.min(i,3),startCode:Math.min(i+1,4)};i=0;break;default:i=0}return{offset:-1,startCode:0}}function n(e){const t=[];let i=a(e,0),r={offset:-1,startCode:0};for(;r=a(e,i.offset+i.startCode),r.offset>-1;)t.push(e.subarray(i.offset+i.startCode,r.offset,!0)),i=r;return t.push(e.subarray(i.offset+i.startCode,void 0,!0)),t}function s(e,t=0,i){i||(i=e.length);const r=new Uint8Array(e.length);let a=0,n=0;for(let s=0;s<e.length;s++){if(s>=t&&s<i)if(0===e[s])a++;else if(3===e[s]&&2===a&&s+1<e.length&&e[s+1]<=3){if(s++,s===e.length)break;a=0===e[s]?1:0}else a=0;r[n++]=e[s]}return r.slice(0,n)}i.d(t,{BN:()=>s,Bs:()=>r,Ky:()=>a,py:()=>n})},37246:(e,t,i)=>{i.d(t,{A:()=>n});var r=i(134),a=i(4624);class n{constructor(e=1048576){(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"bitsLeft",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"endPointer",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),this.pointer=0,this.bitsLeft=8,this.size=e,this.endPointer=0,this.error=0,this.buffer=new Uint8Array(this.size)}peekU1(){let e=0;(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush();let t=this.pointer,i=this.bitsLeft;return 0===i&&(t++,i=8),e=this.buffer[t]>>i-1&1,e}readU1(){let e=0;return(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush(),this.bitsLeft--,e=this.buffer[this.pointer]>>this.bitsLeft&1,0===this.bitsLeft&&(this.pointer++,this.bitsLeft=8),e}readU(e){let t=0;for(let i=0;i<e;i++)t|=this.readU1()<<e-i-1;return t}remainingLength(){return this.endPointer-this.pointer}getPos(){return this.pointer}skip(e){const t=(e-e%8)/8;this.pointer+=t;const i=e%8;this.bitsLeft<=i?(this.pointer++,this.bitsLeft=8-(i-this.bitsLeft)):this.bitsLeft-=i}flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOReader error, flush failed because of no flush callback");if(0===this.bitsLeft&&this.pointer++,!(this.size-this.remainingLength()<=0))if(this.pointer<this.endPointer){this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0);const e=this.onFlush(this.buffer.subarray(this.endPointer-this.pointer,this.size));if(e<0)throw this.error=e,Error("IOReader error, flush failed");this.endPointer=this.endPointer-this.pointer+e,this.pointer=0}else{const e=this.onFlush(this.buffer);if(this.endPointer=e,this.pointer=0,this.bitsLeft=8,e<0)throw this.error=e,Error("IOReader error, flush failed")}}getBuffer(){return this.buffer}appendBuffer(e){if(this.size-this.endPointer>=e.length)this.buffer.set(e,this.endPointer),this.endPointer+=e.length;else if(this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0),this.endPointer=this.endPointer-this.pointer,this.pointer=0,this.size-this.endPointer>=e.length)this.buffer.set(e,this.endPointer),this.endPointer+=e.length;else{const t=Math.min(this.size-this.endPointer,e.length);this.buffer.set(e.subarray(0,t),this.endPointer),this.endPointer+=t,a.R8("BSReader, call appendBuffer but the buffer's size is lagger then the remaining size","src/common/io/BitReader.ts",190)}}clear(){this.pointer=this.endPointer=0,this.bitsLeft=8,this.error=0}skipPadding(){this.bitsLeft<8&&(this.bitsLeft=8,this.pointer++)}}},83314:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(134);class a{constructor(e=1048576){(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"bitPointer",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),this.pointer=0,this.bitPointer=0,this.size=e,this.error=0,this.buffer=new Uint8Array(this.size)}writeU1(e){(this.remainingLength()<1||1===this.remainingLength()&&this.bitPointer>=8)&&this.flush(),1&e?this.buffer[this.pointer]|=1<<7-this.bitPointer:this.buffer[this.pointer]&=~(1<<7-this.bitPointer),this.bitPointer++,8===this.bitPointer&&(this.pointer++,this.bitPointer=0)}writeU(e,t){for(let i=0;i<e;i++)this.writeU1(t>>e-i-1&1)}remainingLength(){return this.size-this.pointer}flush(){if(!this.onFlush)throw this.error=-1048574,Error("BSWriter error, flush failed because of no flush callback");if(this.pointer)if(this.bitPointer&&this.pointer>1){const e=this.onFlush(this.buffer.subarray(0,this.pointer-1));if(0!==e)throw this.error=e,Error("BSWriter error, flush failed");this.buffer[0]=this.buffer[this.pointer]}else if(0===this.bitPointer){const e=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==e)throw this.error=e,Error("BSWriter error, flush failed")}this.pointer=0}padding(){for(;0!==this.bitPointer;)this.writeU1(0)}clear(){this.pointer=0,this.bitPointer=0,this.error=0}getBuffer(){return this.buffer}getPointer(){return this.pointer}}},729:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(134),a=i(4624),n=i(50011);class s{constructor(e,t=!0){(0,r.A)(this,"data",void 0),(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"byteStart",void 0),(0,r.A)(this,"pos",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"littleEndian",void 0),this.buffer=e,this.data=e instanceof Uint8Array?new DataView(e.buffer):e.view,this.byteStart=e instanceof Uint8Array?e.byteOffset:0,this.pos=0,this.size=e.byteLength,this.littleEndian=!t}writeUint8(e){this.data.setUint8(this.pos+++this.byteStart,e)}writeUint16(e){this.data.setUint16(this.pos+this.byteStart,e,this.littleEndian),this.pos+=2}writeUint24(e){const t=3840&e,i=240&e,r=15&e;this.littleEndian?(this.writeUint8(r),this.writeUint8(i),this.writeUint8(t)):(this.writeUint8(t),this.writeUint8(i),this.writeUint8(r))}writeUint32(e){this.data.setUint32(this.pos+this.byteStart,e,this.littleEndian),this.pos+=4}writeUint64(e){const t=e&BigInt(4294967295),i=(e&BigInt(4294967295)<<BigInt(32))>>BigInt(32);this.littleEndian?(this.writeUint32(Number(t)),this.writeUint32(Number(i))):(this.writeUint32(Number(i)),this.writeUint32(Number(t)))}writeInt8(e){this.data.setInt8(this.pos+++this.byteStart,e)}writeInt16(e){this.data.setInt16(this.pos+this.byteStart,e,this.littleEndian),this.pos+=2}writeInt32(e){this.data.setInt32(this.pos+this.byteStart,e,this.littleEndian),this.pos+=4}writeInt64(e){const t=e&BigInt(4294967295),i=(e&BigInt(4294967295)<<BigInt(32))>>BigInt(32);this.littleEndian?(this.writeInt32(Number(t)),this.writeInt32(Number(i))):(this.writeInt32(Number(i)),this.writeInt32(Number(t)))}writeFloat(e){this.data.setFloat32(this.pos+this.byteStart,e,this.littleEndian),this.pos+=4}writeDouble(e){this.data.setFloat64(this.pos+this.byteStart,e,this.littleEndian),this.pos+=8}getPos(){return this.pos}seek(e){e>this.size&&(e=this.size),this.pos=Math.max(0,e)}skip(e){this.seek(this.pos+e)}back(e){this.seek(this.pos-e)}remainingSize(){return this.size-this.pos}writeBuffer(e){let t=e.length;this.remainingSize()<t&&(t=this.remainingSize(),a.R8(`the remaining buffer size is smaller then the wrote buffer, hope set ${e.length}, but set ${t}`,"src/common/io/BufferWriter.ts",211)),this.buffer.set(e,this.pos),this.pos+=e.length}writeString(e){const t=n.encode(e);return this.writeBuffer(t),t.length}getWroteBuffer(){return this.buffer.subarray(0,this.pos)}resetBuffer(e,t=!0){this.buffer=e,this.data=e instanceof Uint8Array?new DataView(e.buffer):e.view,this.byteStart=e instanceof Uint8Array?e.byteOffset:0,this.pos=0,this.size=e.byteLength,this.littleEndian=!t}}},35336:(e,t,i)=>{i.d(t,{A:()=>n});var r=i(134),a=i(50011);class n{constructor(e=1048576,t=!0,i){if((0,r.A)(this,"data",void 0),(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"pos",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"littleEndian",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),(0,r.A)(this,"onSeek",void 0),this.pointer=0,this.pos=BigInt(0),this.size=e,this.littleEndian=!t,this.error=0,i&&i.view)this.size=i.length,this.buffer=i,this.data=i.view;else if(i&&!i.byteOffset)this.size=i.length,this.buffer=i,this.data=new DataView(this.buffer.buffer);else{if(i)throw new Error("not support subarray of ArrayBuffer");this.buffer=new Uint8Array(this.size),this.data=new DataView(this.buffer.buffer)}}writeUint8(e){this.remainingLength()<1&&this.flush(),this.data.setUint8(this.pointer,e),this.pointer++,this.pos++}writeUint16(e){this.remainingLength()<2&&this.flush(),this.data.setUint16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}writeUint24(e){this.remainingLength()<3&&this.flush();const t=(16711680&e)>>16,i=(65280&e)>>8,r=255&e;this.littleEndian?(this.writeUint8(r),this.writeUint8(i),this.writeUint8(t)):(this.writeUint8(t),this.writeUint8(i),this.writeUint8(r))}writeUint32(e){this.remainingLength()<4&&this.flush(),this.data.setUint32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeUint64(e){this.remainingLength()<8&&this.flush(),this.data.setBigUint64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}writeInt8(e){this.remainingLength()<1&&this.flush(),this.data.setInt8(this.pointer,e),this.pointer++,this.pos++}writeInt16(e){this.remainingLength()<2&&this.flush(),this.data.setInt16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}writeInt32(e){this.remainingLength()<4&&this.flush(),this.data.setInt32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeInt64(e){this.remainingLength()<8&&this.flush(),this.data.setBigInt64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}writeFloat(e){this.remainingLength()<4&&this.flush(),this.data.setFloat32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeDouble(e){this.remainingLength()<8&&this.flush(),this.data.setFloat64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}getPointer(){return this.pointer}getPos(){return this.pos}remainingLength(){return this.size-this.pointer}writeBuffer(e){if(!e.length)return;let t=e.length;if(this.remainingLength()<t){let i=0;for(;t>0;){this.flush();const r=Math.min(this.size,t);this.buffer.set(e.subarray(i,i+r),this.pointer),this.pointer+=r,this.pos+=BigInt(r),i+=r,t-=r}}else this.buffer.set(e,this.pointer),this.pointer+=t,this.pos+=BigInt(t)}writeString(e){const t=a.encode(e);return this.writeBuffer(t),t.length}encodeString(e){return a.encode(e)}flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const e=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==e)throw this.error=e,Error("IOWriter error, flush failed")}this.pointer=0}flushToPos(e){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const t=this.onFlush(this.buffer.subarray(0,this.pointer),e);if(0!==t)throw this.error=t,Error("IOWriter error, flush failed")}this.pointer=0}seek(e){if(!this.onSeek)throw this.error=-1048574,Error("IOWriter error, seek failed because of no seek callback");this.flush();const t=this.onSeek(e);if(0!==t)throw this.error=t,Error("IOWriter error, seek failed");this.pos=e}seekInline(e){const t=this.pointer;this.pointer=Math.max(0,Math.min(this.size,e)),this.pos+=BigInt(this.pointer-t)}skip(e){const t=this.pointer;this.pointer=Math.min(this.size,this.pointer+e),this.pos+=BigInt(this.pointer-t)}back(e){const t=this.pointer;this.pointer=Math.max(0,this.pointer-e),this.pos+=BigInt(this.pointer-t)}getBuffer(){return this.buffer.subarray(0,this.pointer)}setEndian(e){this.littleEndian=!e}reset(){this.pointer=0,this.pos=BigInt(0),this.error=0}getBufferSize(){return this.size}}}}]);
"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[808],{85947:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(134);class h{constructor(){(0,i.A)(this,"type",-1),(0,i.A)(this,"onStreamAdd",void 0)}destroy(t){}}},95808:(t,e,s)=>{s.r(e),s.d(e,{default:()=>m});var i=s(134),h=s(63939),r=s(50932),n=s(9705),a=s(85947),u=s(14686),o=s(37837),c=s(71517),d=s(95335),p=s(92647),l=s(55611),f=s(77231),b=s(37246),A=s(23991),g=s(37805);const y={framerate:{num:30,den:1}};class m extends a.A{constructor(t={}){super(),(0,i.A)(this,"type",10),(0,i.A)(this,"options",void 0),(0,i.A)(this,"currentDts",void 0),(0,i.A)(this,"currentPts",void 0),(0,i.A)(this,"step",void 0),(0,i.A)(this,"slices",void 0),(0,i.A)(this,"naluPos",void 0),(0,i.A)(this,"queue",void 0),(0,i.A)(this,"bitReader",void 0),(0,i.A)(this,"sliceType",void 0),(0,i.A)(this,"naluType",void 0),(0,i.A)(this,"poc",void 0),(0,i.A)(this,"pocTid0",void 0),(0,i.A)(this,"sps",void 0),(0,i.A)(this,"naluReader",void 0),this.options=d.X$({},y,t)}init(t){t.ioReader&&t.ioReader.setEndian(!1),this.slices=[],this.queue=[],this.bitReader=new b.A(500),this.naluReader=new g.A}destroy(t){if(this.queue.length){for(let t=0;t<this.queue.length;t++)(0,c.Qe)(this.queue[t].avpacket);this.queue.length=0}}isFrameNalu(t){return(t[1===t[2]?4:5]>>>3&31)<12}async readNaluFrame(t){let e=!1;const s=this.slices;for(this.slices=[],s.length&&(e=this.isFrameNalu(s[0]));;){const i=await this.naluReader.read(t.ioReader);if(!i)return s;const h=i[1===i[2]?4:5]>>>3&31;if(this.isFrameNalu(i))if(e){if(i[1===i[2]?5:6]>>>7)return this.slices.push(i),s;s.push(i)}else s.push(i),e=!0;else{if(e&&(20===h||19===h||15===h||14===h||16===h||12===h||13===h))return this.slices.push(i),s;s.push(i)}}}async readHeader(t){const e=t.createStream();for(e.codecpar.codecType=0,e.codecpar.codecId=196,e.timeBase.den=f.SF,e.timeBase.num=1,e.codecpar.bitFormat=2,this.currentDts=BigInt(0),this.currentPts=BigInt(0),this.naluPos=BigInt(0),this.poc=0,this.pocTid0=0,this.step=BigInt(Math.floor(f.SF/this.options.framerate.num*this.options.framerate.den));;){const s=await this.readNaluFrame(t);if(!s.length)return-1048576;const i=(0,p.A)(Uint8Array,s),n=(0,p.A)(Uint8Array,s.filter((t=>{const e=t[1===t[2]?4:5]>>>3&31;return 14===e||15===e||16===e})));if(n){e.codecpar.extradata=(0,o.sY)(n.length),(0,u.lW)(e.codecpar.extradata,n.length,n),e.codecpar.extradataSize=n.length;const a=s.find((t=>15==(t[1===t[2]?4:5]>>>3&31)));l.QA(e,a),this.sps=l.wf(a);const d=(0,c._5)(),p=(0,o.sY)(i.length);(0,u.lW)(p,i.length,i),(0,c.NX)(d,p,i.length),r.M[17](d+56,this.naluPos),this.naluPos+=BigInt(Math.floor(i.length)),r.M[17](d+16,this.currentDts),this.currentDts+=this.step,r.M[17](d+8,this.currentPts),this.currentPts+=this.step,r.M[15](d+32,e.index),r.M[15](d+36,1|h.f[15](d+36)),r.M[15](d+72,e.timeBase.num),r.M[15](d+76,e.timeBase.den),r.M[15](d+80,2),t.interval.packetBuffer.push(d);break}this.naluPos+=BigInt(Math.floor(i.length))}return 0}computePoc(t,e,s,i){this.bitReader.reset(),this.bitReader.appendBuffer(s.subarray(0,500)),i&&this.bitReader.readU1();const h=this.bitReader.readU1(),r=this.bitReader.readU1();let n=0;h&&(n=this.bitReader.readU1()),this.bitReader.readU1()&&this.bitReader.readU1(),A.xb(this.bitReader);const a=this.bitReader.readU(this.sps.sps_log2_max_pic_order_cnt_lsb_minus4+4);n&&A.xb(this.bitReader);for(let t=0;t<8*this.sps.sps_num_extra_ph_bytes;t++)this.sps.sps_extra_ph_bit_present_flag[t]&&this.bitReader.readU1();let u=0,o=0;this.sps.sps_poc_msb_cycle_flag&&(o=this.bitReader.readU1(),o&&(u=this.bitReader.readU(this.sps.sps_poc_msb_cycle_len_minus1+1)));const c=1<<this.sps.sps_log2_max_pic_order_cnt_lsb_minus4+4;let d=0;if(8===t||7===t)d=o?u*c:0;else{const t=this.pocTid0,e=t&c-1,s=t-e;d=o?u*c:a<e&&e-a>=c/2?s+c:a>e&&a-e>c/2?s-c:s}this.poc=d+a,0!=e||r||2===t||3===t||(this.pocTid0=this.poc)}async readAVPacket_(t,e){const s=t.getStreamByMediaType(0),i=await this.readNaluFrame(t);if(!i.length)return-1048576;this.sliceType=-1;let n=!1,a=!0;i.forEach((t=>{const e=1===t[2]?t[4]:t[5],s=e>>>3&31,i=(7&e)-1;15===s&&(this.sps=l.wf(t)),8!==s&&7!==s||(n=!0),19===s&&this.computePoc(s,i,t.subarray(1===t[2]?5:6),!1),s<14&&a&&(a=!1,this.naluType=s,t[1===t[2]?5:6]>>>7&&this.computePoc(s,i,t.subarray(1===t[2]?5:6),!0))}));const d=(0,p.A)(Uint8Array,i),f=(0,o.sY)(d.length);return(0,u.lW)(f,d.length,d),(0,c.NX)(e,f,d.length),r.M[17](e+56,this.naluPos),this.naluPos+=BigInt(Math.floor(d.length)),r.M[17](e+16,this.currentDts),this.currentDts+=this.step,r.M[15](e+32,s.index),r.M[15](e+72,s.timeBase.num),r.M[15](e+76,s.timeBase.den),r.M[15](e+80,2),n&&r.M[15](e+36,1|h.f[15](e+36)),0}async readAVPacket(t,e){let s=this.queue.length;const i=()=>{this.queue.length>1&&this.queue.sort(((t,e)=>t.poc-e.poc>0?1:-1));for(let t=0;t<this.queue.length;t++)r.M[17](this.queue[t].avpacket+8,this.currentPts),this.currentPts+=this.step;this.queue.length>1&&this.queue.sort(((t,e)=>h.f[17](t.avpacket+16)-h.f[17](e.avpacket+16)>BigInt(0)?1:-1)),this.queue.length&&((0,c.rN)(e,this.queue[0].avpacket),(0,c.Qe)(this.queue[0].avpacket));for(let e=1;e<this.queue.length;e++)t.interval.packetBuffer.push(this.queue[e].avpacket);this.queue.length=0};for(;;){const e=(0,c._5)();let r=await this.readAVPacket_(t,e);if(r<0)return(0,c.Qe)(e),this.queue.length?(i(),0):r;if(1&h.f[15](e+36)||9===this.naluType||1===this.sliceType||2===this.sliceType){if(1===s||(9===this.naluType||1&h.f[15](e+36))&&this.queue.length)return i(),this.queue.push({avpacket:e,poc:this.poc}),0;this.queue.push({avpacket:e,poc:this.poc}),s++}else this.queue.push({avpacket:e,poc:this.poc})}}async seek(t,e,s,i){return BigInt(n.E$)}getAnalyzeStreamsCount(){return 1}}},37805:(t,e,s)=>{s.d(e,{A:()=>n});var i=s(134),h=s(60264),r=s(92647);class n{constructor(){(0,i.A)(this,"buffer",void 0),(0,i.A)(this,"pos",void 0),(0,i.A)(this,"end",void 0),(0,i.A)(this,"ended",void 0),this.buffer=new Uint8Array(102400),this.pos=0,this.end=0,this.ended=!1}async read(t){if(this.ended&&this.pos>=this.end)return;const e=[];if(this.pos<this.end-4){let t=h.Ky(this.buffer.subarray(this.pos,this.end-4),3);if(t.offset>-1){const e=this.buffer.slice(this.pos,this.pos+t.offset);return this.pos+=t.offset,e}e.push(this.buffer.slice(this.pos,this.end-4)),this.buffer.copyWithin(0,this.end-4,this.end),this.pos=0,this.end=4}for(;;){if(!this.ended&&this.end<this.buffer.length)try{const e=await t.readToBuffer(this.buffer.length-this.end,this.buffer.subarray(this.end));this.end+=e}catch(t){if(this.ended=!0,this.pos>=this.end)return e.length?(0,r.A)(Uint8Array,e):null}let s=h.Ky(this.buffer.subarray(this.pos,this.end-4),e.length?0:3);if(s.offset>-1)return e.push(this.buffer.slice(this.pos,this.pos+s.offset)),this.pos+=s.offset,(0,r.A)(Uint8Array,e);if(this.ended)return e.push(this.buffer.slice(this.pos,this.end)),this.pos=this.end=0,(0,r.A)(Uint8Array,e);e.push(this.buffer.slice(this.pos,this.end-4)),this.buffer.copyWithin(0,this.end-4,this.end),this.pos=0,this.end=4}}reset(){this.pos=0,this.end=0,this.ended=!1}}}}]);
"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[47],{58469:(e,a,t)=>{t.d(a,{Bq:()=>p,Hm:()=>n,Ij:()=>f,XC:()=>l,_5:()=>c,f7:()=>m,uF:()=>s});var i=t(77231),r=t(37246);const s={1:"Main",2:"LC",3:"LC",4:"LC",5:"HE",6:"HE"},n={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,i.N_,i.N_,i.N_],d=[i.N_,1,2,3,4,5,6,7];function c(e){let a=i.N_,t=i.N_,r=i.N_;var s,n;return e.length>=2&&(a=e[0]>>3&31,t=null!==(s=o[(7&e[0])<<1|e[1]>>7])&&void 0!==s?s:48e3,r=null!==(n=d[e[1]>>3&15])&&void 0!==n?n:2),{profile:a,sampleRate:t,channels:r}}function l(e,a){if(!a&&e.sideData[1]&&(a=e.sideData[1]),a){const{profile:t,sampleRate:i,channels:r}=c(a);e.codecpar.profile=t,e.codecpar.sampleRate=i,e.codecpar.chLayout.nbChannels=r}}function f(e){const a=n[e.sampleRate],t=e.chLayout.nbChannels,i=new Uint8Array(2);return i[0]=(31&e.profile)<<3|(14&a)>>1,i[1]=(1&a)<<7|(15&t)<<3,i}function p(e){if(e.length<7)return-1;const a=e[0]<<4|e[1]>>4;if(4095!==a)return-1;const t=1&e[1],i=(192&e[2])>>>6,r=(60&e[2])>>>2,s=(1&e[2])<<2|(192&e[3])>>>6,n=(3&e[3])<<11|e[4]<<3|(224&e[5])>>>5,c=3&e[6];let l=1===t?7:9,f=n-l;return{syncWord:a,profile:i+1,sampleRate:o[r],channels:d[s],aacFrameLength:n,numberOfRawDataBlocksInFrame:c,headerLength:l,framePayloadLength:f}}function m(e,a){function t(){const e=a.readU(2);let t=0;for(let i=0;i<=e;i++)t<<=8,t|=a.readU(8);return t}a||(a=new r.A).appendBuffer(e);const i=a.getPointer(),s={syncWord:0,profile:0,sampleRate:0,channels:0,useSameStreamMux:!1,headerLength:0,framePayloadLength:0,muxLengthBytes:0},n=a.readU(11);if(695!==n)return-1;s.syncWord=n,s.muxLengthBytes=a.readU(13);const c=1===a.readU1();if(s.useSameStreamMux=c,!c){const e=1===a.readU1();if(e&&1===a.readU1())return-1;if(e&&t(),1!==a.readU1())return-1;if(0!==a.readU(6))return-1;if(0!==a.readU(4))return-1;if(0!==a.readU(3))return-1;let i=e?t():0;const r=a.readU(5);i-=5;const n=a.readU(4);i-=4;const c=a.readU(4);if(i-=4,a.readU(3),i-=3,i>0&&a.readU(i),0!==a.readU(3))return-1;if(a.readU(8),1===a.readU1())if(e)t();else{let e=0;for(;;){e<<=8;const t=1===a.readU1();if(e+=a.readU(8),!t)break}}1===a.readU1()&&a.readU(8),s.profile=r+1,s.sampleRate=o[n],s.channels=d[c]}let l=0;for(;;){const e=a.readU(8);if(l+=e,255!==e)break}return s.framePayloadLength=l,s.headerLength=a.getPointer()-i+(8===a.getBitLeft()?0:1),s}},87771:(e,a,t)=>{t.d(a,{R:()=>m,j:()=>r});var i=t(37246);const r=[3,4,3,7,259,263,1539,1543],s=[[64,69,96],[64,70,96],[80,87,120],[80,88,120],[96,104,144],[96,105,144],[112,121,168],[112,122,168],[128,139,192],[128,140,192],[160,174,240],[160,175,240],[192,208,288],[192,209,288],[224,243,336],[224,244,336],[256,278,384],[256,279,384],[320,348,480],[320,349,480],[384,417,576],[384,418,576],[448,487,672],[448,488,672],[512,557,768],[512,558,768],[640,696,960],[640,697,960],[768,835,1152],[768,836,1152],[896,975,1344],[896,976,1344],[1024,1114,1536],[1024,1115,1536],[1152,1253,1728],[1152,1254,1728],[1280,1393,1920],[1280,1394,1920]],n=[4,5,6,5],o=[4,6,7,6],d=[48e3,44100,32e3,0],c=[32,40,48,56,64,80,96,112,128,160,192,224,256,320,384,448,512,576,640],l=[2,1,2,3,3,4,4,5],f=[1,2,3,6],p=7;function m(e){const a=new i.A(e.length);a.appendBuffer(e);const t={syncWord:0,crc1:0,srCode:0,bitstreamId:0,bitstreamMode:0,channelMode:0,lfeOn:0,frameType:0,substreamId:0,centerMixLevel:0,surroundMixLevel:0,channelMap:0,numBlocks:0,dolbySurroundMode:0,srShift:0,sampleRate:0,bitrate:0,channels:0,frameSize:0,channelLayout:BigInt(0),ac3BitrateCode:0};if(t.syncWord=a.readU(16),2935!==t.syncWord)return-1;if(t.bitstreamId=31&a.peekU(29),t.bitstreamId>16)return-2;if(t.numBlocks=6,t.ac3BitrateCode=-1,t.centerMixLevel=5,t.surroundMixLevel=6,t.dolbySurroundMode=0,t.bitstreamId<=10){if(t.crc1=a.readU(16),t.srCode=a.readU(2),3===t.srCode)return-3;const e=a.readU(6);if(e>37)return-4;t.ac3BitrateCode=e>>1,a.readU(5),t.bitstreamMode=a.readU(3),t.channelMode=a.readU(3),2==t.channelMode?t.dolbySurroundMode=a.readU(2):(1&t.channelMode&&1!=t.channelMode&&(t.centerMixLevel=n[a.readU(2)]),4&t.channelMode&&(t.surroundMixLevel=o[a.readU(2)])),t.lfeOn=a.readU(1),t.srShift=Math.max(t.bitstreamId,8)-8,t.sampleRate=d[t.srCode]>>t.srShift,t.bitrate=1e3*c[t.ac3BitrateCode]>>t.srShift,t.channels=l[t.channelMode]+t.lfeOn,t.frameSize=2*s[e][t.srCode],t.frameType=2,t.substreamId=0}else{if(t.crc1=0,t.frameType=a.readU(2),3==t.frameType)return-5;if(t.substreamId=a.readU(3),t.frameSize=a.readU(11)+1<<1,t.frameSize<p)return-6;if(t.srCode=a.readU(2),3==t.srCode){const e=a.readU(2);if(3==e)return-7;t.sampleRate=d[e]/2,t.srShift=1}else t.numBlocks=f[a.readU(2)],t.sampleRate=d[t.srCode],t.srShift=0;t.channelMode=a.readU(3),t.lfeOn=a.readU(1),t.bitrate=8*t.frameSize*t.sampleRate/(256*t.numBlocks),t.channels=l[t.channelMode]+t.lfeOn}return t.channelLayout=BigInt(r[t.channelMode]),t.lfeOn&&(t.channelLayout|=BigInt(8)),t}},90412:(e,a,t)=>{t.d(a,{Ui:()=>m,XC:()=>p,Yj:()=>u,k9:()=>f,zk:()=>d});var i=t(63939),r=t(37246),s=t(11573),n=t(83314),o=t(97317);const d={0:"Main",1:"High",2:"Professional"},c=[{level:20,maxResolution:2359296},{level:21,maxResolution:4460544},{level:30,maxResolution:10653696},{level:31,maxResolution:17040384},{level:40,maxResolution:21233664},{level:41,maxResolution:21233664},{level:50,maxResolution:35651584},{level:51,maxResolution:35651584},{level:52,maxResolution:35651584},{level:53,maxResolution:35651584},{level:60,maxResolution:142606336},{level:61,maxResolution:142606336},{level:62,maxResolution:142606336},{level:63,maxResolution:142606336}],l=[20,21,22,23,30,31,32,33,40,41,42,43,50,51,52,53,60,61,62,63,70,71,72,73];function f(e,a,t){const i=e*a;for(const e of c)if(i<=e.maxResolution)return e.level}function p(e,a){if(!a&&e.sideData[1]&&(a=e.sideData[1]),a&&a.length>=4){const t=m(a);e.codecpar.profile=t.profile,e.codecpar.level=t.level}}function m(e){const a=new r.A(e.length);a.appendBuffer(e),a.readU1(),a.readU(7);const t=a.readU(3),i=a.readU(5),s=a.readU1();let n=a.readU1()?10:8;return a.readU1()&&(n=12),{profile:t,level:i,tier:s,bitDepth:n,monochrome:a.readU1(),chromaSubsamplingX:a.readU1(),chromaSubsamplingY:a.readU1(),chromaSamplePosition:a.readU(2)}}function u(e,a){const t=new n.A(4);t.writeU1(1),t.writeU(7,1);const d=function(e){const a=new r.A;a.appendBuffer(e);const t=[];for(;a.remainingLength();){const i=a.getPointer();a.readU1(),a.readU(4);const r=a.readU1(),n=a.readU1();a.readU1(),r&&a.readU(8);const o=n?s.v(a):e.length-1-r,d=a.getPointer()-i;t.push(e.subarray(i,i+d+o)),a.skip(8*o)}return t}(a).find((e=>1==(e[0]>>>3&15)));if(d){const e=function(e){const a=new r.A(e.length);a.appendBuffer(e),a.readU1(),a.readU(4);const t=a.readU1(),i=a.readU1();a.readU1(),t&&a.readU(8),i&&s.v(a);const n=s.f(a,3),o=(s.f(a,1),s.f(a,1));let d=0,c=0,f=[0],p=[0],m=[0],u=[0],w=[0],g=[0],h=0,z=[0],U=[0],v=[0];if(o)p[0]=s.f(a,5);else{d=s.f(a,1),d?(s.f(a,32),s.f(a,32),s.f(a,1)&&s.d(a),s.f(a,1)&&(h=s.f(a,5),s.f(a,32),s.f(a,5),s.f(a,5))):c=0;let e=s.f(a,1),t=s.f(a,5);for(let i=0;i<=t;i++){if(f[i]=s.f(a,12),p[i]=s.f(a,5),p[i]>7?m[i]=s.f(a,1):m[i]=0,c){if(u[i]=s.f(a,1),u[i]){let e=h+1;z[i]=s.f(a,e),U[i]=s.f(a,e),v[i]=s.f(a,1)}}else u[i]=0;e&&(w[i]=s.f(a,1),w[i]&&(g[i]=s.f(a,4)))}}let k=s.f(a,4),A=s.f(a,4),x=k+1,I=s.f(a,x);x=A+1;let b=s.f(a,x),P=0,y=0,R=0;P=o?0:s.f(a,1),P&&(s.f(a,4),s.f(a,3)),s.f(a,1),s.f(a,1),s.f(a,1);let B=0,M=0,S=0,D=0,C=0,N=0,$=2,F=2,T=0;o||(s.f(a,1),s.f(a,1),s.f(a,1),s.f(a,1),D=s.f(a,1),D?(C=s.f(a,1),N=s.f(a,1)):(C=0,N=0),$=s.f(a,1)?2:s.f(a,1),$>0?s.f(a,1)?2:s.f(a,1):2,D&&s.f(a,3)),s.f(a,1),s.f(a,1),s.f(a,1);let L=s.f(a,1),E=0,O=0,_=0;2==n&&L?(E=s.f(a,1),O=E?12:10):n<=2&&(O=L?10:8),_=1==n?0:s.f(a,1);let W=0,X=0,Y=0;s.f(a,1)?(W=s.f(a,8),X=s.f(a,8),Y=s.f(a,8)):(W=2,X=2,Y=2);let j=0,H=0,J=0,V=0,G=0;return _?(j=s.f(a,1),H=1,J=1,V=0,G=0):1==W&&13==X&&0==Y?(j=1,H=0,J=0,G=s.f(a,1)):(j=s.f(a,1),0==n?(H=1,J=1):1==n?(H=0,J=0):12==O?(H=s.f(a,1),J=H?s.f(a,1):0):(H=1,J=0),H&&J&&(V=s.f(a,2)),G=s.f(a,1)),s.f(a,1),{width:I+1,height:b+1,profile:n,level:l[p[0]],tier:m[0],bitDepth:O,monoChrome:_,colorRange:j,colorPrimaries:W,transferCharacteristics:X,matrixCoefficients:Y,subsamplingX:H,subsamplingY:J,chromaSamplePosition:V}}(d);t.writeU(3,e.profile),t.writeU(5,e.level),t.writeU(1,e.tier),t.writeU(1,e.bitDepth>8?1:0),t.writeU(1,12===e.bitDepth?1:0),t.writeU(1,e.monoChrome),t.writeU(1,e.subsamplingX),t.writeU(1,e.subsamplingY),t.writeU(1,e.chromaSamplePosition)}else{const a=o.g[i.f[15](e+28)];t.writeU(3,i.f[15](e+48)),t.writeU(5,i.f[15](e+52)),t.writeU(1,0),t.writeU(1,a.comp[0].depth>8?1:0),t.writeU(1,12===a.comp[0].depth?1:0),t.writeU(1,0),t.writeU(1,1),t.writeU(1,1),t.writeU(1,0)}return t.writeU(8,0),t.getBuffer()}},65451:(e,a,t)=>{t.d(a,{Ij:()=>c,XC:()=>d,kt:()=>o});var i=t(31865),r=t(729),s=t(44328);const n=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960];function o(e){let a=0,t=0,i=0;if(e.length<1)return 0;switch(a=e[0],t=n[a>>3],3&a){case 0:i=1;break;case 1:case 2:i=2;break;case 3:if(e.length<2)return 0;i=63&e[1]}return i*t}function d(e,a){if(!a&&e.sideData[1]&&(a=e.sideData[1]),a&&a.length>=19){const t=new i.A(a,!1);t.skip(9),e.codecpar.chLayout.nbChannels=t.readUint8(),e.codecpar.initialPadding=t.readUint16(),e.codecpar.sampleRate=t.readUint32(),e.codecpar.seekPreroll=Number((0,s.k)(BigInt(80),{den:1e3,num:1},{den:48e3,num:1}))}}function c(e){const a=new Uint8Array(19),t=new r.A(a,!1);return t.writeString("OpusHead"),t.writeUint8(1),t.writeUint8(e.chLayout.nbChannels),t.writeUint16(e.initialPadding),t.writeUint32(e.sampleRate),a}},58919:(e,a,t)=>{t.d(a,{Ui:()=>w,XC:()=>u,Yj:()=>g,k9:()=>m,wN:()=>f});var i=t(63939),r=t(9599),s=t(29170),n=t(37246),o=t(77231),d=t(97317),c=t(44328),l=t(729);const f={0:"Profile0",1:"Profile1",2:"Profile2",3:"Profile3"},p=[{level:10,maxResolution:196608,maxFrameRate:30},{level:11,maxResolution:196608,maxFrameRate:60},{level:20,maxResolution:518400,maxFrameRate:30},{level:21,maxResolution:518400,maxFrameRate:60},{level:30,maxResolution:2073600,maxFrameRate:30},{level:31,maxResolution:2073600,maxFrameRate:60},{level:40,maxResolution:3686400,maxFrameRate:30},{level:41,maxResolution:3686400,maxFrameRate:60},{level:50,maxResolution:8294400,maxFrameRate:30},{level:51,maxResolution:8294400,maxFrameRate:60},{level:60,maxResolution:8847360,maxFrameRate:30},{level:61,maxResolution:8847360,maxFrameRate:60},{level:70,maxResolution:35389440,maxFrameRate:30},{level:71,maxResolution:35389440,maxFrameRate:60}];function m(e,a,t){const i=e*a;for(const e of p)if(i<=e.maxResolution&&t<=e.maxFrameRate)return e.level}function u(e,a){if(!a&&e.sideData[1]&&(a=e.sideData[1]),a&&a.length>=6){const t=w(a);e.codecpar.profile=t.profile,e.codecpar.level=t.level}}function w(e){const a=new n.A(e.length);return a.appendBuffer(e),{profile:a.readU(8),level:a.readU(8),bitDepth:a.readU(4),chromaSubsampling:a.readU(3),fullRangeFlag:a.readU1(),colorPrimaries:a.readU(8),colorTrc:a.readU(8),colorSpace:a.readU(8)}}function g(e){const a=new l.A(new Uint8Array(8)),t=function(e){let a=i.f[15](e+48),t=i.f[15](e+52);t===o.N_&&(t=m(i.f[15](e+56),i.f[15](e+60),(0,c.lb)((0,s.A)(e+72,r.P))));const n=d.g[i.f[15](e+28)];let l=i.f[15](e+40),f=1;n&&(l=n.comp[0].depth,1===n.log2ChromaW&&1===n.log2ChromaH?1===i.f[15](e+100)&&(f=0):1===n.log2ChromaW&&0===n.log2ChromaH?f=2:0===n.log2ChromaW&&0===n.log2ChromaH&&(f=3));const p=2===i.f[15](e+84)?1:0;return a===o.N_&&l&&(a=0==f||1==f?8==l?0:2:8==l?1:3),{profile:a,level:t,bitDepth:l,chromaSubsampling:f,fullRange:p}}(e);return a.writeUint8(t.profile),a.writeUint8(t.level),a.writeUint8(t.bitDepth<<4|t.chromaSubsampling<<1|t.fullRange),a.writeUint8(i.f[15](e+88)),a.writeUint8(i.f[15](e+92)),a.writeUint8(i.f[15](e+96)),a.writeUint16(0),a.getWroteBuffer()}},85947:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(134);class r{constructor(){(0,i.A)(this,"type",-1),(0,i.A)(this,"onStreamAdd",void 0)}destroy(e){}}},92047:(e,a,t)=>{t.r(a),t.d(a,{default:()=>k});var i=t(134),r=t(63939),s=t(50932),n=t(4624),o=t(9705),d=t(65977),c=t(74963),l=t(85947),f=t(85428),p=t(9690),m=t(72739),u=t(14686),w=t(37837),g=t(71517),h=t(44328),z=t(77231),U=t(39381),v="src/avformat/formats/IMovFormat.ts";class k extends l.A{constructor(e={}){super(),(0,i.A)(this,"type",1),(0,i.A)(this,"context",void 0),(0,i.A)(this,"options",void 0),this.options=e,this.context=(0,p.A)()}init(e){e.ioReader&&e.ioReader.setEndian(!0)}async readHeader(e){try{const a=await e.ioReader.fileSize();let t=0,i=await e.ioReader.readUint32(),r=await e.ioReader.readUint32();r===(0,d.A)("ftyp")?await c.E6(e.ioReader,this.context,{type:r,size:i-8}):(!a||i<a)&&await e.ioReader.skip(i-8);let s=BigInt(0);for(;!this.context.foundMoov;){const t=e.ioReader.getPos();if(t===a)return n.z3("the file format is not mp4",v,100),o.LR;if(i=await e.ioReader.readUint32(),r=await e.ioReader.readUint32(),i<8||a&&t+BigInt(Math.floor(i))>a)return n.z3(`invalid box size ${i}`,v,108),o.LR;r===(0,d.A)("mdat")?(this.context.foundMdat||(s=t),this.context.foundMdat=!0,await e.ioReader.seek(t+BigInt(Math.floor(i)))):r===(0,d.A)("moov")?(await c.wB(e.ioReader,e,this.context,{size:i-8,type:r}),this.context.foundMoov=!0):await e.ioReader.seek(t+BigInt(Math.floor(i)))}if(!this.context.fragment&&!this.context.foundMdat){const a=await e.ioReader.peekUint64()>>BigInt(32);Number(a)===(0,d.A)("moof")&&(this.context.fragment=!0)}if(this.context.fragment&&1&e.ioReader.flags){const a=e.ioReader.getPos(),t=await e.ioReader.fileSize();if(t>BigInt(16)){await e.ioReader.seek(t-BigInt(12));let i=await e.ioReader.readUint32();if(i===(0,d.A)("mfro")){await e.ioReader.skip(4);const a=await e.ioReader.readUint32();await e.ioReader.seek(t-BigInt(Math.floor(a)));const r=await e.ioReader.readUint32();i=await e.ioReader.readUint32(),i===(0,d.A)("mfra")&&await c.t9(e.ioReader,e,this.context,{size:r-8,type:i})}await e.ioReader.seek(a)}}return!this.context.fragment&&this.context.foundMdat&&await e.ioReader.seek(s),t}catch(a){return n.z3(a.message,v,170),this.context.foundMoov||n.z3("moov not found",v,173),e.ioReader.error}}async readAVPacket_(e,a){const{sample:t,stream:i}=(0,f.G)(e,this.context);if(!t)return-1048576;{s.M[15](a+32,i.index),s.M[17](a+16,t.dts),s.M[17](a+8,t.pts),s.M[17](a+48,BigInt(Math.floor(t.duration))),s.M[15](a+36,r.f[15](a+36)|t.flags),s.M[17](a+56,t.pos),s.M[15](a+76,i.timeBase.den),s.M[15](a+72,i.timeBase.num),i.startTime===z.Dh&&(i.startTime=r.f[17](a+8)||r.f[17](a+16)),await e.ioReader.seek(r.f[17](a+56));const n=t.size,o=(0,w.sY)(n);if((0,g.NX)(a,o,n),await e.ioReader.readBuffer(n,(0,u.JW)(o,n)),27!==i.codecpar.codecId&&173!==i.codecpar.codecId&&196!==i.codecpar.codecId||s.M[15](a+80,1),94226===i.codecpar.codecId&&r.f[15](a+28)>=8){const e=U.Sg(r.f[20](a+24)+4)>>>0,t=r.f[15](a+28);if(e===(0,d.A)("vtte")&&8===t){const e=(0,w.Gy)(1);(0,g.NX)(a,e,1),s.M[15](a+28,1)}if(t>8&&(e===(0,d.A)("vtte")||e===(0,d.A)("vttc"))){let e=r.f[20](a+24)+8;const i=r.f[20](a+24)+t;for(;e<i;){const t=U.Sg(e);if(U.Sg(e+4)>>>0===(0,d.A)("payl")&&t>8){const i=(0,w.sY)(t-8);(0,u.Mr)(i,e+8,t-8),(0,g.NX)(a,i,t-8);break}e+=t}}}if(i.sideData[1]){const e=i.sideData[1].length,t=(0,w.sY)(e);(0,g.Ow)(a,1,t,e),(0,u.lW)(t,e,i.sideData[1]),delete i.sideData[1]}}return 0}async readAVPacket(e,a){try{if(this.context.fragment&&!this.context.currentFragment)for(;!this.context.currentFragment;){const a=e.ioReader.getPos(),t=await e.ioReader.readUint32(),i=await e.ioReader.readUint32();i===(0,d.A)("moof")?(this.context.currentFragment={pos:a,size:t,sequence:0,tracks:[],currentTrack:null},this.context.firstMoof||(this.context.firstMoof=a),await c.wZ(e.ioReader,e,this.context,{type:i,size:t-8})):i===(0,d.A)("moov")?await c.wB(e.ioReader,e,this.context,{size:t-8,type:i}):await e.ioReader.skip(t-8)}return await this.readAVPacket_(e,a)}catch(a){return-1048576!==e.ioReader.error?(n.z3(`read packet error, ${a}`,v,306),o.LR):e.ioReader.error}}async seek(e,a,t,i){const r=t,s=a.privData,n=()=>{this.context.currentFragment=null,e.streams.forEach((e=>{e.privData.samplesIndex.length=0}))};if(16&i&&this.context.fragment){const i=(0,h.k)(t,a.timeBase,z.i0);return await e.ioReader.seek(i,!0),n(),BigInt(0)}if(this.context.fragment){if(s.fragIndexes.length){let a=m.El(s.fragIndexes,(e=>e.time>r?-1:e.time===r?0:1));if(a>-1)return await e.ioReader.seek(s.fragIndexes[a].pos,!0),n(),BigInt(0)}return r===BigInt(0)&&this.context.firstMoof?(await e.ioReader.seek(this.context.firstMoof),n(),BigInt(0)):BigInt(o.E$)}let d=m.El(s.samplesIndex,(e=>e.pts>r?-1:e.pts===r?0:1));if(d>-1&&0===a.codecpar.codecType){let e=d;for(;e>=0;e--)if(1&s.samplesIndex[e].flags){d=e;break}e<0&&(d=-1)}return d>-1?(s.currentSample=d,s.sampleEnd=!1,m.__(e.streams,(e=>{if(e!==a){const t=e.privData;let i=!1,r=(0,h.k)(s.samplesIndex[s.currentSample].pts,a.timeBase,e.timeBase);m.__(t.samplesIndex,((e,a)=>{if(e.pts>=r)return t.currentSample=a,i=!0,!1})),i?t.sampleEnd=!1:(t.sampleEnd=!0,t.currentSample=t.samplesIndex.length)}})),BigInt(0)):BigInt(o.LR)}getAnalyzeStreamsCount(){return 0}}},21071:(e,a,t)=>{t.d(a,{_l:()=>i,gQ:()=>r});const i=["hmhd","nmhd","iods","xml ","url ","bxml","ipro","mere","stts","ctts","stss","stsz","stz2","stsc","stco","co64","stsd","dref","mvhd","tkhd","mdhd","hdlr"],r=["moov","trak","edts","mdia","minf","dinf","stbl","mvex","moof","traf","vttc","tref","iref","mfra","hnti","hinf","strd","sinf","rinf","schi","trgr","udta","iprp","ipco","strk","meco"]},61179:(e,a,t)=>{function i(e,a,t,i=0){const r=e.privData,s=t.trexs.find((e=>e.trackId===a.trackId));let n=a.baseDataOffset+BigInt(Math.floor(a.dataOffset));a.baseIsMoof&&(n+=t.currentFragment.pos);let o=a.baseMediaDecodeTime;const d=a.sampleSizes,c=a.sampleDurations,l=a.sampleFlags,f=a.sampleCompositionTimeOffset;if(!d.length)for(let e=0;e<a.sampleCount;e++)d.push(a.defaultSampleSize||s.size);if(!c.length)for(let e=0;e<a.sampleCount;e++)c.push(a.defaultSampleDuration||s.duration);if(!l.length)for(let e=0;e<a.sampleCount;e++)l.push(a.defaultSampleFlags||s.flags);if(!f.length)for(let e=0;e<a.sampleCount;e++)f.push(0);const p=[];for(let e=0;e<a.sampleCount;e++){const t={dts:o,pts:o+BigInt(Math.floor(f[e])),pos:n,size:d[e],duration:c[e],flags:0};o+=BigInt(Math.floor(t.duration)),n+=BigInt(Math.floor(t.size));let r=l[e];0===e&&a.firstSampleFlags&&(r=a.firstSampleFlags),16842752&r||(t.flags|=1),0===e&&d.length>1&&2&i&&(t.flags|=1),p.push(t)}r.samplesIndex=p}t.d(a,{p:()=>i})},98859:(e,a,t)=>{function i(e){const a=e.privData,t=a.chunkOffsets,i=a.sampleSizes,r=a.cttsSampleCounts,s=a.cttsSampleOffsets,n=a.stscFirstChunk,o=a.stscSamplesPerChunk,d=a.stssSampleNumbersMap,c=a.sttsSampleCounts,l=a.sttsSampleDeltas;if(!t.length)return;let f=0,p=0,m=0,u=0,w=0,g=0,h=BigInt(0),z=0,U=BigInt(0);const v=[];for(let a=0;a<t.length;a++)for(h=t[a],f<n.length-1&&n[f+1]===a+1&&f++,g=o[f];g>0;){const a={dts:U,pts:U,pos:h,size:i[z],duration:0,flags:0};(d&&d.has(z+1)||1===e.codecpar.codecType)&&(a.flags|=1),s&&(a.pts=a.dts+BigInt(Math.floor(s[u])),w++,w===r[u]&&(u++,w=0)),z&&(v[z-1].duration=Number(a.dts-v[z-1].dts)),h+=BigInt(Math.floor(a.size)),U+=BigInt(Math.floor(l[p])),m++,m===c[p]&&(p++,m=0),z++,v.push(a),g--}v.length>1&&(v[z-1].duration=v[z-2].duration),a.samplesIndex=v}t.d(a,{X:()=>i})},3384:(e,a,t)=>{function i(){return{trackId:0,baseDataOffset:BigInt(0),defaultSampleDuration:0,defaultSampleSize:0,defaultSampleFlags:0,baseMediaDecodeTime:BigInt(0),sampleCount:0,dataOffset:0,dataOffsetPos:BigInt(0),firstSampleFlags:0,sampleDurations:[],sampleSizes:[],sampleFlags:[],sampleCompositionTimeOffset:[],baseIsMoof:!1,ioWriter:null,buffers:[]}}t.d(a,{A:()=>i})},9690:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(77231);function r(){return{isom:!1,timescale:i.N_,duration:i.Dh,foundMoov:!1,foundMdat:!1,majorBrand:0,minorVersion:0,compatibleBrand:[],creationTime:BigInt(0),modificationTime:BigInt(0),rate:i.N_,volume:i.N_,matrix:null,nextTrackId:1,fragment:!1,trexs:[],currentFragment:null,boxsPositionInfo:[],holdMoovPos:BigInt(0),currentChunk:null}}},38106:(e,a,t)=>{t.d(a,{A:()=>r});var i=t(77231);function r(){return{chunkOffsets:null,cttsSampleCounts:null,cttsSampleOffsets:null,stscFirstChunk:null,stscSamplesPerChunk:null,stscSampleDescriptionIndex:null,stssSampleNumbersMap:null,stssSampleNumbers:null,sampleSizes:null,sttsSampleCounts:null,sttsSampleDeltas:null,timescale:0,duration:BigInt(0),trackId:i.N_,layer:0,alternateGroup:0,volume:0,matrix:null,width:0,height:0,audioCid:0,samplesPerFrame:0,bytesPerFrame:0,currentSample:0,sampleEnd:!1,samplesIndex:[],fragIndexes:[],lastPts:BigInt(0),lastDts:BigInt(0),startDts:BigInt(0),startCT:0,lastDuration:0,chunkCount:0,firstWrote:!1,lastStscCount:0,perStreamGrouping:!1,index:0,flags:0}}},85428:(e,a,t)=>{t.d(a,{G:()=>s});var i=t(77231),r=t(44328);function s(e,a){let t,s,n,o,d,c,l=BigInt(0);if(e.streams.forEach((e=>{const a=e.privData;if(!a.samplesIndex||!a.samplesIndex.length)return a.sampleEnd=!0,!0;a.sampleEnd||n&&!(a.samplesIndex[a.currentSample].pos<n.pos)||(n=a.samplesIndex[a.currentSample],o=e),a.sampleEnd||d&&!((0,r.k)(a.samplesIndex[a.currentSample].dts,e.timeBase,i.KR)<l)||(d=a.samplesIndex[a.currentSample],l=(0,r.k)(d.dts,e.timeBase,i.KR),c=e)})),n&&d){const a=(0,r.k)(n.dts,o.timeBase,i.KR),l=(0,r.k)(d.dts,c.timeBase,i.KR);Math.abs(Number(a-l))<1e6||2&e.ioReader.flags?(t=n,s=o):(t=d,s=c)}else n?(t=n,s=o):d&&(t=d,s=c);if(s&&(s.privData.currentSample++,s.privData.currentSample>=s.privData.samplesIndex.length&&(s.privData.sampleEnd=!0)),a.fragment){const t=!!e.streams.find((e=>!1===e.privData.sampleEnd));t||(a.currentFragment=null)}return{sample:t,stream:s}}},74963:(e,a,t)=>{t.d(a,{E6:()=>w,t9:()=>U,wB:()=>h,wZ:()=>z});var i=t(65977),r=t(21071),s=t(68361),n=t(4624),o=t(61179),d=t(98859),c=t(3384),l=t(38106),f=t(37837),p=t(14686),m=t(77231),u="src/avformat/formats/mov/imov.ts";async function w(e,a,t){const r=e.getPos()+BigInt(Math.floor(t.size));for(a.majorBrand=await e.readUint32(),a.minorVersion=await e.readUint32(),a.majorBrand===(0,i.A)("qt  ")&&(a.isom=!0);e.getPos()<r;)a.compatibleBrand.push(await e.readUint32())}async function g(e,a,t,o){const d=e.getPos()+BigInt(Math.floor(t.size));for(;e.getPos()<d;){const t=await e.readUint32(),d=await e.readUint32();if(t<8)return void n.z3(`invalid box size ${t}`,u,76);if(s.A[d])await s.A[d](e,a,{type:d,size:t-8},o);else if(d===(0,i.A)("mdia")){let n=!1,d=BigInt(0);const c=e.getPos()+BigInt(Math.floor(t-8));for(;e.getPos()<c;){const t=await e.readUint32(),c=await e.readUint32();c===(0,i.A)("hdlr")?(await s.A[c](e,a,{type:c,size:t-8},o),n=!0):c===(0,i.A)("minf")&&n?await g(e,a,{type:c,size:t-8},o):c!==(0,i.A)("minf")||n?s.A[c]?await s.A[c](e,a,{type:c,size:t-8},o):r.gQ.some((e=>(0,i.A)(e)===c))?await g(e,a,{type:c,size:t-8},o):await e.skip(t-8):(d=e.getPos()-BigInt(8),await e.skip(t-8))}if(d){const t=e.getPos();await e.seek(d);const i=await e.readUint32(),r=await e.readUint32();await g(e,a,{type:r,size:i-8},o),await e.seek(t)}}else r.gQ.some((e=>(0,i.A)(e)===d))?await g(e,a,{type:d,size:t-8},o):await e.skip(t-8)}}async function h(e,a,t,r){const o=e.getPos()+BigInt(Math.floor(r.size));for(;e.getPos()<o;){const r=await e.readUint32(),o=await e.readUint32();if(r<8)return void n.z3(`invalid box, type: ${o}, size ${r}`,u,209);if(s.A[o])await s.A[o](e,null,{type:o,size:r-8},t);else if(o===(0,i.A)("trak"))if(!t.foundMoov||t.fragment){const i=a.createStream();if(i.privData=(0,l.A)(),await g(e,i,{type:o,size:r-8},t),t.fragment){const e=i.privData,t=a.streams.find((a=>{const t=a.privData;if(a.index!==i.index&&t.trackId===e.trackId)return!0}));t?(i.sideData[1]&&(t.sideData[1]=i.sideData[1],t.codecpar.extradata&&(0,f.Eb)(t.codecpar.extradata),t.codecpar.extradataSize=t.sideData[1].length,t.codecpar.extradata=(0,f.sY)(t.codecpar.extradataSize),(0,p.lW)(t.codecpar.extradata,t.codecpar.extradataSize,t.sideData[1]),i.codecpar.width===m.N_&&e.width>0&&(t.codecpar.width=e.width),i.codecpar.width===m.N_&&e.height>0&&(t.codecpar.height=e.height)),a.removeStream(i),a.streamIndex--):(i.codecpar.width===m.N_&&e.width>0&&(i.codecpar.width=e.width),i.codecpar.width===m.N_&&e.height>0&&(i.codecpar.height=e.height))}else(0,d.X)(i)}else await e.skip(r-8);else o===(0,i.A)("mvex")?(t.fragment=!0,await g(e,null,{type:o,size:r-8},t)):await e.skip(r-8)}}async function z(e,a,t,r){const d=e.getPos()+BigInt(Math.floor(r.size));for(;e.getPos()<d;){const r=await e.readUint32(),d=await e.readUint32();if(r<8)return void n.z3(`invalid box, type: ${d}, size ${r}`,u,314);if(s.A[d])await s.A[d](e,null,{type:d,size:r-8},t);else if(d===(0,i.A)("traf")){const i=(0,c.A)();t.currentFragment.currentTrack=i,await g(e,null,{type:d,size:r-8},t),t.currentFragment.tracks.push(i),t.currentFragment.currentTrack=null;const s=a.streams.find((e=>e.privData.trackId===i.trackId));if(s){const e=s.privData;i.streamIndex=s.index,(0,o.p)(s,i,t,a.ioReader.flags),e.currentSample=0,e.sampleEnd=!1}}else await e.skip(r-8)}}async function U(e,a,t,r){const s=e.getPos()+BigInt(Math.floor(r.size));for(;e.getPos()<s;){const r=e.getPos(),s=await e.readUint32();if(await e.readUint32()===(0,i.A)("tfra")){const r=await e.readUint8();await e.skip(3);const s=await e.readUint32(),n=await e.readUint32(),o=await e.readUint32(),d=a.streams.find((e=>e.privData.trackId===s));if(d){const s=d.privData;let c,l;for(let a=0;a<o;a++){1===r?(c=await e.readUint64(),l=await e.readUint64()):(c=BigInt(Math.floor(await e.readUint32())),l=BigInt(Math.floor(await e.readUint32()))),s.fragIndexes.push({pos:l,time:c});for(let a=0;a<1+(n>>4&3);a++)await e.skip(1);for(let a=0;a<1+(n>>2&3);a++)await e.skip(1);for(let a=0;a<1+(3&n);a++)await e.skip(1)}if(s.fragIndexes.length){await e.seek(s.fragIndexes[s.fragIndexes.length-1].pos);const r=await e.readUint32(),n=await e.readUint32();if(n===(0,i.A)("moof")&&(t.currentFragment={pos:BigInt(0),size:r,sequence:0,tracks:[],currentTrack:null},await z(e,a,t,{size:r,type:n}),s.samplesIndex.length)){const e=s.samplesIndex[s.samplesIndex.length-1];d.duration=e.pts+BigInt(Math.floor(e.duration)),s.samplesIndex.length=0}}}}await e.seek(r+BigInt(Math.floor(s)),!1,!1)}t.currentFragment=null}},6660:(e,a,t)=>{t.d(a,{Q9:()=>s,f3:()=>n,uf:()=>o,zs:()=>r});var i=t(65977);const r={86018:64,86017:105,86076:173,86028:193,86021:221,12:32,27:33,173:35,196:51,167:177,0:0},s={32:12,33:27,35:173,51:196,177:167,64:86018,102:86018,103:86018,104:86018,105:86017,107:86017,173:86076,193:86028,221:86021,0:0},n={vide:0,soun:1,clcp:3,sbtl:3,subt:3,subp:3,text:3},o={[(0,i.A)("mp4a")]:86018,1836253269:86017,[(0,i.A)("Opus")]:86076,[(0,i.A)("fLaC")]:86028,[(0,i.A)("spex")]:86051,[(0,i.A)("SPXN")]:86051,[(0,i.A)("ac-3")]:86019,[(0,i.A)("sac3")]:86019,[i.A.mp4v]:12,[(0,i.A)("av01")]:225,[(0,i.A)("vp08")]:139,[(0,i.A)("vp09")]:167,[(0,i.A)("avc1")]:27,[(0,i.A)("hev1")]:173,[(0,i.A)("hvc1")]:173,[(0,i.A)("vvc1")]:196,[(0,i.A)("vvi1")]:196,[(0,i.A)("text")]:94213,[(0,i.A)("tx3g")]:94213}},38582:(e,a,t)=>{t.d(a,{A:()=>d});var i=t(4624),r=t(14686),s=t(37837),n=t(90412),o="src/avformat/formats/mov/parsing/av1c.ts";async function d(e,a,t,d){const c=e.getPos();if(a.codecpar.codecId=225,t.size<=0)return;const l=(0,s.sY)(t.size),f=await e.readBuffer(t.size,(0,r.JW)(l,t.size));d.foundMoov?(a.sideData[1]=f.slice(),(0,s.Eb)(l)):(a.codecpar.extradata=l,a.codecpar.extradataSize=t.size,a.sideData[1]=f.slice()),n.XC(a,a.sideData[1]);const p=t.size-Number(e.getPos()-c);p>0?await e.skip(p):p<0&&i.z3(`read avcc error, size: ${t.size}, read: ${t.size-p}`,o,67)}},73840:(e,a,t)=>{t.d(a,{A:()=>d});var i=t(37837),r=t(14686),s=t(4624),n=t(20620),o="src/avformat/formats/mov/parsing/avcc.ts";async function d(e,a,t,d){const c=e.getPos();if(a.codecpar.codecId=27,t.size<=0)return;const l=(0,i.sY)(t.size),f=await e.readBuffer(t.size,(0,r.JW)(l,t.size));d.foundMoov?(a.sideData[1]=f.slice(),(0,i.Eb)(l)):(a.codecpar.extradata=l,a.codecpar.extradataSize=t.size,a.sideData[1]=f.slice()),n.XC(a,a.sideData[1]);const p=t.size-Number(e.getPos()-c);p>0?await e.skip(p):p<0&&s.z3(`read avcc error, size: ${t.size}, read: ${t.size-p}`,o,67)}},37213:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(4624),r="src/avformat/formats/mov/parsing/co64.ts";async function s(e,a,t,s){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const d=[],c=await e.readUint32();if(0===o)for(let a=0;a<c;a++)d.push(await e.readUint64());a.privData.chunkOffsets=d;const l=t.size-Number(e.getPos()-n);l>0?await e.skip(l):l<0&&i.z3(`read co64 error, size: ${t.size}, read: ${t.size-l}`,r,56)}},12869:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(4624),r="src/avformat/formats/mov/parsing/colr.ts";async function s(e,a,t,s){const n=e.getPos();let o=await e.readString(4);if("nclx"===o||"nclc"===o||"prof"===o)if("prof"===o){const i=await e.readBuffer(t.size-4);a.sideData[28]=i}else{let t=await e.readUint16(),i=await e.readUint16(),r=await e.readUint16();if("nclx"===o){const t=await e.readUint8()>>7;a.codecpar.colorRange=t?2:1}t>=23&&(t=2),i>=19&&(i=2),r>=15&&(r=2),a.codecpar.colorPrimaries=t,a.codecpar.colorTrc=i,a.codecpar.colorSpace=r}else i.R8(`unsupported color_parameter_type: ${o}`,r,79);const d=t.size-Number(e.getPos()-n);d>0?await e.skip(d):d<0&&i.z3(`read vpcc error, size: ${t.size}, read: ${t.size-d}`,r,87)}},59299:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(4624),r="src/avformat/formats/mov/parsing/ctts.ts";async function s(e,a,t,s){const n=e.getPos(),o=a.privData;await e.skip(4);const d=[],c=[],l=await e.readUint32();for(let a=0;a<l;a++)d.push(await e.readUint32()),c.push(await e.readInt32());o.cttsSampleCounts=d,o.cttsSampleOffsets=c;const f=t.size-Number(e.getPos()-n);f>0?await e.skip(f):f<0&&i.z3(`read ctts error, size: ${t.size}, read: ${t.size-f}`,r,59)}},7320:(e,a,t)=>{t.d(a,{A:()=>f});var i=t(61499),r=t(63939),s=t(50932),n=t(4624),o=t(71517),d=t(87771),c=t(99991),l="src/avformat/formats/mov/parsing/dac3.ts";async function f(e,a,t,f){const p=e.getPos();if(a.codecpar.codecId=86019,t.size<=0)return;const m=(0,o.E4)(a.codecpar[i.o9]+20,a.codecpar[i.o9]+24,7,4),u=r.f[20](m),w=await e.readUint24(),g=w>>14&7,h=w>>11&7,z=w>>10&1;let U=d.j[h];z&&(U|=8),c.bl(a.codecpar[i.o9]+112),c.ML(a.codecpar[i.o9]+112,U),s.M[15](u,g);const v=t.size-Number(e.getPos()-p);v>0?await e.skip(v):v<0&&n.z3(`read avcc error, size: ${t.size}, read: ${t.size-v}`,l,77)}},36868:(e,a,t)=>{t.d(a,{A:()=>f});var i=t(61499),r=t(63939),s=t(50932),n=t(4624),o=t(71517),d=t(87771),c=t(99991),l="src/avformat/formats/mov/parsing/dec3.ts";async function f(e,a,t,f){const p=e.getPos();if(a.codecpar.codecId=86056,t.size<=0)return;const m=(0,o.E4)(a.codecpar[i.o9]+20,a.codecpar[i.o9]+24,7,4),u=r.f[20](m);await e.skip(2);const w=await e.readUint24(),g=w>>12&31,h=w>>9&7,z=w>>8&1;let U=d.j[h];z&&(U|=8),c.bl(a.codecpar[i.o9]+112),c.ML(a.codecpar[i.o9]+112,U),s.M[15](u,g),a.codecpar.chLayout.nbChannels>1&&7==g&&s.M[15](u,8);const v=t.size-Number(e.getPos()-p);v>0?await e.skip(v):v<0&&n.z3(`read avcc error, size: ${t.size}, read: ${t.size-v}`,l,82)}},86528:(e,a,t)=>{t.d(a,{A:()=>o});var i=t(4624),r=t(37837),s=t(14686),n="src/avformat/formats/mov/parsing/dfla.ts";async function o(e,a,t,o){const d=e.getPos();a.codecpar.codecId=86028,await e.skip(1),await e.skip(3);const c=await e.readUint8(),l=128&c,f=127&c,p=await e.readUint24();if(0===f&&34===p){const t=(0,r.sY)(p),i=await e.readBuffer(p,(0,s.JW)(t,p));o.foundMoov?(a.sideData[1]=i.slice(),(0,r.Eb)(t)):(a.codecpar.extradata=t,a.codecpar.extradataSize=p)}else i.z3("streaminfo must be first FLACMetadataBlock",n,67);l||i.R8("non streaminfo FLACMetadataBlock(s) ignored",n,71);const m=t.size-Number(e.getPos()-d);m>0?await e.skip(m):m<0&&i.z3(`read vpcc error, size: ${t.size}, read: ${t.size-m}`,n,79)}},41781:(e,a,t)=>{t.d(a,{A:()=>l});var i=t(4624),r=t(37837),s=t(14686),n=t(65451),o=t(31865),d=t(729),c="src/avformat/formats/mov/parsing/dops.ts";async function l(e,a,t,l){const f=e.getPos();a.codecpar.codecId=86076,await e.skip(1);const p=(0,r.sY)(t.size+8),m=(0,s.JW)(p,t.size+8),u=new o.A(m),w=new d.A(m,!1);w.writeString("OpusHead"),w.writeUint8(1),await e.readBuffer(t.size-1,(0,s.JW)(p+9,t.size-1)),u.seek(10),w.seek(10),w.writeUint16(u.readUint16()),w.writeUint32(u.readUint32()),w.writeUint16(u.readUint16()),l.foundMoov?(a.sideData[1]=m.slice(),(0,r.Eb)(p)):(a.codecpar.extradata=p,a.codecpar.extradataSize=m.length,n.XC(a,m.slice()));const g=t.size-Number(e.getPos()-f);g>0?await e.skip(g):g<0&&i.z3(`read dops error, size: ${t.size}, read: ${t.size-g}`,c,81)}},28412:(e,a,t)=>{t.d(a,{A:()=>f});var i=t(4624),r=t(6660),s=t(37837),n=t(14686),o=t(58469),d=t(65451),c="src/avformat/formats/mov/parsing/esds.ts";async function l(e){let a=0;for(let t=0;t<4;t++){const t=await e.readUint8();if(a=a<<7|127&t,!(128&t))break}return a}async function f(e,a,t,f){const p=e.getPos();await e.skip(4);let m=e.getPos()+BigInt(Math.floor(t.size-4));for(;e.getPos()<m;){let t=await e.readUint8(),p=await l(e);if(0!==p)if(3===t){let m=e.getPos()+BigInt(Math.floor(p));if(await e.skip(2),await e.skip(1),t=await e.readUint8(),p=await l(e),0===p){i.R8("esds invalid ES descriptor size 0, skip",c,85),await e.skip(Number(m-e.getPos()));continue}if(4===t)if(a.codecpar.codecId=r.Q9[await e.readUint8()],await e.skip(1),await e.skip(3),await e.skip(4),await e.skip(4),e.getPos()<m-BigInt(5))if(t=await e.readUint8(),p=await l(e),5===t){const t=(0,s.sY)(p),i=await e.readBuffer(p,(0,n.JW)(t,p));f.foundMoov?(a.sideData[1]=i.slice(),(0,s.Eb)(t)):(a.codecpar.extradata=t,a.codecpar.extradataSize=p,86018===a.codecpar.codecId?o.XC(a,i.slice()):86076===a.codecpar.codecId&&d.XC(a,i.slice()))}else await e.skip(Number(m-e.getPos()));else await e.skip(Number(m-e.getPos()));else await e.skip(Math.min(p,Number(m-e.getPos())))}else await e.skip(Math.min(p,Number(m-e.getPos())));else i.R8("esds invalid descriptor size 0, skip",c,68),await e.skip(Number(m-e.getPos()))}const u=t.size-Number(e.getPos()-p);u>0?await e.skip(u):u<0&&i.z3(`read vpcc error, size: ${t.size}, read: ${t.size-u}`,c,153)}},40179:(e,a,t)=>{t.d(a,{A:()=>o});var i=t(4624),r=t(34677),s=t(6660),n="src/avformat/formats/mov/parsing/hdlr.ts";async function o(e,a,t,o){const d=e.getPos(),c=await e.readUint8();if(await e.skip(3),0===c){await e.skip(4);const i=await e.readString(4),n=s.f3[i];(0,r.A)(n)&&(a.codecpar.codecType=n),await e.skip(4),await e.skip(4),await e.skip(4);const d=t.size-24;if(d>0){const t=!o.isom&&await e.peekUint8()===d-1;t&&await e.skip(1),a.metadata.handlerName=await e.readString(d-(t?1:0))}}const l=t.size-Number(e.getPos()-d);l>0?await e.skip(l):l<0&&i.z3(`read hdlr error, size: ${t.size}, read: ${t.size-l}`,n,77)}},31421:(e,a,t)=>{t.d(a,{A:()=>d});var i=t(37837),r=t(14686),s=t(4624),n=t(53e3),o="src/avformat/formats/mov/parsing/hvcc.ts";async function d(e,a,t,d){const c=e.getPos();if(a.codecpar.codecId=173,t.size<=0)return;const l=(0,i.sY)(t.size),f=await e.readBuffer(t.size,(0,r.JW)(l,t.size));d.foundMoov?(a.sideData[1]=f.slice(),(0,i.Eb)(l)):(a.codecpar.extradata=l,a.codecpar.extradataSize=t.size,a.sideData[1]=f.slice()),n.XC(a,a.sideData[1]);const p=t.size-Number(e.getPos()-c);p>0?await e.skip(p):p<0&&s.z3(`read hevc error, size: ${t.size}, read: ${t.size-p}`,o,67)}},45248:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(4624),r="src/avformat/formats/mov/parsing/mdhd.ts";async function s(e,a,t,s){const n=e.getPos(),o=await e.readUint8();await e.skip(3);let d=BigInt(0),c=BigInt(0),l=0,f=BigInt(0);1===o?(d=await e.readUint64(),c=await e.readUint64(),l=await e.readUint32(),f=await e.readUint64()):(d=BigInt(Math.floor(await e.readUint32())),c=BigInt(Math.floor(await e.readUint32())),l=await e.readUint32(),f=BigInt(Math.floor(await e.readUint32()))),a.duration=f,a.timeBase.den=l,a.timeBase.num=1,a.metadata.creationTime=d,a.metadata.modificationTime=c;const p=await e.readUint16(),m=[];m[0]=p>>10&31,m[1]=p>>5&31,m[2]=31&p;const u=String.fromCharCode(m[0]+96,m[1]+96,m[2]+96);a.metadata.language=p,a.metadata.languageString=u,await e.skip(2);const w=t.size-Number(e.getPos()-n);w>0?await e.skip(w):w<0&&i.z3(`read mdhd error, size: ${t.size}, read: ${t.size-w}`,r,83)}},7018:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(4624),r="src/avformat/formats/mov/parsing/mfhd.ts";async function s(e,a,t,s){const n=e.getPos();await e.readUint8(),await e.skip(3),s.currentFragment.sequence=await e.readUint32();const o=t.size-Number(e.getPos()-n);o>0?await e.skip(o):o<0&&i.z3(`read vpcc error, size: ${t.size}, read: ${t.size-o}`,r,49)}},19354:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(4624),r="src/avformat/formats/mov/parsing/mvhd.ts";async function s(e,a,t,s){const n=e.getPos(),o=await e.readUint8();await e.skip(3),1===o?(s.creationTime=await e.readUint64(),s.modificationTime=await e.readUint64(),s.timescale=await e.readUint32(),s.duration=await e.readUint64()):(s.creationTime=BigInt(Math.floor(await e.readUint32())),s.modificationTime=BigInt(Math.floor(await e.readUint32())),s.timescale=await e.readUint32(),s.duration=BigInt(Math.floor(await e.readUint32()))),s.rate=await e.readUint32(),s.volume=await e.readUint16()>>>8,await e.skip(10),s.matrix=new Uint32Array(9);for(let a=0;a<9;a++)s.matrix[a]=await e.readUint32();await e.skip(24),s.nextTrackId=await e.readUint32();const d=t.size-Number(e.getPos()-n);d>0?await e.skip(d):d<0&&i.z3(`read mvhd error, size: ${t.size}, read: ${t.size-d}`,r,70)}},68361:(e,a,t)=>{t.d(a,{A:()=>A});var i=t(91635),r=t(59299),s=t(63080),n=t(62831),o=t(6570),d=t(34136),c=t(15692),l=t(37213),f=t(45248),p=t(19354),m=t(27436),u=t(40179),w=t(35173),g=t(25778),h=t(7018),z=t(61807),U=t(67523),v=t(58996),k=t(65977);const A={[(0,k.A)("stts")]:i.A,[(0,k.A)("ctts")]:r.A,[(0,k.A)("stss")]:s.A,[(0,k.A)("stsz")]:n.A,[(0,k.A)("stz2")]:o.A,[(0,k.A)("stsc")]:d.A,[(0,k.A)("stco")]:c.A,[(0,k.A)("co64")]:l.A,[(0,k.A)("mdhd")]:f.A,[(0,k.A)("mvhd")]:p.A,[(0,k.A)("tkhd")]:m.A,[(0,k.A)("hdlr")]:u.A,[(0,k.A)("stsd")]:w.A,[(0,k.A)("trex")]:g.A,[(0,k.A)("mfhd")]:h.A,[(0,k.A)("tfhd")]:z.A,[(0,k.A)("tfdt")]:U.A,[(0,k.A)("trun")]:v.A}},15692:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(4624),r="src/avformat/formats/mov/parsing/stco.ts";async function s(e,a,t,s){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const d=[],c=await e.readUint32();if(0===o)for(let a=0;a<c;a++)d.push(BigInt(Math.floor(await e.readUint32())));a.privData.chunkOffsets=d;const l=t.size-Number(e.getPos()-n);l>0?await e.skip(l):l<0&&i.z3(`read stco error, size: ${t.size}, read: ${t.size-l}`,r,56)}},34136:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(4624),r="src/avformat/formats/mov/parsing/stsc.ts";async function s(e,a,t,s){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const d=a.privData,c=[],l=[],f=[],p=await e.readUint32();if(0===o)for(let a=0;a<p;a++)c.push(await e.readUint32()),l.push(await e.readUint32()),f.push(await e.readUint32());d.stscFirstChunk=c,d.stscSamplesPerChunk=l,d.stscSampleDescriptionIndex=f;const m=t.size-Number(e.getPos()-n);m>0?await e.skip(m):m<0&&i.z3(`read stsc error, size: ${t.size}, read: ${t.size-m}`,r,65)}},35173:(e,a,t)=>{t.d(a,{A:()=>U});var i=t(4624),r=t(65977),s=t(6660),n=t(73840),o=t(31421),d=t(60703),c=t(83561),l=t(38582),f=t(28412),p=t(28460),m=t(86528),u=t(41781),w=t(12869),g=t(7320),h=t(36868),z="src/avformat/formats/mov/parsing/stsd.ts";async function U(e,a,t,U){const v=e.getPos(),k=await e.readUint8();await e.skip(3);const A=a.privData,x=await e.readUint32();for(let t=0;t<x;t++){const t=await e.readUint32(),v=await e.readUint32(),x=e.getPos()+BigInt(Math.floor(t-8));if(s.uf[v]&&(a.codecpar.codecId=s.uf[v]),0===t){i.R8("stsd entry invalid box size 0, skip",z,73),await e.skip(Number(x-e.getPos()));break}if(t>=16?(await e.skip(6),await e.skip(2)):t<=7&&i.h2(`invalid size: ${t} in stsd`,z,86),0===a.codecpar.codecType){await e.skip(2),await e.skip(2),a.metadata.vendorId=await e.readString(4),await e.skip(4),await e.skip(4),a.codecpar.width=await e.readUint16(),a.codecpar.height=await e.readUint16(),await e.skip(4),await e.skip(4),await e.skip(4),await e.skip(2);let t=await e.readUint8();for(t>31&&(t=31),a.metadata.encoder=await e.readString(t),t<31&&await e.skip(31-t),await e.skip(2),await e.skip(2);e.getPos()<x;){const t=await e.readUint32(),s=await e.readUint32();0!==t?s===(0,r.A)("avcC")?await(0,n.A)(e,a,{type:s,size:t-8},U):s===(0,r.A)("hvcC")?await(0,o.A)(e,a,{type:s,size:t-8},U):s===(0,r.A)("vvcC")?await(0,d.A)(e,a,{type:s,size:t-8},U):s===(0,r.A)("av1C")?await(0,l.A)(e,a,{type:s,size:t-8},U):s===(0,r.A)("vpcC")?await(0,c.A)(e,a,{type:s,size:t-8},U):s===(0,r.A)("esds")?await(0,f.A)(e,a,{type:s,size:t-8},U):s===(0,r.A)("wave")?await(0,p.A)(e,a,{type:s,size:t-8},U):s===(0,r.A)("colr")?await(0,w.A)(e,a,{type:s,size:t-8},U):await e.skip(Math.min(t-8,Number(x-e.getPos()))):(i.R8("stsd video invalid box size 0, skip",z,135),await e.skip(Number(x-e.getPos())))}}else if(1===a.codecpar.codecType){const t=await e.readUint16();for(await e.skip(2),a.metadata.vendorId=await e.readString(4),a.codecpar.chLayout.nbChannels=await e.readUint16(),a.codecpar.bitsPerCodedSample=await e.readUint16(),A.audioCid=await e.readUint16(),await e.skip(2),a.codecpar.sampleRate=await e.readUint32()>>>16,(!U.isom||0===k&&t>0)&&(1===t?(A.samplesPerFrame=await e.readUint32(),await e.skip(4),A.bytesPerFrame=await e.readUint32(),await e.skip(4)):2===t&&(await e.skip(4),a.codecpar.sampleRate=Number(await e.readUint64()),a.codecpar.chLayout.nbChannels=await e.readUint32(),await e.skip(4),a.codecpar.bitsPerCodedSample=await e.readUint32(),await e.skip(4),A.bytesPerFrame=await e.readUint32(),A.samplesPerFrame=await e.readUint32()));e.getPos()<x;){const t=await e.readUint32(),s=await e.readUint32();0!==t?s===(0,r.A)("esds")?await(0,f.A)(e,a,{type:s,size:t-8},U):s===(0,r.A)("dfLa")?await(0,m.A)(e,a,{type:s,size:t-8},U):s===(0,r.A)("dOps")?await(0,u.A)(e,a,{type:s,size:t-8},U):s===(0,r.A)("wave")?await(0,p.A)(e,a,{type:s,size:t-8},U):s===(0,r.A)("dac3")?await(0,g.A)(e,a,{type:s,size:t-8},U):s===(0,r.A)("dec3")?await(0,h.A)(e,a,{type:s,size:t-8},U):await e.skip(Math.min(t-8,Number(x-e.getPos()))):(i.R8("stsd audio invalid box size 0, skip",z,282),await e.skip(Number(x-e.getPos())))}}else 3===a.codecpar.codecType?(v===(0,r.A)("stpp")?a.codecpar.codecId=94232:v===(0,r.A)("wvtt")?a.codecpar.codecId=94226:v===(0,r.A)("tx3g")||v===(0,r.A)("text")?a.codecpar.codecId=94213:v===(0,r.A)("c608")&&(a.codecpar.codecId=94218),await e.skip(Math.min(t-8,Number(x-e.getPos())))):await e.skip(Math.min(t-8,Number(x-e.getPos())))}const I=t.size-Number(e.getPos()-v);I>0?await e.skip(I):I<0&&i.z3(`read stsd error, size: ${t.size}, read: ${t.size-I}`,z,383)}},63080:(e,a,t)=>{t.d(a,{A:()=>o});var i=t(80662),r=t.n(i),s=t(4624),n="src/avformat/formats/mov/parsing/stss.ts";async function o(e,a,t,i){const o=e.getPos(),d=await e.readUint8();await e.skip(3);const c=new(r()),l=await e.readUint32();if(0===d)for(let a=0;a<l;a++)c.set(await e.readUint32(),!0);a.privData.stssSampleNumbersMap=c;const f=t.size-Number(e.getPos()-o);f>0?await e.skip(f):f<0&&s.z3(`read stss error, size: ${t.size}, read: ${t.size-f}`,n,57)}},62831:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(4624),r="src/avformat/formats/mov/parsing/stsz.ts";async function s(e,a,t,s){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const d=[];let c=0,l=0;if(0===o){c=await e.readUint32(),l=await e.readUint32();for(let a=0;a<l;a++)0===c?d.push(await e.readUint32()):d[a]=c}a.privData.sampleSizes=d;const f=t.size-Number(e.getPos()-n);f>0?await e.skip(f):f<0&&i.z3(`read stsz error, size: ${t.size}, read: ${t.size-f}`,r,65)}},91635:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(4624),r="src/avformat/formats/mov/parsing/stts.ts";async function s(e,a,t,s){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const d=a.privData,c=[],l=[],f=await e.readUint32();let p=1;if(0===o)for(let a=0;a<f;a++)c.push(await e.readUint32()),p=await e.readInt32(),p<0&&i.R8("File uses negative stts sample delta, using value 1 instead, sync may be lost!",r,53),l.push(p);d.sttsSampleCounts=c,d.sttsSampleDeltas=l;const m=t.size-Number(e.getPos()-n);m>0?await e.skip(m):m<0&&i.z3(`read stts error, size: ${t.size}, read: ${t.size-m}`,r,67)}},6570:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(4624),r="src/avformat/formats/mov/parsing/stz2.ts";async function s(e,a,t,s){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const d=[];let c=0,l=0;if(0===o)if(await e.skip(3),l=await e.readUint8(),c=await e.readUint32(),4===l)for(let a=0;a<c;a+=2){const t=await e.readUint8();d[a]=t>>4&15,d[a+1]=15&t}else if(8===l)for(let a=0;a<c;a++)d[a]=await e.readUint8();else if(16===l)for(let a=0;a<c;a++)d[a]=await e.readUint16();else i.z3("Error in length field in stz2 box",r,67);a.privData.sampleSizes=d;const f=t.size-Number(e.getPos()-n);f>0?await e.skip(f):f<0&&i.z3(`read stz2 error, size: ${t.size}, read: ${t.size-f}`,r,78)}},67523:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(4624),r="src/avformat/formats/mov/parsing/tfdt.ts";async function s(e,a,t,s){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const d=s.currentFragment.currentTrack;d&&(d.baseMediaDecodeTime=1===o?await e.readUint64():BigInt(Math.floor(await e.readUint32())));const c=t.size-Number(e.getPos()-n);c>0?await e.skip(c):c<0&&i.z3(`read vpcc error, size: ${t.size}, read: ${t.size-c}`,r,57)}},61807:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(4624),r="src/avformat/formats/mov/parsing/tfhd.ts";async function s(e,a,t,s){const n=e.getPos(),o=(await e.readUint8(),await e.readUint24()),d=await e.readUint32(),c=s.currentFragment.currentTrack;c.trackId=d,c&&(1&o&&(c.baseDataOffset=await e.readUint64()),2&o&&await e.skip(4),8&o&&(c.defaultSampleDuration=await e.readUint32()),16&o&&(c.defaultSampleSize=await e.readUint32()),32&o&&(c.defaultSampleFlags=await e.readUint32()),131072&o&&(c.baseIsMoof=!0));const l=t.size-Number(e.getPos()-n);l>0?await e.skip(l):l<0&&i.z3(`read vpcc error, size: ${t.size}, read: ${t.size-l}`,r,75)}},27436:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(4624),r="src/avformat/formats/mov/parsing/tkhd.ts";async function s(e,a,t,s){const n=a.privData,o=e.getPos(),d=await e.readUint8();n.flags=await e.readUint24(),1&n.flags&&(a.disposition|=1),1===d?(a.metadata.creationTime=await e.readUint64(),a.metadata.modificationTime=await e.readUint64(),n.trackId=await e.readUint32(),await e.skip(4),n.duration=await e.readUint64()):(a.metadata.creationTime=BigInt(Math.floor(await e.readUint32())),a.metadata.modificationTime=BigInt(Math.floor(await e.readUint32())),n.trackId=await e.readUint32(),await e.skip(4),n.duration=BigInt(Math.floor(await e.readUint32()))),await e.skip(8),n.layer=await e.readInt16(),n.alternateGroup=await e.readInt16(),n.volume=await e.readInt16()>>8,await e.skip(2),n.matrix=new Uint32Array(9);for(let a=0;a<9;a++)n.matrix[a]=await e.readUint32();n.width=await e.readUint32()>>16,n.height=await e.readUint32()>>16;const c=t.size-Number(e.getPos()-o);c>0?await e.skip(c):c<0&&i.z3(`read tkhd error, size: ${t.size}, read: ${t.size-c}`,r,82)}},25778:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(4624),r="src/avformat/formats/mov/parsing/trex.ts";async function s(e,a,t,s){const n=e.getPos();await e.readUint8(),await e.skip(3);const o=await e.readUint32();await e.skip(4);const d=await e.readUint32(),c=await e.readUint32(),l=await e.readUint32();s.trexs.push({trackId:o,duration:d,size:c,flags:l});const f=t.size-Number(e.getPos()-n);f>0?await e.skip(f):f<0&&i.z3(`read trex error, size: ${t.size}, read: ${t.size-f}`,r,61)}},58996:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(4624),r="src/avformat/formats/mov/parsing/trun.ts";async function s(e,a,t,s){const n=e.getPos(),o=await e.readUint8(),d=await e.readUint24(),c=s.currentFragment.currentTrack;if(c){c.sampleCount=await e.readUint32(),1&d&&(c.dataOffset=await e.readInt32()),4&d&&(c.firstSampleFlags=await e.readUint32());for(let a=0;a<c.sampleCount;a++)256&d&&c.sampleDurations.push(await e.readUint32()),512&d&&c.sampleSizes.push(await e.readUint32()),1024&d&&c.sampleFlags.push(await e.readUint32()),2048&d&&(0===o?c.sampleCompositionTimeOffset.push(await e.readUint32()):c.sampleCompositionTimeOffset.push(await e.readInt32()))}const l=t.size-Number(e.getPos()-n);l>0?await e.skip(l):l<0&&i.z3(`read vpcc error, size: ${t.size}, read: ${t.size-l}`,r,79)}},83561:(e,a,t)=>{t.d(a,{A:()=>d});var i=t(37837),r=t(14686),s=t(4624),n=t(58919),o="src/avformat/formats/mov/parsing/vpcc.ts";async function d(e,a,t,d){const c=e.getPos();if(await e.readUint8(),await e.skip(3),a.codecpar.codecId=167,t.size-4<=0)return;const l=(0,i.sY)(t.size-4),f=await e.readBuffer(t.size-4,(0,r.JW)(l,t.size-4));d.foundMoov?(a.sideData[1]=f.slice(),(0,i.Eb)(l)):(a.codecpar.extradata=l,a.codecpar.extradataSize=t.size-4,a.sideData[1]=f.slice()),n.XC(a,a.sideData[1]);const p=t.size-Number(e.getPos()-c);p>0?await e.skip(p):p<0&&s.z3(`read vpcc error, size: ${t.size}, read: ${t.size-p}`,o,71)}},60703:(e,a,t)=>{t.d(a,{A:()=>d});var i=t(37837),r=t(14686),s=t(4624),n=t(55611),o="src/avformat/formats/mov/parsing/vvcc.ts";async function d(e,a,t,d){const c=e.getPos();if(await e.readUint8(),await e.skip(3),a.codecpar.codecId=196,t.size-4<=0)return;const l=(0,i.sY)(t.size-4),f=await e.readBuffer(t.size-4,(0,r.JW)(l,t.size-4));d.foundMoov?(a.sideData[1]=f.slice(),(0,i.Eb)(l)):(a.codecpar.extradata=l,a.codecpar.extradataSize=t.size-4,a.sideData[1]=f.slice()),n.XC(a,a.sideData[1]);const p=t.size-Number(e.getPos()-c);p>0?await e.skip(p):p<0&&s.z3(`read vvcc error, size: ${t.size}, read: ${t.size-p}`,o,71)}},28460:(e,a,t)=>{t.d(a,{A:()=>o});var i=t(4624),r=t(65977),s=t(28412),n="src/avformat/formats/mov/parsing/wave.ts";async function o(e,a,t,o){const d=e.getPos(),c=d+BigInt(Math.floor(t.size));for(;e.getPos()<c;){const t=await e.readUint32(),d=await e.readUint32();0!==t?d===(0,r.A)("esds")?await(0,s.A)(e,a,{type:d,size:t-8},o):await e.skip(Math.min(t-8,Number(c-e.getPos()))):(i.R8("wave invalid box size 0, skip",n,47),await e.skip(Number(c-e.getPos())))}const l=t.size-Number(e.getPos()-d);l>0?await e.skip(l):l<0&&i.z3(`read vpcc error, size: ${t.size}, read: ${t.size-l}`,n,73)}},65977:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(4624),r="src/avformat/function/mktag.ts";function s(e){4!==e.length&&i.R8(`tag length is not 4, tag: ${e}`,r,30);let a=0;for(let t=0;t<4;t++)a=a<<8|e.charCodeAt(t);return a}},11573:(e,a,t)=>{function i(e,a){let t=0;for(let i=0;i<a;i++)t=2*t+e.readU1();return t}function r(e){let a=0;for(;!i(e,1);)a++;return a>=32?0:i(e,a)+(1<<a)-1}function s(e){let a=0,t=0;for(let r=0;r<8;r++){let s=i(e,8);if(a|=(127&s)<<7*r,t+=1,!(128&s))break}return a}t.d(a,{d:()=>r,f:()=>i,v:()=>s})}}]);
"use strict";(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[331],{64436:(t,e,i)=>{i.d(e,{A:()=>o});var r=i(134),n=i(63939),a=i(37837),s=i(71766);class o{constructor(){(0,r.A)(this,"inCodecpar",void 0),(0,r.A)(this,"inTimeBase",void 0),(0,r.A)(this,"outCodecpar",void 0)}init(t,e){return this.inCodecpar=(0,a.Gy)(168),(0,s.Yi)(this.inCodecpar,t),this.inTimeBase={den:n.f[15](e+4),num:n.f[15](e)},0}destroy(){this.inCodecpar&&((0,s.dn)(this.inCodecpar),this.inCodecpar=0)}}},50848:(t,e,i)=>{i.d(e,{A:()=>U});var r=i(134),n=i(63939),a=i(50932),s=i(77162),o=i(29170),c=i(64436),d=i(14686),h=i(4624),l=i(9705),f=i(77231),u=i(58469),p=i(44328),g=i(37837),b=i(71517);class U extends c.A{constructor(...t){super(...t),(0,r.A)(this,"streamMuxConfig",void 0),(0,r.A)(this,"caches",void 0)}init(t,e){return super.init(t,e),this.caches=[],this.streamMuxConfig={profile:f.N_,sampleRate:f.N_,channels:f.N_},0}sendAVPacket(t){let e=0,i=n.f[17](t+16)||n.f[17](t+8);const r=(0,d.s3)(n.f[20](t+24),n.f[15](t+28)).slice();for(;e<r.length;){const t=r[e]<<4|r[e+1]>>4;if(4095!==t)return h.z3(`found syncWord not 0xFFF, got: 0x${t.toString(16)}`,"src/avformat/bsf/aac/ADTS2RawFilter.ts",103),l.LR;const c=1&r[e+1],b=(192&r[e+2])>>>6,U=(60&r[e+2])>>>2,m=(1&r[e+2])<<2|(192&r[e+3])>>>6,w=(3&r[e+3])<<11|r[e+4]<<3|(224&r[e+5])>>>5,A=3&r[e+6];let x=1===c?7:9,y=w-x;const P={dts:i,buffer:null,extradata:null,duration:f.N_};P.buffer=r.subarray(e+x,e+x+y),this.streamMuxConfig.profile=b+1,this.streamMuxConfig.sampleRate=u.hY[U],this.streamMuxConfig.channels=u.En[m];const _=n.f[15](this.inCodecpar+48)!==this.streamMuxConfig.profile||n.f[15](this.inCodecpar+136)!==this.streamMuxConfig.sampleRate||n.f[15](this.inCodecpar+116)!==this.streamMuxConfig.channels,I=(0,p.k)(BigInt(Math.floor(1024*(A+1)/this.streamMuxConfig.sampleRate*f.SF)),f.KR,this.inTimeBase);if(P.duration=Number(I),_){a.M[15](this.inCodecpar+48,this.streamMuxConfig.profile),a.M[15](this.inCodecpar+136,this.streamMuxConfig.sampleRate),a.M[15](this.inCodecpar+116,this.streamMuxConfig.channels);const t=(0,u.Ij)((0,o.A)(this.inCodecpar,s.A));n.f[20](this.inCodecpar+12)&&(0,g.Eb)(n.f[20](this.inCodecpar+12)),a.M[20](this.inCodecpar+12,(0,g.sY)(t.length)),(0,d.lW)(n.f[20](this.inCodecpar+12),t.length,t),a.M[15](this.inCodecpar+16,t.length),P.extradata=t}this.caches.push(P),e+=w,i+=I}}receiveAVPacket(t){if(this.caches.length){(0,b.Up)(t);const e=this.caches.shift(),i=(0,g.sY)(e.buffer.length);if((0,d.lW)(i,e.buffer.length,e.buffer),(0,b.NX)(t,i,e.buffer.length),a.M[17](t+16,e.dts),a.M[17](t+8,e.dts),a.M[17](t+48,BigInt(Math.floor(e.duration))),a.M[15](t+36,1|n.f[15](t+36)),e.extradata){const i=(0,g.sY)(e.extradata.length);(0,d.lW)(i,e.extradata.length,e.extradata),(0,b.Ow)(t,1,i,e.extradata.length)}return 0}return l.LT}}},36488:(t,e,i)=>{i.d(e,{A:()=>w});var r=i(134),n=i(63939),a=i(50932),s=i(77162),o=i(29170),c=i(64436),d=i(14686),h=i(4624),l=i(9705),f=i(77231),u=i(58469),p=i(44328),g=i(37837),b=i(71517),U=i(37246),m="src/avformat/bsf/aac/LATM2RawFilter.ts";class w extends c.A{constructor(...t){super(...t),(0,r.A)(this,"bitReader",void 0),(0,r.A)(this,"streamMuxConfig",void 0),(0,r.A)(this,"caches",void 0),(0,r.A)(this,"refSampleDuration",void 0)}init(t,e){return super.init(t,e),this.caches=[],this.refSampleDuration=BigInt(0),this.bitReader=new U.A,this.streamMuxConfig={profile:f.N_,sampleRate:f.N_,channels:f.N_},0}getLATMValue(){const t=this.bitReader.readU(2);let e=0;for(let i=0;i<=t;i++)e<<=8,e|=this.bitReader.readU(8);return e}sendAVPacket(t){const e=(0,d.s3)(n.f[20](t+24),n.f[15](t+28));this.bitReader.clear(),this.bitReader.appendBuffer(e);let i=n.f[17](t+16)||n.f[17](t+8);for(;this.bitReader.remainingLength()>3;){const t=this.bitReader.readU(11);if(695!==t)return h.z3(`AACLATMParser found syncWord not 0x2B7, got: 0x${t.toString(16)}`,m,103),this.bitReader.clear(),l.LR;if(this.bitReader.readU(13)>this.bitReader.remainingLength())break;if(1!==this.bitReader.readU1()){const t=1===this.bitReader.readU1();if(t&&1===this.bitReader.readU1())return h.z3("audioMuxVersionA is Not Supported",m,119),this.bitReader.clear(),l.LR;if(t&&this.getLATMValue(),1!==this.bitReader.readU1())return h.z3("allStreamsSameTimeFraming zero is Not Supported",m,128),this.bitReader.clear(),l.LR;if(0!==this.bitReader.readU(6))return h.z3("more than 2 numSubFrames Not Supported",m,134),this.bitReader.clear(),l.LR;if(0!==this.bitReader.readU(4))return h.z3("more than 2 numProgram Not Supported",m,141),this.bitReader.clear(),l.LR;if(0!==this.bitReader.readU(3))return h.z3("more than 2 numLayer Not Supported'",m,148),this.bitReader.clear(),l.LR;let e=t?this.getLATMValue():0;const i=this.bitReader.readU(5);e-=5;const r=this.bitReader.readU(4);e-=4;const n=this.bitReader.readU(4);e-=4,this.bitReader.readU(3),e-=3,e>0&&this.bitReader.readU(e);const a=this.bitReader.readU(3);if(0!==a)return h.z3(`frameLengthType = ${a}, only frameLengthType = 0 supported`,m,176),this.bitReader.clear(),l.LR;if(this.bitReader.readU(8),1===this.bitReader.readU1())if(t)this.getLATMValue();else{let t=0;for(;;){t<<=8;const e=1===this.bitReader.readU1();if(t+=this.bitReader.readU(8),!e)break}}1===this.bitReader.readU1()&&this.bitReader.readU(8),this.streamMuxConfig.profile=i+1,this.streamMuxConfig.sampleRate=u.hY[r],this.streamMuxConfig.channels=u.En[n]}let e=0;for(;;){const t=this.bitReader.readU(8);if(e+=t,255!==t)break}const r=new Uint8Array(e);for(let t=0;t<e;t++)r[t]=this.bitReader.readU(8);const c={dts:i,buffer:r,extradata:null};if(n.f[15](this.inCodecpar+48)!==this.streamMuxConfig.profile||n.f[15](this.inCodecpar+136)!==this.streamMuxConfig.sampleRate||n.f[15](this.inCodecpar+116)!==this.streamMuxConfig.channels){this.refSampleDuration=(0,p.k)(BigInt(Math.floor(1024/this.streamMuxConfig.sampleRate*f.SF)),f.KR,this.inTimeBase),a.M[15](this.inCodecpar+48,this.streamMuxConfig.profile),a.M[15](this.inCodecpar+136,this.streamMuxConfig.sampleRate),a.M[15](this.inCodecpar+116,this.streamMuxConfig.channels);const t=(0,u.Ij)((0,o.A)(this.inCodecpar,s.A));n.f[20](this.inCodecpar+12)&&(0,g.Eb)(n.f[20](this.inCodecpar+12)),a.M[20](this.inCodecpar+12,(0,g.sY)(t.length)),(0,d.lW)(n.f[20](this.inCodecpar+12),t.length,t),a.M[15](this.inCodecpar+16,t.length),c.extradata=t}this.caches.push(c),i+=this.refSampleDuration,this.bitReader.skipPadding()}}receiveAVPacket(t){if(this.caches.length){(0,b.Up)(t);const e=this.caches.shift(),i=(0,g.sY)(e.buffer.length);if((0,d.lW)(i,e.buffer.length,e.buffer),(0,b.NX)(t,i,e.buffer.length),a.M[17](t+16,e.dts),a.M[17](t+8,e.dts),a.M[15](t+36,1|n.f[15](t+36)),e.extradata){const i=(0,g.sY)(e.extradata.length);(0,d.lW)(i,e.extradata.length,e.extradata),(0,b.Ow)(t,1,i,e.extradata.length)}return 0}return l.LT}}},61702:(t,e,i)=>{i.d(e,{A:()=>g});var r=i(134),n=i(63939),a=i(50932),s=i(64436),o=i(77231),c=i(44328),d=i(65451),h=i(4624),l=i(9705),f=i(71517),u=i(37837),p=i(14686);class g extends s.A{constructor(...t){super(...t),(0,r.A)(this,"caches",void 0)}init(t,e){return super.init(t,e),this.caches=[],0}sendAVPacket(t){let e=0,i=n.f[17](t+16)||n.f[17](t+8);const r=(0,f.iI)(t);for(;e<r.length;){const t=r[e]<<3|r[e+1]>>5;if(1023!==t)return h.z3(`MpegtsOpusParser found syncWord not 0x3ff, got: 0x${t.toString(16)}`,"src/avformat/bsf/opus/Mpegts2RawFilter.ts",67),l.LR;const a=!!(16&r[e+1]),s=!!(8&r[e+1]);let f=e+2,u=0;for(;255===r[f];)u+=255,f++;u+=r[f],f++,f+=a?2:0,f+=s?2:0;let p=r.subarray(f,f+u);const g=n.f[15](this.inCodecpar+136)>0?n.f[15](this.inCodecpar+136):48e3,b=(0,c.k)(BigInt(Math.floor(d.kt(p)/g*o.SF)),o.KR,this.inTimeBase);this.caches.push({dts:i,buffer:p.slice(),duration:Number(b)}),i+=b,e=f+u}}receiveAVPacket(t){if(this.caches.length){(0,f.Up)(t);const e=this.caches.shift(),i=(0,u.sY)(e.buffer.length);return(0,p.lW)(i,e.buffer.length,e.buffer),(0,f.NX)(t,i,e.buffer.length),a.M[17](t+16,e.dts),a.M[17](t+8,e.dts),a.M[15](t+36,1|n.f[15](t+36)),a.M[17](t+48,BigInt(Math.floor(e.duration))),0}return l.LR}}},58469:(t,e,i)=>{i.d(e,{En:()=>o,Ij:()=>d,XC:()=>c,hY:()=>s,uF:()=>n});var r=i(77231);const n={1:"Main",2:"LC",3:"LC",4:"LC",5:"HE",6:"HE"},a={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,r.N_,r.N_,r.N_],o=[r.N_,1,2,3,4,5,6,7];function c(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e){const{profile:i,sampleRate:n,channels:a}=function(t){let e=r.N_,i=r.N_,n=r.N_;var a,c;return t.length>=2&&(e=t[0]>>3&31,i=null!==(a=s[(7&t[0])<<1|t[1]>>7])&&void 0!==a?a:48e3,n=null!==(c=o[t[1]>>3&15])&&void 0!==c?c:2),{profile:e,sampleRate:i,channels:n}}(e);t.codecpar.profile=i,t.codecpar.sampleRate=n,t.codecpar.chLayout.nbChannels=a}}function d(t){const e=a[t.sampleRate],i=t.chLayout.nbChannels,r=new Uint8Array(2);return r[0]=(31&t.profile)<<3|(14&e)>>1,r[1]=(1&e)<<7|(15&i)<<3,r}},20620:(t,e,i)=>{i.d(e,{Jk:()=>P,KD:()=>M,MB:()=>w,S1:()=>x,XC:()=>I,ci:()=>_,oT:()=>y,tZ:()=>m,wf:()=>S});var r=i(63939),n=i(50932),a=i(72739),s=i(729),o=i(31865),c=i(37246),d=i(4624),h=i(14686),l=i(71517),f=i(60264),u=i(37837),p=i(23991),g=i(39381),b="src/avformat/codecs/h264.ts";const U=3,m={66:"Constrained Baseline",77:"Main",100:"High",110:"High10",122:"High422",244:"High444"};function w(t){const e=new o.A(t);e.skip(5);const i=[],r=[],n=[],a=31&e.readUint8();for(let t=0;t<a;t++){const t=e.readUint16();i.push(e.readBuffer(t))}const s=e.readUint8();for(let t=0;t<s;t++){const t=e.readUint16();r.push(e.readBuffer(t))}if(e.remainingSize()>4){e.skip(3);const t=e.readUint8();if(t>0)for(let i=0;i<t;i++){const t=e.readUint16();n.push(e.readBuffer(t))}}return{spss:i,ppss:r,spsExts:n}}function A(t,e,i=[]){t.length>32&&(d.R8(`h264 metadata's sps max length is 32, but get ${t.length}`,b,210),t=t.slice(0,32)),t.length>256&&(d.R8(`h264 metadata's pps max length is 256, but get ${t.length}`,b,214),t=t.slice(0,256));let r=7;r=t.reduce(((t,e)=>t+2+e.length),r),r=e.reduce(((t,e)=>t+2+e.length),r);const n=t[0],o=S(n);66!==o.profile&&77!==o.profile&&88!==o.profile&&(r+=4,i.length&&(r=i.reduce(((t,e)=>t+2+e.length),r)));const c=new Uint8Array(r),h=new s.A(c);return h.writeUint8(1),h.writeUint8(n[1]),h.writeUint8(n[2]),h.writeUint8(n[3]),h.writeUint8(252|U),h.writeUint8(224|31&t.length),a.__(t,(t=>{h.writeUint16(t.length),h.writeBuffer(t)})),h.writeUint8(e.length),a.__(e,(t=>{h.writeUint16(t.length),h.writeBuffer(t)})),66!==o.profile&&77!==o.profile&&88!==o.profile&&(h.writeUint8(252|o.chromaFormatIdc),h.writeUint8(248|o.bitDepthLumaMinus8),h.writeUint8(248|o.bitDepthChromaMinus8),i.length&&a.__(i,(t=>{h.writeUint16(t.length),h.writeBuffer(t)}))),c}function x(t){let e=(0,f.py)(t);if(e.length>1){const t=[],i=[],r=[];if(e.forEach((e=>{const n=31&e[0];7===n?t.push(e):8===n?i.push(e):13===n&&r.push(e)})),t.length&&i.length)return A(t,i,r)}}function y(t){let e,i=(0,f.py)(t),r=!1;if(i.length>1){const t=[],r=[],n=[];i.forEach((e=>{const i=31&e[0];7===i?t.push(e):8===i?r.push(e):13===i&&n.push(e)})),t.length&&r.length&&(e=A(t,r,n)),i=i.filter((t=>{const e=31&t[0];return 9!==e&&8!==e&&7!==e&&13!==e}))}const n=i.reduce(((t,e)=>t+U+1+e.length),0),o=(0,u.sY)(n),c=(0,h.s3)(o,n),d=new s.A(c);return a.__(i,(t=>{3===U?d.writeUint32(t.length):2===U?d.writeUint24(t.length):1===U?d.writeUint16(t.length):d.writeUint8(t.length),d.writeBuffer(t.subarray(0)),5==(31&t[0])&&(r=!0)})),{bufferPointer:o,length:n,key:r,extradata:e}}function P(t,e){var i;if(!(1&r.f[15](t+36)))return;const n=(0,l.iI)(t);if((0,f.Bs)(n))return;const a=null!==(i=e.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:U;let s=[],c=[],d=[],p=[];const g=new o.A(n);for(;g.remainingSize()>0;){let t=0;t=3===a?g.readUint32():2===a?g.readUint24():1===a?g.readUint16():g.readUint8();const e=n.subarray(0|Number(0xffffffffn&g.getPos()),(0|Number(0xffffffffn&g.getPos()))+t);g.skip(t);const i=31&e[0];7===i?s.push(e):8===i?c.push(e):13===i?d.push(e):p.push(e)}if(s.length||c.length){const e=A(s,c,d),i=(0,u.sY)(e.length);(0,h.lW)(i,e.length,e),(0,l.Ow)(t,1,i,e.length)}}function _(t,e=!1){if(!(1&r.f[15](t+36)||e))return;const i=(0,l.iI)(t);if(!(0,f.Bs)(i))return;let a=(0,f.py)(i);if(a.length>1){const e=[],i=[],s=[];if(a.forEach((t=>{const r=31&t[0];7===r?e.push(t):8===r?i.push(t):13===r&&s.push(t)})),e.length&&i.length){const a=A(e,i,s),o=(0,u.sY)(a.length);(0,h.lW)(o,a.length,a),(0,l.Ow)(t,1,o,a.length),n.M[15](t+36,1|r.f[15](t+36))}}}function I(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=6){t.metadata.naluLengthSizeMinusOne=3&e[4];const{spss:i}=w(e);if(i.length){const{profile:e,level:r,width:n,height:a}=S(i[0]);t.codecpar.profile=e,t.codecpar.level=r,t.codecpar.width=n,t.codecpar.height=a}}}function M(t,e=4){if(!(1&r.f[15](t+36)))return!1;if(2===r.f[15](t+80))return(0,f.py)((0,h.s3)(r.f[20](t+24),r.f[15](t+28))).some((t=>5==(31&t[0])));{const i=r.f[15](t+28);let n=0;for(;n<i-e;){if(5==(31&g.r8(r.f[20](t+24)+(n+e))))return!0;n+=4===e?g.Sg(r.f[20](t+24)+n):3===e?g.ht(r.f[20](t+24)+n):2===e?g.yd(r.f[20](t+24)+n):g.r8(r.f[20](t+24)+n),n+=e}return!1}}function S(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);const i=(0,f.BN)(t.subarray(e)),r=new c.A(i.length);r.appendBuffer(i),r.readU1(),r.readU(2),r.readU(5);const n=r.readU(8);r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU1(),r.readU(2);const a=r.readU(8);p.xb(r);let s=1,o=0,d=0;if((100==n||110==n||122==n||244==n||44==n||83==n||86==n||118==n||128==n||138==n||139==n||134==n||135==n)&&(s=p.xb(r),3===s&&r.readU1(),o=p.xb(r),d=p.xb(r),r.readU1(),r.readU1())){const t=new Array(8);for(let e=0;e<(3!=s?8:12);e++)t[e]=r.readU1()}const h=p.xb(r),l=p.xb(r);let u=0,g=0;if(0===l)u=p.xb(r);else if(1===l){g=r.readU1(),p.$x(r),p.$x(r);const t=p.xb(r);for(let e=0;e<t;e++)p.$x(r)}p.xb(r),r.readU1();const b=p.xb(r),U=p.xb(r),m=r.readU1();let w=16*(b+1),A=(2-m)*(U+1)*16;m||r.readU1(),r.readU1();const x=r.readU1();if(x){let t=1,e=2-x;1===s?(t=2,e=2*(2-x)):2===x&&(t=2,e=2-x),w-=t*(p.xb(r)+p.xb(r)),A-=e*(p.xb(r)+p.xb(r))}return{profile:n,level:a,width:w,height:A,chromaFormatIdc:s,bitDepthLumaMinus8:o,bitDepthChromaMinus8:d,frameMbsOnlyFlag:m,picOrderCntType:l,log2MaxPicOrderCntLsbMinus4:u,deltaPicOrderAlwaysZeroFlag:g,log2MaxFrameNumMinus4:h}}},53e3:(t,e,i)=>{i.d(e,{HL:()=>U,Jk:()=>x,KD:()=>_,S1:()=>w,XC:()=>P,ZU:()=>M,ci:()=>y,dT:()=>g,oT:()=>A,wf:()=>I});var r=i(63939),n=i(50932),a=i(72739),s=i(729),o=i(31865),c=i(37246),d=i(14686),h=i(60264),l=i(71517),f=i(37837),u=i(23991),p=i(39381);const g={1:"Main",2:"Main10",3:"MainStillPicture",4:"Main444"},b=3;function U(t){const e=new o.A(t,!0);e.skip(22);let i=[],r=[],n=[];const a=e.readUint8();for(let t=0;t<a;t++){const t=63&e.readUint8(),a=e.readUint16(),s=[];for(let t=0;t<a;t++){const t=e.readUint16();s.push(e.readBuffer(t))}32===t?i=s:33===t?r=s:34===t&&(n=s)}return{vpss:i,spss:r,ppss:n}}function m(t,e,i){const r=e[0];let n=23;t.length&&(n+=3,n=t.reduce(((t,e)=>t+2+e.length),n)),e.length&&(n+=3,n=e.reduce(((t,e)=>t+2+e.length),n)),i.length&&(n+=3,n=i.reduce(((t,e)=>t+2+e.length),n));const o=new Uint8Array(n),c=new s.A(o,!0),d=I(r);c.writeUint8(1),c.writeUint8(r[1]),c.writeUint8(r[2]),c.writeUint8(r[3]),c.writeUint8(r[4]),c.writeUint8(r[5]),c.writeUint8(r[6]),c.writeUint8(r[7]),c.writeUint8(r[8]),c.writeUint8(r[9]),c.writeUint8(r[10]),c.writeUint8(r[11]),c.writeUint8(d.level),c.writeUint8(1020),c.writeUint8(0),c.writeUint8(16320),c.writeUint8(16320|d.chroma_format_idc),c.writeUint8(8160|d.bit_depth_luma_minus8),c.writeUint8(8160|d.bit_depth_chroma_minus8),c.writeUint16(0),c.writeUint8(8|(1&r[0])<<2|b);let h=0;return t.length&&h++,e.length&&h++,i.length&&h++,c.writeUint8(h),t.length&&(c.writeUint8(160),c.writeUint16(t.length),a.__(t,(t=>{c.writeUint16(t.length),c.writeBuffer(t)}))),e.length&&(c.writeUint8(161),c.writeUint16(e.length),a.__(e,(t=>{c.writeUint16(t.length),c.writeBuffer(t)}))),i.length&&(c.writeUint8(162),c.writeUint16(i.length),a.__(i,(t=>{c.writeUint16(t.length),c.writeBuffer(t)}))),o}function w(t){let e=(0,h.py)(t);if(e.length>=2){const t=[],i=[],r=[];if(e.forEach((e=>{const n=e[0]>>>1&63;32===n?t.push(e):33===n?i.push(e):34===n&&r.push(e)})),i.length&&r.length)return m(t,i,r)}}function A(t){let e,i=!1,r=(0,h.py)(t);if(r.length>=2){const t=[],i=[],n=[];r.forEach((e=>{const r=e[0]>>>1&63;32===r?t.push(e):33===r?i.push(e):34===r&&n.push(e)})),i.length&&n.length&&(e=m(t,i,n),r=r.filter((t=>{const e=t[0]>>>1&63;return 32!==e&&33!==e&&34!==e&&35!==e})))}const n=r.reduce(((t,e)=>t+b+1+e.length),0),o=(0,f.sY)(n),c=(0,d.s3)(o,n),l=new s.A(c);return a.__(r,(t=>{3===b?l.writeUint32(t.length):2===b?l.writeUint24(t.length):1===b?l.writeUint16(t.length):l.writeUint8(t.length),l.writeBuffer(t.subarray(0));const e=t[0]>>>1&63;19!==e&&20!==e&&21!==e||(i=!0)})),{bufferPointer:o,length:n,extradata:e,key:i}}function x(t,e){var i;if(!(1&r.f[15](t+36)))return;const n=(0,l.iI)(t);if((0,h.Bs)(n))return;const a=null!==(i=e.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:b;let s=[],c=[],u=[];const p=new o.A(n);for(;p.remainingSize()>0;){let t=0;t=3===a?p.readUint32():2===a?p.readUint24():1===a?p.readUint16():p.readUint8();const e=n.subarray(0|Number(0xffffffffn&p.getPos()),(0|Number(0xffffffffn&p.getPos()))+t);p.skip(t);const i=e[0]>>>1&63;33===i?c.push(e):34===i?u.push(e):32===i&&s.push(e)}if(c.length||u.length||s.length){const e=m(s,c,u),i=(0,f.sY)(e.length);(0,d.lW)(i,e.length,e),(0,l.Ow)(t,1,i,e.length)}}function y(t,e=!1){if(!(1&r.f[15](t+36)||e))return;const i=(0,l.iI)(t);if(!(0,h.Bs)(i))return;let a=(0,h.py)(i);if(a.length>2){const e=[],i=[],s=[];if(a.forEach((t=>{const r=t[0]>>>1&63;32===r?e.push(t):33===r?i.push(t):34===r&&s.push(t)})),e.length&&i.length&&s.length){const a=m(e,i,s),o=(0,f.sY)(a.length);(0,d.lW)(o,a.length,a),(0,l.Ow)(t,1,o,a.length),n.M[15](t+36,1|r.f[15](t+36))}}}function P(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=6){t.metadata.naluLengthSizeMinusOne=3&e[21];const{spss:i}=U(e);if(i.length){const{profile:e,level:r,width:n,height:a}=I(i[0]);t.codecpar.profile=e,t.codecpar.level=r,t.codecpar.width=n,t.codecpar.height=a}}}function _(t,e=4){if(!(1&r.f[15](t+36)))return!1;if(2===r.f[15](t+80))return(0,h.py)((0,d.s3)(r.f[20](t+24),r.f[15](t+28))).some((t=>{const e=t[0]>>>1&63;return 20===e||19===e}));{const i=r.f[15](t+28);let n=0;for(;n<i-e;){const i=p.r8(r.f[20](t+24)+(n+e))>>>1&63;if(20===i||19===i)return!0;n+=4===e?p.Sg(r.f[20](t+24)+n):3===e?p.ht(r.f[20](t+24)+n):2===e?p.yd(r.f[20](t+24)+n):p.r8(r.f[20](t+24)+n),n+=e}return!1}}function I(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);let i=0,r=0,n=0,a=0,s=0,o=0,d=1,l=0,f=0,p=0,g=0;const b=(0,h.BN)(t.subarray(e)),U=new c.A(b.length);U.appendBuffer(b),U.readU1(),U.readU(6),U.readU(6),U.readU(3),U.readU(4);const m=U.readU(3);U.readU1();let w=0;if(m<=6){l=U.readU(2),f=U.readU1(),i=U.readU(5),p=U.readU(32),g=U.readU(48),r=U.readU(8);const t=new Array(6),e=new Array(6);for(let i=0;i<m;i++)t[i]=U.readU1(),e[i]=U.readU1();if(m>0)for(let t=m;t<8;t++)U.readU(2);for(let i=0;i<m;i++)t[i]&&(U.readU(2),U.readU(1),U.readU(5),U.readU(32),U.readU(1),U.readU(1),U.readU(1),U.readU(1),U.readU(44)),e[i]&&U.readU(8);u.xb(U),d=u.xb(U),3===d&&(w=U.readU(1)),n=u.xb(U),a=u.xb(U);let c=0,h=0,b=0,A=0;U.readU1()&&(c=u.xb(U),h=u.xb(U),b=u.xb(U),A=u.xb(U)),s=u.xb(U),o=u.xb(U);let x=2,y=2;0===d?x=y=0:2===d?(x=2,y=1):3===d&&(x=y=1),n-=x*(1<<s+1)*(c+h),a-=y*(1<<s+1)*(b+A)}const A=u.xb(U)+4;for(let t=U.readU1()?0:m;t<m+1;t++)u.xb(U),u.xb(U),u.xb(U);const x=u.xb(U)+3,y=u.xb(U),P=u.xb(U)+2,_=u.xb(U),I=x+y,M=x-1,S=n+(1<<I)-1>>I,v=a+(1<<I)-1>>I;return{profile:i,level:r,width:n,height:a,chroma_format_idc:d,bit_depth_luma_minus8:s,bit_depth_chroma_minus8:o,general_profile_space:l,general_tier_flag:f,general_profile_compatibility_flags:p,constraint_flags:g,separate_colour_plane_flag:w,log2_min_cb_size:x,log2_diff_max_min_coding_block_size:y,log2_min_tb_size:P,log2_diff_max_min_transform_block_size:_,log2_max_trafo_size:_+P,log2_ctb_size:I,log2_min_pu_size:M,ctb_width:S,ctb_height:v,ctb_size:S*v,min_cb_width:n>>x,min_cb_height:a>>x,min_tb_width:n>>P,min_tb_height:a>>P,min_pu_width:n>>M,min_pu_height:a>>M,log2_max_poc_lsb:A}}function M(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);const i=(0,h.BN)(t.subarray(e)),r=new c.A(i.length);return r.appendBuffer(i),{pps_pic_parameter_set_id:u.xb(r),pps_seq_parameter_set_id:u.xb(r),dependent_slice_segment_flag:r.readU1(),output_flag_present_flag:r.readU1(),num_extra_slice_header_bits:r.readU(3)}}},89088:(t,e,i)=>{i.d(e,{Au:()=>m,He:()=>w,XC:()=>A,Y2:()=>g,hG:()=>b,oz:()=>U});var r=i(77231);const n=[44100,48e3,32e3,0],a=[22050,24e3,16e3,0],s=[11025,12e3,8e3,0],o=[0,1152,1152,384],c=[0,576,1152,384],d=[0,576,1152,384],h=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],l=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],f=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],u=[0,32,48,56,64,80,96,112,128,144,160,176,192,224,256,-1],p=[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1];function g(t,e){switch(t){case 0:return s[e];case 2:return a[e];case 3:return n[e]}return r.N_}function b(t,e){switch(t){case 0:return d[e];case 2:return c[e];case 3:return o[e]}return r.N_}function U(t,e,i){switch(e){case 1:switch(t){case 0:case 2:return p[i];case 3:return f[i]}break;case 2:switch(t){case 0:case 2:return p[i];case 3:return l[i]}case 3:switch(t){case 0:case 2:return u[i];case 3:return h[i]}}return r.N_}function m(t){switch(t){case 1:return 34;case 2:return 33;case 3:return 32}return r.N_}const w={32:"Layer1",33:"Layer2",34:"Layer3"};function A(t,e){if(e&&e.length>=4){const i=e[1]>>>3&3,r=(6&e[1])>>1,n=(12&e[2])>>>2,a=3&~(e[3]>>>6)?2:1,s=m(r),o=g(i,n);t.codecpar.profile=s,t.codecpar.sampleRate=o,t.codecpar.chLayout.nbChannels=a}}},65451:(t,e,i)=>{i.d(e,{Ij:()=>d,XC:()=>c,kt:()=>o});var r=i(31865),n=i(729),a=i(44328);const s=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960];function o(t){let e=0,i=0,r=0;if(t.length<1)return 0;switch(e=t[0],i=s[e>>3],3&e){case 0:r=1;break;case 1:case 2:r=2;break;case 3:if(t.length<2)return 0;r=63&t[1]}return r*i}function c(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=19){const i=new r.A(e,!1);i.skip(9),t.codecpar.chLayout.nbChannels=i.readUint8(),t.codecpar.initialPadding=i.readUint16(),t.codecpar.sampleRate=i.readUint32(),t.codecpar.seekPreroll=Number((0,a.k)(BigInt(80),{den:1e3,num:1},{den:48e3,num:1}))}}function d(t){const e=new Uint8Array(19),i=new n.A(e,!1);return i.writeString("OpusHead"),i.writeUint8(1),i.writeUint8(t.chLayout.nbChannels),i.writeUint16(t.initialPadding),i.writeUint32(t.sampleRate),e}},55611:(t,e,i)=>{i.d(e,{Jk:()=>w,QA:()=>x,Ui:()=>_,XC:()=>y,ci:()=>A,oT:()=>m,wf:()=>P});var r=i(63939),n=i(50932),a=i(72739),s=i(729),o=i(31865),c=i(37246),d=i(14686),h=i(60264),l=i(71517),f=i(37837),u=i(23991),p=i(83314);const g=3;function b(t){const e=t.readU(9),i=t.readU(3),r=t.readU(2),n=t.readU(2),a=t.readU(3);t.readU(5),t.readU(2);const s=t.readU(6),o=t.readU(7),c=t.readU(1),d=t.readU(8),h=t.readU(1),l=t.readU(1),f=[],u=[];if(s){for(let e=0;e<s-1;e++)f[e]=t.readU(8);f[s-1]=t.readU(6)}else t.readU(6);if(i>1){let e=0;for(let r=i-2;r>=0;--r)e|=t.readU(1)<<r;for(let e=i;e<=8&&i>1;++e)t.readU(1);for(let r=i-2;r>=0;--r)e&1<<r&&(u[r]=t.readU(8))}const p=t.readU(8),g=[];if(p)for(let e=0;e<p;e++)g.push(t.readU(8));return{olsIdx:e,numSublayers:i,bitDepthMinus8:a,chromaFormatIdc:n,constantFrameRate:r,generalProfileIdc:o,generalTierFlag:c,generalLevelIdc:d,ptlFrameOnlyConstraintFlag:h,ptlMultilayerEnabledFlag:l,generalConstraintInfo:f,sublayerLevelIdc:u,generalSubProfileIdc:g,maxPictureWidth:t.readU(16),maxPictureHeight:t.readU(16),avgFramerate:t.readU(16)}}function U(t,e,i){const r=e[0];let n;if(r){const t=P(r);let e=t.generalConstraintInfo;e.length||(e=new Array(12).fill(0));const i=new p.A;if(i.writeU(9,0),i.writeU(3,t.spsMaxSublayersMinus1+1),i.writeU(2,1),i.writeU(2,t.chromaFormatIdc),i.writeU(3,t.bitDepthMinus8),i.writeU(5,31),i.writeU(2,0),i.writeU(6,e.length),i.writeU(7,t.profile),i.writeU1(t.tierFlag),i.writeU(8,t.level),i.writeU1(t.ptlFrameOnlyConstraintFlag),i.writeU1(t.ptlMultilayerEnabledFlag),e.length){for(let t=0;t<e.length-1;t++)i.writeU(8,e[t]);i.writeU(6,e[e.length-1])}else i.writeU(6,63);if(t.spsMaxSublayersMinus1+1>1){let e=0;for(let i=t.spsMaxSublayersMinus1-1;i>=0;i--)e=e<<1|t.ptlSublayerLevelPresentFlag[i];i.writeU(t.spsMaxSublayersMinus1,e);for(let e=t.spsMaxSublayersMinus1+1;e<=8&&t.spsMaxSublayersMinus1>0;++e)i.writeU1(0);for(let e=t.spsMaxSublayersMinus1-1;e>=0;e--)t.ptlSublayerLevelPresentFlag[e]&&i.writeU(8,t.sublayerLevelIdc[e])}i.writeU(8,t.generalSubProfileIdc.length);for(let e=0;e<t.generalSubProfileIdc.length;e++)i.writeU(8,t.sublayerLevelIdc[e]);i.writeU(16,t.width),i.writeU(16,t.height),i.writeU(16,0),i.padding(),n=i.getBuffer().subarray(0,i.getPointer())}let o=2+(n?n.length:0);t.length&&(o+=3,o=t.reduce(((t,e)=>t+2+e.length),o)),e.length&&(o+=3,o=e.reduce(((t,e)=>t+2+e.length),o)),i.length&&(o+=3,o=i.reduce(((t,e)=>t+2+e.length),o));const c=new Uint8Array(o),d=new s.A(c,!0);d.writeUint8(g<<1|(n?1:0)|248),n&&d.writeBuffer(n);let h=0;return t.length&&h++,e.length&&h++,i.length&&h++,d.writeUint8(h),t.length&&(d.writeUint8(142),d.writeUint16(t.length),a.__(t,(t=>{d.writeUint16(t.length),d.writeBuffer(t)}))),e.length&&(d.writeUint8(143),d.writeUint16(e.length),a.__(e,(t=>{d.writeUint16(t.length),d.writeBuffer(t)}))),i.length&&(d.writeUint8(144),d.writeUint16(i.length),a.__(i,(t=>{d.writeUint16(t.length),d.writeBuffer(t)}))),c}function m(t){let e,i=!1,r=(0,h.py)(t);if(r.length>=2){const t=[],i=[],n=[];r.forEach((e=>{const r=e[1]>>>3&31;14===r?t.push(e):15===r?i.push(e):16===r&&n.push(e)})),i.length&&n.length&&(e=U(t,i,n),r=r.filter((t=>{const e=t[1]>>>3&31;return 14!==e&&15!==e&&16!==e&&20!==e})))}const n=r.reduce(((t,e)=>t+g+1+e.length),0),o=(0,f.sY)(n),c=(0,d.s3)(o,n),l=new s.A(c);return a.__(r,(t=>{3===g?l.writeUint32(t.length):2===g?l.writeUint24(t.length):1===g?l.writeUint16(t.length):l.writeUint8(t.length),l.writeBuffer(t.subarray(0));const e=t[1]>>>3&31;8!==e&&7!==e&&9!==e&&10!==e||(i=!0)})),{bufferPointer:o,length:n,extradata:e,key:i}}function w(t,e){var i;if(!(1&r.f[15](t+36)))return;const n=(0,l.iI)(t);if((0,h.Bs)(n))return;const a=null!==(i=e.metadata.naluLengthSizeMinusOne)&&void 0!==i?i:g;let s=[],c=[],u=[];const p=new o.A(n);for(;p.remainingSize()>0;){let t=0;t=3===a?p.readUint32():2===a?p.readUint24():1===a?p.readUint16():p.readUint8();const e=n.subarray(0|Number(0xffffffffn&p.getPos()),(0|Number(0xffffffffn&p.getPos()))+t);p.skip(t);const i=e[1]>>>3&31;15===i?c.push(e):16===i?u.push(e):14===i&&s.push(e)}if(c.length||u.length||s.length){const e=U(s,c,u),i=(0,f.sY)(e.length);(0,d.lW)(i,e.length,e),(0,l.Ow)(t,1,i,e.length)}}function A(t,e=!1){if(!(1&r.f[15](t+36)||e))return;const i=(0,l.iI)(t);if(!(0,h.Bs)(i))return;let a=(0,h.py)(i);if(a.length>2){const e=[],i=[],s=[];if(a.forEach((t=>{const r=t[1]>>>3&31;14===r?e.push(t):15===r?i.push(t):16===r&&s.push(t)})),e.length&&i.length&&s.length){const a=U(e,i,s),o=(0,f.sY)(a.length);(0,d.lW)(o,a.length,a),(0,l.Ow)(t,1,o,a.length),n.M[15](t+36,1|r.f[15](t+36))}}}function x(t,e){const{profile:i,level:r,width:n,height:a}=P(e);t.codecpar.profile=i,t.codecpar.level=r,t.codecpar.width=n,t.codecpar.height=a}function y(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=6){t.metadata.naluLengthSizeMinusOne=e[0]>>>1&3;const{spss:i}=function(t){const e=new o.A(t,!0);if(1&e.readUint8()){const i=new c.A;i.appendBuffer(t.subarray(1)),b(i),e.skip(i.getPos())}let i=[],r=[],n=[];const a=e.readUint8();for(let t=0;t<a;t++){const t=31&e.readUint8();let a=1;13!==t&&12!==t&&(a=e.readUint16());const s=[];for(let t=0;t<a;t++){const t=e.readUint16();s.push(e.readBuffer(t))}14===t?i=s:15===t?r=s:16===t&&(n=s)}return{vpss:i,spss:r,ppss:n}}(e);i.length&&x(t,i[0])}}function P(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);let i=0,r=0,n=0,a=0,s=0,o=1,d=0,l=0,f=0;const p=[],g=[],b=[],U=[],m=(0,h.BN)(t.subarray(e)),w=new c.A(m.length);w.appendBuffer(m),w.readU1(),w.readU1(),w.readU(6),w.readU(5),w.readU(3),w.readU(8);const A=w.readU(3);o=w.readU(2);const x=w.readU(2);if(w.readU(1)){if(i=w.readU(7),d=w.readU(1),r=w.readU(8),l=w.readU(1),f=w.readU(1),w.readU(1)){for(let t=0;t<8;t++)p[t]=w.readU(8);p[8]=w.readU(7);const t=w.readU(8);w.readU(t)}w.skipPadding();for(let t=A-1;t>=0;t--)g[t]=w.readU(1);w.skipPadding();for(let t=A-1;t>=0;t--)g[t]&&(b[t]=w.readU(8));const t=w.readU(8);if(t)for(let e=0;e<t;e++)U[e]=w.readU(32)}w.readU1(),w.readU1()&&w.readU1();const y=n=u.xb(w),P=a=u.xb(w);if(w.readU1()&&(u.xb(w),u.xb(w),u.xb(w),u.xb(w)),w.readU1()){const t=u.xb(w),e=x+5,i=1<<e,r=y/(1<<e),n=P/(1<<e),a=Math.ceil(Math.log2(r)),s=Math.ceil(Math.log2(n));let o=0,c=0,d=0;t>0&&(d=w.readU1(),c=w.readU1());for(let e=0;t>0&&e<=t;e++)c&&0!=e||(e>0&&y>i&&w.readU(a),e>0&&P>i&&w.readU(s),e<t&&y>i&&w.readU(a),e<t&&P>i&&w.readU(s)),d||w.readU(2);if(o=u.xb(w)+1,w.readU(1)&&w.readU(1))for(let e=0;e<=t;e++)w.readU(o)}s=u.xb(w),w.readU(1),w.readU(1);const _=w.readU(4),I=w.readU(1);let M=0;I&&(M=u.xb(w));const S=[],v=w.readU(2);for(let t=0;t<8*v;t++)S[t]=w.readU(1);return{profile:i,level:r,width:n,height:a,chromaFormatIdc:o,bitDepthMinus8:s,generalProfileSpace:0,tierFlag:d,generalConstraintInfo:p,generalSubProfileIdc:U,ptlFrameOnlyConstraintFlag:l,ptlMultilayerEnabledFlag:f,spsMaxSublayersMinus1:A,ptlSublayerLevelPresentFlag:g,sublayerLevelIdc:b,sps_log2_max_pic_order_cnt_lsb_minus4:_,sps_poc_msb_cycle_flag:I,sps_poc_msb_cycle_len_minus1:M,sps_num_extra_ph_bytes:v,sps_extra_ph_bit_present_flag:S}}function _(t){0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(t=function(t){let e=(0,h.py)(t);if(e.length>=2){const t=[],i=[],r=[];if(e.forEach((e=>{const n=e[1]>>>3&31;14===n?t.push(e):15===n?i.push(e):16===n&&r.push(e)})),i.length&&r.length)return U(t,i,r)}}(t));const e=new c.A;return e.appendBuffer(t),1&e.readU(8)?b(e):{}}},85947:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(134);class n{constructor(){(0,r.A)(this,"type",-1),(0,r.A)(this,"onStreamAdd",void 0)}destroy(t){}}},59331:(t,e,i)=>{i.r(e),i.d(e,{default:()=>B});var r=i(134),n=i(63939),a=i(50932),s=i(4624),o=i(19770),c=i(53783),d=i(27274),h=i(39e3),l=i(9705),f=i(51660),u=i(39144),p=i(52088),g=i(6403),b=i(85947),U=i(86191),m=i(71517),w=i(77231),A=i(52071),x=i(44328),y=i(72739),P=i(89088),_=i(20620),I=i(53e3),M=i(55611),S=i(58469),v=i(65451),k=i(37837),C=i(14686),R="src/avformat/formats/IMpegtsFormat.ts";class B extends b.A{constructor(){super(),(0,r.A)(this,"type",2),(0,r.A)(this,"context",void 0),(0,r.A)(this,"firstTSPacketPos",void 0),(0,r.A)(this,"cacheAVPacket",void 0),this.context=(0,o.A)()}init(t){t.ioReader&&t.ioReader.setEndian(!0),this.cacheAVPacket=0}destroy(t){super.destroy(t),this.cacheAVPacket&&((0,m.Qe)(this.cacheAVPacket),this.cacheAVPacket=0),y.__(t.streams,(t=>{const e=t.privData;e.filter&&(e.filter.destroy(),e.filter=null)}))}async readHeader(t){try{let e=0,i=await c.q(t.ioReader);for(i||(i=d.ZT),this.context.tsPacketSize=i;!this.context.hasPAT||!this.context.hasPMT;){const e=await c.n(t.ioReader,this.context);e.payload&&(0!==e.pid&&e.pid!==this.context.currentPmtPid&&134!==this.context.pmt.pid2StreamType.get(e.pid)||(0,h.A)(e,this.context))}return this.context.hasPAT&&this.context.hasPMT?(this.firstTSPacketPos=t.ioReader.getPos(),e):l.LR}catch(e){return s.z3(e.message,R,137),t.ioReader.error}}checkExtradata(t,e){if(!e.codecpar.extradata){let i=(0,m.rU)(t,1);if(!i)return;e.codecpar.extradata=(0,k.sY)(n.f[15](i+4)),(0,C.Mr)(e.codecpar.extradata,n.f[20](i),n.f[15](i+4)),e.codecpar.extradataSize=n.f[15](i+4),(0,m.Is)(t,1),27===e.codecpar.codecId?_.XC(e,(0,C.JW)(e.codecpar.extradata,e.codecpar.extradataSize)):173===e.codecpar.codecId?I.XC(e,(0,C.JW)(e.codecpar.extradata,e.codecpar.extradataSize)):196===e.codecpar.codecId?M.XC(e,(0,C.JW)(e.codecpar.extradata,e.codecpar.extradataSize)):86018===e.codecpar.codecId?S.XC(e,(0,C.JW)(e.codecpar.extradata,e.codecpar.extradataSize)):86076===e.codecpar.codecId&&v.XC(e,(0,C.JW)(e.codecpar.extradata,e.codecpar.extradataSize))}}parsePESSlice(t,e,i,r){const o=(0,u.A)(i);(0,f.A)(o,e,r),(0,p.A)(i);const c=r.privData;if(c.filter){let i=0;if(i=c.filter.sendAVPacket(e),i<0)return s.z3("send avpacket to bsf failed",R,183),l.LR;if(i=c.filter.receiveAVPacket(e),i<0)return s.z3("receive avpacket from bsf failed",R,190),l.LR;for(a.M[15](e+76,9e4),a.M[15](e+72,1),a.M[15](e+32,r.index),this.checkExtradata(e,r);;){const e=this.cacheAVPacket||(0,m._5)();if(i=c.filter.receiveAVPacket(e),0!==i){this.cacheAVPacket=e;break}a.M[15](e+76,9e4),a.M[15](e+72,1),a.M[15](e+32,r.index),this.checkExtradata(e,r),t.interval.packetBuffer.push(e),this.cacheAVPacket=0}}else{const t=this.context.pmt.pid2StreamType.get(c.pid);if(3===t||4===t){a.M[15](e+36,1|n.f[15](e+36));const t=(0,m.iI)(e),i=t[1]>>>3&3,s=(6&t[1])>>1,o=(12&t[2])>>>2,c=3&~(t[3]>>>6)?2:1,d=P.Au(s),h=P.Y2(i,o);(r.codecpar.profile!==d||r.codecpar.sampleRate!==h||r.codecpar.chLayout.nbChannels!==c)&&(r.codecpar.profile=d,r.codecpar.sampleRate=h,r.codecpar.chLayout.nbChannels=c)}else 27===r.codecpar.codecId?r.codecpar.extradata||(_.ci(e,!0),this.checkExtradata(e,r),r.codecpar.bitFormat=2):173===r.codecpar.codecId?r.codecpar.extradata||(I.ci(e,!0),this.checkExtradata(e,r),r.codecpar.bitFormat=2):196===r.codecpar.codecId&&(r.codecpar.extradata||(M.ci(e,!0),this.checkExtradata(e,r),r.codecpar.bitFormat=2))}return 0}async readAVPacket_(t,e){if(this.context.ioEnd){if(!this.context.tsSliceQueueMap.size)return-1048576;const i=this.context.tsSliceQueueMap.values();let r;for(;;){const t=i.next();if(t.value&&t.value.slices.length){r=t.value;break}if(t.done)break}if(!r)return-1048576;const n=t.streams.find((t=>t.privData.pid===r.pid));return n?this.parsePESSlice(t,e,r,n):((0,p.A)(r),this.readAVPacket_(t,e))}try{for(;;){const n=await c.n(t.ioReader,this.context);if(!n.payload)continue;if(0===n.pid||n.pid===this.context.currentPmtPid||134===this.context.pmt.pid2StreamType.get(n.pid)){(0,h.A)(n,this.context);continue}const a=this.context.pmt.pid2StreamType.get(n.pid);if(!a)continue;let s=t.streams.find((t=>t.privData.pid===n.pid));s||(s=t.createStream(),(0,U.A)(n.pid,s,this.context));let o=n.payload[4]<<8|n.payload[5],d=this.context.tsSliceQueueMap.get(n.pid),l=!1;if(d){if(d.totalLength>0&&n.payloadUnitStartIndicator){const i=this.parsePESSlice(t,e,d,s);if(i<0)return i;l=!0}}else{if(!n.payloadUnitStartIndicator)continue;d=new g.pi,this.context.tsSliceQueueMap.set(n.pid,d)}var i,r;if(n.payloadUnitStartIndicator&&(d.randomAccessIndicator=null!==(i=null===(r=n.adaptationFieldInfo)||void 0===r?void 0:r.randomAccessIndicator)&&void 0!==i?i:0,d.pos=n.pos,d.pid=n.pid,d.streamType=a,d.expectedLength=0===o?0:o+6),d.slices.push(n.payload),d.totalLength+=n.payload.length,d.expectedLength>0&&d.expectedLength===d.totalLength){const i=this.parsePESSlice(t,e,d,s);if(i<0)return i;l=!0}if(l)return 0}}catch(i){if(-1048576!==t.ioReader.error||this.context.ioEnd){if(-1048576===t.ioReader.error)return-1048576;throw i}return this.context.ioEnd=!0,this.readAVPacket_(t,e)}}async readAVPacket(t,e){try{return this.readAVPacket_(t,e)}catch(e){return-1048576!==t.ioReader.error&&s.z3(e.message,R,414),t.ioReader.error}}async syncTSPacket(t){let e=w.Dh;for(;;)try{if(71===await t.ioReader.readUint8()){e=this.context.tsPacketSize===d.VG?t.ioReader.getPos()-BigInt(5):t.ioReader.getPos()-BigInt(1);let i=0,r=t.ioReader.getPos();for(;i<=10&&(await t.ioReader.skip(this.context.tsPacketSize-1),71===await t.ioReader.readUint8());)i++;if(i<10){e=w.Dh,await t.ioReader.seek(r);continue}break}}catch(t){e=w.Dh;break}if(e!==w.Dh)for(await t.ioReader.seek(e);;){if((await c.n(t.ioReader,this.context)).payloadUnitStartIndicator){await t.ioReader.seek(e),t.streams.forEach((t=>{let e=this.context.tsSliceQueueMap.get(t.privData.pid);e&&(0,p.A)(e)}));break}e=t.ioReader.getPos()}}async seek(t,e,i,r){let n=t.ioReader.getPos();if(this.context.tsSliceQueueMap.forEach((t=>{t.slices.length&&t.pos<n&&(n=t.pos),(0,p.A)(t)})),this.context.pmt.pid2StreamType.forEach(((t,e)=>{this.context.tsSliceQueueMap.delete(e)})),16&r){const r=(0,x.k)(i,e.timeBase,w.i0);return await t.ioReader.seek(r,!0),this.context.ioEnd=!1,BigInt(0)}if(e&&e.sampleIndexes.length){let r=y.El(e.sampleIndexes,(t=>t.pts>i?-1:1));if(r>0&&(0,x.k)(i-e.sampleIndexes[r-1].pts,e.timeBase,w.i0)<BigInt(1e4))return s.Yz(`seek in sampleIndexes, found index: ${r}, pts: ${e.sampleIndexes[r-1].pts}, pos: ${e.sampleIndexes[r-1].pos}`,R,524),await t.ioReader.seek(e.sampleIndexes[r-1].pos),this.context.ioEnd=!1,n}if(2&r){const e=await t.ioReader.fileSize();return e<=BigInt(0)?BigInt(l.E$):(i<BigInt(0)?i=BigInt(0):i>e&&(i=e),await t.ioReader.seek(i),4&r||await this.syncTSPacket(t),this.context.ioEnd=!1,n)}{s.Yz("not found any keyframe index, try to seek in bytes",R,556);let r=await(0,A.A)(t,e,i,this.firstTSPacketPos,this.readAVPacket.bind(this),this.syncTSPacket.bind(this));return r>=0&&(this.context.ioEnd=!1),r}}getAnalyzeStreamsCount(){var t,e;return null!==(t=null===(e=this.context.pmt)||void 0===e?void 0:e.pid2StreamType.size)&&void 0!==t?t:0}}},89564:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(27274);function n(t,e,i){const n=new Uint8Array(r.GV);let a=0,s=0;for(let r=0;r<t.length-3;r++)if(71===t[r]){const o=8191&(t[r+1]<<8|t[r+2]);let c=48&t[r+3];if(!i||8191===o||c){const t=r%e;n[t]++,a++,n[t]>s&&(s=n[t])}}return s-Math.max(a-10*s,0)/10}},52088:(t,e,i)=>{function r(t){t.slices=[],t.totalLength=0,t.expectedLength=-1}i.d(e,{A:()=>r})},19770:(t,e,i)=>{i.d(e,{A:()=>o});var r=i(80662),n=i.n(r),a=i(77231),s=i(6403);function o(){return{currentProgram:a.N_,currentPmtPid:a.N_,tsPacketSize:a.N_,hasPAT:!1,hasPMT:!1,tsSliceQueueMap:new(n()),pat:new s.Cd,pmt:new s.I4,program2Pmt:new(n()),ioEnd:!1,startPid:256,delay:BigInt(0)}}},76538:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(77231);function n(){return{pid:r.N_,filter:null,tsPacket:null,pes:null,continuityCounter:0,pesSlices:{total:0,buffers:[]},latm:!1}}},39e3:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(6403),n=i(52088),a=i(63599);function s(t,e){const i=e.tsSliceQueueMap.get(t.pid);if(t.payloadUnitStartIndicator){const c=t.payload[0];if(i&&i.totalLength>0){const r=t.payload.slice(1,Math.min(1+c,t.payload.length));i.slices.push(r),i.totalLength+=r.length,i.totalLength===i.expectedLength?((0,a.A)(t.pid,i,e),(0,n.A)(i)):((0,n.A)(i),e.tsSliceQueueMap.delete(t.pid))}for(let i=1+c;i<t.payload.length;){var s,o;if(255===t.payload[i])break;const c=(15&t.payload[i+1])<<8|t.payload[i+2],d=new r.pi;d.pid=t.pid,d.expectedLength=c+3,d.randomAccessIndicator=null!==(s=null===(o=t.adaptationFieldInfo)||void 0===o?void 0:o.randomAccessIndicator)&&void 0!==s?s:0;const h=t.payload.slice(i,Math.min(i+d.expectedLength-d.totalLength,t.payload.length));d.slices.push(h),d.totalLength+=h.length,e.tsSliceQueueMap.set(t.pid,d),d.totalLength===d.expectedLength?((0,a.A)(t.pid,d,e),(0,n.A)(d)):((0,n.A)(d),e.tsSliceQueueMap.delete(t.pid)),i+=h.length}}else if(i&&0!==i.totalLength){const r=t.payload.slice(0,Math.min(i.expectedLength-i.totalLength,t.payload.length));i.slices.push(r),i.totalLength+=r.length,i.totalLength===i.expectedLength?((0,a.A)(t.pid,i,e),(0,n.A)(i)):((0,n.A)(i),e.tsSliceQueueMap.delete(t.pid))}}},86191:(t,e,i)=>{i.d(e,{A:()=>f});var r=i(61499),n=i(76538),a=i(27274),s=i(50848),o=i(36488),c=i(61702),d=i(65451),h=i(37837),l=i(14686);function f(t,e,i){e.timeBase.den=9e4,e.timeBase.num=1;const f=(0,n.A)();f.pid=t,e.privData=f;const u=i.pmt.pid2StreamType.get(t);if(6===u){const r=i.pmt.pid2ESDescriptor.get(t);if(e.codecpar.codecType=2,r){var p;const t=r.find((t=>5===t.tag));if(t&&(null===(p=t.buffer)||void 0===p?void 0:p.length)>=4)if("O"===String.fromCharCode(t.buffer[0])||"p"===String.fromCharCode(t.buffer[1])||"u"===String.fromCharCode(t.buffer[2])||"s"===String.fromCharCode(t.buffer[3])){e.codecpar.codecType=1,e.codecpar.codecId=86076,e.codecpar.sampleRate=48e3;const t=r.find((t=>127===t.tag));if(t&&128===t.buffer[0]){e.codecpar.chLayout.nbChannels=15&t.buffer[1]?15&t.buffer[1]:2;const i=d.Ij(e.codecpar);i&&(e.codecpar.extradata=(0,h.sY)(i.length),(0,l.lW)(e.codecpar.extradata,i.length,i),e.codecpar.extradataSize=i.length)}}else if("A"===String.fromCharCode(t.buffer[0])||"V"===String.fromCharCode(t.buffer[1])||"0"===String.fromCharCode(t.buffer[2])||"1"===String.fromCharCode(t.buffer[3])){e.codecpar.codecType=0,e.codecpar.codecId=225;const t=r.find((t=>128===t.tag));t&&(e.codecpar.extradata=(0,h.sY)(t.buffer.length),(0,l.lW)(e.codecpar.extradata,t.buffer.length,t.buffer),e.codecpar.extradataSize=t.buffer.length)}}}else{const t=a.$x[u];t?(e.codecpar.codecType=t[0],e.codecpar.codecId=t[1]):e.codecpar.codecType=2}let g;switch(u){case 15:g=new s.A;break;case 17:g=new o.A;break;case 27:case 36:break;case 6:86076===e.codecpar.codecId&&(g=new c.A)}return g&&(e.privData.filter=g,g.init(e.codecpar[r.o9],e.timeBase[r.o9])),e}},52888:(t,e,i)=>{function r(t,e,i){return t>e?i>e&&(e=i>t?t:i):e>i&&(e=i>t?i:t),e}i.d(e,{y:()=>r})},31239:(t,e,i)=>{function r(t,e){let i=0,r=t[i++];if(e.adaptationFieldInfo.discontinuityIndicator=r>>7&1,e.adaptationFieldInfo.randomAccessIndicator=r>>6&1,e.adaptationFieldInfo.elementaryStreamPriorityIndicator=r>>5&1,e.adaptationFieldInfo.pcrFlag=r>>4&1,e.adaptationFieldInfo.opcrFlag=r>>3&1,e.adaptationFieldInfo.splicingPointFlag=r>>2&1,e.adaptationFieldInfo.transportPrivateDataFlag=r>>1&1,e.adaptationFieldInfo.adaptationFieldExtensionFlag=1&r,e.adaptationFieldInfo.pcrFlag){const r=BigInt(Math.floor(t[i++]<<25|t[i++]<<17|t[i++]<<9|t[i++]<<1|t[i]>>7)),n=BigInt(Math.floor((1&t[i++])<<8|t[i++]));e.adaptationFieldInfo.pcr=r*BigInt(300)+n}if(e.adaptationFieldInfo.opcrFlag){const r=BigInt(Math.floor(t[i++]<<25|t[i++]<<17|t[i++]<<9|t[i++]<<1|t[i]>>7)),n=BigInt(Math.floor((1&t[i++])<<8|t[i++]));e.adaptationFieldInfo.pcr=r*BigInt(300)+n}if(e.adaptationFieldInfo.splicingPointFlag&&(e.adaptationFieldInfo.spliceCountDown=t[i++]),e.adaptationFieldInfo.transportPrivateDataFlag){const r=t[i++];e.adaptationFieldInfo.transportPrivateData=t.subarray(i,i+r),i+=r}if(e.adaptationFieldInfo.adaptationFieldExtensionFlag){const r=t[i++];e.adaptationFieldInfo.extension=t.subarray(i,i+r),i+=r}}i.d(e,{A:()=>r})},20549:(t,e,i)=>{i.d(e,{A:()=>c});var r=i(31865),n=i(6403),a=i(92647),s=i(4624),o="src/avformat/formats/mpegts/function/parsePAT.ts";function c(t,e){let i=0;const c=new r.A((0,a.A)(Uint8Array,t.slices),!0),d=c.readUint8();0!==d&&s.z3(`parsePAT: table_id ${d} is not corresponded to PAT!`,o,40);const h=4095&c.readUint16();c.readUint16(),i=c.readUint8();const l=i>>1&31,f=1&i,u=c.readUint8();let p;if(c.readUint8(),1===f&&0===u)p=new n.Cd,p.versionNumber=l;else if(p=e.pat,!p)return void s.z3("can not found PAT in mpegts context",o,64);const g=h-5-4,b=(0|Number(0xffffffffn&c.getPos()))+g;let U=-1,m=-1;for(;c.getPos()<b;){const t=c.readUint16(),e=8191&c.readUint16();0===t?p.networkPid=e:(p.program2PmtPid.set(t,e),-1===U&&(U=t),-1===m&&(m=e))}1===f&&0===u&&(e.pat||s.pq("parsed first PAT",o,100),e.pat=p,e.currentProgram=U,e.currentPmtPid=m,e.hasPAT=!0)}},51660:(t,e,i)=>{i.d(e,{A:()=>d});var r=i(63939),n=i(50932),a=i(71517),s=i(37837),o=i(14686),c=i(77231);function d(t,e,i){t.randomAccessIndicator&&n.M[15](e+36,1|r.f[15](e+36));const d=i.codecpar.codecId;27!==d&&173!==d||n.M[15](e+80,2),n.M[15](e+32,i.index),n.M[17](e+16,t.dts),n.M[17](e+8,t.pts),n.M[17](e+56,t.pos),n.M[15](e+76,9e4),n.M[15](e+72,1),i.startTime===c.Dh&&(i.startTime=r.f[17](e+8)||r.f[17](e+16));const h=(0,s.sY)(t.payload.length);(0,o.lW)(h,t.payload.length,t.payload),(0,a.NX)(e,h,t.payload.length)}},39144:(t,e,i)=>{i.d(e,{A:()=>o});var r=i(6403),n=i(4624),a=i(77231),s="src/avformat/formats/mpegts/function/parsePESSlice.ts";function o(t){let e=new Uint8Array(t.totalLength);for(let i=0,r=0;i<t.slices.length;i++){let n=t.slices[i];e.set(n,r),r+=n.byteLength}const i=e[3],o=e[4]<<8|e[5],c=new r.xf;if(c.data=e,c.pid=t.pid,c.streamId=i,c.streamType=t.streamType,c.pos=t.pos,c.randomAccessIndicator=t.randomAccessIndicator,188!==i&&190!==i&&191!==i&&240!==i&&241!==i&&255!==i&&242!==i&&248!==i){const t=(192&e[7])>>>6,i=e[8];let r=a.Dh,d=a.Dh;2!==t&&3!==t||(r=BigInt(Math.floor(536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2)),d=3===t?BigInt(Math.floor(536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)):r),c.dts=d,c.pts=r;const h=9+i;let l=0;if(0!==o){if(o<3+i)return void n.z3("Malformed PES: PES_packet_length < 3 + PES_header_data_length",s,93);l=o-3-i}else l=e.byteLength-h;c.payload=e.subarray(h,h+l)}else if((188===i||191===i||240===i||241===i||255===i||242===i||248===i)&&6===c.streamId){const t=6;let i=0;i=0!==o?o:e.byteLength-t,c.payload=e.subarray(t,t+i)}return c}},65945:(t,e,i)=>{i.d(e,{A:()=>c});var r=i(31865),n=i(6403),a=i(92647),s=i(4624),o="src/avformat/formats/mpegts/function/parsePMT.ts";function c(t,e){let i=0;const c=new r.A((0,a.A)(Uint8Array,t.slices),!0),d=c.readUint8();2!==d&&s.z3(`parse PMT: table_id ${d} is not corresponded to PAT!`,o,40);const h=4095&c.readUint16(),l=c.readUint16();i=c.readUint8();const f=i>>1&31,u=1&i,p=c.readUint8();let g;if(c.readUint8(),1===u&&0===p)g=new n.I4,g.programNumber=l,g.versionNumber=f,e.program2Pmt.set(l,g),e.hasPMT=!0;else if(g=e.program2Pmt.get(l),!g)return void s.z3("can not found PMT in mpegts context",o,68);g.pcrPid=8191&c.readUint16();const b=4095&c.readUint16();c.skip(b);let U=(0|Number(0xffffffffn&c.getPos()))+(h-9-b-4);for(;c.getPos()<U;){const t=c.readUint8(),e=8191&c.readUint16(),i=4095&c.readUint16();if(g.pid2StreamType.set(e,t),i>0){const t=[],r=(0|Number(0xffffffffn&c.getPos()))+i;for(;c.getPos()<r;){const e=new n.kJ;e.tag=c.readUint8();const i=c.readUint8();i>0&&(e.buffer=c.readBuffer(i)),t.push(e)}g.pid2ESDescriptor.set(e,t)}}l===e.currentProgram&&(e.pmt||s.pq("parsed first PMT",o,111),e.pmt=g)}},43383:(t,e,i)=>{function r(t,e){}i.d(e,{A:()=>r})},63599:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(20549),n=i(65945),a=i(43383);function s(t,e,i){0===t?(0,r.A)(e,i):t===i.currentPmtPid?(0,n.A)(e,i):i.pmt&&134===i.pmt.pid2StreamType.get(t)&&(0,a.A)(e,i)}},53783:(t,e,i)=>{i.d(e,{n:()=>l,q:()=>h});var r=i(27274),n=i(89564),a=i(52888),s=i(4624),o=i(6403),c=i(31239),d="src/avformat/formats/mpegts/impegts.ts";async function h(t){let e;try{e=await t.peekBuffer(r.pm)}catch(i){-1048576!==t.error&&(e=await t.peekBuffer(t.remainingLength()))}if(e&&e.length>=r.ZT){const t=(0,n.A)(e,r.ZT,!1),i=(0,n.A)(e,r.VG,!1),o=(0,n.A)(e,r.eR,!1);let c=(0,a.y)(t,o,i);e.length<r.pm&&(c+=r.hY);let h=r.ZT;return t>c?h=r.ZT:i>c?h=r.VG:o>c&&(h=r.eR),s.Yz(`got ts packet size: ${h}`,d,72),h}return 0}async function l(t,e){const i=t.getPos();let n=0;e.tsPacketSize===r.VG&&await t.skip(4);const a=await t.readUint8();71!==a&&s.h2(`found syncByte not 0x47, value: ${a.toString(16)}`,d,94);const h=new o.am;h.pos=i,n=await t.readUint16(),h.payloadUnitStartIndicator=n>>14&1,h.transportPriority=n>>13&1,h.pid=8191&n,n=await t.readUint8(),h.adaptationFieldControl=n>>4&3,h.continuityCounter=15&n;let l=4;if(2===h.adaptationFieldControl||3===h.adaptationFieldControl){const i=await t.readUint8();if(5+i===r.ZT)return(0,c.A)(await t.readBuffer(i),h),e.tsPacketSize===r.eR&&await t.skip(16),h;i>0&&(0,c.A)(await t.readBuffer(i),h),l=5+i}return 1!==h.adaptationFieldControl&&3!==h.adaptationFieldControl||(h.payload=await t.readBuffer(r.ZT-l)),e.tsPacketSize===r.eR&&await t.skip(16),h}},27274:(t,e,i)=>{i.d(e,{$x:()=>d,GV:()=>s,VG:()=>n,ZT:()=>a,eR:()=>r,hY:()=>c,pm:()=>o});const r=204,n=192,a=188,s=204,o=8192,c=5,d={15:[1,86018],17:[1,86018],3:[1,86017],4:[1,86017],27:[0,27],16:[0,12],36:[0,173],51:[0,196],129:[1,86019],135:[1,86056]}},6403:(t,e,i)=>{i.d(e,{Cd:()=>h,I4:()=>f,am:()=>c,kJ:()=>l,pi:()=>d,xf:()=>u});var r=i(134),n=i(80662),a=i.n(n),s=i(77231);class o{constructor(){(0,r.A)(this,"discontinuityIndicator",0),(0,r.A)(this,"randomAccessIndicator",0),(0,r.A)(this,"elementaryStreamPriorityIndicator",0),(0,r.A)(this,"pcrFlag",0),(0,r.A)(this,"opcrFlag",0),(0,r.A)(this,"splicingPointFlag",0),(0,r.A)(this,"transportPrivateDataFlag",0),(0,r.A)(this,"adaptationFieldExtensionFlag",0),(0,r.A)(this,"pcr",BigInt(0)),(0,r.A)(this,"opcr",BigInt(0)),(0,r.A)(this,"spliceCountDown",0),(0,r.A)(this,"transportPrivateData",null),(0,r.A)(this,"extension",null)}}class c{constructor(){(0,r.A)(this,"pos",s.Dh),(0,r.A)(this,"payloadUnitStartIndicator",0),(0,r.A)(this,"transportPriority",0),(0,r.A)(this,"pid",s.N_),(0,r.A)(this,"adaptationFieldControl",0),(0,r.A)(this,"continuityCounter",0),(0,r.A)(this,"transportScramblingControl",0),(0,r.A)(this,"adaptationFieldInfo",new o),(0,r.A)(this,"payload",null)}}class d{constructor(){(0,r.A)(this,"slices",[]),(0,r.A)(this,"totalLength",0),(0,r.A)(this,"expectedLength",s.N_),(0,r.A)(this,"randomAccessIndicator",0),(0,r.A)(this,"pid",s.N_),(0,r.A)(this,"streamType",0),(0,r.A)(this,"pos",s.Dh)}}class h{constructor(){(0,r.A)(this,"versionNumber",0),(0,r.A)(this,"networkPid",s.N_),(0,r.A)(this,"program2PmtPid",new(a()))}}class l{constructor(){(0,r.A)(this,"tag",void 0),(0,r.A)(this,"buffer",void 0)}}class f{constructor(){(0,r.A)(this,"versionNumber",0),(0,r.A)(this,"programNumber",0),(0,r.A)(this,"pcrPid",0),(0,r.A)(this,"pid2StreamType",new(a())),(0,r.A)(this,"pid2ESDescriptor",new(a()))}}class u{constructor(){(0,r.A)(this,"pid",s.N_),(0,r.A)(this,"streamType",0),(0,r.A)(this,"streamId",s.N_),(0,r.A)(this,"dts",s.Dh),(0,r.A)(this,"pts",s.Dh),(0,r.A)(this,"pos",s.Dh),(0,r.A)(this,"payload",null),(0,r.A)(this,"data",null),(0,r.A)(this,"randomAccessIndicator",0)}}},2187:(t,e,i)=>{i.d(e,{d:()=>s});var r=i(72739),n=i(44328),a=i(77231);function s(t,e,i){let s=BigInt(0);return r.__(t,(t=>{s+=t.codecpar.bitRate*(0,n.k)(e,i,a.i0)/BigInt(8e3)})),s}},52071:(t,e,i)=>{i.d(e,{A:()=>u});var r=i(63939),n=i(9599),a=i(29170),s=i(77231),o=i(44328),c=i(2187),d=i(71517),h=i(9705),l=i(4624),f="src/avformat/function/seekInBytes.ts";async function u(t,e,i,u,p,g){const b=t.ioReader.getPos(),U=await t.ioReader.fileSize();let m=s.Dh,w=i;e.startTime!==s.Dh?w-=e.startTime:w-=e.firstDTS;const A=(0,o.k)(i,e.timeBase,s.i0);if(A<BigInt(1e4))return l.Yz(`seek pts is earlier then 10s, seek to first packet pos(${u}) directly`,f,63),await t.ioReader.seek(u),b;let x=(0,c.d)(t.streams,w,e.timeBase);const y=U-(0,c.d)(t.streams,BigInt(5e3),s.i0),P=(0,c.d)(t.streams,BigInt(1e4),s.i0);if(x>y&&(x=y),x<u)return await t.ioReader.seek(u),b;const _=(0,d._5)();let I=U,M=BigInt(0);for(;;){if(I-M<P){m=M;break}await t.ioReader.seek(x),await g(t);const e=t.ioReader.getPos();if(!(await p(t,_)>=0))break;{const t=(0,o.k)(r.f[17](_+8),(0,a.A)(_+72,n.P),s.i0),i=t-A;if(l.Yz(`try to seek to pos: ${x}, got packet pts: ${r.f[17](_+8)}(${t}ms), diff: ${i}ms`,f,98),i<=BigInt(0)&&-i<BigInt(1e4)){m=e;break}i>BigInt(0)?(I=x,x=M+I>>BigInt(1)):(M=x,x=M+I>>BigInt(1))}}return(0,d.Qe)(_),m!==s.Dh?(l.Yz(`finally seek to pos ${m}`,f,124),await t.ioReader.seek(m),await g(t),b):(await t.ioReader.seek(b),BigInt(h.E$))}},23991:(t,e,i)=>{function r(t){let e=0,i=0;for(;i<32&&0===t.readU1();)i++;return e=t.readU(i),e+=(1<<i)-1,e}function n(t){let e=r(t);return e=1&e?(e+1)/2:-e/2,e}i.d(e,{$x:()=>n,xb:()=>r})},39381:(t,e,i)=>{i.d(e,{E3:()=>a,Sg:()=>d,Y0:()=>c,ht:()=>o,r8:()=>n,yd:()=>s});var r=i(63939);function n(t){return r.f[2](t)}function a(t){return n(t+1)<<8|n(t)}function s(t){return n(t)<<8|n(t+1)}function o(t){return n(t)<<16|n(t+1)<<8|n(t+2)}function c(t){return a(t+2)<<16|a(t)}function d(t){return s(t)<<16|s(t+2)}},60264:(t,e,i)=>{function r(t){return t.length>4&&0===t[0]&&0===t[1]&&(1===t[2]||0===t[2]&&1===t[3])}function n(t,e){let i=0;for(let r=e;r<t.length;r++)switch(t[r]){case 0:i++;break;case 1:if(i>=2)return{offset:r-Math.min(i,3),startCode:Math.min(i+1,4)};i=0;break;default:i=0}return{offset:-1,startCode:0}}function a(t){const e=[];let i=n(t,0),r={offset:-1,startCode:0};for(;r=n(t,i.offset+i.startCode),r.offset>-1;)e.push(t.subarray(i.offset+i.startCode,r.offset,!0)),i=r;return e.push(t.subarray(i.offset+i.startCode,void 0,!0)),e}function s(t,e=0,i){i||(i=t.length);const r=new Uint8Array(t.length);let n=0,a=0;for(let s=0;s<t.length;s++){if(s>=e&&s<i)if(0===t[s])n++;else if(3===t[s]&&2===n&&s+1<t.length&&t[s+1]<=3){if(s++,s===t.length)break;n=0===t[s]?1:0}else n=0;r[a++]=t[s]}return r.slice(0,a)}i.d(e,{BN:()=>s,Bs:()=>r,Ky:()=>n,py:()=>a})},37246:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(134),n=i(4624);class a{constructor(t=1048576){(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"bitsLeft",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"endPointer",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),this.pointer=0,this.bitsLeft=8,this.size=t,this.endPointer=0,this.error=0,this.buffer=new Uint8Array(this.size)}peekU1(){let t=0;(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush();let e=this.pointer,i=this.bitsLeft;return 0===i&&(e++,i=8),t=this.buffer[e]>>i-1&1,t}readU1(){let t=0;return(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush(),this.bitsLeft--,t=this.buffer[this.pointer]>>this.bitsLeft&1,0===this.bitsLeft&&(this.pointer++,this.bitsLeft=8),t}readU(t){let e=0;for(let i=0;i<t;i++)e|=this.readU1()<<t-i-1;return e}remainingLength(){return this.endPointer-this.pointer}getPos(){return this.pointer}skip(t){const e=(t-t%8)/8;this.pointer+=e;const i=t%8;this.bitsLeft<=i?(this.pointer++,this.bitsLeft=8-(i-this.bitsLeft)):this.bitsLeft-=i}flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOReader error, flush failed because of no flush callback");if(0===this.bitsLeft&&this.pointer++,!(this.size-this.remainingLength()<=0))if(this.pointer<this.endPointer){this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0);const t=this.onFlush(this.buffer.subarray(this.endPointer-this.pointer,this.size));if(t<0)throw this.error=t,Error("IOReader error, flush failed");this.endPointer=this.endPointer-this.pointer+t,this.pointer=0}else{const t=this.onFlush(this.buffer);if(this.endPointer=t,this.pointer=0,this.bitsLeft=8,t<0)throw this.error=t,Error("IOReader error, flush failed")}}getBuffer(){return this.buffer}appendBuffer(t){if(this.size-this.endPointer>=t.length)this.buffer.set(t,this.endPointer),this.endPointer+=t.length;else if(this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0),this.endPointer=this.endPointer-this.pointer,this.pointer=0,this.size-this.endPointer>=t.length)this.buffer.set(t,this.endPointer),this.endPointer+=t.length;else{const e=Math.min(this.size-this.endPointer,t.length);this.buffer.set(t.subarray(0,e),this.endPointer),this.endPointer+=e,n.R8("BSReader, call appendBuffer but the buffer's size is lagger then the remaining size","src/common/io/BitReader.ts",190)}}clear(){this.pointer=this.endPointer=0,this.bitsLeft=8,this.error=0}skipPadding(){this.bitsLeft<8&&(this.bitsLeft=8,this.pointer++)}}},83314:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(134);class n{constructor(t=1048576){(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"bitPointer",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),this.pointer=0,this.bitPointer=0,this.size=t,this.error=0,this.buffer=new Uint8Array(this.size)}writeU1(t){(this.remainingLength()<1||1===this.remainingLength()&&this.bitPointer>=8)&&this.flush(),1&t?this.buffer[this.pointer]|=1<<7-this.bitPointer:this.buffer[this.pointer]&=~(1<<7-this.bitPointer),this.bitPointer++,8===this.bitPointer&&(this.pointer++,this.bitPointer=0)}writeU(t,e){for(let i=0;i<t;i++)this.writeU1(e>>t-i-1&1)}remainingLength(){return this.size-this.pointer}flush(){if(!this.onFlush)throw this.error=-1048574,Error("BSWriter error, flush failed because of no flush callback");if(this.pointer)if(this.bitPointer&&this.pointer>1){const t=this.onFlush(this.buffer.subarray(0,this.pointer-1));if(0!==t)throw this.error=t,Error("BSWriter error, flush failed");this.buffer[0]=this.buffer[this.pointer]}else if(0===this.bitPointer){const t=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==t)throw this.error=t,Error("BSWriter error, flush failed")}this.pointer=0}padding(){for(;0!==this.bitPointer;)this.writeU1(0)}clear(){this.pointer=0,this.bitPointer=0,this.error=0}getBuffer(){return this.buffer}getPointer(){return this.pointer}}},729:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(134),n=i(4624),a=i(50011);class s{constructor(t,e=!0){(0,r.A)(this,"data",void 0),(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"byteStart",void 0),(0,r.A)(this,"pos",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"littleEndian",void 0),this.buffer=t,this.data=t instanceof Uint8Array?new DataView(t.buffer):t.view,this.byteStart=t instanceof Uint8Array?t.byteOffset:0,this.pos=0,this.size=t.byteLength,this.littleEndian=!e}writeUint8(t){this.data.setUint8(this.pos+++this.byteStart,t)}writeUint16(t){this.data.setUint16(this.pos+this.byteStart,t,this.littleEndian),this.pos+=2}writeUint24(t){const e=3840&t,i=240&t,r=15&t;this.littleEndian?(this.writeUint8(r),this.writeUint8(i),this.writeUint8(e)):(this.writeUint8(e),this.writeUint8(i),this.writeUint8(r))}writeUint32(t){this.data.setUint32(this.pos+this.byteStart,t,this.littleEndian),this.pos+=4}writeUint64(t){const e=t&BigInt(4294967295),i=(t&BigInt(4294967295)<<BigInt(32))>>BigInt(32);this.littleEndian?(this.writeUint32(Number(e)),this.writeUint32(Number(i))):(this.writeUint32(Number(i)),this.writeUint32(Number(e)))}writeInt8(t){this.data.setInt8(this.pos+++this.byteStart,t)}writeInt16(t){this.data.setInt16(this.pos+this.byteStart,t,this.littleEndian),this.pos+=2}writeInt32(t){this.data.setInt32(this.pos+this.byteStart,t,this.littleEndian),this.pos+=4}writeInt64(t){const e=t&BigInt(4294967295),i=(t&BigInt(4294967295)<<BigInt(32))>>BigInt(32);this.littleEndian?(this.writeInt32(Number(e)),this.writeInt32(Number(i))):(this.writeInt32(Number(i)),this.writeInt32(Number(e)))}writeFloat(t){this.data.setFloat32(this.pos+this.byteStart,t,this.littleEndian),this.pos+=4}writeDouble(t){this.data.setFloat64(this.pos+this.byteStart,t,this.littleEndian),this.pos+=8}getPos(){return this.pos}seek(t){t>this.size&&(t=this.size),this.pos=Math.max(0,t)}skip(t){this.seek(this.pos+t)}back(t){this.seek(this.pos-t)}remainingSize(){return this.size-this.pos}writeBuffer(t){let e=t.length;this.remainingSize()<e&&(e=this.remainingSize(),n.R8(`the remaining buffer size is smaller then the wrote buffer, hope set ${t.length}, but set ${e}`,"src/common/io/BufferWriter.ts",211)),this.buffer.set(t,this.pos),this.pos+=t.length}writeString(t){const e=a.encode(t);return this.writeBuffer(e),e.length}getWroteBuffer(){return this.buffer.subarray(0,this.pos)}resetBuffer(t,e=!0){this.buffer=t,this.data=t instanceof Uint8Array?new DataView(t.buffer):t.view,this.byteStart=t instanceof Uint8Array?t.byteOffset:0,this.pos=0,this.size=t.byteLength,this.littleEndian=!e}}}}]);